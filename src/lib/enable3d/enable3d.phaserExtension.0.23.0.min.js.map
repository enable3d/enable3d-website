{"version":3,"file":"enable3d.phaserExtension.0.23.0.min.js","mappings":"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","sources":["webpack://ENABLE3D/webpack/universalModuleDefinition","webpack://ENABLE3D/../ammoPhysics/node_modules/@yandeu/events/cjs/index.js","webpack://ENABLE3D/../ammoPhysics/node_modules/@yandeu/events/cjs/version.js","webpack://ENABLE3D/../common/node_modules/@yandeu/events/cjs/index.js","webpack://ENABLE3D/../common/node_modules/@yandeu/events/cjs/version.js","webpack://ENABLE3D/../threeGraphics/node_modules/@yandeu/events/cjs/index.js","webpack://ENABLE3D/../threeGraphics/node_modules/@yandeu/events/cjs/version.js","webpack://ENABLE3D/external \"Matter\"","webpack://ENABLE3D/external \"Phaser\"","webpack://ENABLE3D/external \"THREE\"","webpack://ENABLE3D/webpack/bootstrap","webpack://ENABLE3D/webpack/runtime/define property getters","webpack://ENABLE3D/webpack/runtime/hasOwnProperty shorthand","webpack://ENABLE3D/webpack/runtime/make namespace object","webpack://ENABLE3D/../threeGraphics/jsm/plugins/cameras.js","webpack://ENABLE3D/../common/dist/logger.js","webpack://ENABLE3D/../common/dist/extendedObject3D.js","webpack://ENABLE3D/../common/dist/extendedMesh.js","webpack://ENABLE3D/../common/dist/extendedGroup.js","webpack://ENABLE3D/../ammoPhysics/dist/constraints.js","webpack://ENABLE3D/../ammoPhysics/dist/three-to-ammo.js","webpack://ENABLE3D/../common/dist/defaultMaterial.js","webpack://ENABLE3D/../common/dist/factories.js","webpack://ENABLE3D/../ammoPhysics/dist/collisionEvents.js","webpack://ENABLE3D/../ammoPhysics/dist/debugDrawer.js","webpack://ENABLE3D/../ammoPhysics/node_modules/three/examples/jsm/math/ConvexHull.js","webpack://ENABLE3D/../ammoPhysics/node_modules/three/examples/jsm/geometries/ConvexGeometry.js","webpack://ENABLE3D/../ammoPhysics/dist/convexObjectBreaker.js","webpack://ENABLE3D/../common/dist/wasmLoader.js","webpack://ENABLE3D/../common/dist/physicsLoader.js","webpack://ENABLE3D/../common/dist/applyMixins.js","webpack://ENABLE3D/../ammoPhysics/dist/raycaster/raycaster.js","webpack://ENABLE3D/../ammoPhysics/dist/raycaster/closestRayResultCallback.js","webpack://ENABLE3D/../ammoPhysics/dist/raycaster/allHitsRayResultCallback.js","webpack://ENABLE3D/../ammoPhysics/dist/physics.js","webpack://ENABLE3D/../ammoPhysics/dist/shapes.js","webpack://ENABLE3D/../ammoPhysics/dist/torusShape.js","webpack://ENABLE3D/../common/dist/physicsBody.js","webpack://ENABLE3D/../threeGraphics/jsm/index.js","webpack://ENABLE3D/../threeGraphics/node_modules/three/examples/jsm/libs/fflate.module.js","webpack://ENABLE3D/../threeGraphics/node_modules/three/examples/jsm/curves/NURBSUtils.js","webpack://ENABLE3D/../threeGraphics/node_modules/three/examples/jsm/curves/NURBSCurve.js","webpack://ENABLE3D/../threeGraphics/node_modules/three/examples/jsm/loaders/FBXLoader.js","webpack://ENABLE3D/../threeGraphics/node_modules/three/examples/jsm/loaders/GLTFLoader.js","webpack://ENABLE3D/../threeGraphics/node_modules/three/examples/jsm/loaders/SVGLoader.js","webpack://ENABLE3D/../threeGraphics/jsm/plugins/loaders.js","webpack://ENABLE3D/../threeGraphics/jsm/plugins/lights.js","webpack://ENABLE3D/../threeGraphics/node_modules/three/examples/jsm/deprecated/Geometry.js","webpack://ENABLE3D/../threeGraphics/jsm/csg/_directGeometry.js","webpack://ENABLE3D/../threeGraphics/jsm/csg/_fromGeometry.js","webpack://ENABLE3D/../threeGraphics/jsm/plugins/heightmap.js","webpack://ENABLE3D/../threeGraphics/node_modules/three/examples/jsm/controls/OrbitControls.js","webpack://ENABLE3D/../threeGraphics/jsm/plugins/warpSpeed.js","webpack://ENABLE3D/../threeGraphics/node_modules/three/examples/jsm/objects/Reflector.js","webpack://ENABLE3D/../threeGraphics/node_modules/three/examples/jsm/objects/Refractor.js","webpack://ENABLE3D/../threeGraphics/node_modules/three/examples/jsm/objects/Water2.js","webpack://ENABLE3D/../threeGraphics/jsm/plugins/misc.js","webpack://ENABLE3D/../threeGraphics/jsm/plugins/water.js","webpack://ENABLE3D/../threeGraphics/jsm/plugins/transform.js","webpack://ENABLE3D/../threeGraphics/node_modules/three/examples/jsm/libs/motion-controllers.module.js","webpack://ENABLE3D/../threeGraphics/node_modules/three/examples/jsm/webxr/XRControllerModelFactory.js","webpack://ENABLE3D/../threeGraphics/jsm/plugins/webxr.js","webpack://ENABLE3D/../threeGraphics/node_modules/three/examples/jsm/webxr/VRButton.js","webpack://ENABLE3D/../threeWrapper/dist/deprecated/face3.js","webpack://ENABLE3D/../threeGraphics/jsm/csg/index.js","webpack://ENABLE3D/./src/scene3d.ts","webpack://ENABLE3D/./src/third.ts","webpack://ENABLE3D/../threeGraphics/jsm/core.js","webpack://ENABLE3D/../threeGraphics/jsm/plugins/mixers.js","webpack://ENABLE3D/../threeGraphics/jsm/plugins/haveSomeFun.js","webpack://ENABLE3D/./src/enable3d.ts","webpack://ENABLE3D/../common/dist/customCanvas.js","webpack://ENABLE3D/../../node_modules/three/examples/jsm/WebGL.js","webpack://ENABLE3D/../threeGraphics/node_modules/@yandeu/tap/lib/eventMatrix.js","webpack://ENABLE3D/../threeGraphics/node_modules/@yandeu/tap/lib/index.js","webpack://ENABLE3D/../threeGraphics/node_modules/@yandeu/tap/lib/version.js","webpack://ENABLE3D/../threeGraphics/jsm/flat/_misc.js","webpack://ENABLE3D/../threeGraphics/jsm/flat/simpleSprite.js","webpack://ENABLE3D/../threeGraphics/jsm/flat/actionSprite.js","webpack://ENABLE3D/../threeGraphics/jsm/flat/spriteSheet.js","webpack://ENABLE3D/../threeGraphics/jsm/flat/button.js","webpack://ENABLE3D/../threeGraphics/jsm/flat/draw.js","webpack://ENABLE3D/../threeGraphics/jsm/flat/flat.js","webpack://ENABLE3D/../threeGraphics/jsm/flat/text.js","webpack://ENABLE3D/../threeGraphics/jsm/flat/textureAtlas.js","webpack://ENABLE3D/../threeGraphics/jsm/flat/physics/_misc.js","webpack://ENABLE3D/../threeGraphics/jsm/flat/physics/physics.js","webpack://ENABLE3D/../common/dist/misc/joystick.js","webpack://ENABLE3D/../common/dist/misc/thirdPersonControls.js","webpack://ENABLE3D/../common/dist/misc/firstPersonControls.js","webpack://ENABLE3D/../common/dist/misc/pointerLock.js","webpack://ENABLE3D/../common/dist/misc/pointerDrag.js","webpack://ENABLE3D/./node_modules/three/examples/jsm/shaders/CopyShader.js","webpack://ENABLE3D/./node_modules/three/examples/jsm/postprocessing/Pass.js","webpack://ENABLE3D/./node_modules/three/examples/jsm/postprocessing/ShaderPass.js","webpack://ENABLE3D/./node_modules/three/examples/jsm/postprocessing/MaskPass.js","webpack://ENABLE3D/./node_modules/three/examples/jsm/postprocessing/EffectComposer.js","webpack://ENABLE3D/./node_modules/three/examples/jsm/postprocessing/RenderPass.js","webpack://ENABLE3D/./node_modules/three/examples/jsm/shaders/DigitalGlitch.js","webpack://ENABLE3D/./node_modules/three/examples/jsm/postprocessing/GlitchPass.js","webpack://ENABLE3D/./node_modules/three/examples/jsm/shaders/DotScreenShader.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"THREE\"), require(\"Phaser\"), require(\"Matter\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"THREE\", \"Phaser\", \"Matter\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ENABLE3D\"] = factory(require(\"THREE\"), require(\"Phaser\"), require(\"Matter\"));\n\telse\n\t\troot[\"ENABLE3D\"] = factory(root[\"THREE\"], root[\"Phaser\"], root[\"Matter\"]);\n})(self, function(__WEBPACK_EXTERNAL_MODULE__428__, __WEBPACK_EXTERNAL_MODULE__298__, __WEBPACK_EXTERNAL_MODULE__626__) {\nreturn ","\"use strict\";\r\n/**\r\n * @package      npmjs.com/package/@yandeu/events (events.min.js)\r\n *\r\n * @author       Arnout Kazemier (https://github.com/3rd-Eden)\r\n * @copyright    Copyright (c) 2014 Arnout Kazemier\r\n * @license      {@link https://github.com/primus/eventemitter3/blob/master/LICENSE|MIT}\r\n *\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/yandeu/events\r\n * @license      {@link https://github.com/yandeu/events/blob/master/LICENSE|MIT}\r\n */\r\nvar __spreadArray = (this && this.__spreadArray) || function (to, from) {\r\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\r\n        to[j] = from[i];\r\n    return to;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.Events = void 0;\r\nvar version_1 = require(\"./version\");\r\nvar EE = /** @class */ (function () {\r\n    function EE(fn, context, once) {\r\n        if (once === void 0) { once = false; }\r\n        this.fn = fn;\r\n        this.context = context;\r\n        this.once = once;\r\n    }\r\n    return EE;\r\n}());\r\nvar addListener = function (emitter, event, fn, context, once) {\r\n    if (typeof fn !== 'function') {\r\n        throw new TypeError('The listener must be a function');\r\n    }\r\n    var listener = new EE(fn, context || emitter, once);\r\n    if (!emitter._events.has(event))\r\n        emitter._events.set(event, listener), emitter._eventsCount++;\r\n    else if (!emitter._events.get(event).fn)\r\n        emitter._events.get(event).push(listener);\r\n    else\r\n        emitter._events.set(event, [emitter._events.get(event), listener]);\r\n    return emitter;\r\n};\r\nvar clearEvent = function (emitter, event) {\r\n    if (--emitter._eventsCount === 0)\r\n        emitter._events = new Map();\r\n    else\r\n        emitter._events.delete(event);\r\n};\r\nvar Events = /** @class */ (function () {\r\n    function Events() {\r\n        this._events = new Map();\r\n        this._eventsCount = 0;\r\n    }\r\n    Object.defineProperty(Events, \"VERSION\", {\r\n        get: function () {\r\n            return version_1.VERSION;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Events.prototype.eventNames = function () {\r\n        return Array.from(this._events.keys());\r\n    };\r\n    Events.prototype.listeners = function (event) {\r\n        var handlers = this._events.get(event);\r\n        if (!handlers)\r\n            return [];\r\n        if (handlers.fn)\r\n            return [handlers.fn];\r\n        for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\r\n            ee[i] = handlers[i].fn;\r\n        }\r\n        return ee;\r\n    };\r\n    Events.prototype.listenerCount = function (event) {\r\n        var listeners = this._events.get(event);\r\n        if (!listeners)\r\n            return 0;\r\n        if (listeners.fn)\r\n            return 1;\r\n        return listeners.length;\r\n    };\r\n    Events.prototype.emit = function (event) {\r\n        var _a, _b;\r\n        var args = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            args[_i - 1] = arguments[_i];\r\n        }\r\n        if (!this._events.has(event))\r\n            return false;\r\n        var listeners = this._events.get(event);\r\n        var i;\r\n        if (listeners.fn) {\r\n            if (listeners.once)\r\n                this.removeListener(event, listeners.fn, undefined, true);\r\n            return (_a = listeners.fn).call.apply(_a, __spreadArray([listeners.context], args)), true;\r\n        }\r\n        else {\r\n            var length_1 = listeners.length;\r\n            for (i = 0; i < length_1; i++) {\r\n                if (listeners[i].once)\r\n                    this.removeListener(event, listeners[i].fn, undefined, true);\r\n                (_b = listeners[i].fn).call.apply(_b, __spreadArray([listeners[i].context], args));\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n    Events.prototype.on = function (event, fn, context) {\r\n        return addListener(this, event, fn, context, false);\r\n    };\r\n    Events.prototype.once = function (event, fn, context) {\r\n        return addListener(this, event, fn, context, true);\r\n    };\r\n    Events.prototype.removeListener = function (event, fn, context, once) {\r\n        if (!this._events.has(event))\r\n            return this;\r\n        if (!fn) {\r\n            clearEvent(this, event);\r\n            return this;\r\n        }\r\n        var listeners = this._events.get(event);\r\n        if (listeners.fn) {\r\n            if (listeners.fn === fn && (!once || listeners.once) && (!context || listeners.context === context)) {\r\n                clearEvent(this, event);\r\n            }\r\n        }\r\n        else {\r\n            for (var i = 0, events = [], length = listeners.length; i < length; i++) {\r\n                if (listeners[i].fn !== fn || (once && !listeners[i].once) || (context && listeners[i].context !== context)) {\r\n                    events.push(listeners[i]);\r\n                }\r\n            }\r\n            // Reset the array, or remove it completely if we have no more listeners.\r\n            if (events.length)\r\n                this._events.set(event, events.length === 1 ? events[0] : events);\r\n            else\r\n                clearEvent(this, event);\r\n        }\r\n        return this;\r\n    };\r\n    Events.prototype.removeAllListeners = function (event) {\r\n        if (event) {\r\n            if (this._events.delete(event))\r\n                clearEvent(this, event);\r\n        }\r\n        else {\r\n            this._events = new Map();\r\n            this._eventsCount = 0;\r\n        }\r\n        return this;\r\n    };\r\n    Object.defineProperty(Events.prototype, \"off\", {\r\n        // alias\r\n        get: function () {\r\n            return this.removeListener;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Events.prototype, \"addListener\", {\r\n        // alias\r\n        get: function () {\r\n            return this.on;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    return Events;\r\n}());\r\nexports.Events = Events;\r\n/** TESTING SECTION */\r\n// type Colors = 'red' | 'blue' | 'yellow'\r\n// interface EventMap {\r\n//   signal: () => void\r\n//   error: (err: string) => void\r\n//   something: (a: number, b: { colors?: Colors[] }, c: [number, number, string]) => void\r\n// }\r\n// const test = new Events<EventMap>()\r\n// const listener: EventListener<EventMap, 'something'> = (a, b, c) => {\r\n//   console.log(a, b.colors, c)\r\n// }\r\n// test.on('something', listener)\r\n// setTimeout(() => {\r\n//   test.removeListener('something', listener)\r\n// }, 5000)\r\n// test.once('error', err => {\r\n//   console.log('error:', err)\r\n// })\r\n// console.log(test.eventNames())\r\n// test.emit('error', 'ok')\r\n// test.emit('error', 'failed')\r\n// test.emit('something', 1234, { colors: ['blue'] }, [3, 3, 'k'])\r\n//# sourceMappingURL=index.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.VERSION = void 0;\r\n// THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY.\r\nexports.VERSION = \"0.0.5\";\r\n//# sourceMappingURL=version.js.map","\"use strict\";\r\n/**\r\n * @package      npmjs.com/package/@yandeu/events (events.min.js)\r\n *\r\n * @author       Arnout Kazemier (https://github.com/3rd-Eden)\r\n * @copyright    Copyright (c) 2014 Arnout Kazemier\r\n * @license      {@link https://github.com/primus/eventemitter3/blob/master/LICENSE|MIT}\r\n *\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/yandeu/events\r\n * @license      {@link https://github.com/yandeu/events/blob/master/LICENSE|MIT}\r\n */\r\nvar __spreadArray = (this && this.__spreadArray) || function (to, from) {\r\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\r\n        to[j] = from[i];\r\n    return to;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.Events = void 0;\r\nvar version_1 = require(\"./version\");\r\nvar EE = /** @class */ (function () {\r\n    function EE(fn, context, once) {\r\n        if (once === void 0) { once = false; }\r\n        this.fn = fn;\r\n        this.context = context;\r\n        this.once = once;\r\n    }\r\n    return EE;\r\n}());\r\nvar addListener = function (emitter, event, fn, context, once) {\r\n    if (typeof fn !== 'function') {\r\n        throw new TypeError('The listener must be a function');\r\n    }\r\n    var listener = new EE(fn, context || emitter, once);\r\n    if (!emitter._events.has(event))\r\n        emitter._events.set(event, listener), emitter._eventsCount++;\r\n    else if (!emitter._events.get(event).fn)\r\n        emitter._events.get(event).push(listener);\r\n    else\r\n        emitter._events.set(event, [emitter._events.get(event), listener]);\r\n    return emitter;\r\n};\r\nvar clearEvent = function (emitter, event) {\r\n    if (--emitter._eventsCount === 0)\r\n        emitter._events = new Map();\r\n    else\r\n        emitter._events.delete(event);\r\n};\r\nvar Events = /** @class */ (function () {\r\n    function Events() {\r\n        this._events = new Map();\r\n        this._eventsCount = 0;\r\n    }\r\n    Object.defineProperty(Events, \"VERSION\", {\r\n        get: function () {\r\n            return version_1.VERSION;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Events.prototype.eventNames = function () {\r\n        return Array.from(this._events.keys());\r\n    };\r\n    Events.prototype.listeners = function (event) {\r\n        var handlers = this._events.get(event);\r\n        if (!handlers)\r\n            return [];\r\n        if (handlers.fn)\r\n            return [handlers.fn];\r\n        for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\r\n            ee[i] = handlers[i].fn;\r\n        }\r\n        return ee;\r\n    };\r\n    Events.prototype.listenerCount = function (event) {\r\n        var listeners = this._events.get(event);\r\n        if (!listeners)\r\n            return 0;\r\n        if (listeners.fn)\r\n            return 1;\r\n        return listeners.length;\r\n    };\r\n    Events.prototype.emit = function (event) {\r\n        var _a, _b;\r\n        var args = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            args[_i - 1] = arguments[_i];\r\n        }\r\n        if (!this._events.has(event))\r\n            return false;\r\n        var listeners = this._events.get(event);\r\n        var i;\r\n        if (listeners.fn) {\r\n            if (listeners.once)\r\n                this.removeListener(event, listeners.fn, undefined, true);\r\n            return (_a = listeners.fn).call.apply(_a, __spreadArray([listeners.context], args)), true;\r\n        }\r\n        else {\r\n            var length_1 = listeners.length;\r\n            for (i = 0; i < length_1; i++) {\r\n                if (listeners[i].once)\r\n                    this.removeListener(event, listeners[i].fn, undefined, true);\r\n                (_b = listeners[i].fn).call.apply(_b, __spreadArray([listeners[i].context], args));\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n    Events.prototype.on = function (event, fn, context) {\r\n        return addListener(this, event, fn, context, false);\r\n    };\r\n    Events.prototype.once = function (event, fn, context) {\r\n        return addListener(this, event, fn, context, true);\r\n    };\r\n    Events.prototype.removeListener = function (event, fn, context, once) {\r\n        if (!this._events.has(event))\r\n            return this;\r\n        if (!fn) {\r\n            clearEvent(this, event);\r\n            return this;\r\n        }\r\n        var listeners = this._events.get(event);\r\n        if (listeners.fn) {\r\n            if (listeners.fn === fn && (!once || listeners.once) && (!context || listeners.context === context)) {\r\n                clearEvent(this, event);\r\n            }\r\n        }\r\n        else {\r\n            for (var i = 0, events = [], length = listeners.length; i < length; i++) {\r\n                if (listeners[i].fn !== fn || (once && !listeners[i].once) || (context && listeners[i].context !== context)) {\r\n                    events.push(listeners[i]);\r\n                }\r\n            }\r\n            // Reset the array, or remove it completely if we have no more listeners.\r\n            if (events.length)\r\n                this._events.set(event, events.length === 1 ? events[0] : events);\r\n            else\r\n                clearEvent(this, event);\r\n        }\r\n        return this;\r\n    };\r\n    Events.prototype.removeAllListeners = function (event) {\r\n        if (event) {\r\n            if (this._events.delete(event))\r\n                clearEvent(this, event);\r\n        }\r\n        else {\r\n            this._events = new Map();\r\n            this._eventsCount = 0;\r\n        }\r\n        return this;\r\n    };\r\n    Object.defineProperty(Events.prototype, \"off\", {\r\n        // alias\r\n        get: function () {\r\n            return this.removeListener;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Events.prototype, \"addListener\", {\r\n        // alias\r\n        get: function () {\r\n            return this.on;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    return Events;\r\n}());\r\nexports.Events = Events;\r\n/** TESTING SECTION */\r\n// type Colors = 'red' | 'blue' | 'yellow'\r\n// interface EventMap {\r\n//   signal: () => void\r\n//   error: (err: string) => void\r\n//   something: (a: number, b: { colors?: Colors[] }, c: [number, number, string]) => void\r\n// }\r\n// const test = new Events<EventMap>()\r\n// const listener: EventListener<EventMap, 'something'> = (a, b, c) => {\r\n//   console.log(a, b.colors, c)\r\n// }\r\n// test.on('something', listener)\r\n// setTimeout(() => {\r\n//   test.removeListener('something', listener)\r\n// }, 5000)\r\n// test.once('error', err => {\r\n//   console.log('error:', err)\r\n// })\r\n// console.log(test.eventNames())\r\n// test.emit('error', 'ok')\r\n// test.emit('error', 'failed')\r\n// test.emit('something', 1234, { colors: ['blue'] }, [3, 3, 'k'])\r\n//# sourceMappingURL=index.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.VERSION = void 0;\r\n// THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY.\r\nexports.VERSION = \"0.0.5\";\r\n//# sourceMappingURL=version.js.map","\"use strict\";\r\n/**\r\n * @package      npmjs.com/package/@yandeu/events (events.min.js)\r\n *\r\n * @author       Arnout Kazemier (https://github.com/3rd-Eden)\r\n * @copyright    Copyright (c) 2014 Arnout Kazemier\r\n * @license      {@link https://github.com/primus/eventemitter3/blob/master/LICENSE|MIT}\r\n *\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/yandeu/events\r\n * @license      {@link https://github.com/yandeu/events/blob/master/LICENSE|MIT}\r\n */\r\nvar __spreadArray = (this && this.__spreadArray) || function (to, from) {\r\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\r\n        to[j] = from[i];\r\n    return to;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.Events = void 0;\r\nvar version_1 = require(\"./version\");\r\nvar EE = /** @class */ (function () {\r\n    function EE(fn, context, once) {\r\n        if (once === void 0) { once = false; }\r\n        this.fn = fn;\r\n        this.context = context;\r\n        this.once = once;\r\n    }\r\n    return EE;\r\n}());\r\nvar addListener = function (emitter, event, fn, context, once) {\r\n    if (typeof fn !== 'function') {\r\n        throw new TypeError('The listener must be a function');\r\n    }\r\n    var listener = new EE(fn, context || emitter, once);\r\n    if (!emitter._events.has(event))\r\n        emitter._events.set(event, listener), emitter._eventsCount++;\r\n    else if (!emitter._events.get(event).fn)\r\n        emitter._events.get(event).push(listener);\r\n    else\r\n        emitter._events.set(event, [emitter._events.get(event), listener]);\r\n    return emitter;\r\n};\r\nvar clearEvent = function (emitter, event) {\r\n    if (--emitter._eventsCount === 0)\r\n        emitter._events = new Map();\r\n    else\r\n        emitter._events.delete(event);\r\n};\r\nvar Events = /** @class */ (function () {\r\n    function Events() {\r\n        this._events = new Map();\r\n        this._eventsCount = 0;\r\n    }\r\n    Object.defineProperty(Events, \"VERSION\", {\r\n        get: function () {\r\n            return version_1.VERSION;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Events.prototype.eventNames = function () {\r\n        return Array.from(this._events.keys());\r\n    };\r\n    Events.prototype.listeners = function (event) {\r\n        var handlers = this._events.get(event);\r\n        if (!handlers)\r\n            return [];\r\n        if (handlers.fn)\r\n            return [handlers.fn];\r\n        for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\r\n            ee[i] = handlers[i].fn;\r\n        }\r\n        return ee;\r\n    };\r\n    Events.prototype.listenerCount = function (event) {\r\n        var listeners = this._events.get(event);\r\n        if (!listeners)\r\n            return 0;\r\n        if (listeners.fn)\r\n            return 1;\r\n        return listeners.length;\r\n    };\r\n    Events.prototype.emit = function (event) {\r\n        var _a, _b;\r\n        var args = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            args[_i - 1] = arguments[_i];\r\n        }\r\n        if (!this._events.has(event))\r\n            return false;\r\n        var listeners = this._events.get(event);\r\n        var i;\r\n        if (listeners.fn) {\r\n            if (listeners.once)\r\n                this.removeListener(event, listeners.fn, undefined, true);\r\n            return (_a = listeners.fn).call.apply(_a, __spreadArray([listeners.context], args)), true;\r\n        }\r\n        else {\r\n            var length_1 = listeners.length;\r\n            for (i = 0; i < length_1; i++) {\r\n                if (listeners[i].once)\r\n                    this.removeListener(event, listeners[i].fn, undefined, true);\r\n                (_b = listeners[i].fn).call.apply(_b, __spreadArray([listeners[i].context], args));\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n    Events.prototype.on = function (event, fn, context) {\r\n        return addListener(this, event, fn, context, false);\r\n    };\r\n    Events.prototype.once = function (event, fn, context) {\r\n        return addListener(this, event, fn, context, true);\r\n    };\r\n    Events.prototype.removeListener = function (event, fn, context, once) {\r\n        if (!this._events.has(event))\r\n            return this;\r\n        if (!fn) {\r\n            clearEvent(this, event);\r\n            return this;\r\n        }\r\n        var listeners = this._events.get(event);\r\n        if (listeners.fn) {\r\n            if (listeners.fn === fn && (!once || listeners.once) && (!context || listeners.context === context)) {\r\n                clearEvent(this, event);\r\n            }\r\n        }\r\n        else {\r\n            for (var i = 0, events = [], length = listeners.length; i < length; i++) {\r\n                if (listeners[i].fn !== fn || (once && !listeners[i].once) || (context && listeners[i].context !== context)) {\r\n                    events.push(listeners[i]);\r\n                }\r\n            }\r\n            // Reset the array, or remove it completely if we have no more listeners.\r\n            if (events.length)\r\n                this._events.set(event, events.length === 1 ? events[0] : events);\r\n            else\r\n                clearEvent(this, event);\r\n        }\r\n        return this;\r\n    };\r\n    Events.prototype.removeAllListeners = function (event) {\r\n        if (event) {\r\n            if (this._events.delete(event))\r\n                clearEvent(this, event);\r\n        }\r\n        else {\r\n            this._events = new Map();\r\n            this._eventsCount = 0;\r\n        }\r\n        return this;\r\n    };\r\n    Object.defineProperty(Events.prototype, \"off\", {\r\n        // alias\r\n        get: function () {\r\n            return this.removeListener;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Events.prototype, \"addListener\", {\r\n        // alias\r\n        get: function () {\r\n            return this.on;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    return Events;\r\n}());\r\nexports.Events = Events;\r\n/** TESTING SECTION */\r\n// type Colors = 'red' | 'blue' | 'yellow'\r\n// interface EventMap {\r\n//   signal: () => void\r\n//   error: (err: string) => void\r\n//   something: (a: number, b: { colors?: Colors[] }, c: [number, number, string]) => void\r\n// }\r\n// const test = new Events<EventMap>()\r\n// const listener: EventListener<EventMap, 'something'> = (a, b, c) => {\r\n//   console.log(a, b.colors, c)\r\n// }\r\n// test.on('something', listener)\r\n// setTimeout(() => {\r\n//   test.removeListener('something', listener)\r\n// }, 5000)\r\n// test.once('error', err => {\r\n//   console.log('error:', err)\r\n// })\r\n// console.log(test.eventNames())\r\n// test.emit('error', 'ok')\r\n// test.emit('error', 'failed')\r\n// test.emit('something', 1234, { colors: ['blue'] }, [3, 3, 'k'])\r\n//# sourceMappingURL=index.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.VERSION = void 0;\r\n// THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY.\r\nexports.VERSION = \"0.0.5\";\r\n//# sourceMappingURL=version.js.map","module.exports = __WEBPACK_EXTERNAL_MODULE__626__;","module.exports = __WEBPACK_EXTERNAL_MODULE__298__;","module.exports = __WEBPACK_EXTERNAL_MODULE__428__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\nimport { OrthographicCamera, PerspectiveCamera } from 'three';\r\nexport default class Cameras {\r\n    perspectiveCamera(config = {}) {\r\n        return Cameras.Perspective(config);\r\n    }\r\n    orthographicCamera(config = {}) {\r\n        return Cameras.Orthographic(config);\r\n    }\r\n    static Perspective(config = {}) {\r\n        // for phaser\r\n        // aspect = scene.scale.gameSize.aspectRatio\r\n        const { fov = 50, aspect = window.innerWidth / window.innerHeight, near = 0.1, far = 2000, x = 0, y = 5, z = 25 } = config;\r\n        const camera = new PerspectiveCamera(fov, aspect, near, far);\r\n        camera.position.set(x, y, z);\r\n        return camera;\r\n    }\r\n    static Orthographic(config = {}) {\r\n        // for phaser\r\n        // const { width, height } = scene.cameras.main\r\n        const width = window.innerWidth;\r\n        const height = window.innerHeight;\r\n        const { left = width / -2, right = width / 2, top = height / 2, bottom = height / -2, near = 1, far = 1000, x = 0, y = 0, z = 10 } = config;\r\n        const camera = new OrthographicCamera(left, right, top, bottom, near, far);\r\n        camera.position.set(x, y, z);\r\n        return camera;\r\n    }\r\n}\r\n//# sourceMappingURL=cameras.js.map","const loggerCache = new Map();\r\nconst LOG_LIMIT = 5;\r\nexport const logger = (msg, error = false) => {\r\n    if (!loggerCache.has(msg)) {\r\n        loggerCache.set(msg, 1);\r\n    }\r\n    else {\r\n        const count = loggerCache.get(msg);\r\n        if (typeof count === 'undefined')\r\n            return;\r\n        if (count >= LOG_LIMIT)\r\n            return;\r\n        loggerCache.set(msg, count + 1);\r\n    }\r\n    if (error)\r\n        console.error(`%c [enable3d] ${msg} `, 'background: #222; color: #bada55');\r\n    else\r\n        console.warn(`%c [enable3d] ${msg} `, 'background: #222; color: #bada55');\r\n};\r\n//# sourceMappingURL=logger.js.map","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\nimport { AnimationMixer, LoopOnce, Object3D, Vector3 } from 'three';\r\nimport { logger } from './logger';\r\nexport class ExtendedObject3D extends Object3D {\r\n    constructor() {\r\n        super();\r\n        this.isExtendedObject3D = true;\r\n        this.isGroup = false;\r\n        this.vector3 = new Vector3();\r\n        this.hasBody = false;\r\n        // convex object breaking\r\n        this.fragmentDepth = 0;\r\n        this.breakable = false;\r\n        this.fractureImpulse = 1;\r\n        this._currentAnimation = '';\r\n        this._animationActions = new Map();\r\n        this.name = `object-${this.id}`;\r\n    }\r\n    /** Returns all values relative to the world. */\r\n    get world() {\r\n        return {\r\n            theta: this.worldTheta,\r\n            phi: this.worldPhi\r\n        };\r\n    }\r\n    /** Get the theta relative to the world. */\r\n    get worldTheta() {\r\n        this.getWorldDirection(this.vector3);\r\n        return Math.atan2(this.vector3.x, this.vector3.z);\r\n    }\r\n    /** Get the phi relative to the world. */\r\n    get worldPhi() {\r\n        this.getWorldDirection(this.vector3);\r\n        return Math.acos(this.vector3.y);\r\n    }\r\n    set animationMixer(animationMixer) {\r\n        this._animationMixer = animationMixer;\r\n    }\r\n    get animationMixer() {\r\n        if (!this._animationMixer)\r\n            this._animationMixer = new AnimationMixer(this);\r\n        return this._animationMixer;\r\n    }\r\n    /** Control your animations. */\r\n    get anims() {\r\n        return {\r\n            /** Get the name of the current animation. */\r\n            current: this._currentAnimation,\r\n            /** Add animation name and the AnimationClip. */\r\n            add: (name, animation) => this._animsAdd(name, animation),\r\n            /** Get AnimationAction by animation name. */\r\n            get: (name) => this._animsGet(name),\r\n            /**\r\n             * Play an animation.\r\n             * @param name Animation name.\r\n             * @param transitionDuration Transition duration in ms.\r\n             * @param loop Should the animation loop?\r\n             */\r\n            play: (name, transitionDuration = 500, loop = true) => this._animsPlay(name, transitionDuration, loop),\r\n            /** Get the AnimationMixer */\r\n            mixer: this.animationMixer\r\n        };\r\n    }\r\n    /** @deprecated Please use anims instead! */\r\n    get animation() {\r\n        logger('Please use \"anims\" instead of \"animation\"');\r\n        return this.anims;\r\n    }\r\n    _animsAdd(name, animation) {\r\n        this._animationActions.set(name, this.animationMixer.clipAction(animation));\r\n    }\r\n    _animsGet(name) {\r\n        const action = this._animationActions.get(name);\r\n        if (!action)\r\n            logger(`Animation(${name}) not found!`);\r\n        return action;\r\n    }\r\n    _animsPlay(name, transitionDuration = 500, loop = true) {\r\n        const next = this._animationActions.get(name);\r\n        const current = this._animationActions.get(this._currentAnimation);\r\n        if (next) {\r\n            next.reset();\r\n            if (current) {\r\n                next.crossFadeFrom(current, transitionDuration / 1000, true);\r\n                next.clampWhenFinished = true;\r\n            }\r\n            if (!loop)\r\n                next.setLoop(LoopOnce, 0);\r\n            next.play();\r\n        }\r\n        this._currentAnimation = name;\r\n    }\r\n    /** @deprecated Use animation.play(name) instead! */\r\n    setAction(name) {\r\n        logger(`setAction(${name}) is deprecated. Use animation.play(${name}) instead!`);\r\n    }\r\n    traverse(callback) {\r\n        super.traverse(callback);\r\n    }\r\n    traverseVisible(callback) {\r\n        super.traverseVisible(callback);\r\n    }\r\n    traverseAncestors(callback) {\r\n        super.traverseAncestors(callback);\r\n    }\r\n}\r\nexport default ExtendedObject3D;\r\n//# sourceMappingURL=extendedObject3D.js.map","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\nimport { Mesh, Vector3 } from 'three';\r\nexport class ExtendedMesh extends Mesh {\r\n    constructor(geometry, material) {\r\n        super(geometry, material);\r\n        this.isExtendedMesh = true;\r\n        this.isGroup = false;\r\n        this.vector3 = new Vector3();\r\n        this.hasBody = false;\r\n        // convex object breaking\r\n        this.fragmentDepth = 0;\r\n        this.breakable = false;\r\n        this.fractureImpulse = 1;\r\n        this.name = `object-${this.id}`;\r\n    }\r\n    /** Returns all values relative to the world. */\r\n    get world() {\r\n        return {\r\n            theta: this.worldTheta,\r\n            phi: this.worldPhi\r\n        };\r\n    }\r\n    /** Get the theta relative to the world. */\r\n    get worldTheta() {\r\n        this.getWorldDirection(this.vector3);\r\n        return Math.atan2(this.vector3.x, this.vector3.z);\r\n    }\r\n    /** Get the phi relative to the world. */\r\n    get worldPhi() {\r\n        this.getWorldDirection(this.vector3);\r\n        return Math.acos(this.vector3.y);\r\n    }\r\n}\r\n//# sourceMappingURL=extendedMesh.js.map","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\nimport { Group } from 'three';\r\nexport class ExtendedGroup extends Group {\r\n    constructor() {\r\n        super();\r\n        this.isExtendedGroup = true;\r\n        this.isMesh = false;\r\n        this.hasBody = false;\r\n        // convex object breaking\r\n        this.fragmentDepth = 0;\r\n        this.breakable = false;\r\n        this.fractureImpulse = 1;\r\n        this.name = `object-${this.id}`;\r\n    }\r\n}\r\n//# sourceMappingURL=extendedGroup.js.map","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\nexport default class Constraints {\r\n    constructor(worldTransform, physicsWorld) {\r\n        this.worldTransform = worldTransform;\r\n        this.physicsWorld = physicsWorld;\r\n        this.tmpBtVector3 = new Ammo.btVector3();\r\n    }\r\n    toAmmoV3(v, d = 0) {\r\n        return new Ammo.btVector3(typeof (v === null || v === void 0 ? void 0 : v.x) !== 'undefined' ? v.x : d, typeof (v === null || v === void 0 ? void 0 : v.y) !== 'undefined' ? v.y : d, typeof (v === null || v === void 0 ? void 0 : v.z) !== 'undefined' ? v.z : d);\r\n    }\r\n    get addConstraints() {\r\n        return {\r\n            lock: (bodyA, bodyB, disableCollisionsBetweenLinkedBodies) => this.lock(bodyA, bodyB, disableCollisionsBetweenLinkedBodies),\r\n            fixed: (bodyA, bodyB, disableCollisionsBetweenLinkedBodies) => this.fixed(bodyA, bodyB, disableCollisionsBetweenLinkedBodies),\r\n            pointToPoint: (bodyA, bodyB, config, disableCollisionsBetweenLinkedBodies) => this.pointToPoint(bodyA, bodyB, config, disableCollisionsBetweenLinkedBodies),\r\n            hinge: (bodyA, bodyB, config, disableCollisionsBetweenLinkedBodies) => this.hinge(bodyA, bodyB, config, disableCollisionsBetweenLinkedBodies),\r\n            slider: (bodyA, bodyB, config = {}, disableCollisionsBetweenLinkedBodies) => this.slider(bodyA, bodyB, config, disableCollisionsBetweenLinkedBodies),\r\n            spring: (bodyA, bodyB, config = {}, disableCollisionsBetweenLinkedBodies) => this.spring(bodyA, bodyB, config, disableCollisionsBetweenLinkedBodies),\r\n            coneTwist: (bodyA, bodyB, config = { frameA: {}, frameB: {} }, disableCollisionsBetweenLinkedBodies) => this.coneTwist(bodyA, bodyB, config, disableCollisionsBetweenLinkedBodies),\r\n            dof: (bodyA, bodyB, config, disableCollisionsBetweenLinkedBodies) => this.dof(bodyA, bodyB, config, disableCollisionsBetweenLinkedBodies)\r\n        };\r\n    }\r\n    getTransform(bodyA, bodyB, offset = { x: 0, y: 0, z: 0 }, center = false) {\r\n        // @ts-ignore\r\n        offset = Object.assign({ x: 0, y: 0, z: 0 }, offset);\r\n        const centerVector = (v1, v2) => {\r\n            var dx = (v1.x() - v2.x()) / 2 + offset.x;\r\n            var dy = (v1.y() - v2.y()) / 2 + offset.y;\r\n            var dz = (v1.z() - v2.z()) / 2 + offset.z;\r\n            return new Ammo.btVector3(dx, dy, dz);\r\n        };\r\n        const transformB = new Ammo.btTransform();\r\n        transformB.setIdentity();\r\n        if (!center) {\r\n            // offset\r\n            transformB.setOrigin(new Ammo.btVector3(offset.x, offset.y, offset.z));\r\n            const transformA = bodyA.getCenterOfMassTransform().inverse().op_mul(bodyB.getWorldTransform()).op_mul(transformB);\r\n            return { transformA: transformA, transformB: transformB };\r\n        }\r\n        else {\r\n            const center = centerVector(bodyA.getWorldTransform().getOrigin(), bodyB.getWorldTransform().getOrigin());\r\n            const transformB = new Ammo.btTransform();\r\n            transformB.setIdentity();\r\n            transformB.setOrigin(center);\r\n            const transformA = bodyA.getCenterOfMassTransform().inverse().op_mul(bodyB.getWorldTransform());\r\n            transformA.op_mul(transformB);\r\n            return { transformA: transformA, transformB: transformB };\r\n        }\r\n    }\r\n    lock(bodyA, bodyB, disableCollisionsBetweenLinkedBodies = true) {\r\n        const zero = { x: 0, y: 0, z: 0 };\r\n        return this.dof(bodyA, bodyB, { angularLowerLimit: zero, angularUpperLimit: zero }, disableCollisionsBetweenLinkedBodies);\r\n    }\r\n    fixed(bodyA, bodyB, disableCollisionsBetweenLinkedBodies = true) {\r\n        const transform = this.getTransform(bodyA.ammo, bodyB.ammo);\r\n        transform.transformA.setRotation(bodyA.ammo.getWorldTransform().getRotation());\r\n        transform.transformB.setRotation(bodyB.ammo.getWorldTransform().getRotation());\r\n        const constraint = new Ammo.btFixedConstraint(bodyA.ammo, bodyB.ammo, transform.transformA, transform.transformB);\r\n        this.physicsWorld.addConstraint(constraint, disableCollisionsBetweenLinkedBodies);\r\n        return constraint;\r\n    }\r\n    pointToPoint(bodyA, bodyB, config = {}, disableCollisionsBetweenLinkedBodies = true) {\r\n        const { pivotA, pivotB } = config;\r\n        const pivotV3 = new Ammo.btVector3((pivotA === null || pivotA === void 0 ? void 0 : pivotA.x) || 0, (pivotA === null || pivotA === void 0 ? void 0 : pivotA.y) || 0, (pivotA === null || pivotA === void 0 ? void 0 : pivotA.z) || 0);\r\n        const targetPivotV3 = new Ammo.btVector3((pivotB === null || pivotB === void 0 ? void 0 : pivotB.x) || 0, (pivotB === null || pivotB === void 0 ? void 0 : pivotB.y) || 0, (pivotB === null || pivotB === void 0 ? void 0 : pivotB.z) || 0);\r\n        const constraint = new Ammo.btPoint2PointConstraint(bodyA.ammo, bodyB.ammo, pivotV3, targetPivotV3);\r\n        this.physicsWorld.addConstraint(constraint, disableCollisionsBetweenLinkedBodies);\r\n        return constraint;\r\n    }\r\n    hinge(bodyA, bodyB, config = {}, disableCollisionsBetweenLinkedBodies = true) {\r\n        const { pivotA, pivotB, axisA, axisB } = config;\r\n        const pivotV3 = new Ammo.btVector3((pivotA === null || pivotA === void 0 ? void 0 : pivotA.x) || 0, (pivotA === null || pivotA === void 0 ? void 0 : pivotA.y) || 0, (pivotA === null || pivotA === void 0 ? void 0 : pivotA.z) || 0);\r\n        const targetPivotV3 = new Ammo.btVector3((pivotB === null || pivotB === void 0 ? void 0 : pivotB.x) || 0, (pivotB === null || pivotB === void 0 ? void 0 : pivotB.y) || 0, (pivotB === null || pivotB === void 0 ? void 0 : pivotB.z) || 0);\r\n        const axisV3 = new Ammo.btVector3((axisA === null || axisA === void 0 ? void 0 : axisA.x) || 0, (axisA === null || axisA === void 0 ? void 0 : axisA.y) || 0, (axisA === null || axisA === void 0 ? void 0 : axisA.z) || 0);\r\n        const targetAxisV3 = new Ammo.btVector3((axisB === null || axisB === void 0 ? void 0 : axisB.x) || 0, (axisB === null || axisB === void 0 ? void 0 : axisB.y) || 0, (axisB === null || axisB === void 0 ? void 0 : axisB.z) || 0);\r\n        const constraint = new Ammo.btHingeConstraint(bodyA.ammo, bodyB.ammo, pivotV3, targetPivotV3, axisV3, targetAxisV3, true);\r\n        this.physicsWorld.addConstraint(constraint, disableCollisionsBetweenLinkedBodies);\r\n        return constraint;\r\n    }\r\n    // https://pybullet.org/Bullet/phpBB3/viewtopic.php?f=9&t=12690&p=42152&hilit=btSliderConstraint#p42152\r\n    slider(bodyA, bodyB, config = {}, disableCollisionsBetweenLinkedBodies = true) {\r\n        const transform = this.getTransform(bodyA.ammo, bodyB.ammo);\r\n        const { frameA = {}, frameB = {}, linearLowerLimit: lll = 0, linearUpperLimit: lul = 0, angularLowerLimit: all = 0, angularUpperLimit: aul = 0 } = config;\r\n        const rotationA = transform.transformA.getRotation();\r\n        rotationA.setEulerZYX(frameA.x || 0, frameA.y || 0, frameA.z || 0);\r\n        transform.transformA.setRotation(rotationA);\r\n        const rotationB = transform.transformB.getRotation();\r\n        rotationB.setEulerZYX(frameB.x || 0, frameB.y || 0, frameB.z || 0);\r\n        transform.transformB.setRotation(rotationB);\r\n        const constraint = new Ammo.btSliderConstraint(bodyA.ammo, bodyB.ammo, transform.transformA, transform.transformB, true);\r\n        constraint.setLowerLinLimit(lll);\r\n        constraint.setUpperLinLimit(lul);\r\n        constraint.setLowerAngLimit(all);\r\n        constraint.setUpperAngLimit(aul);\r\n        this.physicsWorld.addConstraint(constraint, disableCollisionsBetweenLinkedBodies);\r\n        return constraint;\r\n    }\r\n    spring(bodyA, bodyB, config = {}, disableCollisionsBetweenLinkedBodies = true) {\r\n        const { stiffness = 50, damping = 0.01, angularLock = false, linearLowerLimit: lll = {}, linearUpperLimit: lul = {}, angularLowerLimit: all = {}, angularUpperLimit: aul = {}, offset = {}, center = false, enableSpring = true } = config;\r\n        const off = Object.assign({ x: 0, y: 0, z: 0 }, offset);\r\n        const transform = this.getTransform(bodyA.ammo, bodyB.ammo, off, center);\r\n        const constraint = new Ammo.btGeneric6DofSpringConstraint(bodyA.ammo, bodyB.ammo, transform.transformA, transform.transformB, true);\r\n        this.tmpBtVector3.setValue(lll.x || 0, lll.y || 0, lll.z || 0);\r\n        constraint.setLinearLowerLimit(this.tmpBtVector3);\r\n        this.tmpBtVector3.setValue(lul.x || 0, lul.y || 0, lul.z || 0);\r\n        constraint.setLinearUpperLimit(this.tmpBtVector3);\r\n        if (angularLock) {\r\n            this.tmpBtVector3.setValue(0, 0, 0);\r\n            constraint.setAngularLowerLimit(this.tmpBtVector3);\r\n            constraint.setAngularUpperLimit(this.tmpBtVector3);\r\n        }\r\n        else {\r\n            console.log(all, aul);\r\n            constraint.setAngularLowerLimit(this.toAmmoV3(all, -Math.PI));\r\n            constraint.setAngularUpperLimit(this.toAmmoV3(aul, Math.PI));\r\n        }\r\n        for (let i = 0; i < 3; i++) {\r\n            constraint.enableSpring(i, enableSpring);\r\n            constraint.setStiffness(i, stiffness);\r\n            constraint.setDamping(i, damping);\r\n        }\r\n        // I have no idea what setEquilibriumPoint does :/\r\n        // constraint.setEquilibriumPoint()\r\n        this.physicsWorld.addConstraint(constraint, disableCollisionsBetweenLinkedBodies);\r\n        return constraint;\r\n    }\r\n    coneTwist(bodyA, bodyB, config, disableCollisionsBetweenLinkedBodies = true) {\r\n        const { frameA, frameB } = config;\r\n        const rbAFrame = new Ammo.btTransform();\r\n        rbAFrame.setIdentity();\r\n        rbAFrame.getOrigin().setValue((frameA === null || frameA === void 0 ? void 0 : frameA.x) || 0, (frameA === null || frameA === void 0 ? void 0 : frameA.y) || 0, (frameA === null || frameA === void 0 ? void 0 : frameA.z) || 0);\r\n        const rbBFrame = new Ammo.btTransform();\r\n        rbBFrame.setIdentity();\r\n        rbBFrame.getOrigin().setValue((frameB === null || frameB === void 0 ? void 0 : frameB.x) || 0, (frameB === null || frameB === void 0 ? void 0 : frameB.y) || 0, (frameB === null || frameB === void 0 ? void 0 : frameB.z) || 0);\r\n        const t = this.getTransform(bodyA.ammo, bodyB.ammo);\r\n        const constraint = new Ammo.btConeTwistConstraint(bodyB.ammo, bodyA.ammo, rbAFrame, rbBFrame);\r\n        // does not work at all :/\r\n        // constraint.setLimit(-Math.PI / 50, Math.PI / 50)\r\n        constraint.setAngularOnly(true);\r\n        this.physicsWorld.addConstraint(constraint, disableCollisionsBetweenLinkedBodies);\r\n        return constraint;\r\n    }\r\n    dof(bodyA, bodyB, config = {}, disableCollisionsBetweenLinkedBodies = true) {\r\n        const { offset, center = false } = config;\r\n        const off = Object.assign({ x: 0, y: 0, z: 0 }, offset);\r\n        const transform = this.getTransform(bodyA.ammo, bodyB.ammo, off, center);\r\n        const constraint = new Ammo.btGeneric6DofConstraint(bodyA.ammo, bodyB.ammo, transform.transformA, transform.transformB, true);\r\n        const { linearLowerLimit, linearUpperLimit, angularLowerLimit, angularUpperLimit } = config;\r\n        const lll = this.toAmmoV3(linearLowerLimit);\r\n        const lul = this.toAmmoV3(linearUpperLimit);\r\n        const all = this.toAmmoV3(angularLowerLimit, -Math.PI);\r\n        const aul = this.toAmmoV3(angularUpperLimit, Math.PI);\r\n        constraint.setLinearLowerLimit(lll);\r\n        constraint.setLinearUpperLimit(lul);\r\n        constraint.setAngularLowerLimit(all);\r\n        constraint.setAngularUpperLimit(aul);\r\n        Ammo.destroy(lll);\r\n        Ammo.destroy(lul);\r\n        Ammo.destroy(all);\r\n        Ammo.destroy(aul);\r\n        this.physicsWorld.addConstraint(constraint, disableCollisionsBetweenLinkedBodies);\r\n        return constraint;\r\n    }\r\n}\r\n//# sourceMappingURL=constraints.js.map","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @description  This is a modified version of the original code from Kevin Lee\r\n * (Includes latest three-to-ammo commit from August 6, 2020)\r\n */\r\n/**\r\n * @author       Kevin Lee (https://github.com/InfiniteLee)\r\n * @copyright    Copyright (c) 2020 Kevin Lee; Project Url: https://github.com/InfiniteLee/three-to-ammo\r\n * @license      {@link https://github.com/InfiniteLee/three-to-ammo/blob/master/LICENSE|MPL-2.0}\r\n */\r\nimport { Vector3, Matrix4, Quaternion, Box3, REVISION } from 'three';\r\n('use strict');\r\n/* global Ammo */\r\nexport const TYPE = {\r\n    BOX: 'box',\r\n    CYLINDER: 'cylinder',\r\n    SPHERE: 'sphere',\r\n    CAPSULE: 'capsule',\r\n    CONE: 'cone',\r\n    HULL: 'hull',\r\n    HACD: 'hacd',\r\n    VHACD: 'vhacd',\r\n    MESH: 'mesh',\r\n    HEIGHTFIELD: 'heightfield'\r\n};\r\nexport const FIT = {\r\n    ALL: 'all',\r\n    MANUAL: 'manual' //A single shape is sized manually. Requires halfExtents or sphereRadius.\r\n};\r\nexport const HEIGHTFIELD_DATA_TYPE = {\r\n    short: 'short',\r\n    float: 'float'\r\n};\r\nexport const createCollisionShapes = function (vertices, matrices, indexes, matrixWorld, options = {}) {\r\n    switch (options.type) {\r\n        case TYPE.BOX:\r\n            return [createBoxShape(vertices, matrices, matrixWorld, options)];\r\n        case TYPE.CYLINDER:\r\n            return [createCylinderShape(vertices, matrices, matrixWorld, options)];\r\n        case TYPE.CAPSULE:\r\n            return [createCapsuleShape(vertices, matrices, matrixWorld, options)];\r\n        case TYPE.CONE:\r\n            return [createConeShape(vertices, matrices, matrixWorld, options)];\r\n        case TYPE.SPHERE:\r\n            return [createSphereShape(vertices, matrices, matrixWorld, options)];\r\n        case TYPE.HULL:\r\n            return [createHullShape(vertices, matrices, matrixWorld, options)];\r\n        case TYPE.HACD:\r\n            return createHACDShapes(vertices, matrices, indexes, matrixWorld, options);\r\n        case TYPE.VHACD:\r\n            return createVHACDShapes(vertices, matrices, indexes, matrixWorld, options);\r\n        case TYPE.MESH:\r\n            return [createTriMeshShape(vertices, matrices, indexes, matrixWorld, options)];\r\n        case TYPE.HEIGHTFIELD:\r\n            return [createHeightfieldTerrainShape(options)];\r\n        default:\r\n            console.warn(options.type + ' is not currently supported');\r\n            return [];\r\n    }\r\n};\r\n//TODO: support gimpact (dynamic trimesh) and heightmap\r\nexport const createBoxShape = function (vertices, matrices, matrixWorld, options = {}) {\r\n    options.type = TYPE.BOX;\r\n    _setOptions(options);\r\n    if (options.fit === FIT.ALL) {\r\n        options.halfExtents = _computeHalfExtents(_computeBounds(vertices, matrices), options.minHalfExtent, options.maxHalfExtent);\r\n    }\r\n    const btHalfExtents = new Ammo.btVector3(options.halfExtents.x, options.halfExtents.y, options.halfExtents.z);\r\n    const collisionShape = new Ammo.btBoxShape(btHalfExtents);\r\n    Ammo.destroy(btHalfExtents);\r\n    _finishCollisionShape(collisionShape, options, _computeScale(matrixWorld, options));\r\n    return collisionShape;\r\n};\r\nexport const createCylinderShape = function (vertices, matrices, matrixWorld, options = {}) {\r\n    options.type = TYPE.CYLINDER;\r\n    _setOptions(options);\r\n    if (options.fit === FIT.ALL) {\r\n        options.halfExtents = _computeHalfExtents(_computeBounds(vertices, matrices), options.minHalfExtent, options.maxHalfExtent);\r\n    }\r\n    const btHalfExtents = new Ammo.btVector3(options.halfExtents.x, options.halfExtents.y, options.halfExtents.z);\r\n    const collisionShape = (() => {\r\n        switch (options.cylinderAxis) {\r\n            case 'y':\r\n                return new Ammo.btCylinderShape(btHalfExtents);\r\n            case 'x':\r\n                return new Ammo.btCylinderShapeX(btHalfExtents);\r\n            case 'z':\r\n                return new Ammo.btCylinderShapeZ(btHalfExtents);\r\n        }\r\n        return null;\r\n    })();\r\n    Ammo.destroy(btHalfExtents);\r\n    _finishCollisionShape(collisionShape, options, _computeScale(matrixWorld, options));\r\n    return collisionShape;\r\n};\r\nexport const createCapsuleShape = function (vertices, matrices, matrixWorld, options = {}) {\r\n    options.type = TYPE.CAPSULE;\r\n    _setOptions(options);\r\n    if (options.fit === FIT.ALL) {\r\n        options.halfExtents = _computeHalfExtents(_computeBounds(vertices, matrices), options.minHalfExtent, options.maxHalfExtent);\r\n    }\r\n    const { x, y, z } = options.halfExtents;\r\n    const collisionShape = (() => {\r\n        switch (options.cylinderAxis) {\r\n            case 'y':\r\n                return new Ammo.btCapsuleShape(Math.max(x, z), y * 2);\r\n            case 'x':\r\n                return new Ammo.btCapsuleShapeX(Math.max(y, z), x * 2);\r\n            case 'z':\r\n                return new Ammo.btCapsuleShapeZ(Math.max(x, y), z * 2);\r\n        }\r\n        return null;\r\n    })();\r\n    _finishCollisionShape(collisionShape, options, _computeScale(matrixWorld, options));\r\n    return collisionShape;\r\n};\r\nexport const createConeShape = function (vertices, matrices, matrixWorld, options = {}) {\r\n    options.type = TYPE.CONE;\r\n    _setOptions(options);\r\n    if (options.fit === FIT.ALL) {\r\n        options.halfExtents = _computeHalfExtents(_computeBounds(vertices, matrices), options.minHalfExtent, options.maxHalfExtent);\r\n    }\r\n    const { x, y, z } = options.halfExtents;\r\n    const collisionShape = (() => {\r\n        switch (options.cylinderAxis) {\r\n            case 'y':\r\n                return new Ammo.btConeShape(Math.max(x, z), y * 2);\r\n            case 'x':\r\n                return new Ammo.btConeShapeX(Math.max(y, z), x * 2);\r\n            case 'z':\r\n                return new Ammo.btConeShapeZ(Math.max(x, y), z * 2);\r\n        }\r\n        return null;\r\n    })();\r\n    _finishCollisionShape(collisionShape, options, _computeScale(matrixWorld, options));\r\n    return collisionShape;\r\n};\r\nexport const createSphereShape = function (vertices, matrices, matrixWorld, options = {}) {\r\n    options.type = TYPE.SPHERE;\r\n    _setOptions(options);\r\n    let radius;\r\n    if (options.fit === FIT.MANUAL && !isNaN(options.sphereRadius)) {\r\n        radius = options.sphereRadius;\r\n    }\r\n    else {\r\n        radius = _computeRadius(vertices, matrices, _computeBounds(vertices, matrices));\r\n    }\r\n    const collisionShape = new Ammo.btSphereShape(radius);\r\n    _finishCollisionShape(collisionShape, options, _computeScale(matrixWorld, options));\r\n    return collisionShape;\r\n};\r\nexport const createHullShape = (function () {\r\n    const vertex = new Vector3();\r\n    const center = new Vector3();\r\n    const matrix = new Matrix4();\r\n    return function (vertices, matrices, matrixWorld, options = {}) {\r\n        options.type = TYPE.HULL;\r\n        _setOptions(options);\r\n        if (options.fit === FIT.MANUAL) {\r\n            console.warn('cannot use fit: manual with type: hull');\r\n            return null;\r\n        }\r\n        const bounds = _computeBounds(vertices, matrices);\r\n        const btVertex = new Ammo.btVector3();\r\n        const originalHull = new Ammo.btConvexHullShape();\r\n        originalHull.setMargin(options.margin);\r\n        center.addVectors(bounds.max, bounds.min).multiplyScalar(0.5);\r\n        let vertexCount = 0;\r\n        for (let i = 0; i < vertices.length; i++) {\r\n            vertexCount += vertices[i].length / 3;\r\n        }\r\n        const maxVertices = options.hullMaxVertices || 100000;\r\n        // todo: might want to implement this in a deterministic way that doesn't do O(verts) calls to Math.random\r\n        if (vertexCount > maxVertices) {\r\n            console.warn(`too many vertices for hull shape; sampling ~${maxVertices} from ~${vertexCount} vertices`);\r\n        }\r\n        const p = Math.min(1, maxVertices / vertexCount);\r\n        for (let i = 0; i < vertices.length; i++) {\r\n            const components = vertices[i];\r\n            matrix.fromArray(matrices[i]);\r\n            for (let j = 0; j < components.length; j += 3) {\r\n                const isLastVertex = i === vertices.length - 1 && j === components.length - 3;\r\n                if (Math.random() <= p || isLastVertex) {\r\n                    // always include the last vertex\r\n                    vertex\r\n                        .set(components[j], components[j + 1], components[j + 2])\r\n                        .applyMatrix4(matrix)\r\n                        .sub(center);\r\n                    btVertex.setValue(vertex.x, vertex.y, vertex.z);\r\n                    originalHull.addPoint(btVertex, isLastVertex); // recalc AABB only on last geometry\r\n                }\r\n            }\r\n        }\r\n        let collisionShape = originalHull;\r\n        if (originalHull.getNumVertices() >= 100) {\r\n            //Bullet documentation says don't use convexHulls with 100 verts or more\r\n            const shapeHull = new Ammo.btShapeHull(originalHull);\r\n            shapeHull.buildHull(options.margin);\r\n            Ammo.destroy(originalHull);\r\n            collisionShape = new Ammo.btConvexHullShape(Ammo.getPointer(shapeHull.getVertexPointer()), shapeHull.numVertices());\r\n            Ammo.destroy(shapeHull); // btConvexHullShape makes a copy\r\n        }\r\n        Ammo.destroy(btVertex);\r\n        _finishCollisionShape(collisionShape, options, _computeScale(matrixWorld, options));\r\n        return collisionShape;\r\n    };\r\n})();\r\nexport const createHACDShapes = (function () {\r\n    const vector = new Vector3();\r\n    const center = new Vector3();\r\n    const matrix = new Matrix4();\r\n    return function (vertices, matrices, indexes, matrixWorld, options = {}) {\r\n        options.type = TYPE.HACD;\r\n        _setOptions(options);\r\n        if (options.fit === FIT.MANUAL) {\r\n            console.warn('cannot use fit: manual with type: hacd');\r\n            return [];\r\n        }\r\n        if (!Ammo.hasOwnProperty('HACD')) {\r\n            console.warn('HACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version.');\r\n            return [];\r\n        }\r\n        const bounds = _computeBounds(vertices, matrices);\r\n        const scale = _computeScale(matrixWorld, options);\r\n        let vertexCount = 0;\r\n        let triCount = 0;\r\n        center.addVectors(bounds.max, bounds.min).multiplyScalar(0.5);\r\n        for (let i = 0; i < vertices.length; i++) {\r\n            vertexCount += vertices[i].length / 3;\r\n            if (indexes && indexes[i]) {\r\n                triCount += indexes[i].length / 3;\r\n            }\r\n            else {\r\n                triCount += vertices[i].length / 9;\r\n            }\r\n        }\r\n        const hacd = new Ammo.HACD();\r\n        if (options.hasOwnProperty('compacityWeight'))\r\n            hacd.SetCompacityWeight(options.compacityWeight);\r\n        if (options.hasOwnProperty('volumeWeight'))\r\n            hacd.SetVolumeWeight(options.volumeWeight);\r\n        if (options.hasOwnProperty('nClusters'))\r\n            hacd.SetNClusters(options.nClusters);\r\n        if (options.hasOwnProperty('nVerticesPerCH'))\r\n            hacd.SetNVerticesPerCH(options.nVerticesPerCH);\r\n        if (options.hasOwnProperty('concavity'))\r\n            hacd.SetConcavity(options.concavity);\r\n        const points = Ammo._malloc(vertexCount * 3 * 8);\r\n        const triangles = Ammo._malloc(triCount * 3 * 4);\r\n        hacd.SetPoints(points);\r\n        hacd.SetTriangles(triangles);\r\n        hacd.SetNPoints(vertexCount);\r\n        hacd.SetNTriangles(triCount);\r\n        let pptr = points / 8, tptr = triangles / 4;\r\n        for (let i = 0; i < vertices.length; i++) {\r\n            const components = vertices[i];\r\n            matrix.fromArray(matrices[i]);\r\n            for (let j = 0; j < components.length; j += 3) {\r\n                vector\r\n                    .set(components[j + 0], components[j + 1], components[j + 2])\r\n                    .applyMatrix4(matrix)\r\n                    .sub(center);\r\n                Ammo.HEAPF64[pptr + 0] = vector.x;\r\n                Ammo.HEAPF64[pptr + 1] = vector.y;\r\n                Ammo.HEAPF64[pptr + 2] = vector.z;\r\n                pptr += 3;\r\n            }\r\n            if (indexes[i]) {\r\n                const indices = indexes[i];\r\n                for (let j = 0; j < indices.length; j++) {\r\n                    Ammo.HEAP32[tptr] = indices[j];\r\n                    tptr++;\r\n                }\r\n            }\r\n            else {\r\n                for (let j = 0; j < components.length / 3; j++) {\r\n                    Ammo.HEAP32[tptr] = j;\r\n                    tptr++;\r\n                }\r\n            }\r\n        }\r\n        hacd.Compute();\r\n        Ammo._free(points);\r\n        Ammo._free(triangles);\r\n        const nClusters = hacd.GetNClusters();\r\n        const shapes = [];\r\n        for (let i = 0; i < nClusters; i++) {\r\n            const hull = new Ammo.btConvexHullShape();\r\n            hull.setMargin(options.margin);\r\n            const nPoints = hacd.GetNPointsCH(i);\r\n            const nTriangles = hacd.GetNTrianglesCH(i);\r\n            const hullPoints = Ammo._malloc(nPoints * 3 * 8);\r\n            const hullTriangles = Ammo._malloc(nTriangles * 3 * 4);\r\n            hacd.GetCH(i, hullPoints, hullTriangles);\r\n            const pptr = hullPoints / 8;\r\n            for (let pi = 0; pi < nPoints; pi++) {\r\n                const btVertex = new Ammo.btVector3();\r\n                const px = Ammo.HEAPF64[pptr + pi * 3 + 0];\r\n                const py = Ammo.HEAPF64[pptr + pi * 3 + 1];\r\n                const pz = Ammo.HEAPF64[pptr + pi * 3 + 2];\r\n                btVertex.setValue(px, py, pz);\r\n                hull.addPoint(btVertex, pi === nPoints - 1);\r\n                Ammo.destroy(btVertex);\r\n            }\r\n            _finishCollisionShape(hull, options, scale);\r\n            shapes.push(hull);\r\n        }\r\n        return shapes;\r\n    };\r\n})();\r\nexport const createVHACDShapes = (function () {\r\n    const vector = new Vector3();\r\n    const center = new Vector3();\r\n    const matrix = new Matrix4();\r\n    return function (vertices, matrices, indexes, matrixWorld, options = {}) {\r\n        options.type = TYPE.VHACD;\r\n        _setOptions(options);\r\n        if (options.fit === FIT.MANUAL) {\r\n            console.warn('cannot use fit: manual with type: vhacd');\r\n            return [];\r\n        }\r\n        if (!Ammo.hasOwnProperty('VHACD')) {\r\n            console.warn('VHACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version.');\r\n            return [];\r\n        }\r\n        const bounds = _computeBounds(vertices, matrices);\r\n        const scale = _computeScale(matrixWorld, options);\r\n        let vertexCount = 0;\r\n        let triCount = 0;\r\n        center.addVectors(bounds.max, bounds.min).multiplyScalar(0.5);\r\n        for (let i = 0; i < vertices.length; i++) {\r\n            vertexCount += vertices[i].length / 3;\r\n            if (indexes && indexes[i]) {\r\n                triCount += indexes[i].length / 3;\r\n            }\r\n            else {\r\n                triCount += vertices[i].length / 9;\r\n            }\r\n        }\r\n        const vhacd = new Ammo.VHACD();\r\n        const params = new Ammo.Parameters();\r\n        //https://kmamou.blogspot.com/2014/12/v-hacd-20-parameters-description.html\r\n        if (options.hasOwnProperty('resolution'))\r\n            params.set_m_resolution(options.resolution);\r\n        if (options.hasOwnProperty('depth'))\r\n            params.set_m_depth(options.depth);\r\n        if (options.hasOwnProperty('concavity'))\r\n            params.set_m_concavity(options.concavity);\r\n        if (options.hasOwnProperty('planeDownsampling'))\r\n            params.set_m_planeDownsampling(options.planeDownsampling);\r\n        if (options.hasOwnProperty('convexhullDownsampling'))\r\n            params.set_m_convexhullDownsampling(options.convexhullDownsampling);\r\n        if (options.hasOwnProperty('alpha'))\r\n            params.set_m_alpha(options.alpha);\r\n        if (options.hasOwnProperty('beta'))\r\n            params.set_m_beta(options.beta);\r\n        if (options.hasOwnProperty('gamma'))\r\n            params.set_m_gamma(options.gamma);\r\n        if (options.hasOwnProperty('pca'))\r\n            params.set_m_pca(options.pca);\r\n        if (options.hasOwnProperty('mode'))\r\n            params.set_m_mode(options.mode);\r\n        if (options.hasOwnProperty('maxNumVerticesPerCH'))\r\n            params.set_m_maxNumVerticesPerCH(options.maxNumVerticesPerCH);\r\n        if (options.hasOwnProperty('minVolumePerCH'))\r\n            params.set_m_minVolumePerCH(options.minVolumePerCH);\r\n        if (options.hasOwnProperty('convexhullApproximation'))\r\n            params.set_m_convexhullApproximation(options.convexhullApproximation);\r\n        if (options.hasOwnProperty('oclAcceleration'))\r\n            params.set_m_oclAcceleration(options.oclAcceleration);\r\n        const points = Ammo._malloc(vertexCount * 3 * 8 + 3);\r\n        const triangles = Ammo._malloc(triCount * 3 * 4);\r\n        let pptr = points / 8, tptr = triangles / 4;\r\n        for (let i = 0; i < vertices.length; i++) {\r\n            const components = vertices[i];\r\n            matrix.fromArray(matrices[i]);\r\n            for (let j = 0; j < components.length; j += 3) {\r\n                vector\r\n                    .set(components[j + 0], components[j + 1], components[j + 2])\r\n                    .applyMatrix4(matrix)\r\n                    .sub(center);\r\n                Ammo.HEAPF64[pptr + 0] = vector.x;\r\n                Ammo.HEAPF64[pptr + 1] = vector.y;\r\n                Ammo.HEAPF64[pptr + 2] = vector.z;\r\n                pptr += 3;\r\n            }\r\n            if (indexes[i]) {\r\n                const indices = indexes[i];\r\n                for (let j = 0; j < indices.length; j++) {\r\n                    Ammo.HEAP32[tptr] = indices[j];\r\n                    tptr++;\r\n                }\r\n            }\r\n            else {\r\n                for (let j = 0; j < components.length / 3; j++) {\r\n                    Ammo.HEAP32[tptr] = j;\r\n                    tptr++;\r\n                }\r\n            }\r\n        }\r\n        vhacd.Compute(points, 3, vertexCount, triangles, 3, triCount, params);\r\n        Ammo._free(points);\r\n        Ammo._free(triangles);\r\n        const nHulls = vhacd.GetNConvexHulls();\r\n        const shapes = [];\r\n        const ch = new Ammo.ConvexHull();\r\n        for (let i = 0; i < nHulls; i++) {\r\n            vhacd.GetConvexHull(i, ch);\r\n            const nPoints = ch.get_m_nPoints();\r\n            const hullPoints = ch.get_m_points();\r\n            const hull = new Ammo.btConvexHullShape();\r\n            hull.setMargin(options.margin);\r\n            for (let pi = 0; pi < nPoints; pi++) {\r\n                const btVertex = new Ammo.btVector3();\r\n                const px = ch.get_m_points(pi * 3 + 0);\r\n                const py = ch.get_m_points(pi * 3 + 1);\r\n                const pz = ch.get_m_points(pi * 3 + 2);\r\n                btVertex.setValue(px, py, pz);\r\n                hull.addPoint(btVertex, pi === nPoints - 1);\r\n                Ammo.destroy(btVertex);\r\n            }\r\n            _finishCollisionShape(hull, options, scale);\r\n            shapes.push(hull);\r\n        }\r\n        Ammo.destroy(ch);\r\n        Ammo.destroy(vhacd);\r\n        return shapes;\r\n    };\r\n})();\r\nexport const createTriMeshShape = (function () {\r\n    const va = new Vector3();\r\n    const vb = new Vector3();\r\n    const vc = new Vector3();\r\n    const matrix = new Matrix4();\r\n    return function (vertices, matrices, indexes, matrixWorld, options = {}) {\r\n        options.type = TYPE.MESH;\r\n        _setOptions(options);\r\n        if (options.fit === FIT.MANUAL) {\r\n            console.warn('cannot use fit: manual with type: mesh');\r\n            return null;\r\n        }\r\n        const scale = _computeScale(matrixWorld, options);\r\n        const bta = new Ammo.btVector3();\r\n        const btb = new Ammo.btVector3();\r\n        const btc = new Ammo.btVector3();\r\n        const triMesh = new Ammo.btTriangleMesh(true, false);\r\n        for (let i = 0; i < vertices.length; i++) {\r\n            const components = vertices[i];\r\n            const index = indexes[i] ? indexes[i] : null;\r\n            matrix.fromArray(matrices[i]);\r\n            if (index) {\r\n                for (let j = 0; j < index.length; j += 3) {\r\n                    const ai = index[j] * 3;\r\n                    const bi = index[j + 1] * 3;\r\n                    const ci = index[j + 2] * 3;\r\n                    va.set(components[ai], components[ai + 1], components[ai + 2]).applyMatrix4(matrix);\r\n                    vb.set(components[bi], components[bi + 1], components[bi + 2]).applyMatrix4(matrix);\r\n                    vc.set(components[ci], components[ci + 1], components[ci + 2]).applyMatrix4(matrix);\r\n                    bta.setValue(va.x, va.y, va.z);\r\n                    btb.setValue(vb.x, vb.y, vb.z);\r\n                    btc.setValue(vc.x, vc.y, vc.z);\r\n                    triMesh.addTriangle(bta, btb, btc, false);\r\n                }\r\n            }\r\n            else {\r\n                for (let j = 0; j < components.length; j += 9) {\r\n                    va.set(components[j + 0], components[j + 1], components[j + 2]).applyMatrix4(matrix);\r\n                    vb.set(components[j + 3], components[j + 4], components[j + 5]).applyMatrix4(matrix);\r\n                    vc.set(components[j + 6], components[j + 7], components[j + 8]).applyMatrix4(matrix);\r\n                    bta.setValue(va.x, va.y, va.z);\r\n                    btb.setValue(vb.x, vb.y, vb.z);\r\n                    btc.setValue(vc.x, vc.y, vc.z);\r\n                    triMesh.addTriangle(bta, btb, btc, false);\r\n                }\r\n            }\r\n        }\r\n        const localScale = new Ammo.btVector3(scale.x, scale.y, scale.z);\r\n        triMesh.setScaling(localScale);\r\n        Ammo.destroy(localScale);\r\n        // MOD (yandeu): Use btConvexTriangleMeshShape for concave shapes\r\n        let collisionShape;\r\n        if (options.concave)\r\n            collisionShape = new Ammo.btBvhTriangleMeshShape(triMesh, true, true);\r\n        else\r\n            collisionShape = new Ammo.btConvexTriangleMeshShape(triMesh, true);\r\n        // const collisionShape = new Ammo.btBvhTriangleMeshShape(triMesh, true, true)\r\n        collisionShape.resources = [triMesh];\r\n        Ammo.destroy(bta);\r\n        Ammo.destroy(btb);\r\n        Ammo.destroy(btc);\r\n        _finishCollisionShape(collisionShape, options);\r\n        return collisionShape;\r\n    };\r\n})();\r\nexport const createHeightfieldTerrainShape = function (options = {}) {\r\n    _setOptions(options);\r\n    if (options.fit === FIT.ALL) {\r\n        console.warn('cannot use fit: all with type: heightfield');\r\n        return null;\r\n    }\r\n    const heightfieldDistance = options.heightfieldDistance || 1;\r\n    const heightfieldData = options.heightfieldData || [];\r\n    const heightScale = options.heightScale || 0;\r\n    const upAxis = options.hasOwnProperty('upAxis') ? options.upAxis : 1; // x = 0; y = 1; z = 2\r\n    const hdt = (() => {\r\n        switch (options.heightDataType) {\r\n            case 'short':\r\n                return Ammo.PHY_SHORT;\r\n            case 'float':\r\n                return Ammo.PHY_FLOAT;\r\n            default:\r\n                return Ammo.PHY_FLOAT;\r\n        }\r\n    })();\r\n    const flipQuadEdges = options.hasOwnProperty('flipQuadEdges') ? options.flipQuadEdges : true;\r\n    const heightStickLength = heightfieldData.length;\r\n    const heightStickWidth = heightStickLength > 0 ? heightfieldData[0].length : 0;\r\n    const data = Ammo._malloc(heightStickLength * heightStickWidth * 4);\r\n    const ptr = data / 4;\r\n    let minHeight = Number.POSITIVE_INFINITY;\r\n    let maxHeight = Number.NEGATIVE_INFINITY;\r\n    let index = 0;\r\n    for (let l = 0; l < heightStickLength; l++) {\r\n        for (let w = 0; w < heightStickWidth; w++) {\r\n            const height = heightfieldData[l][w];\r\n            Ammo.HEAPF32[ptr + index] = height;\r\n            index++;\r\n            minHeight = Math.min(minHeight, height);\r\n            maxHeight = Math.max(maxHeight, height);\r\n        }\r\n    }\r\n    const collisionShape = new Ammo.btHeightfieldTerrainShape(heightStickWidth, heightStickLength, data, heightScale, minHeight, maxHeight, upAxis, hdt, flipQuadEdges);\r\n    const scale = new Ammo.btVector3(heightfieldDistance, 1, heightfieldDistance);\r\n    collisionShape.setLocalScaling(scale);\r\n    Ammo.destroy(scale);\r\n    collisionShape.heightfieldData = data;\r\n    _finishCollisionShape(collisionShape, options);\r\n    return collisionShape;\r\n};\r\nfunction _setOptions(options) {\r\n    // MOD (yandeu): All of this will be done in physics.ts\r\n    // we only keep type and margin\r\n    options.type = options.type || TYPE.HULL;\r\n    options.margin = options.hasOwnProperty('margin') ? options.margin : 0.01;\r\n    return;\r\n    options.fit = options.hasOwnProperty('fit') ? options.fit : FIT.ALL;\r\n    options.type = options.type || TYPE.HULL;\r\n    options.minHalfExtent = options.hasOwnProperty('minHalfExtent') ? options.minHalfExtent : 0;\r\n    options.maxHalfExtent = options.hasOwnProperty('maxHalfExtent') ? options.maxHalfExtent : Number.POSITIVE_INFINITY;\r\n    options.cylinderAxis = options.cylinderAxis || 'y';\r\n    options.margin = options.hasOwnProperty('margin') ? options.margin : 0.01;\r\n    options.includeInvisible = options.hasOwnProperty('includeInvisible') ? options.includeInvisible : false;\r\n    if (!options.offset) {\r\n        options.offset = new Vector3();\r\n    }\r\n    if (!options.orientation) {\r\n        options.orientation = new Quaternion();\r\n    }\r\n}\r\nconst _finishCollisionShape = function (collisionShape, options, scale) {\r\n    // MOD (yandeu): All of this will be done in physics.ts\r\n    return;\r\n    collisionShape.type = options.type;\r\n    collisionShape.setMargin(options.margin);\r\n    collisionShape.destroy = () => {\r\n        for (let res of collisionShape.resources || []) {\r\n            Ammo.destroy(res);\r\n        }\r\n        if (collisionShape.heightfieldData) {\r\n            Ammo._free(collisionShape.heightfieldData);\r\n        }\r\n        Ammo.destroy(collisionShape);\r\n    };\r\n    const localTransform = new Ammo.btTransform();\r\n    const rotation = new Ammo.btQuaternion();\r\n    localTransform.setIdentity();\r\n    localTransform.getOrigin().setValue(options.offset.x, options.offset.y, options.offset.z);\r\n    rotation.setValue(options.orientation.x, options.orientation.y, options.orientation.z, options.orientation.w);\r\n    localTransform.setRotation(rotation);\r\n    Ammo.destroy(rotation);\r\n    if (scale) {\r\n        const localScale = new Ammo.btVector3(scale.x, scale.y, scale.z);\r\n        collisionShape.setLocalScaling(localScale);\r\n        Ammo.destroy(localScale);\r\n    }\r\n    collisionShape.localTransform = localTransform;\r\n};\r\nexport const iterateGeometries = (function () {\r\n    const inverse = new Matrix4();\r\n    return function (root, options, cb) {\r\n        // MOD (yandeu): Update to three.js r123\r\n        // compatibility fix for three.js >= r123 (Dezember 2020)\r\n        if (parseInt(REVISION) >= 123)\r\n            inverse.copy(root.matrixWorld).invert();\r\n        else\r\n            inverse.getInverse(root.matrixWorld);\r\n        const scale = new Vector3();\r\n        scale.setFromMatrixScale(root.matrixWorld);\r\n        root.traverse(mesh => {\r\n            const transform = new Matrix4();\r\n            if (mesh.isMesh &&\r\n                // MOD (yandeu): No need to check if name is 'Sky'\r\n                // mesh.name !== 'Sky' &&\r\n                (options.includeInvisible || (mesh.el && mesh.el.object3D.visible) || mesh.visible)) {\r\n                if (mesh === root) {\r\n                    transform.identity();\r\n                }\r\n                else {\r\n                    mesh.updateWorldMatrix(true);\r\n                    transform.multiplyMatrices(inverse, mesh.matrixWorld);\r\n                }\r\n                // todo: might want to return null xform if this is the root so that callers can avoid multiplying\r\n                // things by the identity matrix\r\n                cb(mesh.geometry.isBufferGeometry ? mesh.geometry.attributes.position.array : mesh.geometry.vertices, transform.elements, mesh.geometry.index ? mesh.geometry.index.array : null);\r\n            }\r\n        });\r\n    };\r\n})();\r\nconst _computeScale = (function () {\r\n    const matrix = new Matrix4();\r\n    return function (matrixWorld, options = {}) {\r\n        const scale = new Vector3(1, 1, 1);\r\n        if (options.fit === FIT.ALL) {\r\n            matrix.fromArray(matrixWorld);\r\n            scale.setFromMatrixScale(matrix);\r\n        }\r\n        return scale;\r\n    };\r\n})();\r\nconst _computeRadius = (function () {\r\n    const center = new Vector3();\r\n    return function (vertices, matrices, bounds) {\r\n        let maxRadiusSq = 0;\r\n        let { x: cx, y: cy, z: cz } = bounds.getCenter(center);\r\n        _iterateVertices(vertices, matrices, v => {\r\n            const dx = cx - v.x;\r\n            const dy = cy - v.y;\r\n            const dz = cz - v.z;\r\n            maxRadiusSq = Math.max(maxRadiusSq, dx * dx + dy * dy + dz * dz);\r\n        });\r\n        return Math.sqrt(maxRadiusSq);\r\n    };\r\n})();\r\nconst _computeHalfExtents = function (bounds, minHalfExtent, maxHalfExtent) {\r\n    const halfExtents = new Vector3();\r\n    return halfExtents.subVectors(bounds.max, bounds.min).multiplyScalar(0.5).clampScalar(minHalfExtent, maxHalfExtent);\r\n};\r\nconst _computeLocalOffset = function (matrix, bounds, target) {\r\n    target.addVectors(bounds.max, bounds.min).multiplyScalar(0.5).applyMatrix4(matrix);\r\n    return target;\r\n};\r\n// returns the bounding box for the geometries underneath `root`.\r\nconst _computeBounds = function (vertices, matrices) {\r\n    const bounds = new Box3();\r\n    let minX = +Infinity;\r\n    let minY = +Infinity;\r\n    let minZ = +Infinity;\r\n    let maxX = -Infinity;\r\n    let maxY = -Infinity;\r\n    let maxZ = -Infinity;\r\n    bounds.min.set(0, 0, 0);\r\n    bounds.max.set(0, 0, 0);\r\n    _iterateVertices(vertices, matrices, v => {\r\n        if (v.x < minX)\r\n            minX = v.x;\r\n        if (v.y < minY)\r\n            minY = v.y;\r\n        if (v.z < minZ)\r\n            minZ = v.z;\r\n        if (v.x > maxX)\r\n            maxX = v.x;\r\n        if (v.y > maxY)\r\n            maxY = v.y;\r\n        if (v.z > maxZ)\r\n            maxZ = v.z;\r\n    });\r\n    bounds.min.set(minX, minY, minZ);\r\n    bounds.max.set(maxX, maxY, maxZ);\r\n    return bounds;\r\n};\r\nconst _iterateVertices = (function () {\r\n    const vertex = new Vector3();\r\n    const matrix = new Matrix4();\r\n    return function (vertices, matrices, cb) {\r\n        for (let i = 0; i < vertices.length; i++) {\r\n            matrix.fromArray(matrices[i]);\r\n            for (let j = 0; j < vertices[i].length; j += 3) {\r\n                vertex.set(vertices[i][j], vertices[i][j + 1], vertices[i][j + 2]).applyMatrix4(matrix);\r\n                cb(vertex);\r\n            }\r\n        }\r\n    };\r\n})();\r\n//# sourceMappingURL=three-to-ammo.js.map","import { MeshLambertMaterial } from 'three';\r\nclass DefaultMaterial {\r\n    constructor() {\r\n        this._defaultMaterial = new MeshLambertMaterial({ color: 0xcccccc });\r\n    }\r\n    get() {\r\n        return this._defaultMaterial;\r\n    }\r\n}\r\nexport default DefaultMaterial;\r\n//# sourceMappingURL=defaultMaterial.js.map","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\nvar __rest = (this && this.__rest) || function (s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n};\r\nimport { BoxBufferGeometry, ConeBufferGeometry, CylinderBufferGeometry, DoubleSide, ExtrudeBufferGeometry, Line, LineBasicMaterial, MeshBasicMaterial, MeshLambertMaterial, MeshNormalMaterial, MeshPhongMaterial, MeshPhysicalMaterial, MeshStandardMaterial, MeshToonMaterial, PlaneBufferGeometry, Points, PointsMaterial, SphereBufferGeometry, MathUtils as THREE_Math, TorusBufferGeometry } from 'three';\r\nimport { ExtendedMesh } from './extendedMesh';\r\nimport { logger } from './logger';\r\nimport DefaultMaterial from './defaultMaterial';\r\nexport default class Factories {\r\n    constructor(scene) {\r\n        this.scene = scene;\r\n        this.isHeadless = scene === 'headless' ? true : false;\r\n        this.defaultMaterial = new DefaultMaterial();\r\n    }\r\n    get make() {\r\n        return {\r\n            plane: (planeConfig = {}, materialConfig = {}) => this.makePlane(planeConfig, materialConfig),\r\n            box: (boxConfig = {}, materialConfig = {}) => this.makeBox(boxConfig, materialConfig),\r\n            sphere: (sphereConfig = {}, materialConfig = {}) => this.makeSphere(sphereConfig, materialConfig),\r\n            cylinder: (cylinderConfig = {}, materialConfig = {}) => this.makeCylinder(cylinderConfig, materialConfig),\r\n            cone: (coneConfig = {}, materialConfig = {}) => this.makeCone(coneConfig, materialConfig),\r\n            torus: (torusConfig = {}, materialConfig = {}) => this.makeTorus(torusConfig, materialConfig),\r\n            extrude: (extrudeConfig, materialConfig = {}) => this.makeExtrude(extrudeConfig, materialConfig)\r\n        };\r\n    }\r\n    get add() {\r\n        return {\r\n            // effectComposer: () => this.addEffectComposer(),\r\n            mesh: (mesh) => this.addMesh(mesh),\r\n            // group: (...children) => this.addGroup(children),\r\n            existing: (object) => this.addExisting(object),\r\n            //  Geometry\r\n            plane: (planeConfig = {}, materialConfig = {}) => this.addPlane(planeConfig, materialConfig),\r\n            box: (boxConfig = {}, materialConfig = {}) => this.addBox(boxConfig, materialConfig),\r\n            ground: (groundConfig, materialConfig = {}) => this.addGround(groundConfig, materialConfig),\r\n            //...\r\n            sphere: (sphereConfig = {}, materialConfig = {}) => this.addSphere(sphereConfig, materialConfig),\r\n            cylinder: (cylinderConfig = {}, materialConfig = {}) => this.addCylinder(cylinderConfig, materialConfig),\r\n            cone: (coneConfig = {}, materialConfig = {}) => this.addCone(coneConfig, materialConfig),\r\n            torus: (torusConfig = {}, materialConfig = {}) => this.addTorus(torusConfig, materialConfig),\r\n            extrude: (extrudeConfig, materialConfig = {}) => this.addExtrude(extrudeConfig, materialConfig),\r\n            //...\r\n            material: (materialConfig = {}) => this.addMaterial(materialConfig)\r\n        };\r\n    }\r\n    addExisting(...object) {\r\n        if (this.scene === 'headless')\r\n            return;\r\n        this.scene.add(...object);\r\n    }\r\n    addMesh(mesh) {\r\n        if (Array.isArray(mesh)) {\r\n            for (let i = 0; i < mesh.length; i++) {\r\n                this.addExisting(mesh[i]);\r\n            }\r\n        }\r\n        else {\r\n            this.addExisting(mesh);\r\n        }\r\n        return this;\r\n    }\r\n    createMesh(geometry, material, position) {\r\n        const { x = 0, y = 0, z = 0 } = position;\r\n        let obj;\r\n        switch (!Array.isArray(material) && material.type) {\r\n            case 'LineBasicMaterial':\r\n                obj = new Line(geometry, material);\r\n                break;\r\n            case 'PointsMaterial':\r\n                obj = new Points(geometry, material);\r\n                break;\r\n            default:\r\n                obj = new ExtendedMesh(geometry, material);\r\n                break;\r\n        }\r\n        obj.position.set(x, y, z);\r\n        obj.castShadow = obj.receiveShadow = true;\r\n        return obj;\r\n    }\r\n    makeExtrude(extrudeConfig, materialConfig) {\r\n        const { x, y, z, name, shape, autoCenter = true, breakable = false } = extrudeConfig, rest = __rest(extrudeConfig\r\n        // @ts-ignore // ExtrudeGeometryOptions interface missing since three.js r121\r\n        , [\"x\", \"y\", \"z\", \"name\", \"shape\", \"autoCenter\", \"breakable\"]);\r\n        // @ts-ignore // ExtrudeGeometryOptions interface missing since three.js r121\r\n        const { depth = 1, bevelEnabled = false } = rest;\r\n        const geometry = new ExtrudeBufferGeometry(shape, Object.assign({ depth, bevelEnabled }, rest));\r\n        const material = this.addMaterial(materialConfig);\r\n        const mesh = this.createMesh(geometry, material, { x, y, z });\r\n        // auto adjust the center for custom shapes\r\n        if (autoCenter)\r\n            mesh.geometry.center();\r\n        mesh.name = name || `body_id_${mesh.id}`;\r\n        mesh.shape = 'extrude';\r\n        return mesh;\r\n    }\r\n    addExtrude(extrudeConfig, materialConfig = {}) {\r\n        const obj = this.makeExtrude(extrudeConfig, materialConfig);\r\n        this.addExisting(obj);\r\n        return obj;\r\n    }\r\n    makePlane(planeConfig, materialConfig) {\r\n        const { x, y, z, name, breakable = false } = planeConfig, rest = __rest(planeConfig, [\"x\", \"y\", \"z\", \"name\", \"breakable\"]);\r\n        const geometry = new PlaneBufferGeometry(rest.width || 1, rest.height || 1, rest.widthSegments || 1, rest.heightSegments || 1);\r\n        const material = this.addMaterial(materialConfig);\r\n        material.side = DoubleSide;\r\n        const mesh = this.createMesh(geometry, material, { x, y, z });\r\n        mesh.name = name || `body_id_${mesh.id}`;\r\n        mesh.shape = 'plane';\r\n        return mesh;\r\n    }\r\n    addPlane(planeConfig, materialConfig) {\r\n        const obj = this.makePlane(planeConfig, materialConfig);\r\n        this.addExisting(obj);\r\n        return obj;\r\n    }\r\n    makeSphere(sphereConfig, materialConfig) {\r\n        const { x, y, z, name, breakable = false } = sphereConfig, rest = __rest(sphereConfig, [\"x\", \"y\", \"z\", \"name\", \"breakable\"]);\r\n        const geometry = new SphereBufferGeometry(rest.radius || 1, rest.widthSegments || 16, rest.heightSegments || 12, rest.phiStart || undefined, rest.phiLength || undefined, rest.thetaStart || undefined, rest.thetaLength || undefined);\r\n        const material = this.addMaterial(materialConfig);\r\n        const mesh = this.createMesh(geometry, material, { x, y, z });\r\n        mesh.name = name || `body_id_${mesh.id}`;\r\n        mesh.shape = 'sphere';\r\n        return mesh;\r\n    }\r\n    addSphere(sphereConfig = {}, materialConfig = {}) {\r\n        const obj = this.makeSphere(sphereConfig, materialConfig);\r\n        this.addExisting(obj);\r\n        return obj;\r\n    }\r\n    makeBox(boxConfig, materialConfig) {\r\n        const { x, y, z, name, breakable = false } = boxConfig, rest = __rest(boxConfig, [\"x\", \"y\", \"z\", \"name\", \"breakable\"]);\r\n        const geometry = new BoxBufferGeometry(rest.width || 1, rest.height || 1, rest.depth || 1, rest.widthSegments || undefined, rest.heightSegments || undefined, rest.depthSegments || undefined);\r\n        const material = this.addMaterial(materialConfig);\r\n        const mesh = this.createMesh(geometry, material, { x, y, z });\r\n        mesh.name = name || `body_id_${mesh.id}`;\r\n        mesh.shape = 'box';\r\n        return mesh;\r\n    }\r\n    addBox(boxConfig = {}, materialConfig = {}) {\r\n        const obj = this.makeBox(boxConfig, materialConfig);\r\n        this.addExisting(obj);\r\n        return obj;\r\n    }\r\n    addGround(groundConfig, materialConfig = {}) {\r\n        const obj = this.makeBox(groundConfig, materialConfig);\r\n        obj.rotateX(THREE_Math.degToRad(90));\r\n        this.addExisting(obj);\r\n        return obj;\r\n    }\r\n    makeCylinder(cylinderConfig = {}, materialConfig = {}) {\r\n        const { x, y, z, name, breakable = false } = cylinderConfig, rest = __rest(cylinderConfig, [\"x\", \"y\", \"z\", \"name\", \"breakable\"]);\r\n        const geometry = new CylinderBufferGeometry(rest.radiusTop || 1, rest.radiusBottom || 1, rest.height || 1, rest.radiusSegments || undefined, rest.heightSegments || undefined, rest.openEnded || undefined, rest.thetaStart || undefined, rest.thetaLength || undefined);\r\n        const material = this.addMaterial(materialConfig);\r\n        const mesh = this.createMesh(geometry, material, { x, y, z });\r\n        mesh.name = name || `body_id_${mesh.id}`;\r\n        mesh.shape = 'cylinder';\r\n        return mesh;\r\n    }\r\n    addCylinder(cylinderConfig = {}, materialConfig = {}) {\r\n        const obj = this.makeCylinder(cylinderConfig, materialConfig);\r\n        this.addExisting(obj);\r\n        return obj;\r\n    }\r\n    makeCone(coneConfig = {}, materialConfig = {}) {\r\n        const { x, y, z, name, breakable = false } = coneConfig, rest = __rest(coneConfig, [\"x\", \"y\", \"z\", \"name\", \"breakable\"]);\r\n        const geometry = new ConeBufferGeometry(rest.radius || 1, rest.height || 1, rest.radiusSegments || 8, rest.heightSegments || 1, rest.openEnded || false, rest.thetaStart || 0, rest.thetaLength || 2 * Math.PI);\r\n        const material = this.addMaterial(materialConfig);\r\n        const mesh = this.createMesh(geometry, material, { x, y, z });\r\n        mesh.name = name || `body_id_${mesh.id}`;\r\n        mesh.shape = 'cone';\r\n        return mesh;\r\n    }\r\n    addCone(coneConfig = {}, materialConfig = {}) {\r\n        const obj = this.makeCone(coneConfig, materialConfig);\r\n        this.addExisting(obj);\r\n        return obj;\r\n    }\r\n    // https://threejs.org/docs/index.html#api/en/geometries/TorusBufferGeometry\r\n    makeTorus(torusConfig = {}, materialConfig = {}) {\r\n        const { x, y, z, name, breakable = false } = torusConfig, rest = __rest(torusConfig, [\"x\", \"y\", \"z\", \"name\", \"breakable\"]);\r\n        const geometry = new TorusBufferGeometry(rest.radius || undefined, rest.tube || undefined, rest.radialSegments || undefined, rest.tubularSegments || undefined, rest.arc || undefined);\r\n        const material = this.addMaterial(materialConfig);\r\n        const mesh = this.createMesh(geometry, material, { x, y, z });\r\n        mesh.name = name || `body_id_${mesh.id}`;\r\n        mesh.shape = 'torus';\r\n        return mesh;\r\n    }\r\n    addTorus(torusConfig = {}, materialConfig = {}) {\r\n        const obj = this.makeTorus(torusConfig, materialConfig);\r\n        this.addExisting(obj);\r\n        return obj;\r\n    }\r\n    addMaterial(materialConfig = {}) {\r\n        const type = Object.keys(materialConfig)[0];\r\n        let material;\r\n        // if (type) {\r\n        //   const { map } = materialConfig[type]\r\n        //   if (typeof map === 'string') materialConfig[type].map = this.loadTexture(map)\r\n        // }\r\n        // always share the same material in headless mode to save memory\r\n        if (this.scene === 'headless')\r\n            return this.defaultMaterial.get();\r\n        switch (type) {\r\n            case 'basic':\r\n                material = new MeshBasicMaterial(materialConfig.basic);\r\n                break;\r\n            case 'normal':\r\n                material = new MeshNormalMaterial(materialConfig.normal);\r\n                break;\r\n            case 'standard':\r\n                material = new MeshStandardMaterial(materialConfig.standard);\r\n                break;\r\n            case 'lambert':\r\n                material = new MeshLambertMaterial(materialConfig.lambert);\r\n                break;\r\n            case 'phong':\r\n                material = new MeshPhongMaterial(materialConfig.phong);\r\n                break;\r\n            case 'physical':\r\n                if (typeof materialConfig.physical !== 'undefined') {\r\n                    material = new MeshPhysicalMaterial(materialConfig.physical);\r\n                }\r\n                else {\r\n                    logger('You need to pass parameters to the physical material. (Fallback to default material)');\r\n                    material = this.defaultMaterial.get();\r\n                }\r\n                break;\r\n            case 'toon':\r\n                material = new MeshToonMaterial(materialConfig.toon);\r\n                break;\r\n            case 'line':\r\n                material = new LineBasicMaterial(materialConfig.line);\r\n                break;\r\n            case 'points':\r\n                material = new PointsMaterial(materialConfig.points);\r\n                break;\r\n            case 'custom':\r\n                material = materialConfig.custom || this.defaultMaterial.get();\r\n                break;\r\n            default:\r\n                material = this.defaultMaterial.get();\r\n                break;\r\n        }\r\n        return material;\r\n    }\r\n}\r\n//# sourceMappingURL=factories.js.map","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\nimport { Events } from '@yandeu/events';\r\nexport class CollisionEvents extends Events {\r\n    addCollider(object1, object2, eventCallback) {\r\n        if (!object1.body || !object2.body)\r\n            return;\r\n        object1.body.checkCollisions = true;\r\n        object2.body.checkCollisions = true;\r\n        this.on('collision', (data) => {\r\n            var _a, _b;\r\n            const { bodies, event } = data;\r\n            if (((_a = bodies[0]) === null || _a === void 0 ? void 0 : _a.name) && ((_b = bodies[1]) === null || _b === void 0 ? void 0 : _b.name) && (object1 === null || object1 === void 0 ? void 0 : object1.name) && (object2 === null || object2 === void 0 ? void 0 : object2.name)) {\r\n                if (bodies[0].name === object1.name && bodies[1].name === object2.name)\r\n                    eventCallback(event);\r\n                else if (bodies[1].name === object1.name && bodies[0].name === object2.name)\r\n                    eventCallback(event);\r\n            }\r\n        });\r\n    }\r\n}\r\n//# sourceMappingURL=collisionEvents.js.map","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @description  This is a modified version of the original code from Kevin Lee\r\n */\r\n/**\r\n * @author       Kevin Lee (https://github.com/InfiniteLee)\r\n * @copyright    Copyright (c) 2019 Kevin Lee; Project Url: https://github.com/InfiniteLee/ammo-debug-drawer\r\n * @license      {@link https://github.com/InfiniteLee/ammo-debug-drawer/blob/master/LICENSE|MPL-2.0}\r\n */\r\nimport { BufferAttribute, BufferGeometry, LineBasicMaterial, LineSegments, StaticDrawUsage } from 'three';\r\nconst AmmoDebugConstants = {\r\n    NoDebug: 0,\r\n    DrawWireframe: 1,\r\n    DrawAabb: 2,\r\n    DrawFeaturesText: 4,\r\n    DrawContactPoints: 8,\r\n    NoDeactivation: 16,\r\n    NoHelpText: 32,\r\n    DrawText: 64,\r\n    ProfileTimings: 128,\r\n    EnableSatComparison: 256,\r\n    DisableBulletLCP: 512,\r\n    EnableCCD: 1024,\r\n    DrawConstraints: 1 << 11,\r\n    DrawConstraintLimits: 1 << 12,\r\n    FastWireframe: 1 << 13,\r\n    DrawNormals: 1 << 14,\r\n    DrawOnTop: 1 << 15,\r\n    MAX_DEBUG_DRAW_MODE: 0xffffffff\r\n};\r\n/**\r\n * An implementation of the btIDebugDraw interface in Ammo.js, for debug rendering of Ammo shapes\r\n */\r\nclass DebugDrawer {\r\n    constructor(scene, world, options = {}) {\r\n        this.scene = scene;\r\n        this.world = world;\r\n        this.options = options;\r\n        this.debugDrawMode = options.debugDrawMode || AmmoDebugConstants.DrawWireframe;\r\n        const drawOnTop = this.debugDrawMode & AmmoDebugConstants.DrawOnTop || false;\r\n        const maxBufferSize = options.maxBufferSize || 1000000;\r\n        this.geometry = new BufferGeometry();\r\n        const vertices = new Float32Array(maxBufferSize * 3);\r\n        const colors = new Float32Array(maxBufferSize * 3);\r\n        /*\r\n        I do not know the difference, just using the first one.\r\n        export const StaticDrawUsage: Usage;\r\n        export const DynamicDrawUsage: Usage;\r\n        export const StreamDrawUsage: Usage;\r\n        export const StaticReadUsage: Usage;\r\n        export const DynamicReadUsage: Usage;\r\n        export const StreamReadUsage: Usage;\r\n        export const StaticCopyUsage: Usage;\r\n        export const DynamicCopyUsage: Usage;\r\n        export const StreamCopyUsage: Usage;\r\n         */\r\n        this.geometry.setAttribute('position', new BufferAttribute(vertices, 3).setUsage(StaticDrawUsage));\r\n        this.geometry.setAttribute('color', new BufferAttribute(colors, 3).setUsage(StaticDrawUsage));\r\n        this.index = 0;\r\n        const material = new LineBasicMaterial({\r\n            vertexColors: true,\r\n            depthTest: !drawOnTop\r\n        });\r\n        this.mesh = new LineSegments(this.geometry, material);\r\n        if (drawOnTop)\r\n            this.mesh.renderOrder = 999;\r\n        this.mesh.frustumCulled = false;\r\n        this.enabled = false;\r\n        this.debugDrawer = new Ammo.DebugDrawer();\r\n        this.debugDrawer.drawLine = this.drawLine.bind(this);\r\n        this.debugDrawer.drawContactPoint = this.drawContactPoint.bind(this);\r\n        this.debugDrawer.reportErrorWarning = this.reportErrorWarning.bind(this);\r\n        this.debugDrawer.draw3dText = this.draw3dText.bind(this);\r\n        this.debugDrawer.setDebugMode = this.setDebugMode.bind(this);\r\n        this.debugDrawer.getDebugMode = this.getDebugMode.bind(this);\r\n        this.world.setDebugDrawer(this.debugDrawer);\r\n    }\r\n    enable() {\r\n        this.enabled = true;\r\n        this.scene.add(this.mesh);\r\n    }\r\n    disable() {\r\n        this.enabled = false;\r\n        this.scene.remove(this.mesh);\r\n    }\r\n    update() {\r\n        if (!this.enabled) {\r\n            return;\r\n        }\r\n        if (this.index != 0) {\r\n            // @ts-ignore\r\n            this.geometry.attributes.position.needsUpdate = true;\r\n            // @ts-ignore\r\n            this.geometry.attributes.color.needsUpdate = true;\r\n        }\r\n        this.index = 0;\r\n        this.world.debugDrawWorld();\r\n        this.geometry.setDrawRange(0, this.index);\r\n    }\r\n    drawLine(from, to, color) {\r\n        // @ts-ignore\r\n        const heap = Ammo.HEAPF32;\r\n        const r = heap[(color + 0) / 4];\r\n        const g = heap[(color + 4) / 4];\r\n        const b = heap[(color + 8) / 4];\r\n        const fromX = heap[(from + 0) / 4];\r\n        const fromY = heap[(from + 4) / 4];\r\n        const fromZ = heap[(from + 8) / 4];\r\n        this.geometry.attributes.position.setXYZ(this.index, fromX, fromY, fromZ);\r\n        this.geometry.attributes.color.setXYZ(this.index++, r, g, b);\r\n        const toX = heap[(to + 0) / 4];\r\n        const toY = heap[(to + 4) / 4];\r\n        const toZ = heap[(to + 8) / 4];\r\n        this.geometry.attributes.position.setXYZ(this.index, toX, toY, toZ);\r\n        this.geometry.attributes.color.setXYZ(this.index++, r, g, b);\r\n    }\r\n    //TODO: figure out how to make lifeTime work\r\n    drawContactPoint(pointOnB, normalOnB, distance, _lifeTime, color) {\r\n        // @ts-ignore\r\n        const heap = Ammo.HEAPF32;\r\n        const r = heap[(color + 0) / 4];\r\n        const g = heap[(color + 4) / 4];\r\n        const b = heap[(color + 8) / 4];\r\n        const x = heap[(pointOnB + 0) / 4];\r\n        const y = heap[(pointOnB + 4) / 4];\r\n        const z = heap[(pointOnB + 8) / 4];\r\n        this.geometry.attributes.position.setXYZ(this.index, x, y, z);\r\n        this.geometry.attributes.color.setXYZ(this.index++, r, g, b);\r\n        const dx = heap[(normalOnB + 0) / 4] * distance;\r\n        const dy = heap[(normalOnB + 4) / 4] * distance;\r\n        const dz = heap[(normalOnB + 8) / 4] * distance;\r\n        this.geometry.attributes.position.setXYZ(this.index, x + dx, y + dy, z + dz);\r\n        this.geometry.attributes.color.setXYZ(this.index++, r, g, b);\r\n    }\r\n    reportErrorWarning(warningString) {\r\n        // eslint-disable-next-line no-prototype-builtins\r\n        if (Ammo.hasOwnProperty('Pointer_stringify')) {\r\n            // @ts-ignore\r\n            console.warn(Ammo.Pointer_stringify(warningString));\r\n        }\r\n        else if (!this.warnedOnce) {\r\n            this.warnedOnce = true;\r\n            console.warn(\"Cannot print warningString, please rebuild Ammo.js using 'debug' flag\");\r\n        }\r\n    }\r\n    draw3dText(_location, _textString) {\r\n        //TODO\r\n        console.warn('TODO: draw3dText');\r\n    }\r\n    setDebugMode(debugMode) {\r\n        this.debugDrawMode = debugMode;\r\n    }\r\n    getDebugMode() {\r\n        return this.debugDrawMode;\r\n    }\r\n}\r\nexport default DebugDrawer;\r\n//# sourceMappingURL=debugDrawer.js.map","import {\n\tLine3,\n\tPlane,\n\tTriangle,\n\tVector3\n} from 'three';\n\n/**\n * Ported from: https://github.com/maurizzzio/quickhull3d/ by Mauricio Poppe (https://github.com/maurizzzio)\n */\n\nconst Visible = 0;\nconst Deleted = 1;\n\nconst _v1 = new Vector3();\nconst _line3 = new Line3();\nconst _plane = new Plane();\nconst _closestPoint = new Vector3();\nconst _triangle = new Triangle();\n\nclass ConvexHull {\n\n\tconstructor() {\n\n\t\tthis.tolerance = - 1;\n\n\t\tthis.faces = []; // the generated faces of the convex hull\n\t\tthis.newFaces = []; // this array holds the faces that are generated within a single iteration\n\n\t\t// the vertex lists work as follows:\n\t\t//\n\t\t// let 'a' and 'b' be 'Face' instances\n\t\t// let 'v' be points wrapped as instance of 'Vertex'\n\t\t//\n\t\t//     [v, v, ..., v, v, v, ...]\n\t\t//      ^             ^\n\t\t//      |             |\n\t\t//  a.outside     b.outside\n\t\t//\n\t\tthis.assigned = new VertexList();\n\t\tthis.unassigned = new VertexList();\n\n\t\tthis.vertices = []; \t// vertices of the hull (internal representation of given geometry data)\n\n\t}\n\n\tsetFromPoints( points ) {\n\n\t\tif ( Array.isArray( points ) !== true ) {\n\n\t\t\tconsole.error( 'THREE.ConvexHull: Points parameter is not an array.' );\n\n\t\t}\n\n\t\tif ( points.length < 4 ) {\n\n\t\t\tconsole.error( 'THREE.ConvexHull: The algorithm needs at least four points.' );\n\n\t\t}\n\n\t\tthis.makeEmpty();\n\n\t\tfor ( let i = 0, l = points.length; i < l; i ++ ) {\n\n\t\t\tthis.vertices.push( new VertexNode( points[ i ] ) );\n\n\t\t}\n\n\t\tthis.compute();\n\n\t\treturn this;\n\n\t}\n\n\tsetFromObject( object ) {\n\n\t\tconst points = [];\n\n\t\tobject.updateMatrixWorld( true );\n\n\t\tobject.traverse( function ( node ) {\n\n\t\t\tconst geometry = node.geometry;\n\n\t\t\tif ( geometry !== undefined ) {\n\n\t\t\t\tif ( geometry.isGeometry ) {\n\n\t\t\t\t\tconsole.error( 'THREE.ConvexHull no longer supports Geometry. Use THREE.BufferGeometry instead.' );\n\t\t\t\t\treturn;\n\n\t\t\t\t} else if ( geometry.isBufferGeometry ) {\n\n\t\t\t\t\tconst attribute = geometry.attributes.position;\n\n\t\t\t\t\tif ( attribute !== undefined ) {\n\n\t\t\t\t\t\tfor ( let i = 0, l = attribute.count; i < l; i ++ ) {\n\n\t\t\t\t\t\t\tconst point = new Vector3();\n\n\t\t\t\t\t\t\tpoint.fromBufferAttribute( attribute, i ).applyMatrix4( node.matrixWorld );\n\n\t\t\t\t\t\t\tpoints.push( point );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} );\n\n\t\treturn this.setFromPoints( points );\n\n\t}\n\n\tcontainsPoint( point ) {\n\n\t\tconst faces = this.faces;\n\n\t\tfor ( let i = 0, l = faces.length; i < l; i ++ ) {\n\n\t\t\tconst face = faces[ i ];\n\n\t\t\t// compute signed distance and check on what half space the point lies\n\n\t\t\tif ( face.distanceToPoint( point ) > this.tolerance ) return false;\n\n\t\t}\n\n\t\treturn true;\n\n\t}\n\n\tintersectRay( ray, target ) {\n\n\t\t// based on \"Fast Ray-Convex Polyhedron Intersection\"  by Eric Haines, GRAPHICS GEMS II\n\n\t\tconst faces = this.faces;\n\n\t\tlet tNear = - Infinity;\n\t\tlet tFar = Infinity;\n\n\t\tfor ( let i = 0, l = faces.length; i < l; i ++ ) {\n\n\t\t\tconst face = faces[ i ];\n\n\t\t\t// interpret faces as planes for the further computation\n\n\t\t\tconst vN = face.distanceToPoint( ray.origin );\n\t\t\tconst vD = face.normal.dot( ray.direction );\n\n\t\t\t// if the origin is on the positive side of a plane (so the plane can \"see\" the origin) and\n\t\t\t// the ray is turned away or parallel to the plane, there is no intersection\n\n\t\t\tif ( vN > 0 && vD >= 0 ) return null;\n\n\t\t\t// compute the distance from the rays origin to the intersection with the plane\n\n\t\t\tconst t = ( vD !== 0 ) ? ( - vN / vD ) : 0;\n\n\t\t\t// only proceed if the distance is positive. a negative distance means the intersection point\n\t\t\t// lies \"behind\" the origin\n\n\t\t\tif ( t <= 0 ) continue;\n\n\t\t\t// now categorized plane as front-facing or back-facing\n\n\t\t\tif ( vD > 0 ) {\n\n\t\t\t\t//  plane faces away from the ray, so this plane is a back-face\n\n\t\t\t\ttFar = Math.min( t, tFar );\n\n\t\t\t} else {\n\n\t\t\t\t// front-face\n\n\t\t\t\ttNear = Math.max( t, tNear );\n\n\t\t\t}\n\n\t\t\tif ( tNear > tFar ) {\n\n\t\t\t\t// if tNear ever is greater than tFar, the ray must miss the convex hull\n\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t}\n\n\t\t// evaluate intersection point\n\n\t\t// always try tNear first since its the closer intersection point\n\n\t\tif ( tNear !== - Infinity ) {\n\n\t\t\tray.at( tNear, target );\n\n\t\t} else {\n\n\t\t\tray.at( tFar, target );\n\n\t\t}\n\n\t\treturn target;\n\n\t}\n\n\tintersectsRay( ray ) {\n\n\t\treturn this.intersectRay( ray, _v1 ) !== null;\n\n\t}\n\n\tmakeEmpty() {\n\n\t\tthis.faces = [];\n\t\tthis.vertices = [];\n\n\t\treturn this;\n\n\t}\n\n\t// Adds a vertex to the 'assigned' list of vertices and assigns it to the given face\n\n\taddVertexToFace( vertex, face ) {\n\n\t\tvertex.face = face;\n\n\t\tif ( face.outside === null ) {\n\n\t\t\tthis.assigned.append( vertex );\n\n\t\t} else {\n\n\t\t\tthis.assigned.insertBefore( face.outside, vertex );\n\n\t\t}\n\n\t\tface.outside = vertex;\n\n\t\treturn this;\n\n\t}\n\n\t// Removes a vertex from the 'assigned' list of vertices and from the given face\n\n\tremoveVertexFromFace( vertex, face ) {\n\n\t\tif ( vertex === face.outside ) {\n\n\t\t\t// fix face.outside link\n\n\t\t\tif ( vertex.next !== null && vertex.next.face === face ) {\n\n\t\t\t\t// face has at least 2 outside vertices, move the 'outside' reference\n\n\t\t\t\tface.outside = vertex.next;\n\n\t\t\t} else {\n\n\t\t\t\t// vertex was the only outside vertex that face had\n\n\t\t\t\tface.outside = null;\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.assigned.remove( vertex );\n\n\t\treturn this;\n\n\t}\n\n\t// Removes all the visible vertices that a given face is able to see which are stored in the 'assigned' vertext list\n\n\tremoveAllVerticesFromFace( face ) {\n\n\t\tif ( face.outside !== null ) {\n\n\t\t\t// reference to the first and last vertex of this face\n\n\t\t\tconst start = face.outside;\n\t\t\tlet end = face.outside;\n\n\t\t\twhile ( end.next !== null && end.next.face === face ) {\n\n\t\t\t\tend = end.next;\n\n\t\t\t}\n\n\t\t\tthis.assigned.removeSubList( start, end );\n\n\t\t\t// fix references\n\n\t\t\tstart.prev = end.next = null;\n\t\t\tface.outside = null;\n\n\t\t\treturn start;\n\n\t\t}\n\n\t}\n\n\t// Removes all the visible vertices that 'face' is able to see\n\n\tdeleteFaceVertices( face, absorbingFace ) {\n\n\t\tconst faceVertices = this.removeAllVerticesFromFace( face );\n\n\t\tif ( faceVertices !== undefined ) {\n\n\t\t\tif ( absorbingFace === undefined ) {\n\n\t\t\t\t// mark the vertices to be reassigned to some other face\n\n\t\t\t\tthis.unassigned.appendChain( faceVertices );\n\n\n\t\t\t} else {\n\n\t\t\t\t// if there's an absorbing face try to assign as many vertices as possible to it\n\n\t\t\t\tlet vertex = faceVertices;\n\n\t\t\t\tdo {\n\n\t\t\t\t\t// we need to buffer the subsequent vertex at this point because the 'vertex.next' reference\n\t\t\t\t\t// will be changed by upcoming method calls\n\n\t\t\t\t\tconst nextVertex = vertex.next;\n\n\t\t\t\t\tconst distance = absorbingFace.distanceToPoint( vertex.point );\n\n\t\t\t\t\t// check if 'vertex' is able to see 'absorbingFace'\n\n\t\t\t\t\tif ( distance > this.tolerance ) {\n\n\t\t\t\t\t\tthis.addVertexToFace( vertex, absorbingFace );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tthis.unassigned.append( vertex );\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// now assign next vertex\n\n\t\t\t\t\tvertex = nextVertex;\n\n\t\t\t\t} while ( vertex !== null );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\t// Reassigns as many vertices as possible from the unassigned list to the new faces\n\n\tresolveUnassignedPoints( newFaces ) {\n\n\t\tif ( this.unassigned.isEmpty() === false ) {\n\n\t\t\tlet vertex = this.unassigned.first();\n\n\t\t\tdo {\n\n\t\t\t\t// buffer 'next' reference, see .deleteFaceVertices()\n\n\t\t\t\tconst nextVertex = vertex.next;\n\n\t\t\t\tlet maxDistance = this.tolerance;\n\n\t\t\t\tlet maxFace = null;\n\n\t\t\t\tfor ( let i = 0; i < newFaces.length; i ++ ) {\n\n\t\t\t\t\tconst face = newFaces[ i ];\n\n\t\t\t\t\tif ( face.mark === Visible ) {\n\n\t\t\t\t\t\tconst distance = face.distanceToPoint( vertex.point );\n\n\t\t\t\t\t\tif ( distance > maxDistance ) {\n\n\t\t\t\t\t\t\tmaxDistance = distance;\n\t\t\t\t\t\t\tmaxFace = face;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( maxDistance > 1000 * this.tolerance ) break;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// 'maxFace' can be null e.g. if there are identical vertices\n\n\t\t\t\tif ( maxFace !== null ) {\n\n\t\t\t\t\tthis.addVertexToFace( vertex, maxFace );\n\n\t\t\t\t}\n\n\t\t\t\tvertex = nextVertex;\n\n\t\t\t} while ( vertex !== null );\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\t// Computes the extremes of a simplex which will be the initial hull\n\n\tcomputeExtremes() {\n\n\t\tconst min = new Vector3();\n\t\tconst max = new Vector3();\n\n\t\tconst minVertices = [];\n\t\tconst maxVertices = [];\n\n\t\t// initially assume that the first vertex is the min/max\n\n\t\tfor ( let i = 0; i < 3; i ++ ) {\n\n\t\t\tminVertices[ i ] = maxVertices[ i ] = this.vertices[ 0 ];\n\n\t\t}\n\n\t\tmin.copy( this.vertices[ 0 ].point );\n\t\tmax.copy( this.vertices[ 0 ].point );\n\n\t\t// compute the min/max vertex on all six directions\n\n\t\tfor ( let i = 0, l = this.vertices.length; i < l; i ++ ) {\n\n\t\t\tconst vertex = this.vertices[ i ];\n\t\t\tconst point = vertex.point;\n\n\t\t\t// update the min coordinates\n\n\t\t\tfor ( let j = 0; j < 3; j ++ ) {\n\n\t\t\t\tif ( point.getComponent( j ) < min.getComponent( j ) ) {\n\n\t\t\t\t\tmin.setComponent( j, point.getComponent( j ) );\n\t\t\t\t\tminVertices[ j ] = vertex;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// update the max coordinates\n\n\t\t\tfor ( let j = 0; j < 3; j ++ ) {\n\n\t\t\t\tif ( point.getComponent( j ) > max.getComponent( j ) ) {\n\n\t\t\t\t\tmax.setComponent( j, point.getComponent( j ) );\n\t\t\t\t\tmaxVertices[ j ] = vertex;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\t// use min/max vectors to compute an optimal epsilon\n\n\t\tthis.tolerance = 3 * Number.EPSILON * (\n\t\t\tMath.max( Math.abs( min.x ), Math.abs( max.x ) ) +\n\t\t\tMath.max( Math.abs( min.y ), Math.abs( max.y ) ) +\n\t\t\tMath.max( Math.abs( min.z ), Math.abs( max.z ) )\n\t\t);\n\n\t\treturn { min: minVertices, max: maxVertices };\n\n\t}\n\n\t// Computes the initial simplex assigning to its faces all the points\n\t// that are candidates to form part of the hull\n\n\tcomputeInitialHull() {\n\n\t\tconst vertices = this.vertices;\n\t\tconst extremes = this.computeExtremes();\n\t\tconst min = extremes.min;\n\t\tconst max = extremes.max;\n\n\t\t// 1. Find the two vertices 'v0' and 'v1' with the greatest 1d separation\n\t\t// (max.x - min.x)\n\t\t// (max.y - min.y)\n\t\t// (max.z - min.z)\n\n\t\tlet maxDistance = 0;\n\t\tlet index = 0;\n\n\t\tfor ( let i = 0; i < 3; i ++ ) {\n\n\t\t\tconst distance = max[ i ].point.getComponent( i ) - min[ i ].point.getComponent( i );\n\n\t\t\tif ( distance > maxDistance ) {\n\n\t\t\t\tmaxDistance = distance;\n\t\t\t\tindex = i;\n\n\t\t\t}\n\n\t\t}\n\n\t\tconst v0 = min[ index ];\n\t\tconst v1 = max[ index ];\n\t\tlet v2;\n\t\tlet v3;\n\n\t\t// 2. The next vertex 'v2' is the one farthest to the line formed by 'v0' and 'v1'\n\n\t\tmaxDistance = 0;\n\t\t_line3.set( v0.point, v1.point );\n\n\t\tfor ( let i = 0, l = this.vertices.length; i < l; i ++ ) {\n\n\t\t\tconst vertex = vertices[ i ];\n\n\t\t\tif ( vertex !== v0 && vertex !== v1 ) {\n\n\t\t\t\t_line3.closestPointToPoint( vertex.point, true, _closestPoint );\n\n\t\t\t\tconst distance = _closestPoint.distanceToSquared( vertex.point );\n\n\t\t\t\tif ( distance > maxDistance ) {\n\n\t\t\t\t\tmaxDistance = distance;\n\t\t\t\t\tv2 = vertex;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\t// 3. The next vertex 'v3' is the one farthest to the plane 'v0', 'v1', 'v2'\n\n\t\tmaxDistance = - 1;\n\t\t_plane.setFromCoplanarPoints( v0.point, v1.point, v2.point );\n\n\t\tfor ( let i = 0, l = this.vertices.length; i < l; i ++ ) {\n\n\t\t\tconst vertex = vertices[ i ];\n\n\t\t\tif ( vertex !== v0 && vertex !== v1 && vertex !== v2 ) {\n\n\t\t\t\tconst distance = Math.abs( _plane.distanceToPoint( vertex.point ) );\n\n\t\t\t\tif ( distance > maxDistance ) {\n\n\t\t\t\t\tmaxDistance = distance;\n\t\t\t\t\tv3 = vertex;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tconst faces = [];\n\n\t\tif ( _plane.distanceToPoint( v3.point ) < 0 ) {\n\n\t\t\t// the face is not able to see the point so 'plane.normal' is pointing outside the tetrahedron\n\n\t\t\tfaces.push(\n\t\t\t\tFace.create( v0, v1, v2 ),\n\t\t\t\tFace.create( v3, v1, v0 ),\n\t\t\t\tFace.create( v3, v2, v1 ),\n\t\t\t\tFace.create( v3, v0, v2 )\n\t\t\t);\n\n\t\t\t// set the twin edge\n\n\t\t\tfor ( let i = 0; i < 3; i ++ ) {\n\n\t\t\t\tconst j = ( i + 1 ) % 3;\n\n\t\t\t\t// join face[ i ] i > 0, with the first face\n\n\t\t\t\tfaces[ i + 1 ].getEdge( 2 ).setTwin( faces[ 0 ].getEdge( j ) );\n\n\t\t\t\t// join face[ i ] with face[ i + 1 ], 1 <= i <= 3\n\n\t\t\t\tfaces[ i + 1 ].getEdge( 1 ).setTwin( faces[ j + 1 ].getEdge( 0 ) );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\t// the face is able to see the point so 'plane.normal' is pointing inside the tetrahedron\n\n\t\t\tfaces.push(\n\t\t\t\tFace.create( v0, v2, v1 ),\n\t\t\t\tFace.create( v3, v0, v1 ),\n\t\t\t\tFace.create( v3, v1, v2 ),\n\t\t\t\tFace.create( v3, v2, v0 )\n\t\t\t);\n\n\t\t\t// set the twin edge\n\n\t\t\tfor ( let i = 0; i < 3; i ++ ) {\n\n\t\t\t\tconst j = ( i + 1 ) % 3;\n\n\t\t\t\t// join face[ i ] i > 0, with the first face\n\n\t\t\t\tfaces[ i + 1 ].getEdge( 2 ).setTwin( faces[ 0 ].getEdge( ( 3 - i ) % 3 ) );\n\n\t\t\t\t// join face[ i ] with face[ i + 1 ]\n\n\t\t\t\tfaces[ i + 1 ].getEdge( 0 ).setTwin( faces[ j + 1 ].getEdge( 1 ) );\n\n\t\t\t}\n\n\t\t}\n\n\t\t// the initial hull is the tetrahedron\n\n\t\tfor ( let i = 0; i < 4; i ++ ) {\n\n\t\t\tthis.faces.push( faces[ i ] );\n\n\t\t}\n\n\t\t// initial assignment of vertices to the faces of the tetrahedron\n\n\t\tfor ( let i = 0, l = vertices.length; i < l; i ++ ) {\n\n\t\t\tconst vertex = vertices[ i ];\n\n\t\t\tif ( vertex !== v0 && vertex !== v1 && vertex !== v2 && vertex !== v3 ) {\n\n\t\t\t\tmaxDistance = this.tolerance;\n\t\t\t\tlet maxFace = null;\n\n\t\t\t\tfor ( let j = 0; j < 4; j ++ ) {\n\n\t\t\t\t\tconst distance = this.faces[ j ].distanceToPoint( vertex.point );\n\n\t\t\t\t\tif ( distance > maxDistance ) {\n\n\t\t\t\t\t\tmaxDistance = distance;\n\t\t\t\t\t\tmaxFace = this.faces[ j ];\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( maxFace !== null ) {\n\n\t\t\t\t\tthis.addVertexToFace( vertex, maxFace );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\t// Removes inactive faces\n\n\treindexFaces() {\n\n\t\tconst activeFaces = [];\n\n\t\tfor ( let i = 0; i < this.faces.length; i ++ ) {\n\n\t\t\tconst face = this.faces[ i ];\n\n\t\t\tif ( face.mark === Visible ) {\n\n\t\t\t\tactiveFaces.push( face );\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.faces = activeFaces;\n\n\t\treturn this;\n\n\t}\n\n\t// Finds the next vertex to create faces with the current hull\n\n\tnextVertexToAdd() {\n\n\t\t// if the 'assigned' list of vertices is empty, no vertices are left. return with 'undefined'\n\n\t\tif ( this.assigned.isEmpty() === false ) {\n\n\t\t\tlet eyeVertex, maxDistance = 0;\n\n\t\t\t// grap the first available face and start with the first visible vertex of that face\n\n\t\t\tconst eyeFace = this.assigned.first().face;\n\t\t\tlet vertex = eyeFace.outside;\n\n\t\t\t// now calculate the farthest vertex that face can see\n\n\t\t\tdo {\n\n\t\t\t\tconst distance = eyeFace.distanceToPoint( vertex.point );\n\n\t\t\t\tif ( distance > maxDistance ) {\n\n\t\t\t\t\tmaxDistance = distance;\n\t\t\t\t\teyeVertex = vertex;\n\n\t\t\t\t}\n\n\t\t\t\tvertex = vertex.next;\n\n\t\t\t} while ( vertex !== null && vertex.face === eyeFace );\n\n\t\t\treturn eyeVertex;\n\n\t\t}\n\n\t}\n\n\t// Computes a chain of half edges in CCW order called the 'horizon'.\n\t// For an edge to be part of the horizon it must join a face that can see\n\t// 'eyePoint' and a face that cannot see 'eyePoint'.\n\n\tcomputeHorizon( eyePoint, crossEdge, face, horizon ) {\n\n\t\t// moves face's vertices to the 'unassigned' vertex list\n\n\t\tthis.deleteFaceVertices( face );\n\n\t\tface.mark = Deleted;\n\n\t\tlet edge;\n\n\t\tif ( crossEdge === null ) {\n\n\t\t\tedge = crossEdge = face.getEdge( 0 );\n\n\t\t} else {\n\n\t\t\t// start from the next edge since 'crossEdge' was already analyzed\n\t\t\t// (actually 'crossEdge.twin' was the edge who called this method recursively)\n\n\t\t\tedge = crossEdge.next;\n\n\t\t}\n\n\t\tdo {\n\n\t\t\tconst twinEdge = edge.twin;\n\t\t\tconst oppositeFace = twinEdge.face;\n\n\t\t\tif ( oppositeFace.mark === Visible ) {\n\n\t\t\t\tif ( oppositeFace.distanceToPoint( eyePoint ) > this.tolerance ) {\n\n\t\t\t\t\t// the opposite face can see the vertex, so proceed with next edge\n\n\t\t\t\t\tthis.computeHorizon( eyePoint, twinEdge, oppositeFace, horizon );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// the opposite face can't see the vertex, so this edge is part of the horizon\n\n\t\t\t\t\thorizon.push( edge );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tedge = edge.next;\n\n\t\t} while ( edge !== crossEdge );\n\n\t\treturn this;\n\n\t}\n\n\t// Creates a face with the vertices 'eyeVertex.point', 'horizonEdge.tail' and 'horizonEdge.head' in CCW order\n\n\taddAdjoiningFace( eyeVertex, horizonEdge ) {\n\n\t\t// all the half edges are created in ccw order thus the face is always pointing outside the hull\n\n\t\tconst face = Face.create( eyeVertex, horizonEdge.tail(), horizonEdge.head() );\n\n\t\tthis.faces.push( face );\n\n\t\t// join face.getEdge( - 1 ) with the horizon's opposite edge face.getEdge( - 1 ) = face.getEdge( 2 )\n\n\t\tface.getEdge( - 1 ).setTwin( horizonEdge.twin );\n\n\t\treturn face.getEdge( 0 ); // the half edge whose vertex is the eyeVertex\n\n\n\t}\n\n\t//  Adds 'horizon.length' faces to the hull, each face will be linked with the\n\t//  horizon opposite face and the face on the left/right\n\n\taddNewFaces( eyeVertex, horizon ) {\n\n\t\tthis.newFaces = [];\n\n\t\tlet firstSideEdge = null;\n\t\tlet previousSideEdge = null;\n\n\t\tfor ( let i = 0; i < horizon.length; i ++ ) {\n\n\t\t\tconst horizonEdge = horizon[ i ];\n\n\t\t\t// returns the right side edge\n\n\t\t\tconst sideEdge = this.addAdjoiningFace( eyeVertex, horizonEdge );\n\n\t\t\tif ( firstSideEdge === null ) {\n\n\t\t\t\tfirstSideEdge = sideEdge;\n\n\t\t\t} else {\n\n\t\t\t\t// joins face.getEdge( 1 ) with previousFace.getEdge( 0 )\n\n\t\t\t\tsideEdge.next.setTwin( previousSideEdge );\n\n\t\t\t}\n\n\t\t\tthis.newFaces.push( sideEdge.face );\n\t\t\tpreviousSideEdge = sideEdge;\n\n\t\t}\n\n\t\t// perform final join of new faces\n\n\t\tfirstSideEdge.next.setTwin( previousSideEdge );\n\n\t\treturn this;\n\n\t}\n\n\t// Adds a vertex to the hull\n\n\taddVertexToHull( eyeVertex ) {\n\n\t\tconst horizon = [];\n\n\t\tthis.unassigned.clear();\n\n\t\t// remove 'eyeVertex' from 'eyeVertex.face' so that it can't be added to the 'unassigned' vertex list\n\n\t\tthis.removeVertexFromFace( eyeVertex, eyeVertex.face );\n\n\t\tthis.computeHorizon( eyeVertex.point, null, eyeVertex.face, horizon );\n\n\t\tthis.addNewFaces( eyeVertex, horizon );\n\n\t\t// reassign 'unassigned' vertices to the new faces\n\n\t\tthis.resolveUnassignedPoints( this.newFaces );\n\n\t\treturn\tthis;\n\n\t}\n\n\tcleanup() {\n\n\t\tthis.assigned.clear();\n\t\tthis.unassigned.clear();\n\t\tthis.newFaces = [];\n\n\t\treturn this;\n\n\t}\n\n\tcompute() {\n\n\t\tlet vertex;\n\n\t\tthis.computeInitialHull();\n\n\t\t// add all available vertices gradually to the hull\n\n\t\twhile ( ( vertex = this.nextVertexToAdd() ) !== undefined ) {\n\n\t\t\tthis.addVertexToHull( vertex );\n\n\t\t}\n\n\t\tthis.reindexFaces();\n\n\t\tthis.cleanup();\n\n\t\treturn this;\n\n\t}\n\n}\n\n//\n\nclass Face {\n\n\tconstructor() {\n\n\t\tthis.normal = new Vector3();\n\t\tthis.midpoint = new Vector3();\n\t\tthis.area = 0;\n\n\t\tthis.constant = 0; // signed distance from face to the origin\n\t\tthis.outside = null; // reference to a vertex in a vertex list this face can see\n\t\tthis.mark = Visible;\n\t\tthis.edge = null;\n\n\t}\n\n\tstatic create( a, b, c ) {\n\n\t\tconst face = new Face();\n\n\t\tconst e0 = new HalfEdge( a, face );\n\t\tconst e1 = new HalfEdge( b, face );\n\t\tconst e2 = new HalfEdge( c, face );\n\n\t\t// join edges\n\n\t\te0.next = e2.prev = e1;\n\t\te1.next = e0.prev = e2;\n\t\te2.next = e1.prev = e0;\n\n\t\t// main half edge reference\n\n\t\tface.edge = e0;\n\n\t\treturn face.compute();\n\n\t}\n\n\tgetEdge( i ) {\n\n\t\tlet edge = this.edge;\n\n\t\twhile ( i > 0 ) {\n\n\t\t\tedge = edge.next;\n\t\t\ti --;\n\n\t\t}\n\n\t\twhile ( i < 0 ) {\n\n\t\t\tedge = edge.prev;\n\t\t\ti ++;\n\n\t\t}\n\n\t\treturn edge;\n\n\t}\n\n\tcompute() {\n\n\t\tconst a = this.edge.tail();\n\t\tconst b = this.edge.head();\n\t\tconst c = this.edge.next.head();\n\n\t\t_triangle.set( a.point, b.point, c.point );\n\n\t\t_triangle.getNormal( this.normal );\n\t\t_triangle.getMidpoint( this.midpoint );\n\t\tthis.area = _triangle.getArea();\n\n\t\tthis.constant = this.normal.dot( this.midpoint );\n\n\t\treturn this;\n\n\t}\n\n\tdistanceToPoint( point ) {\n\n\t\treturn this.normal.dot( point ) - this.constant;\n\n\t}\n\n}\n\n// Entity for a Doubly-Connected Edge List (DCEL).\n\nclass HalfEdge {\n\n\n\tconstructor( vertex, face ) {\n\n\t\tthis.vertex = vertex;\n\t\tthis.prev = null;\n\t\tthis.next = null;\n\t\tthis.twin = null;\n\t\tthis.face = face;\n\n\t}\n\n\thead() {\n\n\t\treturn this.vertex;\n\n\t}\n\n\ttail() {\n\n\t\treturn this.prev ? this.prev.vertex : null;\n\n\t}\n\n\tlength() {\n\n\t\tconst head = this.head();\n\t\tconst tail = this.tail();\n\n\t\tif ( tail !== null ) {\n\n\t\t\treturn tail.point.distanceTo( head.point );\n\n\t\t}\n\n\t\treturn - 1;\n\n\t}\n\n\tlengthSquared() {\n\n\t\tconst head = this.head();\n\t\tconst tail = this.tail();\n\n\t\tif ( tail !== null ) {\n\n\t\t\treturn tail.point.distanceToSquared( head.point );\n\n\t\t}\n\n\t\treturn - 1;\n\n\t}\n\n\tsetTwin( edge ) {\n\n\t\tthis.twin = edge;\n\t\tedge.twin = this;\n\n\t\treturn this;\n\n\t}\n\n}\n\n// A vertex as a double linked list node.\n\nclass VertexNode {\n\n\tconstructor( point ) {\n\n\t\tthis.point = point;\n\t\tthis.prev = null;\n\t\tthis.next = null;\n\t\tthis.face = null; // the face that is able to see this vertex\n\n\t}\n\n}\n\n// A double linked list that contains vertex nodes.\n\nclass VertexList {\n\n\tconstructor() {\n\n\t\tthis.head = null;\n\t\tthis.tail = null;\n\n\t}\n\n\tfirst() {\n\n\t\treturn this.head;\n\n\t}\n\n\tlast() {\n\n\t\treturn this.tail;\n\n\t}\n\n\tclear() {\n\n\t\tthis.head = this.tail = null;\n\n\t\treturn this;\n\n\t}\n\n\t// Inserts a vertex before the target vertex\n\n\tinsertBefore( target, vertex ) {\n\n\t\tvertex.prev = target.prev;\n\t\tvertex.next = target;\n\n\t\tif ( vertex.prev === null ) {\n\n\t\t\tthis.head = vertex;\n\n\t\t} else {\n\n\t\t\tvertex.prev.next = vertex;\n\n\t\t}\n\n\t\ttarget.prev = vertex;\n\n\t\treturn this;\n\n\t}\n\n\t// Inserts a vertex after the target vertex\n\n\tinsertAfter( target, vertex ) {\n\n\t\tvertex.prev = target;\n\t\tvertex.next = target.next;\n\n\t\tif ( vertex.next === null ) {\n\n\t\t\tthis.tail = vertex;\n\n\t\t} else {\n\n\t\t\tvertex.next.prev = vertex;\n\n\t\t}\n\n\t\ttarget.next = vertex;\n\n\t\treturn this;\n\n\t}\n\n\t// Appends a vertex to the end of the linked list\n\n\tappend( vertex ) {\n\n\t\tif ( this.head === null ) {\n\n\t\t\tthis.head = vertex;\n\n\t\t} else {\n\n\t\t\tthis.tail.next = vertex;\n\n\t\t}\n\n\t\tvertex.prev = this.tail;\n\t\tvertex.next = null; // the tail has no subsequent vertex\n\n\t\tthis.tail = vertex;\n\n\t\treturn this;\n\n\t}\n\n\t// Appends a chain of vertices where 'vertex' is the head.\n\n\tappendChain( vertex ) {\n\n\t\tif ( this.head === null ) {\n\n\t\t\tthis.head = vertex;\n\n\t\t} else {\n\n\t\t\tthis.tail.next = vertex;\n\n\t\t}\n\n\t\tvertex.prev = this.tail;\n\n\t\t// ensure that the 'tail' reference points to the last vertex of the chain\n\n\t\twhile ( vertex.next !== null ) {\n\n\t\t\tvertex = vertex.next;\n\n\t\t}\n\n\t\tthis.tail = vertex;\n\n\t\treturn this;\n\n\t}\n\n\t// Removes a vertex from the linked list\n\n\tremove( vertex ) {\n\n\t\tif ( vertex.prev === null ) {\n\n\t\t\tthis.head = vertex.next;\n\n\t\t} else {\n\n\t\t\tvertex.prev.next = vertex.next;\n\n\t\t}\n\n\t\tif ( vertex.next === null ) {\n\n\t\t\tthis.tail = vertex.prev;\n\n\t\t} else {\n\n\t\t\tvertex.next.prev = vertex.prev;\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\t// Removes a list of vertices whose 'head' is 'a' and whose 'tail' is b\n\n\tremoveSubList( a, b ) {\n\n\t\tif ( a.prev === null ) {\n\n\t\t\tthis.head = b.next;\n\n\t\t} else {\n\n\t\t\ta.prev.next = b.next;\n\n\t\t}\n\n\t\tif ( b.next === null ) {\n\n\t\t\tthis.tail = a.prev;\n\n\t\t} else {\n\n\t\t\tb.next.prev = a.prev;\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\tisEmpty() {\n\n\t\treturn this.head === null;\n\n\t}\n\n}\n\nexport { ConvexHull };\n","import {\n\tBufferGeometry,\n\tFloat32BufferAttribute\n} from 'three';\nimport { ConvexHull } from '../math/ConvexHull.js';\n\nclass ConvexGeometry extends BufferGeometry {\n\n\tconstructor( points ) {\n\n\t\tsuper();\n\n\t\t// buffers\n\n\t\tconst vertices = [];\n\t\tconst normals = [];\n\n\t\tif ( ConvexHull === undefined ) {\n\n\t\t\tconsole.error( 'THREE.ConvexBufferGeometry: ConvexBufferGeometry relies on ConvexHull' );\n\n\t\t}\n\n\t\tconst convexHull = new ConvexHull().setFromPoints( points );\n\n\t\t// generate vertices and normals\n\n\t\tconst faces = convexHull.faces;\n\n\t\tfor ( let i = 0; i < faces.length; i ++ ) {\n\n\t\t\tconst face = faces[ i ];\n\t\t\tlet edge = face.edge;\n\n\t\t\t// we move along a doubly-connected edge list to access all face points (see HalfEdge docs)\n\n\t\t\tdo {\n\n\t\t\t\tconst point = edge.head().point;\n\n\t\t\t\tvertices.push( point.x, point.y, point.z );\n\t\t\t\tnormals.push( face.normal.x, face.normal.y, face.normal.z );\n\n\t\t\t\tedge = edge.next;\n\n\t\t\t} while ( edge !== face.edge );\n\n\t\t}\n\n\t\t// build geometry\n\n\t\tthis.setAttribute( 'position', new Float32BufferAttribute( vertices, 3 ) );\n\t\tthis.setAttribute( 'normal', new Float32BufferAttribute( normals, 3 ) );\n\n\t}\n\n}\n\nexport { ConvexGeometry };\n","/* eslint-disable @typescript-eslint/no-redeclare */\r\n/**\r\n * Copied from three.js examples and added a fix\r\n */\r\n/**\r\n * @author yomboprime https://github.com/yomboprime\r\n *\r\n * @fileoverview This class can be used to subdivide a convex Geometry object into pieces.\r\n *\r\n * Usage:\r\n *\r\n * Use the function prepareBreakableObject to prepare a Mesh object to be broken.\r\n *\r\n * Then, call the various functions to subdivide the object (subdivideByImpact, cutByPlane)\r\n *\r\n * Sub-objects that are product of subdivision don't need prepareBreakableObject to be called on them.\r\n *\r\n * Requisites for the object:\r\n *\r\n *  - Mesh object must have a BufferGeometry (not Geometry) and a Material\r\n *\r\n *  - Vertex normals must be planar (not smoothed)\r\n *\r\n *  - The geometry must be convex (this is not checked in the library). You can create convex\r\n *  geometries with ConvexBufferGeometry. The BoxBufferGeometry, SphereBufferGeometry and other convex primitives\r\n *  can also be used.\r\n *\r\n * Note: This lib adds member variables to object's userData member (see prepareBreakableObject function)\r\n * Use with caution and read the code when using with other libs.\r\n *\r\n * @param {double} minSizeForBreak Min size a debris can have to break.\r\n * @param {double} smallDelta Max distance to consider that a point belongs to a plane.\r\n *\r\n */\r\nimport { Line3, Mesh, Plane, Vector3 } from 'three';\r\nimport { ConvexGeometry } from './externals';\r\nimport { logger } from '@enable3d/common/dist/logger';\r\nconst newConvexGeometry = (points) => {\r\n    // @ts-ignore\r\n    const _newConvexGeometry = window.THREE && window.THREE.ConvexGeometry ? window.THREE.ConvexGeometry : ConvexGeometry;\r\n    return new _newConvexGeometry(points);\r\n};\r\nconst ConvexObjectBreaker = function (minSizeForBreak, smallDelta) {\r\n    // @ts-ignore\r\n    this.minSizeForBreak = minSizeForBreak || 1.4;\r\n    // @ts-ignore\r\n    this.smallDelta = smallDelta || 0.0001;\r\n    // @ts-ignore\r\n    this.tempLine1 = new Line3();\r\n    // @ts-ignore\r\n    this.tempPlane1 = new Plane();\r\n    // @ts-ignore\r\n    this.tempPlane2 = new Plane();\r\n    // @ts-ignore\r\n    this.tempPlane_Cut = new Plane();\r\n    // @ts-ignore\r\n    this.tempCM1 = new Vector3();\r\n    // @ts-ignore\r\n    this.tempCM2 = new Vector3();\r\n    // @ts-ignore\r\n    this.tempVector3 = new Vector3();\r\n    // @ts-ignore\r\n    this.tempVector3_2 = new Vector3();\r\n    // @ts-ignore\r\n    this.tempVector3_3 = new Vector3();\r\n    // @ts-ignore\r\n    this.tempVector3_P0 = new Vector3();\r\n    // @ts-ignore\r\n    this.tempVector3_P1 = new Vector3();\r\n    // @ts-ignore\r\n    this.tempVector3_P2 = new Vector3();\r\n    // @ts-ignore\r\n    this.tempVector3_N0 = new Vector3();\r\n    // @ts-ignore\r\n    this.tempVector3_N1 = new Vector3();\r\n    // @ts-ignore\r\n    this.tempVector3_AB = new Vector3();\r\n    // @ts-ignore\r\n    this.tempVector3_CB = new Vector3();\r\n    // @ts-ignore\r\n    this.tempResultObjects = { object1: null, object2: null };\r\n    // @ts-ignore\r\n    this.segments = [];\r\n    var n = 30 * 30;\r\n    // @ts-ignore\r\n    for (var i = 0; i < n; i++)\r\n        this.segments[i] = false;\r\n};\r\nConvexObjectBreaker.prototype = {\r\n    constructor: ConvexObjectBreaker,\r\n    prepareBreakableObject: function (object, mass, velocity, angularVelocity, breakable) {\r\n        // object is a Object3d (normally a Mesh), must have a BufferGeometry, and it must be convex.\r\n        // Its material property is propagated to its children (sub-pieces)\r\n        // mass must be > 0\r\n        if (!object.geometry.isBufferGeometry) {\r\n            console.error('THREE.ConvexObjectBreaker.prepareBreakableObject(): Parameter object must have a BufferGeometry.');\r\n        }\r\n        object.userData.ammoPhysicsData = {}; // initialise our new data container - would be best to move this to ExtendedObject and not rely on userData at all for best compatibility\r\n        var ammoPhysicsData = object.userData.ammoPhysicsData; // get reference to it\r\n        ammoPhysicsData.mass = mass;\r\n        ammoPhysicsData.velocity = velocity.clone();\r\n        ammoPhysicsData.angularVelocity = angularVelocity.clone();\r\n        ammoPhysicsData.breakable = breakable;\r\n    },\r\n    /*\r\n     * @param {int} maxRadialIterations Iterations for radial cuts.\r\n     * @param {int} maxRandomIterations Max random iterations for not-radial cuts\r\n     *\r\n     * Returns the array of pieces\r\n     */\r\n    subdivideByImpact: function (object, pointOfImpact, normal, maxRadialIterations, maxRandomIterations) {\r\n        var debris = [];\r\n        var tempPlane1 = this.tempPlane1;\r\n        var tempPlane2 = this.tempPlane2;\r\n        this.tempVector3.addVectors(pointOfImpact, normal);\r\n        tempPlane1.setFromCoplanarPoints(pointOfImpact, object.position, this.tempVector3);\r\n        var maxTotalIterations = maxRandomIterations + maxRadialIterations;\r\n        var scope = this;\r\n        function subdivideRadial(subObject, startAngle, endAngle, numIterations) {\r\n            if (Math.random() < numIterations * 0.05 || numIterations > maxTotalIterations) {\r\n                debris.push(subObject);\r\n                return;\r\n            }\r\n            var angle = Math.PI;\r\n            if (numIterations === 0) {\r\n                tempPlane2.normal.copy(tempPlane1.normal);\r\n                tempPlane2.constant = tempPlane1.constant;\r\n            }\r\n            else {\r\n                if (numIterations <= maxRadialIterations) {\r\n                    angle = (endAngle - startAngle) * (0.2 + 0.6 * Math.random()) + startAngle;\r\n                    // Rotate tempPlane2 at impact point around normal axis and the angle\r\n                    scope.tempVector3_2.copy(object.position).sub(pointOfImpact).applyAxisAngle(normal, angle).add(pointOfImpact);\r\n                    tempPlane2.setFromCoplanarPoints(pointOfImpact, scope.tempVector3, scope.tempVector3_2);\r\n                }\r\n                else {\r\n                    angle = (0.5 * (numIterations & 1) + 0.2 * (2 - Math.random())) * Math.PI;\r\n                    // Rotate tempPlane2 at object position around normal axis and the angle\r\n                    scope.tempVector3_2\r\n                        .copy(pointOfImpact)\r\n                        .sub(subObject.position)\r\n                        .applyAxisAngle(normal, angle)\r\n                        .add(subObject.position);\r\n                    scope.tempVector3_3.copy(normal).add(subObject.position);\r\n                    tempPlane2.setFromCoplanarPoints(subObject.position, scope.tempVector3_3, scope.tempVector3_2);\r\n                }\r\n            }\r\n            // Perform the cut\r\n            scope.cutByPlane(subObject, tempPlane2, scope.tempResultObjects);\r\n            var obj1 = scope.tempResultObjects.object1;\r\n            var obj2 = scope.tempResultObjects.object2;\r\n            if (obj1) {\r\n                subdivideRadial(obj1, startAngle, angle, numIterations + 1);\r\n            }\r\n            if (obj2) {\r\n                subdivideRadial(obj2, angle, endAngle, numIterations + 1);\r\n            }\r\n        }\r\n        subdivideRadial(object, 0, 2 * Math.PI, 0);\r\n        return debris;\r\n    },\r\n    cutByPlane: function (object, plane, output) {\r\n        // Returns breakable objects in output.object1 and output.object2 members, the resulting 2 pieces of the cut.\r\n        // object2 can be null if the plane doesn't cut the object.\r\n        // object1 can be null only in case of internal error\r\n        // Returned value is number of pieces, 0 for error.\r\n        var geometry = object.geometry;\r\n        var coords = geometry.attributes.position.array;\r\n        var normals = geometry.attributes.normal.array;\r\n        var numPoints = coords.length / 3;\r\n        var numFaces = numPoints / 3;\r\n        var indices = geometry.getIndex();\r\n        if (indices) {\r\n            indices = indices.array;\r\n            numFaces = indices.length / 3;\r\n        }\r\n        function getVertexIndex(faceIdx, vert) {\r\n            // vert = 0, 1 or 2.\r\n            var idx = faceIdx * 3 + vert;\r\n            return indices ? indices[idx] : idx;\r\n        }\r\n        var points1 = [];\r\n        var points2 = [];\r\n        var delta = this.smallDelta;\r\n        // Reset segments mark\r\n        var numPointPairs = numPoints * numPoints;\r\n        for (var i = 0; i < numPointPairs; i++)\r\n            this.segments[i] = false;\r\n        var p0 = this.tempVector3_P0;\r\n        var p1 = this.tempVector3_P1;\r\n        var n0 = this.tempVector3_N0;\r\n        var n1 = this.tempVector3_N1;\r\n        // Iterate through the faces to mark edges shared by coplanar faces\r\n        for (var i = 0; i < numFaces - 1; i++) {\r\n            var a1 = getVertexIndex(i, 0);\r\n            var b1 = getVertexIndex(i, 1);\r\n            var c1 = getVertexIndex(i, 2);\r\n            // Assuming all 3 vertices have the same normal\r\n            n0.set(normals[a1], normals[a1] + 1, normals[a1] + 2);\r\n            for (var j = i + 1; j < numFaces; j++) {\r\n                var a2 = getVertexIndex(j, 0);\r\n                var b2 = getVertexIndex(j, 1);\r\n                var c2 = getVertexIndex(j, 2);\r\n                // Assuming all 3 vertices have the same normal\r\n                n1.set(normals[a2], normals[a2] + 1, normals[a2] + 2);\r\n                var coplanar = 1 - n0.dot(n1) < delta;\r\n                if (coplanar) {\r\n                    if (a1 === a2 || a1 === b2 || a1 === c2) {\r\n                        if (b1 === a2 || b1 === b2 || b1 === c2) {\r\n                            this.segments[a1 * numPoints + b1] = true;\r\n                            this.segments[b1 * numPoints + a1] = true;\r\n                        }\r\n                        else {\r\n                            this.segments[c1 * numPoints + a1] = true;\r\n                            this.segments[a1 * numPoints + c1] = true;\r\n                        }\r\n                    }\r\n                    else if (b1 === a2 || b1 === b2 || b1 === c2) {\r\n                        this.segments[c1 * numPoints + b1] = true;\r\n                        this.segments[b1 * numPoints + c1] = true;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        // Transform the plane to object local space\r\n        var localPlane = this.tempPlane_Cut;\r\n        object.updateMatrix();\r\n        ConvexObjectBreaker.transformPlaneToLocalSpace(plane, object.matrix, localPlane);\r\n        // Iterate through the faces adding points to both pieces\r\n        for (var i = 0; i < numFaces; i++) {\r\n            var va = getVertexIndex(i, 0);\r\n            var vb = getVertexIndex(i, 1);\r\n            var vc = getVertexIndex(i, 2);\r\n            for (var segment = 0; segment < 3; segment++) {\r\n                var i0 = segment === 0 ? va : segment === 1 ? vb : vc;\r\n                var i1 = segment === 0 ? vb : segment === 1 ? vc : va;\r\n                var segmentState = this.segments[i0 * numPoints + i1];\r\n                if (segmentState)\r\n                    continue; // The segment already has been processed in another face\r\n                // Mark segment as processed (also inverted segment)\r\n                this.segments[i0 * numPoints + i1] = true;\r\n                this.segments[i1 * numPoints + i0] = true;\r\n                p0.set(coords[3 * i0], coords[3 * i0 + 1], coords[3 * i0 + 2]);\r\n                p1.set(coords[3 * i1], coords[3 * i1 + 1], coords[3 * i1 + 2]);\r\n                // mark: 1 for negative side, 2 for positive side, 3 for coplanar point\r\n                var mark0 = 0;\r\n                var d = localPlane.distanceToPoint(p0);\r\n                if (d > delta) {\r\n                    mark0 = 2;\r\n                    points2.push(p0.clone());\r\n                }\r\n                else if (d < -delta) {\r\n                    mark0 = 1;\r\n                    points1.push(p0.clone());\r\n                }\r\n                else {\r\n                    mark0 = 3;\r\n                    points1.push(p0.clone());\r\n                    points2.push(p0.clone());\r\n                }\r\n                // mark: 1 for negative side, 2 for positive side, 3 for coplanar point\r\n                var mark1 = 0;\r\n                var d = localPlane.distanceToPoint(p1);\r\n                if (d > delta) {\r\n                    mark1 = 2;\r\n                    points2.push(p1.clone());\r\n                }\r\n                else if (d < -delta) {\r\n                    mark1 = 1;\r\n                    points1.push(p1.clone());\r\n                }\r\n                else {\r\n                    mark1 = 3;\r\n                    points1.push(p1.clone());\r\n                    points2.push(p1.clone());\r\n                }\r\n                if ((mark0 === 1 && mark1 === 2) || (mark0 === 2 && mark1 === 1)) {\r\n                    // Intersection of segment with the plane\r\n                    this.tempLine1.start.copy(p0);\r\n                    this.tempLine1.end.copy(p1);\r\n                    var intersection = new Vector3();\r\n                    intersection = localPlane.intersectLine(this.tempLine1, intersection);\r\n                    if (intersection === undefined) {\r\n                        // Shouldn't happen\r\n                        console.error('Internal error: segment does not intersect plane.');\r\n                        output.segmentedObject1 = null;\r\n                        output.segmentedObject2 = null;\r\n                        return 0;\r\n                    }\r\n                    points1.push(intersection);\r\n                    points2.push(intersection.clone());\r\n                }\r\n            }\r\n        }\r\n        // Calculate debris mass (very fast and imprecise):\r\n        var newMass = object.userData.ammoPhysicsData.mass * 0.5;\r\n        // Calculate debris Center of Mass (again fast and imprecise)\r\n        this.tempCM1.set(0, 0, 0);\r\n        var radius1 = 0;\r\n        var numPoints1 = points1.length;\r\n        if (numPoints1 > 0) {\r\n            for (var i = 0; i < numPoints1; i++)\r\n                this.tempCM1.add(points1[i]);\r\n            this.tempCM1.divideScalar(numPoints1);\r\n            for (var i = 0; i < numPoints1; i++) {\r\n                var p = points1[i];\r\n                p.sub(this.tempCM1);\r\n                radius1 = Math.max(radius1, p.x, p.y, p.z);\r\n            }\r\n            this.tempCM1.add(object.position);\r\n        }\r\n        this.tempCM2.set(0, 0, 0);\r\n        var radius2 = 0;\r\n        var numPoints2 = points2.length;\r\n        if (numPoints2 > 0) {\r\n            for (var i = 0; i < numPoints2; i++)\r\n                this.tempCM2.add(points2[i]);\r\n            this.tempCM2.divideScalar(numPoints2);\r\n            for (var i = 0; i < numPoints2; i++) {\r\n                var p = points2[i];\r\n                p.sub(this.tempCM2);\r\n                radius2 = Math.max(radius2, p.x, p.y, p.z);\r\n            }\r\n            this.tempCM2.add(object.position);\r\n        }\r\n        var object1 = null;\r\n        var object2 = null;\r\n        var numObjects = 0;\r\n        /**\r\n         * MOD: Wrapped in try catch block to avoid errors\r\n         */\r\n        if (numPoints1 > 4) {\r\n            try {\r\n                object1 = new Mesh(newConvexGeometry(points1), object.material);\r\n                object1.position.copy(this.tempCM1);\r\n                object1.quaternion.copy(object.quaternion);\r\n                object1.userData = object.userData;\r\n                this.prepareBreakableObject(object1, newMass, object.userData.ammoPhysicsData.velocity, object.userData.ammoPhysicsData.angularVelocity, 2 * radius1 > this.minSizeForBreak);\r\n                numObjects++;\r\n            }\r\n            catch (error) {\r\n                logger('Error in ConvexObjectBreaker.ts', true);\r\n                logger(error, true);\r\n            }\r\n        }\r\n        if (numPoints2 > 4) {\r\n            try {\r\n                object2 = new Mesh(newConvexGeometry(points2), object.material);\r\n                object2.position.copy(this.tempCM2);\r\n                object2.quaternion.copy(object.quaternion);\r\n                object2.userData = object.userData;\r\n                this.prepareBreakableObject(object2, newMass, object.userData.ammoPhysicsData.velocity, object.userData.ammoPhysicsData.angularVelocity, 2 * radius2 > this.minSizeForBreak);\r\n                numObjects++;\r\n            }\r\n            catch (error) {\r\n                logger('Error in ConvexObjectBreaker.ts', true);\r\n                logger(error, true);\r\n            }\r\n        }\r\n        output.object1 = object1;\r\n        output.object2 = object2;\r\n        return numObjects;\r\n    }\r\n};\r\nConvexObjectBreaker.transformFreeVector = function (v, m) {\r\n    // input:\r\n    // vector interpreted as a free vector\r\n    // THREE.Matrix4 orthogonal matrix (matrix without scale)\r\n    var x = v.x, y = v.y, z = v.z;\r\n    var e = m.elements;\r\n    v.x = e[0] * x + e[4] * y + e[8] * z;\r\n    v.y = e[1] * x + e[5] * y + e[9] * z;\r\n    v.z = e[2] * x + e[6] * y + e[10] * z;\r\n    return v;\r\n};\r\nConvexObjectBreaker.transformFreeVectorInverse = function (v, m) {\r\n    // input:\r\n    // vector interpreted as a free vector\r\n    // THREE.Matrix4 orthogonal matrix (matrix without scale)\r\n    var x = v.x, y = v.y, z = v.z;\r\n    var e = m.elements;\r\n    v.x = e[0] * x + e[1] * y + e[2] * z;\r\n    v.y = e[4] * x + e[5] * y + e[6] * z;\r\n    v.z = e[8] * x + e[9] * y + e[10] * z;\r\n    return v;\r\n};\r\nConvexObjectBreaker.transformTiedVectorInverse = function (v, m) {\r\n    // input:\r\n    // vector interpreted as a tied (ordinary) vector\r\n    // THREE.Matrix4 orthogonal matrix (matrix without scale)\r\n    var x = v.x, y = v.y, z = v.z;\r\n    var e = m.elements;\r\n    v.x = e[0] * x + e[1] * y + e[2] * z - e[12];\r\n    v.y = e[4] * x + e[5] * y + e[6] * z - e[13];\r\n    v.z = e[8] * x + e[9] * y + e[10] * z - e[14];\r\n    return v;\r\n};\r\nConvexObjectBreaker.transformPlaneToLocalSpace = (function () {\r\n    var v1 = new Vector3();\r\n    return function transformPlaneToLocalSpace(plane, m, resultPlane) {\r\n        resultPlane.normal.copy(plane.normal);\r\n        resultPlane.constant = plane.constant;\r\n        var referencePoint = ConvexObjectBreaker.transformTiedVectorInverse(plane.coplanarPoint(v1), m);\r\n        ConvexObjectBreaker.transformFreeVectorInverse(resultPlane.normal, m);\r\n        // recalculate constant (like in setFromNormalAndCoplanarPoint)\r\n        resultPlane.constant = -referencePoint.dot(resultPlane.normal);\r\n    };\r\n})();\r\nexport { ConvexObjectBreaker };\r\n//# sourceMappingURL=convexObjectBreaker.js.map","// Inspired by https://github.com/playcanvas/engine/blob/master/examples/wasm-loader.js\r\nconst wasmSupported = (() => {\r\n    try {\r\n        if (typeof WebAssembly === 'object' && typeof WebAssembly.instantiate === 'function') {\r\n            const module = new WebAssembly.Module(Uint8Array.of(0x0, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00));\r\n            if (module instanceof WebAssembly.Module)\r\n                return new WebAssembly.Instance(module) instanceof WebAssembly.Instance;\r\n        }\r\n    }\r\n    catch (e) {\r\n        console.error(e.message);\r\n    }\r\n    return false;\r\n})();\r\nconst loadScriptAsync = (url, doneCallback) => {\r\n    var tag = document.createElement('script');\r\n    tag.onload = () => {\r\n        doneCallback();\r\n    };\r\n    tag.onerror = () => {\r\n        throw new Error(`failed to load ${url}`);\r\n    };\r\n    tag.async = true;\r\n    tag.src = url;\r\n    document.head.appendChild(tag);\r\n};\r\nconst loadAmmoModule = (path, doneCallback) => {\r\n    // console.log(wasmSupported ? 'WebAssembly is supported' : 'WebAssembly is not supported')\r\n    if (wasmSupported)\r\n        loadScriptAsync(`${path}/ammo.wasm.js`, () => doneCallback());\r\n    else\r\n        loadScriptAsync(`${path}/ammo.js`, () => doneCallback());\r\n};\r\nexport default loadAmmoModule;\r\n//# sourceMappingURL=wasmLoader.js.map","import loadAmmoModule from './wasmLoader';\r\nconst PhysicsLoader = (path, callback) => {\r\n    if (typeof window !== 'undefined')\r\n        window.__loadPhysics = true;\r\n    loadAmmoModule(path, () => {\r\n        Ammo().then(() => {\r\n            callback();\r\n        });\r\n    });\r\n};\r\nexport { PhysicsLoader };\r\n//# sourceMappingURL=physicsLoader.js.map","// https://www.typescriptlang.org/docs/handbook/mixins.html\r\nconst applyMixins = (derivedCtor, baseCtors) => {\r\n    baseCtors.forEach(baseCtor => {\r\n        Object.getOwnPropertyNames(baseCtor.prototype).forEach(name => {\r\n            // @ts-ignore\r\n            Object.defineProperty(derivedCtor.prototype, name, Object.getOwnPropertyDescriptor(baseCtor.prototype, name));\r\n        });\r\n    });\r\n};\r\nexport default applyMixins;\r\n//# sourceMappingURL=applyMixins.js.map","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\nimport applyMixins from '@enable3d/common/dist/applyMixins';\r\nimport ClosestRayResultCallback from './closestRayResultCallback';\r\nimport AllHitsRayResultCallback from './allHitsRayResultCallback';\r\nclass Raycaster {\r\n    constructor(physics) {\r\n        this.physics = physics;\r\n    }\r\n    setRayFromWorld(x = 0, y = 0, z = 0) {\r\n        this._btRayFrom.setValue(x, y, z);\r\n    }\r\n    setRayToWorld(x = 0, y = 0, z = 0) {\r\n        this._btRayTo.setValue(x, y, z);\r\n    }\r\n    hasHit() {\r\n        return this._btRayCallback.hasHit();\r\n    }\r\n    rayTest() {\r\n        if (typeof this._btRayCallback !== 'undefined')\r\n            Ammo.destroy(this._btRayCallback);\r\n        this._btRayCallback =\r\n            this.type === 'closest'\r\n                ? new Ammo.ClosestRayResultCallback(this._btRayFrom, this._btRayTo)\r\n                : new Ammo.AllHitsRayResultCallback(this._btRayFrom, this._btRayTo);\r\n        this.physics.physicsWorld.rayTest(this._btRayFrom, this._btRayTo, this._btRayCallback);\r\n    }\r\n    destroy() {\r\n        if (typeof this._btRayFrom !== 'undefined')\r\n            Ammo.destroy(this._btRayFrom);\r\n        if (typeof this._btRayTo !== 'undefined')\r\n            Ammo.destroy(this._btRayTo);\r\n        if (typeof this._btRayCallback !== 'undefined')\r\n            Ammo.destroy(this._btRayCallback);\r\n    }\r\n}\r\nclass ClosestRaycaster {\r\n    constructor(physics) {\r\n        this.physics = physics;\r\n        this.type = 'closest';\r\n        this._btRayFrom = new Ammo.btVector3(0, 0, 0);\r\n        this._btRayTo = new Ammo.btVector3(0, 0, 0);\r\n    }\r\n}\r\nclass AllHitsRaycaster {\r\n    constructor(physics) {\r\n        this.physics = physics;\r\n        this.type = 'allHits';\r\n        this._btRayFrom = new Ammo.btVector3(0, 0, 0);\r\n        this._btRayTo = new Ammo.btVector3(0, 0, 0);\r\n    }\r\n}\r\napplyMixins(ClosestRaycaster, [Raycaster, ClosestRayResultCallback]);\r\napplyMixins(AllHitsRaycaster, [Raycaster, AllHitsRayResultCallback]);\r\nexport { ClosestRaycaster, AllHitsRaycaster };\r\n//# sourceMappingURL=raycaster.js.map","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\nexport default class ClosestRayResultCallback {\r\n    constructor(physics) {\r\n        this.physics = physics;\r\n    }\r\n    getHitPointWorld() {\r\n        const h = this._btRayCallback.get_m_hitPointWorld();\r\n        const point = { x: h.x(), y: h.y(), z: h.z() };\r\n        return point;\r\n    }\r\n    getHitNormalWorld() {\r\n        const h = this._btRayCallback.get_m_hitNormalWorld();\r\n        const normal = { x: h.x(), y: h.y(), z: h.z() };\r\n        return normal;\r\n    }\r\n    getCollisionObject() {\r\n        // @ts-ignore\r\n        const rb = Ammo.castObject(this._btRayCallback.get_m_collisionObject(), Ammo.btRigidBody);\r\n        // @ts-ignore\r\n        return rb.threeObject;\r\n    }\r\n}\r\n//# sourceMappingURL=closestRayResultCallback.js.map","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\nimport { logger } from '@enable3d/common/dist/logger';\r\nexport default class AllHitsRayResultCallback {\r\n    constructor(physics) {\r\n        this.physics = physics;\r\n    }\r\n    getHitPointsWorld() {\r\n        const h = this._btRayCallback.get_m_hitPointWorld();\r\n        const points = [];\r\n        for (let i = h.size() - 1; i >= 0; i--) {\r\n            const hh = h.at(i);\r\n            points.push({ x: hh.x(), y: hh.y(), z: hh.z() });\r\n        }\r\n        return points;\r\n    }\r\n    // TODO: Remove this in future versions!\r\n    getHitPointWorld() {\r\n        logger('Use getHitPointsWorld() instead of getHitPointWorld() for the AllHitsRayCaster!');\r\n        return this.getHitPointsWorld();\r\n    }\r\n    getHitNormalsWorld() {\r\n        const h = this._btRayCallback.get_m_hitNormalWorld();\r\n        const normals = [];\r\n        for (let i = h.size() - 1; i >= 0; i--) {\r\n            const hh = h.at(i);\r\n            normals.push({ x: hh.x(), y: hh.y(), z: hh.z() });\r\n        }\r\n        return normals;\r\n    }\r\n    getCollisionObjects() {\r\n        const threeObjects = [];\r\n        const objects = this._btRayCallback.get_m_collisionObjects();\r\n        for (let i = objects.size() - 1; i >= 0; i--) {\r\n            // @ts-ignore\r\n            const rb = Ammo.castObject(objects.at(i), Ammo.btRigidBody);\r\n            // @ts-ignore\r\n            threeObjects.push(rb.threeObject);\r\n        }\r\n        return threeObjects;\r\n    }\r\n}\r\n//# sourceMappingURL=allHitsRayResultCallback.js.map","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\nimport { logger } from '@enable3d/common/dist/logger';\r\nimport PhysicsBody from '@enable3d/common/dist/physicsBody';\r\nimport { ExtendedObject3D } from '@enable3d/common/dist/extendedObject3D';\r\nexport { ExtendedObject3D };\r\nimport { ExtendedMesh } from '@enable3d/common/dist/extendedMesh';\r\nexport { ExtendedMesh };\r\nimport { ExtendedGroup } from '@enable3d/common/dist/extendedGroup';\r\nexport { ExtendedGroup };\r\nimport Shapes from './shapes';\r\nimport Constraints from './constraints';\r\nimport { Events } from '@yandeu/events';\r\nimport { BufferGeometry, Euler, Matrix4, Quaternion, REVISION, Vector3 } from 'three';\r\nimport { createHACDShapes, createHullShape, createTriMeshShape, createVHACDShapes, iterateGeometries } from './three-to-ammo';\r\nimport { createTorusShape } from './torusShape';\r\nimport Factories from '@enable3d/common/dist/factories';\r\nimport { CollisionEvents } from './collisionEvents';\r\nimport DebugDrawer from './debugDrawer';\r\nimport { ConvexObjectBreaker } from './convexObjectBreaker';\r\nimport { PhysicsLoader } from '@enable3d/common/dist/physicsLoader';\r\nimport DefaultMaterial from '@enable3d/common/dist/defaultMaterial';\r\nexport { PhysicsLoader };\r\nimport * as Types from '@enable3d/common/dist/types';\r\nimport { AllHitsRaycaster, ClosestRaycaster } from './raycaster/raycaster';\r\nexport { ClosestRaycaster, AllHitsRaycaster };\r\nexport { Types };\r\n// Export THREE.Clock\r\nexport { Clock } from './lib/Clock';\r\nclass AmmoPhysics extends Events {\r\n    constructor(scene, config = {}) {\r\n        super();\r\n        this.scene = scene;\r\n        this.config = config;\r\n        this.rigidBodies = [];\r\n        this.earlierDetectedCollisions = [];\r\n        this.complexShapes = ['plane', 'hull', 'hacd', 'vhacd', 'convexMesh', 'concaveMesh'];\r\n        this.gravity = config.gravity || { x: 0, y: -9.81, z: 0 };\r\n        this.isHeadless = scene === 'headless' ? true : false;\r\n        this.tmpEuler = new Euler();\r\n        this.tmpQuaternion = new Quaternion();\r\n        this.tmpVector3 = new Vector3();\r\n        this.tmpVector3a = new Vector3();\r\n        this.tmpMatrix4 = new Matrix4();\r\n        this.tmpMatrix4a = new Matrix4();\r\n        this.tmpBtVector3 = new Ammo.btVector3();\r\n        this.tmpBtQuaternion = new Ammo.btQuaternion(0, 0, 0, 1);\r\n        this.emptyV3 = new Vector3();\r\n        this.impactPoint = new Vector3();\r\n        this.impactNormal = new Vector3();\r\n        if (scene !== 'headless') {\r\n            this.defaultMaterial = new DefaultMaterial();\r\n            // const info = `Ammo.js physics provided by enable3d`\r\n            // console.log(\r\n            //   `%c %c %c %c %c ${info} %c https://enable3d.io/`,\r\n            //   'background: #ff0000',\r\n            //   'background: #ffff00',\r\n            //   'background: #00ff00',\r\n            //   'background: #00ffff',\r\n            //   'color: #fff; background: #000000;',\r\n            //   'background: none'\r\n            // )\r\n        }\r\n        this.start();\r\n    }\r\n    /** @deprecated Use worldTransform instead of tmpTrans. */\r\n    get tmpTrans() {\r\n        console.warn('Use worldTransform instead of tmpTrans.');\r\n        return this.worldTransform;\r\n    }\r\n    /** @deprecated Use worldTransform instead of tmpTrans. */\r\n    set tmpTrans(transform) {\r\n        console.warn('Use worldTransform instead of tmpTrans.');\r\n        this.worldTransform = transform;\r\n    }\r\n    /** Destroys a physics body. */\r\n    destroy(body) {\r\n        var _a;\r\n        // @ts-ignore\r\n        const b = Object.keys(body).includes('body') ? body.body : body;\r\n        if (typeof (b === null || b === void 0 ? void 0 : b.ammo) === 'undefined')\r\n            return;\r\n        // @ts-ignore\r\n        const name = b.ammo.name;\r\n        // @ts-ignore\r\n        let obj = b.ammo.threeObject;\r\n        if (name && obj) {\r\n            if ((_a = obj === null || obj === void 0 ? void 0 : obj.body) === null || _a === void 0 ? void 0 : _a.ammo) {\r\n                // remove from physics world\r\n                !obj.body.isSoftBody\r\n                    ? this.physicsWorld.removeRigidBody(obj.body.ammo)\r\n                    : this.physicsWorld.removeSoftBody(obj.body.ammo);\r\n                // call destructor on body\r\n                obj.body.destructor();\r\n                // reset properties\r\n                // @ts-ignore\r\n                obj.body = undefined;\r\n                obj.hasBody = false;\r\n                // remove from this.objectAmmo\r\n                // @ts-ignore\r\n                delete b.ammo.threeObject;\r\n                // remove from this.rigidBodies\r\n                for (let i = 0; i < this.rigidBodies.length; i++) {\r\n                    if (this.rigidBodies[i].name === name) {\r\n                        this.rigidBodies.splice(i, 1);\r\n                        i--;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (this.scene === 'headless' && obj)\r\n            obj = null;\r\n    }\r\n    setup() {\r\n        // add worldTransform\r\n        this.worldTransform = new Ammo.btTransform();\r\n        // setup ammo physics\r\n        if (typeof this.config.setupPhysicsWorld === 'function')\r\n            this.physicsWorld = this.config.setupPhysicsWorld();\r\n        else\r\n            this.physicsWorld = this.setupPhysicsWorld();\r\n        if (this.scene !== 'headless') {\r\n            // Initialize convexBreaker\r\n            // @ts-ignore\r\n            this.convexBreaker = new ConvexObjectBreaker();\r\n            this.objectsToRemove = [];\r\n            this.numObjectsToRemove = 0;\r\n            for (let i = 0; i < 500; i++) {\r\n                this.objectsToRemove[i] = null;\r\n            }\r\n        }\r\n        this.collisionEvents = new CollisionEvents();\r\n        this.factory = new Factories(this.scene);\r\n        this.shapes = new Shapes(this.factory, (object, config) => this.addExisting(object, config));\r\n        this.constraints = new Constraints(this.worldTransform, this.physicsWorld);\r\n        if (this.scene !== 'headless')\r\n            this.debugDrawer = new DebugDrawer(this.scene, this.physicsWorld, {});\r\n    }\r\n    updateDebugger() {\r\n        if (this.scene === 'headless')\r\n            return;\r\n        if (this.debugDrawer && this.debugDrawer.enabled)\r\n            this.debugDrawer.update();\r\n    }\r\n    setupPhysicsWorld() {\r\n        const g = this.gravity;\r\n        const { softBodies = false } = this.config;\r\n        let physicsWorld;\r\n        if (!softBodies) {\r\n            const collisionConfiguration = new Ammo.btDefaultCollisionConfiguration(), dispatcher = new Ammo.btCollisionDispatcher(collisionConfiguration), broadphase = new Ammo.btDbvtBroadphase(), solver = new Ammo.btSequentialImpulseConstraintSolver();\r\n            physicsWorld = new Ammo.btDiscreteDynamicsWorld(dispatcher, broadphase, solver, collisionConfiguration);\r\n        }\r\n        if (softBodies) {\r\n            const collisionConfiguration = new Ammo.btSoftBodyRigidBodyCollisionConfiguration(), dispatcher = new Ammo.btCollisionDispatcher(collisionConfiguration), broadphase = new Ammo.btDbvtBroadphase(), solver = new Ammo.btSequentialImpulseConstraintSolver(), softBodySolver = new Ammo.btDefaultSoftBodySolver();\r\n            physicsWorld = new Ammo.btSoftRigidDynamicsWorld(dispatcher, broadphase, solver, collisionConfiguration, softBodySolver);\r\n        }\r\n        physicsWorld.setGravity(new Ammo.btVector3(g.x, g.y, g.z));\r\n        return physicsWorld;\r\n    }\r\n    createDebrisFromBreakableObject(object, parent) {\r\n        if (this.scene === 'headless')\r\n            return;\r\n        object.material = parent.material;\r\n        object.shape = 'hull';\r\n        object.fragmentDepth = parent.fragmentDepth + 1;\r\n        // Add the object to the scene\r\n        this.scene.add(object);\r\n        // Add physics to the object\r\n        // @ts-ignore\r\n        this.addExisting(object);\r\n        object.body.fractureImpulse = parent.body.fractureImpulse;\r\n        object.body.breakable = false;\r\n        // make this fragment breakable in 2.5seconds\r\n        setTimeout(() => {\r\n            object.body.breakable = true;\r\n        }, 2500);\r\n    }\r\n    removeDebris(object) {\r\n        if (this.scene === 'headless')\r\n            return;\r\n        this.scene.remove(object);\r\n        this.destroy(object);\r\n    }\r\n    update(delta) {\r\n        this.updatePhysics(delta);\r\n        this.detectCollisions();\r\n    }\r\n    updatePhysics(delta) {\r\n        // step world\r\n        const deltaTime = delta / 1000;\r\n        // must always satisfy the equation timeStep < maxSubSteps * fixedTimeStep\r\n        this.physicsWorld.stepSimulation(deltaTime, this.config.maxSubSteps || 4, this.config.fixedTimeStep || 1 / 60);\r\n        // update rigid bodies\r\n        for (let i = 0; i < this.rigidBodies.length; i++) {\r\n            const objThree = this.rigidBodies[i];\r\n            const objPhys = objThree.body.ammo;\r\n            const ms = objPhys.getMotionState();\r\n            if (ms) {\r\n                ms.getWorldTransform(this.worldTransform);\r\n                // check if object did an update since last call\r\n                if (objThree.body.didUpdate) {\r\n                    // @ts-ignore\r\n                    if (objThree.body._emitUpdateEvents)\r\n                        objThree.body.eventEmitter.emit('update');\r\n                    objThree.body.didUpdate = false;\r\n                }\r\n                // update positions\r\n                if (objThree.body.ammo.isKinematicObject() && objThree.body.needUpdate) {\r\n                    // get position and rotation\r\n                    objThree.getWorldQuaternion(this.tmpQuaternion);\r\n                    objThree.getWorldPosition(this.tmpVector3);\r\n                    // adjust tmp variables\r\n                    this.tmpBtVector3.setValue(this.tmpVector3.x, this.tmpVector3.y, this.tmpVector3.z);\r\n                    this.tmpBtQuaternion.setValue(this.tmpQuaternion.x, this.tmpQuaternion.y, this.tmpQuaternion.z, this.tmpQuaternion.w);\r\n                    // set position and rotation\r\n                    this.worldTransform.setOrigin(this.tmpBtVector3);\r\n                    this.worldTransform.setRotation(this.tmpBtQuaternion);\r\n                    // set transform\r\n                    ms.setWorldTransform(this.worldTransform);\r\n                    // reset needsUpdate\r\n                    objThree.body.needUpdate = false;\r\n                }\r\n                else if (objThree.body.skipUpdate) {\r\n                    // do nothing ...\r\n                }\r\n                else if (!objThree.body.ammo.isStaticObject()) {\r\n                    // get position and rotation\r\n                    const p = this.worldTransform.getOrigin();\r\n                    const q = this.worldTransform.getRotation();\r\n                    // body offset\r\n                    const o = objThree.body.offset;\r\n                    // set position and rotation\r\n                    if (objThree.body.ignoreScale) {\r\n                        this.tmpVector3a.set(objThree.scale.x, objThree.scale.y, objThree.scale.z);\r\n                    }\r\n                    else {\r\n                        const scale = objThree.body.ammo.getCollisionShape().getLocalScaling();\r\n                        this.tmpVector3a.set(scale.x(), scale.y(), scale.z());\r\n                    }\r\n                    this.tmpVector3.set(p.x() + o.x, p.y() + o.y, p.z() + o.z);\r\n                    this.tmpQuaternion.set(q.x(), q.y(), q.z(), q.w());\r\n                    this.tmpMatrix4.compose(this.tmpVector3, this.tmpQuaternion, this.tmpVector3a);\r\n                    if (objThree.parent) {\r\n                        // compatibility fix for three.js >= r123 (Dezember 2020)\r\n                        // @ts-ignore\r\n                        if (parseInt(REVISION) >= 123)\r\n                            this.tmpMatrix4a.copy(objThree.parent.matrixWorld).invert();\r\n                        else\r\n                            this.tmpMatrix4a.getInverse(objThree.parent.matrixWorld);\r\n                    }\r\n                    else {\r\n                        this.tmpMatrix4a.identity();\r\n                    }\r\n                    this.tmpMatrix4a.multiply(this.tmpMatrix4);\r\n                    this.tmpMatrix4a.decompose(objThree.position, objThree.quaternion, objThree.scale);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    detectCollisions() {\r\n        var _a, _b;\r\n        const detectedCollisions = [];\r\n        // reset these vectors\r\n        this.impactPoint.set(0, 0, 0);\r\n        this.impactNormal.set(0, 0, 0);\r\n        const dispatcher = this.physicsWorld.getDispatcher();\r\n        const numManifolds = dispatcher.getNumManifolds();\r\n        // check collisions\r\n        for (let i = 0; i < numManifolds; i++) {\r\n            const contactManifold = dispatcher.getManifoldByIndexInternal(i);\r\n            const numContacts = contactManifold.getNumContacts();\r\n            // @ts-ignore\r\n            const rb0 = Ammo.castObject(contactManifold.getBody0(), Ammo.btRigidBody);\r\n            // @ts-ignore\r\n            const rb1 = Ammo.castObject(contactManifold.getBody1(), Ammo.btRigidBody);\r\n            const threeObject0 = rb0.threeObject;\r\n            const threeObject1 = rb1.threeObject;\r\n            if (!threeObject0 || !threeObject1) {\r\n                continue;\r\n            }\r\n            // do not check collision between 2 unnamed objects\r\n            // (fragments do not have a name, for example)\r\n            if (rb0.name === '' && rb1.name === '')\r\n                continue;\r\n            /**\r\n             * Get some information\r\n             */\r\n            const checkCollisions0 = (_a = threeObject0.body) === null || _a === void 0 ? void 0 : _a.checkCollisions;\r\n            const checkCollisions1 = (_b = threeObject1.body) === null || _b === void 0 ? void 0 : _b.checkCollisions;\r\n            const breakable0 = threeObject0.body.breakable;\r\n            const breakable1 = threeObject1.body.breakable;\r\n            const fractureImpulse0 = threeObject0.body.fractureImpulse;\r\n            const fractureImpulse1 = threeObject1.body.fractureImpulse;\r\n            const checkCollisions = checkCollisions0 || checkCollisions1;\r\n            const checkBreakable = breakable0 || breakable1;\r\n            if (!checkCollisions && !checkBreakable)\r\n                continue;\r\n            let contact = false;\r\n            let maxImpulse = 0;\r\n            let event = 'start';\r\n            for (let j = 0; j < numContacts; j++) {\r\n                const contactPoint = contactManifold.getContactPoint(j);\r\n                const distance = contactPoint.getDistance();\r\n                // Distance definition: when the distance between objects is positive, they are separated. When the distance is negative, they are penetrating. Zero distance means exactly touching.\r\n                // https://pybullet.org/Bullet/phpBB3/viewtopic.php?t=5831\r\n                if (distance <= 0) {\r\n                    contact = true;\r\n                    const impulse = contactPoint.getAppliedImpulse();\r\n                    const impactPoint = contactPoint.get_m_positionWorldOnB();\r\n                    const impactNormal = contactPoint.get_m_normalWorldOnB();\r\n                    // handle collision events\r\n                    if (checkCollisions0 || checkCollisions1) {\r\n                        const names = [threeObject0.name, threeObject1.name].sort();\r\n                        const combinedName = `${names[0]}__${names[1]}`;\r\n                        if (this.earlierDetectedCollisions.find(el => el.combinedName === combinedName))\r\n                            event = 'collision';\r\n                        if (!detectedCollisions.find(el => el.combinedName === combinedName)) {\r\n                            detectedCollisions.push({ combinedName, collision: true });\r\n                            this.collisionEvents.emit('collision', { bodies: [threeObject0, threeObject1], event });\r\n                        }\r\n                    }\r\n                    // get impactPoint and impactNormal of the hight impulse point (for breakable objects)\r\n                    if (impulse >= maxImpulse) {\r\n                        maxImpulse = impulse;\r\n                        // get what ween need for the convex breaking\r\n                        if (breakable0 || breakable1) {\r\n                            this.impactPoint.set(impactPoint.x(), impactPoint.y(), impactPoint.z());\r\n                            this.impactNormal.set(impactNormal.x(), impactNormal.y(), impactNormal.z());\r\n                        }\r\n                    }\r\n                    break;\r\n                }\r\n            }\r\n            // if no point has contact, abort\r\n            if (!contact)\r\n                continue;\r\n            // if no objects are breakable, abort\r\n            if (!checkBreakable)\r\n                continue;\r\n            /**\r\n             * check for breakable objects (subdivision)\r\n             */\r\n            const MAX_FRAGMENT_DEPTH = 2;\r\n            // since the library convexBreaker makes use of three's userData.ammoPhysicsData\r\n            // we have to clone the necessary params to threeObjectX.userData.ammoPhysicsData\r\n            // TODO improve this\r\n            this.emptyV3.set(0, 0, 0);\r\n            threeObject0.userData.ammoPhysicsData = {\r\n                mass: 1,\r\n                velocity: this.emptyV3,\r\n                angularVelocity: this.emptyV3,\r\n                breakable: breakable0,\r\n                physicsBody: rb0\r\n            };\r\n            threeObject1.userData.ammoPhysicsData = {\r\n                mass: 1,\r\n                velocity: this.emptyV3,\r\n                angularVelocity: this.emptyV3,\r\n                breakable: breakable1,\r\n                physicsBody: rb1\r\n            };\r\n            // threeObject0\r\n            if (breakable0 && maxImpulse > fractureImpulse0 && threeObject0.fragmentDepth < MAX_FRAGMENT_DEPTH) {\r\n                const debris = this.convexBreaker.subdivideByImpact(threeObject0, this.impactPoint, this.impactNormal, 1, 2); //, 1.5)\r\n                const numObjects = debris.length;\r\n                for (let j = 0; j < numObjects; j++) {\r\n                    const vel = rb0.getLinearVelocity();\r\n                    const angVel = rb0.getAngularVelocity();\r\n                    const fragment = debris[j];\r\n                    fragment.userData.ammoPhysicsData.velocity.set(vel.x(), vel.y(), vel.z());\r\n                    fragment.userData.ammoPhysicsData.angularVelocity.set(angVel.x(), angVel.y(), angVel.z());\r\n                    this.createDebrisFromBreakableObject(fragment, threeObject0);\r\n                }\r\n                this.objectsToRemove[this.numObjectsToRemove++] = threeObject0;\r\n            }\r\n            // threeObject1\r\n            if (breakable1 && maxImpulse > fractureImpulse1 && threeObject1.fragmentDepth < MAX_FRAGMENT_DEPTH) {\r\n                const debris = this.convexBreaker.subdivideByImpact(threeObject1, this.impactPoint, this.impactNormal, 1, 2); //, 1.5)\r\n                const numObjects = debris.length;\r\n                for (let j = 0; j < numObjects; j++) {\r\n                    const vel = rb1.getLinearVelocity();\r\n                    const angVel = rb1.getAngularVelocity();\r\n                    const fragment = debris[j];\r\n                    fragment.userData.ammoPhysicsData.velocity.set(vel.x(), vel.y(), vel.z());\r\n                    fragment.userData.ammoPhysicsData.angularVelocity.set(angVel.x(), angVel.y(), angVel.z());\r\n                    this.createDebrisFromBreakableObject(fragment, threeObject1);\r\n                }\r\n                this.objectsToRemove[this.numObjectsToRemove++] = threeObject1;\r\n            }\r\n        }\r\n        // remove objects\r\n        for (let i = 0; i < this.numObjectsToRemove; i++) {\r\n            this.removeDebris(this.objectsToRemove[i]);\r\n        }\r\n        this.numObjectsToRemove = 0;\r\n        // handle collision end events\r\n        this.earlierDetectedCollisions.forEach(el => {\r\n            const { combinedName } = el;\r\n            if (!detectedCollisions.find(el => el.combinedName === combinedName)) {\r\n                const split = combinedName.split('__');\r\n                const obj0 = this.rigidBodies.find(obj => obj.name === split[0]);\r\n                const obj1 = this.rigidBodies.find(obj => obj.name === split[1]);\r\n                const event = 'end';\r\n                if (obj0 && obj1)\r\n                    this.collisionEvents.emit('collision', { bodies: [obj0, obj1], event });\r\n            }\r\n        });\r\n        this.earlierDetectedCollisions = [...detectedCollisions];\r\n    }\r\n    setGravity(x = 0, y = -9.8, z = 0) {\r\n        this.tmpBtVector3.setValue(x, y, z);\r\n        this.physicsWorld.setGravity(this.tmpBtVector3);\r\n    }\r\n    get debug() {\r\n        if (this.isHeadless)\r\n            return null;\r\n        return {\r\n            enable: () => {\r\n                this.debugDrawer.enable();\r\n            },\r\n            mode: (debugMode = 1) => {\r\n                this.debugDrawer.setDebugMode(debugMode);\r\n            },\r\n            disable: () => {\r\n                this.debugDrawer.disable();\r\n            }\r\n        };\r\n    }\r\n    start() {\r\n        if (typeof Ammo === 'undefined') {\r\n            logger('Are you sure you included ammo.js?');\r\n            return;\r\n        }\r\n        if (typeof Ammo === 'function')\r\n            Ammo().then(() => {\r\n                this.setup();\r\n            });\r\n        else\r\n            this.setup();\r\n    }\r\n    get add() {\r\n        return {\r\n            collider: (object1, object2, eventCallback) => this.collisionEvents.addCollider(object1, object2, eventCallback),\r\n            constraints: this.constraints.addConstraints,\r\n            existing: (object, config) => this.addExisting(object, config),\r\n            plane: (planeConfig = {}, materialConfig = {}) => this.shapes.addPlane(planeConfig, materialConfig),\r\n            sphere: (sphereConfig = {}, materialConfig = {}) => this.shapes.addSphere(sphereConfig, materialConfig),\r\n            ground: (groundConfig = {}, materialConfig = {}) => this.shapes.addGround(groundConfig, materialConfig),\r\n            box: (boxConfig = {}, materialConfig = {}) => this.shapes.addBox(boxConfig, materialConfig),\r\n            cylinder: (cylinderConfig = {}, materialConfig = {}) => this.shapes.addCylinder(cylinderConfig, materialConfig),\r\n            cone: (coneConfig = {}, materialConfig = {}) => this.shapes.addCone(coneConfig, materialConfig),\r\n            torus: (torusConfig = {}, materialConfig = {}) => this.shapes.addTorus(torusConfig, materialConfig),\r\n            extrude: (extrudeConfig, materialConfig = {}) => this.shapes.addExtrude(extrudeConfig, materialConfig),\r\n            /**\r\n             * Creates a new Raycaster\r\n             * @param type Returns only the closes body by default. Can be 'closest' or 'allHits'.\r\n             */\r\n            raycaster: (type = 'closest') => {\r\n                if (type === 'closest')\r\n                    return new ClosestRaycaster(this);\r\n                else\r\n                    return new AllHitsRaycaster(this);\r\n            }\r\n        };\r\n    }\r\n    prepareThreeObjectForCollisionShape(object, config = {}) {\r\n        var _a, _b;\r\n        const { autoCenter = false } = config;\r\n        // set default params\r\n        const defaultParams = {\r\n            width: 1,\r\n            height: 1,\r\n            depth: 1,\r\n            radius: 1,\r\n            radiusTop: 1,\r\n            radiusBottom: 1,\r\n            tube: 0.4,\r\n            tubularSegments: 6 // for the torus\r\n        };\r\n        // determine the shape (fallback to hacd)\r\n        let shape = 'unknown';\r\n        // retrieve the shape from the geometry\r\n        const type = ((_a = object.geometry) === null || _a === void 0 ? void 0 : _a.type) || 'unknown';\r\n        if (/box/i.test(type))\r\n            shape = 'box';\r\n        else if (/cone/i.test(type))\r\n            shape = 'cone';\r\n        else if (/cylinder/i.test(type))\r\n            shape = 'cylinder';\r\n        else if (/extrude/i.test(type))\r\n            shape = 'extrude';\r\n        else if (/plane/i.test(type))\r\n            shape = 'plane';\r\n        else if (/sphere/i.test(type))\r\n            shape = 'sphere';\r\n        else if (/torus/i.test(type))\r\n            shape = 'torus';\r\n        // @ts-ignore\r\n        let params = Object.assign(Object.assign({}, defaultParams), (_b = object === null || object === void 0 ? void 0 : object.geometry) === null || _b === void 0 ? void 0 : _b.parameters);\r\n        if (config.shape) {\r\n            params = Object.assign(Object.assign({}, defaultParams), config);\r\n            shape = config.shape;\r\n        }\r\n        else if (object.shape) {\r\n            shape = object.shape;\r\n        }\r\n        // Add all default params if undefined\r\n        Object.keys(params).forEach(key => {\r\n            // @ts-ignore\r\n            if (typeof params[key] === 'undefined' && defaultParams[key]) {\r\n                // @ts-ignore\r\n                params[key] = defaultParams[key];\r\n            }\r\n        });\r\n        // auto adjust the center for custom shapes\r\n        if (autoCenter)\r\n            object.geometry.center();\r\n        // adjust the cylinder radius for its physcis body\r\n        if (shape === 'cylinder')\r\n            params.radius = config.radius || params.radiusTop;\r\n        // some aliases\r\n        if (shape === 'extrude')\r\n            shape = 'hacd';\r\n        if (shape === 'mesh' || shape === 'convex')\r\n            shape = 'convexMesh';\r\n        if (shape === 'concave')\r\n            shape = 'concaveMesh';\r\n        // if we have not found a shape until here, we fallback to 'box'\r\n        if (shape === 'unknown') {\r\n            logger(`Shape for ${object === null || object === void 0 ? void 0 : object.name} not recognized! Will fallback to box.`);\r\n            shape = 'box';\r\n        }\r\n        return { shape, params, object };\r\n    }\r\n    createCollisionShape(shape, params, object) {\r\n        const quat = (object === null || object === void 0 ? void 0 : object.quaternion) ? object === null || object === void 0 ? void 0 : object.quaternion : new Quaternion(0, 0, 0, 1);\r\n        const { axis = 'y' } = params;\r\n        const btHalfExtents = new Ammo.btVector3();\r\n        // transform geometry to bufferGeometry (because three-to-ammo works only with bufferGeometry)\r\n        // @ts-ignore\r\n        const geometry = object === null || object === void 0 ? void 0 : object.geometry;\r\n        if (object && (geometry === null || geometry === void 0 ? void 0 : geometry.isGeometry)) {\r\n            // @ts-ignore\r\n            object.geometry = new BufferGeometry().fromGeometry(geometry);\r\n        }\r\n        // prepare data to pass to three-to-ammo.js\r\n        const extractData = (object) => {\r\n            const matrixWorld = new Matrix4().elements;\r\n            const vertices = [];\r\n            const matrices = [];\r\n            const indexes = [];\r\n            iterateGeometries(object, {}, (vertexArray, matrixArray, indexArray) => {\r\n                vertices.push(vertexArray);\r\n                matrices.push(matrixArray);\r\n                indexes.push(indexArray);\r\n            });\r\n            return { vertices, matrices, indexes, matrixWorld };\r\n        };\r\n        let d = {};\r\n        // extract data for complex shapes generated with three-to-ammo.js\r\n        if (this.complexShapes.indexOf(shape) !== -1)\r\n            d = extractData(object);\r\n        let collisionShape;\r\n        switch (shape) {\r\n            case 'box':\r\n                btHalfExtents.setValue(params.width / 2, params.height / 2, params.depth / 2);\r\n                collisionShape = new Ammo.btBoxShape(btHalfExtents);\r\n                break;\r\n            case 'sphere':\r\n                collisionShape = new Ammo.btSphereShape(params.radius);\r\n                break;\r\n            case 'cylinder':\r\n                switch (axis) {\r\n                    case 'y':\r\n                        btHalfExtents.setValue(params.radius, params.height / 2, params.radius);\r\n                        collisionShape = new Ammo.btCylinderShape(btHalfExtents);\r\n                        break;\r\n                    case 'x':\r\n                        btHalfExtents.setValue(params.height / 2, params.radius, params.radius);\r\n                        collisionShape = new Ammo.btCylinderShapeX(btHalfExtents);\r\n                        break;\r\n                    case 'z':\r\n                        btHalfExtents.setValue(params.radius, params.radius, params.height / 2);\r\n                        collisionShape = new Ammo.btCylinderShapeZ(btHalfExtents);\r\n                        break;\r\n                }\r\n                break;\r\n            case 'cone':\r\n                switch (axis) {\r\n                    case 'y':\r\n                        collisionShape = new Ammo.btConeShape(params.radius, params.height);\r\n                        break;\r\n                    case 'x':\r\n                        collisionShape = new Ammo.btConeShapeX(params.radius, params.height);\r\n                        break;\r\n                    case 'z':\r\n                        collisionShape = new Ammo.btConeShapeZ(params.radius, params.height);\r\n                        break;\r\n                }\r\n                break;\r\n            case 'capsule':\r\n                switch (axis) {\r\n                    case 'y':\r\n                        collisionShape = new Ammo.btCapsuleShape(params.radius, params.height);\r\n                        break;\r\n                    case 'x':\r\n                        collisionShape = new Ammo.btCapsuleShapeX(params.radius, params.height);\r\n                        break;\r\n                    case 'z':\r\n                        collisionShape = new Ammo.btCapsuleShapeZ(params.radius, params.height);\r\n                        break;\r\n                }\r\n                break;\r\n            case 'torus':\r\n                collisionShape = createTorusShape(params, quat);\r\n                break;\r\n            case 'plane':\r\n                // uses a triMeshShape for the plane\r\n                collisionShape = createTriMeshShape(d.vertices, d.matrices, d.indexes, d.matrixWorld, Object.assign(Object.assign({}, params), { concave: false }));\r\n                break;\r\n            case 'hull':\r\n                collisionShape = createHullShape(d.vertices, d.matrices, d.matrixWorld, params);\r\n                break;\r\n            case 'hacd':\r\n                collisionShape = createHACDShapes(d.vertices, d.matrices, d.indexes, d.matrixWorld, params);\r\n                break;\r\n            case 'vhacd':\r\n                collisionShape = createVHACDShapes(d.vertices, d.matrices, d.indexes, d.matrixWorld, params);\r\n                break;\r\n            case 'convexMesh':\r\n                collisionShape = createTriMeshShape(d.vertices, d.matrices, d.indexes, d.matrixWorld, Object.assign(Object.assign({}, params), { concave: false }));\r\n                break;\r\n            case 'concaveMesh':\r\n                collisionShape = createTriMeshShape(d.vertices, d.matrices, d.indexes, d.matrixWorld, Object.assign(Object.assign({}, params), { concave: true }));\r\n                break;\r\n        }\r\n        Ammo.destroy(btHalfExtents);\r\n        // if there is a x, y or z, take is as temporary offset parameter\r\n        const { x, y, z } = params;\r\n        if (x || y || z) {\r\n            // @ts-ignore\r\n            collisionShape.offset = { x: x || 0, y: y || 0, z: z || 0 };\r\n        }\r\n        // in some cases, like hacd, it will be an array of shapes\r\n        // so we merge them\r\n        if (Array.isArray(collisionShape))\r\n            collisionShape = this.mergeCollisionShapesToCompoundShape(collisionShape);\r\n        return collisionShape;\r\n    }\r\n    mergeCollisionShapesToCompoundShape(collisionShapes) {\r\n        const compoundShape = new Ammo.btCompoundShape();\r\n        collisionShapes.forEach(shape => {\r\n            // @ts-ignore // _tmp is a custom parameter\r\n            const _tmp = shape._tmp;\r\n            if (_tmp) {\r\n                const { pos, quat, scale, margin } = _tmp;\r\n                const transform = this.applyPosQuatScaleMargin(shape, pos, quat, scale, margin);\r\n                compoundShape.addChildShape(transform, shape);\r\n            }\r\n            else {\r\n                const transform = new Ammo.btTransform();\r\n                transform.setIdentity();\r\n                compoundShape.addChildShape(transform, shape);\r\n            }\r\n        });\r\n        return compoundShape;\r\n    }\r\n    addExisting(object, config = {}) {\r\n        const { hasBody } = object;\r\n        if (hasBody) {\r\n            logger(`Object \"${object.name}\" already has a physical body!`);\r\n            return;\r\n        }\r\n        const pos = new Vector3();\r\n        const quat = new Quaternion();\r\n        const scale = new Vector3();\r\n        object.getWorldPosition(pos);\r\n        object.getWorldQuaternion(quat);\r\n        object.getWorldScale(scale);\r\n        const isStaticObject = (config.collisionFlags || 0).toString(2).slice(-1) === '1';\r\n        const isKinematicObject = (config.collisionFlags || 0).toString(2).slice(-2, -1) === '1';\r\n        const { shape = 'unknown', compound = [], mass = isStaticObject || isKinematicObject ? 0 : 1, // set default mass of 0 for static objects, and 1 for all other objects\r\n        collisionFlags = 0, collisionGroup = 1, collisionMask = -1, offset = undefined, breakable = false, addChildren = true, margin = 0.01, ignoreScale = false, fractureImpulse = 1 } = config;\r\n        if (ignoreScale)\r\n            scale.set(1, 1, 1);\r\n        if (compound.length >= 1) {\r\n            // if we want a custom compound shape, we simply do\r\n            const collisionShapes = compound.map((s) => this.createCollisionShape(s.shape, s));\r\n            const compoundShape = this.mergeCollisionShapesToCompoundShape(collisionShapes);\r\n            const localTransform = this.applyPosQuatScaleMargin(compoundShape, pos, quat, scale, margin);\r\n            const rigidBody = this.collisionShapeToRigidBody(compoundShape, localTransform, mass, isKinematicObject);\r\n            this.addRigidBodyToWorld(object, rigidBody, collisionFlags, collisionGroup, collisionMask, offset);\r\n            object.body.breakable = breakable;\r\n            object.body.fractureImpulse = fractureImpulse;\r\n            object.body.ignoreScale = ignoreScale;\r\n            return;\r\n        }\r\n        const collisionShapes = [];\r\n        // if object is a THREE.Group, object does not have a mesh\r\n        if (shape !== 'unknown' || object.isMesh) {\r\n            const p = this.prepareThreeObjectForCollisionShape(object, config);\r\n            const cs = this.createCollisionShape(p.shape, p.params, p.object);\r\n            collisionShapes.push(cs);\r\n        }\r\n        // check if the object has children\r\n        if (shape === 'unknown' && addChildren && object.children.length >= 1) {\r\n            object.children.forEach((child) => {\r\n                if (child.isMesh) {\r\n                    const p = this.prepareThreeObjectForCollisionShape(child);\r\n                    const cs = this.createCollisionShape(p.shape, p.params, p.object);\r\n                    // @ts-ignore // the relative pos, quat and scale to its parent\r\n                    cs._tmp = {\r\n                        pos: child.position.clone(),\r\n                        quat: child.quaternion.clone(),\r\n                        scale: child.scale.clone(),\r\n                        margin: margin\r\n                    };\r\n                    collisionShapes.push(cs);\r\n                }\r\n            });\r\n        }\r\n        // FALLBACK: if we do not have any collisionShapes yet, add a simple box as a fallback\r\n        if (collisionShapes.length === 0) {\r\n            const p = this.prepareThreeObjectForCollisionShape(object, config);\r\n            const cs = this.createCollisionShape(p.shape, p.params, p.object);\r\n            collisionShapes.push(cs);\r\n        }\r\n        const collisionShape = collisionShapes.length === 1 ? collisionShapes[0] : this.mergeCollisionShapesToCompoundShape(collisionShapes);\r\n        // add rigid body\r\n        // object.position.copy(pos)\r\n        // object.quaternion.copy(quat)\r\n        const localTransform = this.applyPosQuatScaleMargin(collisionShape, pos, quat, scale, margin);\r\n        const rigidBody = this.collisionShapeToRigidBody(collisionShape, localTransform, mass, isKinematicObject);\r\n        this.addRigidBodyToWorld(object, rigidBody, collisionFlags, collisionGroup, collisionMask, offset);\r\n        object.body.breakable = breakable;\r\n        object.body.fractureImpulse = fractureImpulse;\r\n        object.body.ignoreScale = ignoreScale;\r\n    }\r\n    addRigidBodyToWorld(object, rigidBody, collisionFlags, collisionGroup, collisionMask, offset) {\r\n        this.rigidBodies.push(object);\r\n        this.physicsWorld.addRigidBody(rigidBody, collisionGroup, collisionMask);\r\n        const ptr = Object.values(rigidBody)[0];\r\n        // @ts-ignore\r\n        rigidBody.name = object.name;\r\n        object.body = new PhysicsBody(this, rigidBody);\r\n        object.hasBody = true;\r\n        // @ts-ignore\r\n        object.ptr = ptr;\r\n        // @ts-ignore\r\n        rigidBody.threeObject = object;\r\n        if (offset)\r\n            object.body.offset = Object.assign({ x: 0, y: 0, z: 0 }, offset);\r\n        object.body.setCollisionFlags(collisionFlags);\r\n    }\r\n    applyPosQuatScaleMargin(collisionShape, pos = new Vector3(), quat = new Quaternion(), scale = new Vector3(), margin = 0.01) {\r\n        collisionShape.setMargin(margin);\r\n        const rotation = new Ammo.btQuaternion(0, 0, 0, 1);\r\n        rotation.setValue(quat.x, quat.y, quat.z, quat.w);\r\n        const localTransform = new Ammo.btTransform();\r\n        localTransform.setIdentity();\r\n        localTransform.getOrigin().setValue(pos.x, pos.y, pos.z);\r\n        localTransform.setRotation(rotation);\r\n        Ammo.destroy(rotation);\r\n        const localScale = new Ammo.btVector3(scale.x, scale.y, scale.z);\r\n        collisionShape.setLocalScaling(localScale);\r\n        Ammo.destroy(localScale);\r\n        return localTransform;\r\n    }\r\n    collisionShapeToRigidBody(collisionShape, localTransform, mass, disableDeactivation) {\r\n        const motionState = new Ammo.btDefaultMotionState(localTransform);\r\n        const localInertia = new Ammo.btVector3(0, 0, 0);\r\n        if (mass > 0)\r\n            collisionShape.calculateLocalInertia(mass, localInertia);\r\n        const rbInfo = new Ammo.btRigidBodyConstructionInfo(mass, motionState, collisionShape, localInertia);\r\n        const rigidBody = new Ammo.btRigidBody(rbInfo);\r\n        if (mass > 0 || disableDeactivation)\r\n            rigidBody.setActivationState(4); // Disable deactivation\r\n        return rigidBody;\r\n    }\r\n}\r\nexport { AmmoPhysics };\r\n//# sourceMappingURL=physics.js.map","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\nclass Shapes {\r\n    constructor(factory, addExisting) {\r\n        this.factory = factory;\r\n        this.addExisting = addExisting;\r\n    }\r\n    addPlane(planeConfig = {}, materialConfig = {}) {\r\n        const plane = this.factory.add.plane(planeConfig, materialConfig);\r\n        this.addExisting(plane, planeConfig);\r\n        return plane;\r\n    }\r\n    addSphere(sphereConfig = {}, materialConfig = {}) {\r\n        const sphere = this.factory.add.sphere(sphereConfig, materialConfig);\r\n        this.addExisting(sphere, sphereConfig);\r\n        return sphere;\r\n    }\r\n    addBox(boxConfig = {}, materialConfig = {}) {\r\n        const box = this.factory.add.box(boxConfig, materialConfig);\r\n        this.addExisting(box, boxConfig);\r\n        return box;\r\n    }\r\n    addGround(groundConfig, materialConfig = {}) {\r\n        const ground = this.factory.add.ground(groundConfig, materialConfig);\r\n        const config = Object.assign(Object.assign({}, groundConfig), { mass: 0, collisionFlags: 1 });\r\n        this.addExisting(ground, config);\r\n        return ground;\r\n    }\r\n    addCylinder(cylinderConfig = {}, materialConfig = {}) {\r\n        const cylinder = this.factory.add.cylinder(cylinderConfig, materialConfig);\r\n        this.addExisting(cylinder, cylinderConfig);\r\n        return cylinder;\r\n    }\r\n    addCone(coneConfig = {}, materialConfig = {}) {\r\n        const cone = this.factory.add.cone(coneConfig, materialConfig);\r\n        this.addExisting(cone, coneConfig);\r\n        return cone;\r\n    }\r\n    addTorus(torusConfig = {}, materialConfig = {}) {\r\n        const torus = this.factory.add.torus(torusConfig, materialConfig);\r\n        this.addExisting(torus, torusConfig);\r\n        return torus;\r\n    }\r\n    addExtrude(extrudeConfig, materialConfig = {}) {\r\n        const object = this.factory.add.extrude(extrudeConfig, materialConfig);\r\n        object.translateX(1);\r\n        this.addExisting(object);\r\n        return object;\r\n    }\r\n}\r\nexport default Shapes;\r\n//# sourceMappingURL=shapes.js.map","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\n// https://pybullet.org/Bullet/phpBB3/viewtopic.php?t=7228\r\nexport const createTorusShape = (config, quat) => {\r\n    const { radius = 1, tube = 0.4, tubularSegments = 8 } = config;\r\n    const SIMD_PI = Math.PI;\r\n    const subdivisions = tubularSegments;\r\n    const gap = Math.sqrt(2.0 * tube * tube - 2.0 * tube * tube * Math.cos((2.0 * SIMD_PI) / subdivisions));\r\n    const btHalfExtents = new Ammo.btVector3(tube, SIMD_PI / subdivisions + 0.5 * gap, tube);\r\n    const cylinderShape = new Ammo.btCylinderShape(btHalfExtents);\r\n    cylinderShape.setMargin(0.05);\r\n    const compoundShape = new Ammo.btCompoundShape();\r\n    const forward = new Ammo.btVector3(0, 0, 1);\r\n    const side = new Ammo.btVector3(0, radius, 0);\r\n    const rotation = new Ammo.btQuaternion(quat.x, quat.y, quat.z, quat.w);\r\n    for (let x = 0; x < subdivisions; x++) {\r\n        const angle = (x * 2.0 * SIMD_PI) / subdivisions;\r\n        const position = side.rotate(forward, angle);\r\n        const transform = new Ammo.btTransform();\r\n        rotation.setRotation(forward, angle + Math.PI / 2);\r\n        transform.setIdentity();\r\n        transform.setOrigin(position);\r\n        transform.setRotation(rotation);\r\n        compoundShape.addChildShape(transform, cylinderShape);\r\n    }\r\n    return compoundShape;\r\n};\r\n//# sourceMappingURL=torusShape.js.map","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\nimport { Events } from '@yandeu/events';\r\nimport { Euler, Quaternion } from 'three';\r\nclass PhysicsBody {\r\n    constructor(physics, ammo) {\r\n        this.physics = physics;\r\n        this.ammo = ammo;\r\n        this.ignoreScale = false;\r\n        this.isSoftBody = false;\r\n        this.offset = { x: 0, y: 0, z: 0 };\r\n        this.errors = [];\r\n        this.checkCollisions = false;\r\n        this.breakable = false;\r\n        this.fractureImpulse = 1;\r\n        this.didUpdate = false;\r\n        /** Skip syncing the mesh to the physics body. */\r\n        this.skipUpdate = false;\r\n        this._emitUpdateEvents = false;\r\n        this._needUpdate = false;\r\n        this.tmpEuler = new Euler();\r\n        this.tmpQuaternion = new Quaternion();\r\n        this.tmpBtVector3 = new Ammo.btVector3();\r\n        this.tmpBtVector3_1 = new Ammo.btVector3();\r\n        this.tmpBtQuaternion = new Ammo.btQuaternion(0, 0, 0, 1);\r\n        this.eventEmitter = new Events();\r\n        // @ts-ignore\r\n        this.name = ammo.name;\r\n    }\r\n    /**\r\n     * Don't call this manually! Do physics.destroy() instead.\r\n     */\r\n    destructor() {\r\n        // remove events\r\n        if (this.eventEmitter)\r\n            this.eventEmitter.removeAllListeners();\r\n        // destroy tmp ammo values\r\n        Ammo.destroy(this.tmpBtVector3);\r\n        Ammo.destroy(this.tmpBtVector3_1);\r\n        Ammo.destroy(this.tmpBtQuaternion);\r\n        // destory collision shape\r\n        Ammo.destroy(this.ammo.getCollisionShape());\r\n        // destroy body\r\n        Ammo.destroy(this.ammo);\r\n    }\r\n    setupEventEmitter() {\r\n        if (typeof this.eventEmitter === 'undefined')\r\n            this.eventEmitter = new Events();\r\n    }\r\n    get needUpdate() {\r\n        return this._needUpdate;\r\n    }\r\n    set needUpdate(need) {\r\n        if (!need && this._needUpdate)\r\n            this.didUpdate = true;\r\n        this._needUpdate = need;\r\n    }\r\n    onUpdateEvent(updateCallback, once = false) {\r\n        this.setupEventEmitter();\r\n        this._emitUpdateEvents = true;\r\n        if (once)\r\n            this.eventEmitter.once('update', () => {\r\n                updateCallback();\r\n            });\r\n        else\r\n            this.eventEmitter.on('update', () => {\r\n                updateCallback();\r\n            });\r\n    }\r\n    get on() {\r\n        return {\r\n            update: (updateCallback) => this.onUpdateEvent(updateCallback),\r\n            collision: (collisionCallback) => this.onCollision(collisionCallback)\r\n        };\r\n    }\r\n    get once() {\r\n        return {\r\n            update: (updateCallback) => this.onUpdateEvent(updateCallback, true)\r\n        };\r\n    }\r\n    onCollision(collisionCallback) {\r\n        this.checkCollisions = true;\r\n        this.physics.collisionEvents.on('collision', (data) => {\r\n            const { bodies, event } = data;\r\n            if (bodies[0].name === this.name)\r\n                collisionCallback(bodies[1], event);\r\n            else if (bodies[1].name === this.name)\r\n                collisionCallback(bodies[0], event);\r\n        });\r\n    }\r\n    /** You have to call transform() before you can get or set the body's position or rotation. (for headless mode only) */\r\n    transform() {\r\n        const t = this.physics.worldTransform;\r\n        this.ammo.getMotionState().getWorldTransform(t);\r\n    }\r\n    /** You have to call refresh() after you set the position or rotation of the body. (for headless mode only) */\r\n    refresh() {\r\n        const t = this.physics.worldTransform;\r\n        this.ammo.getMotionState().setWorldTransform(t);\r\n    }\r\n    /** Set the rotation in radians. (for headless mode only) */\r\n    setRotation(x, y, z) {\r\n        const e = this.tmpEuler.set(x, y, z);\r\n        const q = this.tmpQuaternion.set(0, 0, 0, 1);\r\n        q.setFromEuler(e);\r\n        this.tmpBtQuaternion.setValue(0, 0, 0, 1);\r\n        const ammoQuat = this.tmpBtQuaternion;\r\n        ammoQuat.setValue(q.x, q.y, q.z, q.w);\r\n        const t = this.physics.worldTransform;\r\n        t.setRotation(ammoQuat);\r\n    }\r\n    /** Get the rotation in radians. (for headless mode only) */\r\n    get rotation() {\r\n        // https://www.euclideanspace.com/maths/geometry/rotations/conversions/quaternionToAngle/index.htm\r\n        let x, y, z;\r\n        const t = this.physics.worldTransform;\r\n        const ammoQuat = t.getRotation();\r\n        let q1 = this.tmpQuaternion.set(ammoQuat.x(), ammoQuat.y(), ammoQuat.z(), ammoQuat.w());\r\n        if (q1.w > 1)\r\n            q1 = q1.normalize(); // if w>1 acos and sqrt will produce errors, this cant happen if quaternion is normalized\r\n        const angle = 2 * Math.acos(q1.w);\r\n        const s = Math.sqrt(1 - q1.w * q1.w); // assuming quaternion normalized then w is less than 1, so term always positive.\r\n        if (s < 0.001) {\r\n            // test to avoid divide by zero, s is always positive due to sqrt\r\n            // if s close to zero then direction of axis not important\r\n            x = q1.x; // if it is important that axis is normalized then replace with x=1; y=z=0;\r\n            y = q1.y;\r\n            z = q1.z;\r\n        }\r\n        else {\r\n            x = q1.x / s; // normalized axis\r\n            y = q1.y / s;\r\n            z = q1.z / s;\r\n        }\r\n        return { x: x * angle, y: y * angle, z: z * angle };\r\n    }\r\n    /** Get the quaternion. (for headless mode only) */\r\n    get quaternion() {\r\n        const t = this.physics.worldTransform;\r\n        const q = t.getRotation();\r\n        return { x: q.x(), y: q.y(), z: q.z(), w: q.w() };\r\n    }\r\n    /** Set position. (for headless mode only) */\r\n    setPosition(x, y, z) {\r\n        const t = this.physics.worldTransform;\r\n        t.getOrigin().setValue(x, y, z);\r\n    }\r\n    /** Get position. (for headless mode only) */\r\n    get position() {\r\n        const t = this.physics.worldTransform;\r\n        return { x: t.getOrigin().x(), y: t.getOrigin().y(), z: t.getOrigin().z() };\r\n    }\r\n    get velocity() {\r\n        return {\r\n            x: this.ammo.getLinearVelocity().x(),\r\n            y: this.ammo.getLinearVelocity().y(),\r\n            z: this.ammo.getLinearVelocity().z()\r\n        };\r\n    }\r\n    get angularVelocity() {\r\n        return {\r\n            x: this.ammo.getAngularVelocity().x(),\r\n            y: this.ammo.getAngularVelocity().y(),\r\n            z: this.ammo.getAngularVelocity().z()\r\n        };\r\n    }\r\n    setVelocity(x, y, z) {\r\n        this.tmpBtVector3.setValue(x, y, z);\r\n        this.ammo.setLinearVelocity(this.tmpBtVector3);\r\n    }\r\n    setVelocityX(value) {\r\n        this.tmpBtVector3.setValue(value, this.velocity.y, this.velocity.z);\r\n        this.ammo.setLinearVelocity(this.tmpBtVector3);\r\n    }\r\n    setVelocityY(value) {\r\n        this.tmpBtVector3.setValue(this.velocity.x, value, this.velocity.z);\r\n        this.ammo.setLinearVelocity(this.tmpBtVector3);\r\n    }\r\n    setVelocityZ(value) {\r\n        this.tmpBtVector3.setValue(this.velocity.x, this.velocity.y, value);\r\n        this.ammo.setLinearVelocity(this.tmpBtVector3);\r\n    }\r\n    setAngularVelocity(x, y, z) {\r\n        this.tmpBtVector3.setValue(x, y, z);\r\n        this.ammo.setAngularVelocity(this.tmpBtVector3);\r\n    }\r\n    setAngularVelocityX(value) {\r\n        this.tmpBtVector3.setValue(value, this.angularVelocity.y, this.angularVelocity.z);\r\n        this.ammo.setAngularVelocity(this.tmpBtVector3);\r\n    }\r\n    setAngularVelocityY(value) {\r\n        this.tmpBtVector3.setValue(this.angularVelocity.x, value, this.angularVelocity.z);\r\n        this.ammo.setAngularVelocity(this.tmpBtVector3);\r\n    }\r\n    setAngularVelocityZ(value) {\r\n        this.tmpBtVector3.setValue(this.angularVelocity.x, this.angularVelocity.y, value);\r\n        this.ammo.setAngularVelocity(this.tmpBtVector3);\r\n    }\r\n    // Apply Force methods\r\n    applyForce(x, y, z) {\r\n        this.tmpBtVector3.setValue(x, y, z);\r\n        this.ammo.applyCentralImpulse(this.tmpBtVector3);\r\n    }\r\n    applyForceX(value) {\r\n        this.tmpBtVector3.setValue(value, 0, 0);\r\n        this.ammo.applyCentralImpulse(this.tmpBtVector3);\r\n    }\r\n    applyForceY(value) {\r\n        this.tmpBtVector3.setValue(0, value, 0);\r\n        this.ammo.applyCentralImpulse(this.tmpBtVector3);\r\n    }\r\n    applyForceZ(value) {\r\n        this.tmpBtVector3.setValue(0, 0, value);\r\n        this.ammo.applyCentralImpulse(this.tmpBtVector3);\r\n    }\r\n    // Apply \"Something\" Methods\r\n    applyCentralForce(x, y, z) {\r\n        this.tmpBtVector3.setValue(x, y, z);\r\n        this.ammo.applyCentralForce(this.tmpBtVector3);\r\n    }\r\n    applyCentralImpulse(x, y, z) {\r\n        this.tmpBtVector3.setValue(x, y, z);\r\n        this.ammo.applyCentralImpulse(this.tmpBtVector3);\r\n    }\r\n    applyCentralLocalForce(x, y, z) {\r\n        this.tmpBtVector3.setValue(x, y, z);\r\n        this.ammo.applyCentralLocalForce(this.tmpBtVector3);\r\n    }\r\n    applyImpulse(impulse, relativePosition) {\r\n        this.tmpBtVector3.setValue(impulse.x || 0, impulse.y || 0, impulse.z || 0);\r\n        this.tmpBtVector3_1.setValue(relativePosition.x || 0, relativePosition.y || 0, relativePosition.z || 0);\r\n        this.ammo.applyImpulse(this.tmpBtVector3, this.tmpBtVector3_1);\r\n    }\r\n    applyLocalTorque(x, y, z) {\r\n        this.tmpBtVector3.setValue(x, y, z);\r\n        this.ammo.applyLocalTorque(this.tmpBtVector3);\r\n    }\r\n    applyTorque(x, y, z) {\r\n        this.tmpBtVector3.setValue(x, y, z);\r\n        this.ammo.applyTorque(this.tmpBtVector3);\r\n    }\r\n    applyTorqueImpulse(x, y, z) {\r\n        this.tmpBtVector3.setValue(x, y, z);\r\n        this.ammo.applyTorqueImpulse(this.tmpBtVector3);\r\n    }\r\n    /**\r\n     * Add the collision flags\r\n     * @param value 0 is DYNAMIC, 1 is STATIC, 2 is KINEMATIC, 4 GHOST\r\n     */\r\n    // https://github.com/bulletphysics/bullet3/blob/aae8048722f2596f7e2bdd52d2a1dcb52a218f2b/src/BulletCollision/CollisionDispatch/btCollisionObject.h#L128\r\n    setCollisionFlags(value) {\r\n        this.ammo.setCollisionFlags(value);\r\n    }\r\n    /**\r\n     * Get the collision flags\r\n     * @param value 0 is DYNAMIC, 1 is STATIC, 2 is KINEMATIC, 4 GHOST\r\n     */\r\n    getCollisionFlags() {\r\n        return this.ammo.getCollisionFlags();\r\n    }\r\n    /**\r\n     * Set the restitution (same as bounciness)\r\n     * @param value A number from 0 to 1.\r\n     */\r\n    setRestitution(value) {\r\n        this.ammo.setRestitution(value);\r\n    }\r\n    /**\r\n     * Set the bounciness (same as restitution)\r\n     * @param value A number from 0 to 1.\r\n     */\r\n    setBounciness(value) {\r\n        this.setRestitution(value);\r\n    }\r\n    /**\r\n     * Set the friction\r\n     * @param value A number from 0 to 1.\r\n     */\r\n    setFriction(value) {\r\n        this.ammo.setFriction(value);\r\n    }\r\n    /**\r\n     * Set the linear and angular damping\r\n     * @param linear A number from 0 to 1.\r\n     * @param angular A number from 0 to 1.\r\n     */\r\n    setDamping(linear, angular) {\r\n        this.ammo.setDamping(linear, angular);\r\n    }\r\n    /** Set per body gravity */\r\n    setGravity(x, y, z) {\r\n        this.tmpBtVector3.setValue(x, y, z);\r\n        this.ammo.setGravity(this.tmpBtVector3);\r\n    }\r\n    setLinearFactor(x, y, z) {\r\n        this.tmpBtVector3.setValue(x, y, z);\r\n        this.ammo.setLinearFactor(this.tmpBtVector3);\r\n    }\r\n    setAngularFactor(x, y, z) {\r\n        this.tmpBtVector3.setValue(x, y, z);\r\n        this.ammo.setAngularFactor(this.tmpBtVector3);\r\n    }\r\n    setCcdMotionThreshold(threshold) {\r\n        this.ammo.setCcdMotionThreshold(threshold);\r\n    }\r\n    setCcdSweptSphereRadius(radius) {\r\n        this.ammo.setCcdSweptSphereRadius(radius);\r\n    }\r\n}\r\nexport default PhysicsBody;\r\n//# sourceMappingURL=physicsBody.js.map","export { ThreeGraphics } from './core';\r\nexport { PhysicsLoader } from '@enable3d/common/dist/physicsLoader';\r\nimport * as Types_1 from '@enable3d/common/dist/types';\r\nexport { Types_1 as Types };\r\nimport { VERSION } from './version';\r\nconst info = `Powered by enable3d v${VERSION}`;\r\nconsole.log(`%c %c %c %c %c ${info} %c https://enable3d.io/`, 'background: #ff0000', 'background: #ffff00', 'background: #00ff00', 'background: #00ffff', 'color: #fff; background: #000000;', 'background: none');\r\n//# sourceMappingURL=index.js.map","/*!\nfflate - fast JavaScript compression/decompression\n<https://101arrowz.github.io/fflate>\nLicensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE\nversion 0.6.9\n*/\n\n// DEFLATE is a complex format; to read this code, you should probably check the RFC first:\n// https://tools.ietf.org/html/rfc1951\n// You may also wish to take a look at the guide I made about this program:\n// https://gist.github.com/101arrowz/253f31eb5abc3d9275ab943003ffecad\n// Some of the following code is similar to that of UZIP.js:\n// https://github.com/photopea/UZIP.js\n// However, the vast majority of the codebase has diverged from UZIP.js to increase performance and reduce bundle size.\n// Sometimes 0 will appear where -1 would be more appropriate. This is because using a uint\n// is better for memory in most engines (I *think*).\nvar ch2 = {};\nvar durl = function (c) { return URL.createObjectURL(new Blob([c], { type: 'text/javascript' })); };\nvar cwk = function (u) { return new Worker(u); };\ntry {\n    URL.revokeObjectURL(durl(''));\n}\ncatch (e) {\n    // We're in Deno or a very old browser\n    durl = function (c) { return 'data:application/javascript;charset=UTF-8,' + encodeURI(c); };\n    // If Deno, this is necessary; if not, this changes nothing\n    cwk = function (u) { return new Worker(u, { type: 'module' }); };\n}\nvar wk = (function (c, id, msg, transfer, cb) {\n    var w = cwk(ch2[id] || (ch2[id] = durl(c)));\n    w.onerror = function (e) { return cb(e.error, null); };\n    w.onmessage = function (e) { return cb(null, e.data); };\n    w.postMessage(msg, transfer);\n    return w;\n});\n\n// aliases for shorter compressed code (most minifers don't do this)\nvar u8 = Uint8Array, u16 = Uint16Array, u32 = Uint32Array;\n// fixed length extra bits\nvar fleb = new u8([0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0, /* unused */ 0, 0, /* impossible */ 0]);\n// fixed distance extra bits\n// see fleb note\nvar fdeb = new u8([0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13, /* unused */ 0, 0]);\n// code length index map\nvar clim = new u8([16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15]);\n// get base, reverse index map from extra bits\nvar freb = function (eb, start) {\n    var b = new u16(31);\n    for (var i = 0; i < 31; ++i) {\n        b[i] = start += 1 << eb[i - 1];\n    }\n    // numbers here are at max 18 bits\n    var r = new u32(b[30]);\n    for (var i = 1; i < 30; ++i) {\n        for (var j = b[i]; j < b[i + 1]; ++j) {\n            r[j] = ((j - b[i]) << 5) | i;\n        }\n    }\n    return [b, r];\n};\nvar _a = freb(fleb, 2), fl = _a[0], revfl = _a[1];\n// we can ignore the fact that the other numbers are wrong; they never happen anyway\nfl[28] = 258, revfl[258] = 28;\nvar _b = freb(fdeb, 0), fd = _b[0], revfd = _b[1];\n// map of value to reverse (assuming 16 bits)\nvar rev = new u16(32768);\nfor (var i = 0; i < 32768; ++i) {\n    // reverse table algorithm from SO\n    var x = ((i & 0xAAAA) >>> 1) | ((i & 0x5555) << 1);\n    x = ((x & 0xCCCC) >>> 2) | ((x & 0x3333) << 2);\n    x = ((x & 0xF0F0) >>> 4) | ((x & 0x0F0F) << 4);\n    rev[i] = (((x & 0xFF00) >>> 8) | ((x & 0x00FF) << 8)) >>> 1;\n}\n// create huffman tree from u8 \"map\": index -> code length for code index\n// mb (max bits) must be at most 15\n// TODO: optimize/split up?\nvar hMap = (function (cd, mb, r) {\n    var s = cd.length;\n    // index\n    var i = 0;\n    // u16 \"map\": index -> # of codes with bit length = index\n    var l = new u16(mb);\n    // length of cd must be 288 (total # of codes)\n    for (; i < s; ++i)\n        ++l[cd[i] - 1];\n    // u16 \"map\": index -> minimum code for bit length = index\n    var le = new u16(mb);\n    for (i = 0; i < mb; ++i) {\n        le[i] = (le[i - 1] + l[i - 1]) << 1;\n    }\n    var co;\n    if (r) {\n        // u16 \"map\": index -> number of actual bits, symbol for code\n        co = new u16(1 << mb);\n        // bits to remove for reverser\n        var rvb = 15 - mb;\n        for (i = 0; i < s; ++i) {\n            // ignore 0 lengths\n            if (cd[i]) {\n                // num encoding both symbol and bits read\n                var sv = (i << 4) | cd[i];\n                // free bits\n                var r_1 = mb - cd[i];\n                // start value\n                var v = le[cd[i] - 1]++ << r_1;\n                // m is end value\n                for (var m = v | ((1 << r_1) - 1); v <= m; ++v) {\n                    // every 16 bit value starting with the code yields the same result\n                    co[rev[v] >>> rvb] = sv;\n                }\n            }\n        }\n    }\n    else {\n        co = new u16(s);\n        for (i = 0; i < s; ++i) {\n            if (cd[i]) {\n                co[i] = rev[le[cd[i] - 1]++] >>> (15 - cd[i]);\n            }\n        }\n    }\n    return co;\n});\n// fixed length tree\nvar flt = new u8(288);\nfor (var i = 0; i < 144; ++i)\n    flt[i] = 8;\nfor (var i = 144; i < 256; ++i)\n    flt[i] = 9;\nfor (var i = 256; i < 280; ++i)\n    flt[i] = 7;\nfor (var i = 280; i < 288; ++i)\n    flt[i] = 8;\n// fixed distance tree\nvar fdt = new u8(32);\nfor (var i = 0; i < 32; ++i)\n    fdt[i] = 5;\n// fixed length map\nvar flm = /*#__PURE__*/ hMap(flt, 9, 0), flrm = /*#__PURE__*/ hMap(flt, 9, 1);\n// fixed distance map\nvar fdm = /*#__PURE__*/ hMap(fdt, 5, 0), fdrm = /*#__PURE__*/ hMap(fdt, 5, 1);\n// find max of array\nvar max = function (a) {\n    var m = a[0];\n    for (var i = 1; i < a.length; ++i) {\n        if (a[i] > m)\n            m = a[i];\n    }\n    return m;\n};\n// read d, starting at bit p and mask with m\nvar bits = function (d, p, m) {\n    var o = (p / 8) | 0;\n    return ((d[o] | (d[o + 1] << 8)) >> (p & 7)) & m;\n};\n// read d, starting at bit p continuing for at least 16 bits\nvar bits16 = function (d, p) {\n    var o = (p / 8) | 0;\n    return ((d[o] | (d[o + 1] << 8) | (d[o + 2] << 16)) >> (p & 7));\n};\n// get end of byte\nvar shft = function (p) { return ((p / 8) | 0) + (p & 7 && 1); };\n// typed array slice - allows garbage collector to free original reference,\n// while being more compatible than .slice\nvar slc = function (v, s, e) {\n    if (s == null || s < 0)\n        s = 0;\n    if (e == null || e > v.length)\n        e = v.length;\n    // can't use .constructor in case user-supplied\n    var n = new (v instanceof u16 ? u16 : v instanceof u32 ? u32 : u8)(e - s);\n    n.set(v.subarray(s, e));\n    return n;\n};\n// expands raw DEFLATE data\nvar inflt = function (dat, buf, st) {\n    // source length\n    var sl = dat.length;\n    if (!sl || (st && !st.l && sl < 5))\n        return buf || new u8(0);\n    // have to estimate size\n    var noBuf = !buf || st;\n    // no state\n    var noSt = !st || st.i;\n    if (!st)\n        st = {};\n    // Assumes roughly 33% compression ratio average\n    if (!buf)\n        buf = new u8(sl * 3);\n    // ensure buffer can fit at least l elements\n    var cbuf = function (l) {\n        var bl = buf.length;\n        // need to increase size to fit\n        if (l > bl) {\n            // Double or set to necessary, whichever is greater\n            var nbuf = new u8(Math.max(bl * 2, l));\n            nbuf.set(buf);\n            buf = nbuf;\n        }\n    };\n    //  last chunk         bitpos           bytes\n    var final = st.f || 0, pos = st.p || 0, bt = st.b || 0, lm = st.l, dm = st.d, lbt = st.m, dbt = st.n;\n    // total bits\n    var tbts = sl * 8;\n    do {\n        if (!lm) {\n            // BFINAL - this is only 1 when last chunk is next\n            st.f = final = bits(dat, pos, 1);\n            // type: 0 = no compression, 1 = fixed huffman, 2 = dynamic huffman\n            var type = bits(dat, pos + 1, 3);\n            pos += 3;\n            if (!type) {\n                // go to end of byte boundary\n                var s = shft(pos) + 4, l = dat[s - 4] | (dat[s - 3] << 8), t = s + l;\n                if (t > sl) {\n                    if (noSt)\n                        throw 'unexpected EOF';\n                    break;\n                }\n                // ensure size\n                if (noBuf)\n                    cbuf(bt + l);\n                // Copy over uncompressed data\n                buf.set(dat.subarray(s, t), bt);\n                // Get new bitpos, update byte count\n                st.b = bt += l, st.p = pos = t * 8;\n                continue;\n            }\n            else if (type == 1)\n                lm = flrm, dm = fdrm, lbt = 9, dbt = 5;\n            else if (type == 2) {\n                //  literal                            lengths\n                var hLit = bits(dat, pos, 31) + 257, hcLen = bits(dat, pos + 10, 15) + 4;\n                var tl = hLit + bits(dat, pos + 5, 31) + 1;\n                pos += 14;\n                // length+distance tree\n                var ldt = new u8(tl);\n                // code length tree\n                var clt = new u8(19);\n                for (var i = 0; i < hcLen; ++i) {\n                    // use index map to get real code\n                    clt[clim[i]] = bits(dat, pos + i * 3, 7);\n                }\n                pos += hcLen * 3;\n                // code lengths bits\n                var clb = max(clt), clbmsk = (1 << clb) - 1;\n                // code lengths map\n                var clm = hMap(clt, clb, 1);\n                for (var i = 0; i < tl;) {\n                    var r = clm[bits(dat, pos, clbmsk)];\n                    // bits read\n                    pos += r & 15;\n                    // symbol\n                    var s = r >>> 4;\n                    // code length to copy\n                    if (s < 16) {\n                        ldt[i++] = s;\n                    }\n                    else {\n                        //  copy   count\n                        var c = 0, n = 0;\n                        if (s == 16)\n                            n = 3 + bits(dat, pos, 3), pos += 2, c = ldt[i - 1];\n                        else if (s == 17)\n                            n = 3 + bits(dat, pos, 7), pos += 3;\n                        else if (s == 18)\n                            n = 11 + bits(dat, pos, 127), pos += 7;\n                        while (n--)\n                            ldt[i++] = c;\n                    }\n                }\n                //    length tree                 distance tree\n                var lt = ldt.subarray(0, hLit), dt = ldt.subarray(hLit);\n                // max length bits\n                lbt = max(lt);\n                // max dist bits\n                dbt = max(dt);\n                lm = hMap(lt, lbt, 1);\n                dm = hMap(dt, dbt, 1);\n            }\n            else\n                throw 'invalid block type';\n            if (pos > tbts) {\n                if (noSt)\n                    throw 'unexpected EOF';\n                break;\n            }\n        }\n        // Make sure the buffer can hold this + the largest possible addition\n        // Maximum chunk size (practically, theoretically infinite) is 2^17;\n        if (noBuf)\n            cbuf(bt + 131072);\n        var lms = (1 << lbt) - 1, dms = (1 << dbt) - 1;\n        var lpos = pos;\n        for (;; lpos = pos) {\n            // bits read, code\n            var c = lm[bits16(dat, pos) & lms], sym = c >>> 4;\n            pos += c & 15;\n            if (pos > tbts) {\n                if (noSt)\n                    throw 'unexpected EOF';\n                break;\n            }\n            if (!c)\n                throw 'invalid length/literal';\n            if (sym < 256)\n                buf[bt++] = sym;\n            else if (sym == 256) {\n                lpos = pos, lm = null;\n                break;\n            }\n            else {\n                var add = sym - 254;\n                // no extra bits needed if less\n                if (sym > 264) {\n                    // index\n                    var i = sym - 257, b = fleb[i];\n                    add = bits(dat, pos, (1 << b) - 1) + fl[i];\n                    pos += b;\n                }\n                // dist\n                var d = dm[bits16(dat, pos) & dms], dsym = d >>> 4;\n                if (!d)\n                    throw 'invalid distance';\n                pos += d & 15;\n                var dt = fd[dsym];\n                if (dsym > 3) {\n                    var b = fdeb[dsym];\n                    dt += bits16(dat, pos) & ((1 << b) - 1), pos += b;\n                }\n                if (pos > tbts) {\n                    if (noSt)\n                        throw 'unexpected EOF';\n                    break;\n                }\n                if (noBuf)\n                    cbuf(bt + 131072);\n                var end = bt + add;\n                for (; bt < end; bt += 4) {\n                    buf[bt] = buf[bt - dt];\n                    buf[bt + 1] = buf[bt + 1 - dt];\n                    buf[bt + 2] = buf[bt + 2 - dt];\n                    buf[bt + 3] = buf[bt + 3 - dt];\n                }\n                bt = end;\n            }\n        }\n        st.l = lm, st.p = lpos, st.b = bt;\n        if (lm)\n            final = 1, st.m = lbt, st.d = dm, st.n = dbt;\n    } while (!final);\n    return bt == buf.length ? buf : slc(buf, 0, bt);\n};\n// starting at p, write the minimum number of bits that can hold v to d\nvar wbits = function (d, p, v) {\n    v <<= p & 7;\n    var o = (p / 8) | 0;\n    d[o] |= v;\n    d[o + 1] |= v >>> 8;\n};\n// starting at p, write the minimum number of bits (>8) that can hold v to d\nvar wbits16 = function (d, p, v) {\n    v <<= p & 7;\n    var o = (p / 8) | 0;\n    d[o] |= v;\n    d[o + 1] |= v >>> 8;\n    d[o + 2] |= v >>> 16;\n};\n// creates code lengths from a frequency table\nvar hTree = function (d, mb) {\n    // Need extra info to make a tree\n    var t = [];\n    for (var i = 0; i < d.length; ++i) {\n        if (d[i])\n            t.push({ s: i, f: d[i] });\n    }\n    var s = t.length;\n    var t2 = t.slice();\n    if (!s)\n        return [et, 0];\n    if (s == 1) {\n        var v = new u8(t[0].s + 1);\n        v[t[0].s] = 1;\n        return [v, 1];\n    }\n    t.sort(function (a, b) { return a.f - b.f; });\n    // after i2 reaches last ind, will be stopped\n    // freq must be greater than largest possible number of symbols\n    t.push({ s: -1, f: 25001 });\n    var l = t[0], r = t[1], i0 = 0, i1 = 1, i2 = 2;\n    t[0] = { s: -1, f: l.f + r.f, l: l, r: r };\n    // efficient algorithm from UZIP.js\n    // i0 is lookbehind, i2 is lookahead - after processing two low-freq\n    // symbols that combined have high freq, will start processing i2 (high-freq,\n    // non-composite) symbols instead\n    // see https://reddit.com/r/photopea/comments/ikekht/uzipjs_questions/\n    while (i1 != s - 1) {\n        l = t[t[i0].f < t[i2].f ? i0++ : i2++];\n        r = t[i0 != i1 && t[i0].f < t[i2].f ? i0++ : i2++];\n        t[i1++] = { s: -1, f: l.f + r.f, l: l, r: r };\n    }\n    var maxSym = t2[0].s;\n    for (var i = 1; i < s; ++i) {\n        if (t2[i].s > maxSym)\n            maxSym = t2[i].s;\n    }\n    // code lengths\n    var tr = new u16(maxSym + 1);\n    // max bits in tree\n    var mbt = ln(t[i1 - 1], tr, 0);\n    if (mbt > mb) {\n        // more algorithms from UZIP.js\n        // TODO: find out how this code works (debt)\n        //  ind    debt\n        var i = 0, dt = 0;\n        //    left            cost\n        var lft = mbt - mb, cst = 1 << lft;\n        t2.sort(function (a, b) { return tr[b.s] - tr[a.s] || a.f - b.f; });\n        for (; i < s; ++i) {\n            var i2_1 = t2[i].s;\n            if (tr[i2_1] > mb) {\n                dt += cst - (1 << (mbt - tr[i2_1]));\n                tr[i2_1] = mb;\n            }\n            else\n                break;\n        }\n        dt >>>= lft;\n        while (dt > 0) {\n            var i2_2 = t2[i].s;\n            if (tr[i2_2] < mb)\n                dt -= 1 << (mb - tr[i2_2]++ - 1);\n            else\n                ++i;\n        }\n        for (; i >= 0 && dt; --i) {\n            var i2_3 = t2[i].s;\n            if (tr[i2_3] == mb) {\n                --tr[i2_3];\n                ++dt;\n            }\n        }\n        mbt = mb;\n    }\n    return [new u8(tr), mbt];\n};\n// get the max length and assign length codes\nvar ln = function (n, l, d) {\n    return n.s == -1\n        ? Math.max(ln(n.l, l, d + 1), ln(n.r, l, d + 1))\n        : (l[n.s] = d);\n};\n// length codes generation\nvar lc = function (c) {\n    var s = c.length;\n    // Note that the semicolon was intentional\n    while (s && !c[--s])\n        ;\n    var cl = new u16(++s);\n    //  ind      num         streak\n    var cli = 0, cln = c[0], cls = 1;\n    var w = function (v) { cl[cli++] = v; };\n    for (var i = 1; i <= s; ++i) {\n        if (c[i] == cln && i != s)\n            ++cls;\n        else {\n            if (!cln && cls > 2) {\n                for (; cls > 138; cls -= 138)\n                    w(32754);\n                if (cls > 2) {\n                    w(cls > 10 ? ((cls - 11) << 5) | 28690 : ((cls - 3) << 5) | 12305);\n                    cls = 0;\n                }\n            }\n            else if (cls > 3) {\n                w(cln), --cls;\n                for (; cls > 6; cls -= 6)\n                    w(8304);\n                if (cls > 2)\n                    w(((cls - 3) << 5) | 8208), cls = 0;\n            }\n            while (cls--)\n                w(cln);\n            cls = 1;\n            cln = c[i];\n        }\n    }\n    return [cl.subarray(0, cli), s];\n};\n// calculate the length of output from tree, code lengths\nvar clen = function (cf, cl) {\n    var l = 0;\n    for (var i = 0; i < cl.length; ++i)\n        l += cf[i] * cl[i];\n    return l;\n};\n// writes a fixed block\n// returns the new bit pos\nvar wfblk = function (out, pos, dat) {\n    // no need to write 00 as type: TypedArray defaults to 0\n    var s = dat.length;\n    var o = shft(pos + 2);\n    out[o] = s & 255;\n    out[o + 1] = s >>> 8;\n    out[o + 2] = out[o] ^ 255;\n    out[o + 3] = out[o + 1] ^ 255;\n    for (var i = 0; i < s; ++i)\n        out[o + i + 4] = dat[i];\n    return (o + 4 + s) * 8;\n};\n// writes a block\nvar wblk = function (dat, out, final, syms, lf, df, eb, li, bs, bl, p) {\n    wbits(out, p++, final);\n    ++lf[256];\n    var _a = hTree(lf, 15), dlt = _a[0], mlb = _a[1];\n    var _b = hTree(df, 15), ddt = _b[0], mdb = _b[1];\n    var _c = lc(dlt), lclt = _c[0], nlc = _c[1];\n    var _d = lc(ddt), lcdt = _d[0], ndc = _d[1];\n    var lcfreq = new u16(19);\n    for (var i = 0; i < lclt.length; ++i)\n        lcfreq[lclt[i] & 31]++;\n    for (var i = 0; i < lcdt.length; ++i)\n        lcfreq[lcdt[i] & 31]++;\n    var _e = hTree(lcfreq, 7), lct = _e[0], mlcb = _e[1];\n    var nlcc = 19;\n    for (; nlcc > 4 && !lct[clim[nlcc - 1]]; --nlcc)\n        ;\n    var flen = (bl + 5) << 3;\n    var ftlen = clen(lf, flt) + clen(df, fdt) + eb;\n    var dtlen = clen(lf, dlt) + clen(df, ddt) + eb + 14 + 3 * nlcc + clen(lcfreq, lct) + (2 * lcfreq[16] + 3 * lcfreq[17] + 7 * lcfreq[18]);\n    if (flen <= ftlen && flen <= dtlen)\n        return wfblk(out, p, dat.subarray(bs, bs + bl));\n    var lm, ll, dm, dl;\n    wbits(out, p, 1 + (dtlen < ftlen)), p += 2;\n    if (dtlen < ftlen) {\n        lm = hMap(dlt, mlb, 0), ll = dlt, dm = hMap(ddt, mdb, 0), dl = ddt;\n        var llm = hMap(lct, mlcb, 0);\n        wbits(out, p, nlc - 257);\n        wbits(out, p + 5, ndc - 1);\n        wbits(out, p + 10, nlcc - 4);\n        p += 14;\n        for (var i = 0; i < nlcc; ++i)\n            wbits(out, p + 3 * i, lct[clim[i]]);\n        p += 3 * nlcc;\n        var lcts = [lclt, lcdt];\n        for (var it = 0; it < 2; ++it) {\n            var clct = lcts[it];\n            for (var i = 0; i < clct.length; ++i) {\n                var len = clct[i] & 31;\n                wbits(out, p, llm[len]), p += lct[len];\n                if (len > 15)\n                    wbits(out, p, (clct[i] >>> 5) & 127), p += clct[i] >>> 12;\n            }\n        }\n    }\n    else {\n        lm = flm, ll = flt, dm = fdm, dl = fdt;\n    }\n    for (var i = 0; i < li; ++i) {\n        if (syms[i] > 255) {\n            var len = (syms[i] >>> 18) & 31;\n            wbits16(out, p, lm[len + 257]), p += ll[len + 257];\n            if (len > 7)\n                wbits(out, p, (syms[i] >>> 23) & 31), p += fleb[len];\n            var dst = syms[i] & 31;\n            wbits16(out, p, dm[dst]), p += dl[dst];\n            if (dst > 3)\n                wbits16(out, p, (syms[i] >>> 5) & 8191), p += fdeb[dst];\n        }\n        else {\n            wbits16(out, p, lm[syms[i]]), p += ll[syms[i]];\n        }\n    }\n    wbits16(out, p, lm[256]);\n    return p + ll[256];\n};\n// deflate options (nice << 13) | chain\nvar deo = /*#__PURE__*/ new u32([65540, 131080, 131088, 131104, 262176, 1048704, 1048832, 2114560, 2117632]);\n// empty\nvar et = /*#__PURE__*/ new u8(0);\n// compresses data into a raw DEFLATE buffer\nvar dflt = function (dat, lvl, plvl, pre, post, lst) {\n    var s = dat.length;\n    var o = new u8(pre + s + 5 * (1 + Math.ceil(s / 7000)) + post);\n    // writing to this writes to the output buffer\n    var w = o.subarray(pre, o.length - post);\n    var pos = 0;\n    if (!lvl || s < 8) {\n        for (var i = 0; i <= s; i += 65535) {\n            // end\n            var e = i + 65535;\n            if (e < s) {\n                // write full block\n                pos = wfblk(w, pos, dat.subarray(i, e));\n            }\n            else {\n                // write final block\n                w[i] = lst;\n                pos = wfblk(w, pos, dat.subarray(i, s));\n            }\n        }\n    }\n    else {\n        var opt = deo[lvl - 1];\n        var n = opt >>> 13, c = opt & 8191;\n        var msk_1 = (1 << plvl) - 1;\n        //    prev 2-byte val map    curr 2-byte val map\n        var prev = new u16(32768), head = new u16(msk_1 + 1);\n        var bs1_1 = Math.ceil(plvl / 3), bs2_1 = 2 * bs1_1;\n        var hsh = function (i) { return (dat[i] ^ (dat[i + 1] << bs1_1) ^ (dat[i + 2] << bs2_1)) & msk_1; };\n        // 24576 is an arbitrary number of maximum symbols per block\n        // 424 buffer for last block\n        var syms = new u32(25000);\n        // length/literal freq   distance freq\n        var lf = new u16(288), df = new u16(32);\n        //  l/lcnt  exbits  index  l/lind  waitdx  bitpos\n        var lc_1 = 0, eb = 0, i = 0, li = 0, wi = 0, bs = 0;\n        for (; i < s; ++i) {\n            // hash value\n            // deopt when i > s - 3 - at end, deopt acceptable\n            var hv = hsh(i);\n            // index mod 32768    previous index mod\n            var imod = i & 32767, pimod = head[hv];\n            prev[imod] = pimod;\n            head[hv] = imod;\n            // We always should modify head and prev, but only add symbols if\n            // this data is not yet processed (\"wait\" for wait index)\n            if (wi <= i) {\n                // bytes remaining\n                var rem = s - i;\n                if ((lc_1 > 7000 || li > 24576) && rem > 423) {\n                    pos = wblk(dat, w, 0, syms, lf, df, eb, li, bs, i - bs, pos);\n                    li = lc_1 = eb = 0, bs = i;\n                    for (var j = 0; j < 286; ++j)\n                        lf[j] = 0;\n                    for (var j = 0; j < 30; ++j)\n                        df[j] = 0;\n                }\n                //  len    dist   chain\n                var l = 2, d = 0, ch_1 = c, dif = (imod - pimod) & 32767;\n                if (rem > 2 && hv == hsh(i - dif)) {\n                    var maxn = Math.min(n, rem) - 1;\n                    var maxd = Math.min(32767, i);\n                    // max possible length\n                    // not capped at dif because decompressors implement \"rolling\" index population\n                    var ml = Math.min(258, rem);\n                    while (dif <= maxd && --ch_1 && imod != pimod) {\n                        if (dat[i + l] == dat[i + l - dif]) {\n                            var nl = 0;\n                            for (; nl < ml && dat[i + nl] == dat[i + nl - dif]; ++nl)\n                                ;\n                            if (nl > l) {\n                                l = nl, d = dif;\n                                // break out early when we reach \"nice\" (we are satisfied enough)\n                                if (nl > maxn)\n                                    break;\n                                // now, find the rarest 2-byte sequence within this\n                                // length of literals and search for that instead.\n                                // Much faster than just using the start\n                                var mmd = Math.min(dif, nl - 2);\n                                var md = 0;\n                                for (var j = 0; j < mmd; ++j) {\n                                    var ti = (i - dif + j + 32768) & 32767;\n                                    var pti = prev[ti];\n                                    var cd = (ti - pti + 32768) & 32767;\n                                    if (cd > md)\n                                        md = cd, pimod = ti;\n                                }\n                            }\n                        }\n                        // check the previous match\n                        imod = pimod, pimod = prev[imod];\n                        dif += (imod - pimod + 32768) & 32767;\n                    }\n                }\n                // d will be nonzero only when a match was found\n                if (d) {\n                    // store both dist and len data in one Uint32\n                    // Make sure this is recognized as a len/dist with 28th bit (2^28)\n                    syms[li++] = 268435456 | (revfl[l] << 18) | revfd[d];\n                    var lin = revfl[l] & 31, din = revfd[d] & 31;\n                    eb += fleb[lin] + fdeb[din];\n                    ++lf[257 + lin];\n                    ++df[din];\n                    wi = i + l;\n                    ++lc_1;\n                }\n                else {\n                    syms[li++] = dat[i];\n                    ++lf[dat[i]];\n                }\n            }\n        }\n        pos = wblk(dat, w, lst, syms, lf, df, eb, li, bs, i - bs, pos);\n        // this is the easiest way to avoid needing to maintain state\n        if (!lst && pos & 7)\n            pos = wfblk(w, pos + 1, et);\n    }\n    return slc(o, 0, pre + shft(pos) + post);\n};\n// CRC32 table\nvar crct = /*#__PURE__*/ (function () {\n    var t = new u32(256);\n    for (var i = 0; i < 256; ++i) {\n        var c = i, k = 9;\n        while (--k)\n            c = ((c & 1) && 0xEDB88320) ^ (c >>> 1);\n        t[i] = c;\n    }\n    return t;\n})();\n// CRC32\nvar crc = function () {\n    var c = -1;\n    return {\n        p: function (d) {\n            // closures have awful performance\n            var cr = c;\n            for (var i = 0; i < d.length; ++i)\n                cr = crct[(cr & 255) ^ d[i]] ^ (cr >>> 8);\n            c = cr;\n        },\n        d: function () { return ~c; }\n    };\n};\n// Alder32\nvar adler = function () {\n    var a = 1, b = 0;\n    return {\n        p: function (d) {\n            // closures have awful performance\n            var n = a, m = b;\n            var l = d.length;\n            for (var i = 0; i != l;) {\n                var e = Math.min(i + 2655, l);\n                for (; i < e; ++i)\n                    m += n += d[i];\n                n = (n & 65535) + 15 * (n >> 16), m = (m & 65535) + 15 * (m >> 16);\n            }\n            a = n, b = m;\n        },\n        d: function () {\n            a %= 65521, b %= 65521;\n            return (a & 255) << 24 | (a >>> 8) << 16 | (b & 255) << 8 | (b >>> 8);\n        }\n    };\n};\n;\n// deflate with opts\nvar dopt = function (dat, opt, pre, post, st) {\n    return dflt(dat, opt.level == null ? 6 : opt.level, opt.mem == null ? Math.ceil(Math.max(8, Math.min(13, Math.log(dat.length))) * 1.5) : (12 + opt.mem), pre, post, !st);\n};\n// Walmart object spread\nvar mrg = function (a, b) {\n    var o = {};\n    for (var k in a)\n        o[k] = a[k];\n    for (var k in b)\n        o[k] = b[k];\n    return o;\n};\n// worker clone\n// This is possibly the craziest part of the entire codebase, despite how simple it may seem.\n// The only parameter to this function is a closure that returns an array of variables outside of the function scope.\n// We're going to try to figure out the variable names used in the closure as strings because that is crucial for workerization.\n// We will return an object mapping of true variable name to value (basically, the current scope as a JS object).\n// The reason we can't just use the original variable names is minifiers mangling the toplevel scope.\n// This took me three weeks to figure out how to do.\nvar wcln = function (fn, fnStr, td) {\n    var dt = fn();\n    var st = fn.toString();\n    var ks = st.slice(st.indexOf('[') + 1, st.lastIndexOf(']')).replace(/ /g, '').split(',');\n    for (var i = 0; i < dt.length; ++i) {\n        var v = dt[i], k = ks[i];\n        if (typeof v == 'function') {\n            fnStr += ';' + k + '=';\n            var st_1 = v.toString();\n            if (v.prototype) {\n                // for global objects\n                if (st_1.indexOf('[native code]') != -1) {\n                    var spInd = st_1.indexOf(' ', 8) + 1;\n                    fnStr += st_1.slice(spInd, st_1.indexOf('(', spInd));\n                }\n                else {\n                    fnStr += st_1;\n                    for (var t in v.prototype)\n                        fnStr += ';' + k + '.prototype.' + t + '=' + v.prototype[t].toString();\n                }\n            }\n            else\n                fnStr += st_1;\n        }\n        else\n            td[k] = v;\n    }\n    return [fnStr, td];\n};\nvar ch = [];\n// clone bufs\nvar cbfs = function (v) {\n    var tl = [];\n    for (var k in v) {\n        if (v[k] instanceof u8 || v[k] instanceof u16 || v[k] instanceof u32)\n            tl.push((v[k] = new v[k].constructor(v[k])).buffer);\n    }\n    return tl;\n};\n// use a worker to execute code\nvar wrkr = function (fns, init, id, cb) {\n    var _a;\n    if (!ch[id]) {\n        var fnStr = '', td_1 = {}, m = fns.length - 1;\n        for (var i = 0; i < m; ++i)\n            _a = wcln(fns[i], fnStr, td_1), fnStr = _a[0], td_1 = _a[1];\n        ch[id] = wcln(fns[m], fnStr, td_1);\n    }\n    var td = mrg({}, ch[id][1]);\n    return wk(ch[id][0] + ';onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage=' + init.toString() + '}', id, td, cbfs(td), cb);\n};\n// base async inflate fn\nvar bInflt = function () { return [u8, u16, u32, fleb, fdeb, clim, fl, fd, flrm, fdrm, rev, hMap, max, bits, bits16, shft, slc, inflt, inflateSync, pbf, gu8]; };\nvar bDflt = function () { return [u8, u16, u32, fleb, fdeb, clim, revfl, revfd, flm, flt, fdm, fdt, rev, deo, et, hMap, wbits, wbits16, hTree, ln, lc, clen, wfblk, wblk, shft, slc, dflt, dopt, deflateSync, pbf]; };\n// gzip extra\nvar gze = function () { return [gzh, gzhl, wbytes, crc, crct]; };\n// gunzip extra\nvar guze = function () { return [gzs, gzl]; };\n// zlib extra\nvar zle = function () { return [zlh, wbytes, adler]; };\n// unzlib extra\nvar zule = function () { return [zlv]; };\n// post buf\nvar pbf = function (msg) { return postMessage(msg, [msg.buffer]); };\n// get u8\nvar gu8 = function (o) { return o && o.size && new u8(o.size); };\n// async helper\nvar cbify = function (dat, opts, fns, init, id, cb) {\n    var w = wrkr(fns, init, id, function (err, dat) {\n        w.terminate();\n        cb(err, dat);\n    });\n    w.postMessage([dat, opts], opts.consume ? [dat.buffer] : []);\n    return function () { w.terminate(); };\n};\n// auto stream\nvar astrm = function (strm) {\n    strm.ondata = function (dat, final) { return postMessage([dat, final], [dat.buffer]); };\n    return function (ev) { return strm.push(ev.data[0], ev.data[1]); };\n};\n// async stream attach\nvar astrmify = function (fns, strm, opts, init, id) {\n    var t;\n    var w = wrkr(fns, init, id, function (err, dat) {\n        if (err)\n            w.terminate(), strm.ondata.call(strm, err);\n        else {\n            if (dat[1])\n                w.terminate();\n            strm.ondata.call(strm, err, dat[0], dat[1]);\n        }\n    });\n    w.postMessage(opts);\n    strm.push = function (d, f) {\n        if (t)\n            throw 'stream finished';\n        if (!strm.ondata)\n            throw 'no stream handler';\n        w.postMessage([d, t = f], [d.buffer]);\n    };\n    strm.terminate = function () { w.terminate(); };\n};\n// read 2 bytes\nvar b2 = function (d, b) { return d[b] | (d[b + 1] << 8); };\n// read 4 bytes\nvar b4 = function (d, b) { return (d[b] | (d[b + 1] << 8) | (d[b + 2] << 16) | (d[b + 3] << 24)) >>> 0; };\nvar b8 = function (d, b) { return b4(d, b) + (b4(d, b + 4) * 4294967296); };\n// write bytes\nvar wbytes = function (d, b, v) {\n    for (; v; ++b)\n        d[b] = v, v >>>= 8;\n};\n// gzip header\nvar gzh = function (c, o) {\n    var fn = o.filename;\n    c[0] = 31, c[1] = 139, c[2] = 8, c[8] = o.level < 2 ? 4 : o.level == 9 ? 2 : 0, c[9] = 3; // assume Unix\n    if (o.mtime != 0)\n        wbytes(c, 4, Math.floor(new Date(o.mtime || Date.now()) / 1000));\n    if (fn) {\n        c[3] = 8;\n        for (var i = 0; i <= fn.length; ++i)\n            c[i + 10] = fn.charCodeAt(i);\n    }\n};\n// gzip footer: -8 to -4 = CRC, -4 to -0 is length\n// gzip start\nvar gzs = function (d) {\n    if (d[0] != 31 || d[1] != 139 || d[2] != 8)\n        throw 'invalid gzip data';\n    var flg = d[3];\n    var st = 10;\n    if (flg & 4)\n        st += d[10] | (d[11] << 8) + 2;\n    for (var zs = (flg >> 3 & 1) + (flg >> 4 & 1); zs > 0; zs -= !d[st++])\n        ;\n    return st + (flg & 2);\n};\n// gzip length\nvar gzl = function (d) {\n    var l = d.length;\n    return ((d[l - 4] | d[l - 3] << 8 | d[l - 2] << 16) | (d[l - 1] << 24)) >>> 0;\n};\n// gzip header length\nvar gzhl = function (o) { return 10 + ((o.filename && (o.filename.length + 1)) || 0); };\n// zlib header\nvar zlh = function (c, o) {\n    var lv = o.level, fl = lv == 0 ? 0 : lv < 6 ? 1 : lv == 9 ? 3 : 2;\n    c[0] = 120, c[1] = (fl << 6) | (fl ? (32 - 2 * fl) : 1);\n};\n// zlib valid\nvar zlv = function (d) {\n    if ((d[0] & 15) != 8 || (d[0] >>> 4) > 7 || ((d[0] << 8 | d[1]) % 31))\n        throw 'invalid zlib data';\n    if (d[1] & 32)\n        throw 'invalid zlib data: preset dictionaries not supported';\n};\nfunction AsyncCmpStrm(opts, cb) {\n    if (!cb && typeof opts == 'function')\n        cb = opts, opts = {};\n    this.ondata = cb;\n    return opts;\n}\n// zlib footer: -4 to -0 is Adler32\n/**\n * Streaming DEFLATE compression\n */\nvar Deflate = /*#__PURE__*/ (function () {\n    function Deflate(opts, cb) {\n        if (!cb && typeof opts == 'function')\n            cb = opts, opts = {};\n        this.ondata = cb;\n        this.o = opts || {};\n    }\n    Deflate.prototype.p = function (c, f) {\n        this.ondata(dopt(c, this.o, 0, 0, !f), f);\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Deflate.prototype.push = function (chunk, final) {\n        if (this.d)\n            throw 'stream finished';\n        if (!this.ondata)\n            throw 'no stream handler';\n        this.d = final;\n        this.p(chunk, final || false);\n    };\n    return Deflate;\n}());\nexport { Deflate };\n/**\n * Asynchronous streaming DEFLATE compression\n */\nvar AsyncDeflate = /*#__PURE__*/ (function () {\n    function AsyncDeflate(opts, cb) {\n        astrmify([\n            bDflt,\n            function () { return [astrm, Deflate]; }\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\n            var strm = new Deflate(ev.data);\n            onmessage = astrm(strm);\n        }, 6);\n    }\n    return AsyncDeflate;\n}());\nexport { AsyncDeflate };\nexport function deflate(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bDflt,\n    ], function (ev) { return pbf(deflateSync(ev.data[0], ev.data[1])); }, 0, cb);\n}\n/**\n * Compresses data with DEFLATE without any wrapper\n * @param data The data to compress\n * @param opts The compression options\n * @returns The deflated version of the data\n */\nexport function deflateSync(data, opts) {\n    return dopt(data, opts || {}, 0, 0);\n}\n/**\n * Streaming DEFLATE decompression\n */\nvar Inflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates an inflation stream\n     * @param cb The callback to call whenever data is inflated\n     */\n    function Inflate(cb) {\n        this.s = {};\n        this.p = new u8(0);\n        this.ondata = cb;\n    }\n    Inflate.prototype.e = function (c) {\n        if (this.d)\n            throw 'stream finished';\n        if (!this.ondata)\n            throw 'no stream handler';\n        var l = this.p.length;\n        var n = new u8(l + c.length);\n        n.set(this.p), n.set(c, l), this.p = n;\n    };\n    Inflate.prototype.c = function (final) {\n        this.d = this.s.i = final || false;\n        var bts = this.s.b;\n        var dt = inflt(this.p, this.o, this.s);\n        this.ondata(slc(dt, bts, this.s.b), this.d);\n        this.o = slc(dt, this.s.b - 32768), this.s.b = this.o.length;\n        this.p = slc(this.p, (this.s.p / 8) | 0), this.s.p &= 7;\n    };\n    /**\n     * Pushes a chunk to be inflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the final chunk\n     */\n    Inflate.prototype.push = function (chunk, final) {\n        this.e(chunk), this.c(final);\n    };\n    return Inflate;\n}());\nexport { Inflate };\n/**\n * Asynchronous streaming DEFLATE decompression\n */\nvar AsyncInflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous inflation stream\n     * @param cb The callback to call whenever data is deflated\n     */\n    function AsyncInflate(cb) {\n        this.ondata = cb;\n        astrmify([\n            bInflt,\n            function () { return [astrm, Inflate]; }\n        ], this, 0, function () {\n            var strm = new Inflate();\n            onmessage = astrm(strm);\n        }, 7);\n    }\n    return AsyncInflate;\n}());\nexport { AsyncInflate };\nexport function inflate(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bInflt\n    ], function (ev) { return pbf(inflateSync(ev.data[0], gu8(ev.data[1]))); }, 1, cb);\n}\n/**\n * Expands DEFLATE data with no wrapper\n * @param data The data to decompress\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\n * @returns The decompressed version of the data\n */\nexport function inflateSync(data, out) {\n    return inflt(data, out);\n}\n// before you yell at me for not just using extends, my reason is that TS inheritance is hard to workerize.\n/**\n * Streaming GZIP compression\n */\nvar Gzip = /*#__PURE__*/ (function () {\n    function Gzip(opts, cb) {\n        this.c = crc();\n        this.l = 0;\n        this.v = 1;\n        Deflate.call(this, opts, cb);\n    }\n    /**\n     * Pushes a chunk to be GZIPped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Gzip.prototype.push = function (chunk, final) {\n        Deflate.prototype.push.call(this, chunk, final);\n    };\n    Gzip.prototype.p = function (c, f) {\n        this.c.p(c);\n        this.l += c.length;\n        var raw = dopt(c, this.o, this.v && gzhl(this.o), f && 8, !f);\n        if (this.v)\n            gzh(raw, this.o), this.v = 0;\n        if (f)\n            wbytes(raw, raw.length - 8, this.c.d()), wbytes(raw, raw.length - 4, this.l);\n        this.ondata(raw, f);\n    };\n    return Gzip;\n}());\nexport { Gzip };\n/**\n * Asynchronous streaming GZIP compression\n */\nvar AsyncGzip = /*#__PURE__*/ (function () {\n    function AsyncGzip(opts, cb) {\n        astrmify([\n            bDflt,\n            gze,\n            function () { return [astrm, Deflate, Gzip]; }\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\n            var strm = new Gzip(ev.data);\n            onmessage = astrm(strm);\n        }, 8);\n    }\n    return AsyncGzip;\n}());\nexport { AsyncGzip };\nexport function gzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bDflt,\n        gze,\n        function () { return [gzipSync]; }\n    ], function (ev) { return pbf(gzipSync(ev.data[0], ev.data[1])); }, 2, cb);\n}\n/**\n * Compresses data with GZIP\n * @param data The data to compress\n * @param opts The compression options\n * @returns The gzipped version of the data\n */\nexport function gzipSync(data, opts) {\n    if (!opts)\n        opts = {};\n    var c = crc(), l = data.length;\n    c.p(data);\n    var d = dopt(data, opts, gzhl(opts), 8), s = d.length;\n    return gzh(d, opts), wbytes(d, s - 8, c.d()), wbytes(d, s - 4, l), d;\n}\n/**\n * Streaming GZIP decompression\n */\nvar Gunzip = /*#__PURE__*/ (function () {\n    /**\n     * Creates a GUNZIP stream\n     * @param cb The callback to call whenever data is inflated\n     */\n    function Gunzip(cb) {\n        this.v = 1;\n        Inflate.call(this, cb);\n    }\n    /**\n     * Pushes a chunk to be GUNZIPped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Gunzip.prototype.push = function (chunk, final) {\n        Inflate.prototype.e.call(this, chunk);\n        if (this.v) {\n            var s = this.p.length > 3 ? gzs(this.p) : 4;\n            if (s >= this.p.length && !final)\n                return;\n            this.p = this.p.subarray(s), this.v = 0;\n        }\n        if (final) {\n            if (this.p.length < 8)\n                throw 'invalid gzip stream';\n            this.p = this.p.subarray(0, -8);\n        }\n        // necessary to prevent TS from using the closure value\n        // This allows for workerization to function correctly\n        Inflate.prototype.c.call(this, final);\n    };\n    return Gunzip;\n}());\nexport { Gunzip };\n/**\n * Asynchronous streaming GZIP decompression\n */\nvar AsyncGunzip = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous GUNZIP stream\n     * @param cb The callback to call whenever data is deflated\n     */\n    function AsyncGunzip(cb) {\n        this.ondata = cb;\n        astrmify([\n            bInflt,\n            guze,\n            function () { return [astrm, Inflate, Gunzip]; }\n        ], this, 0, function () {\n            var strm = new Gunzip();\n            onmessage = astrm(strm);\n        }, 9);\n    }\n    return AsyncGunzip;\n}());\nexport { AsyncGunzip };\nexport function gunzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bInflt,\n        guze,\n        function () { return [gunzipSync]; }\n    ], function (ev) { return pbf(gunzipSync(ev.data[0])); }, 3, cb);\n}\n/**\n * Expands GZIP data\n * @param data The data to decompress\n * @param out Where to write the data. GZIP already encodes the output size, so providing this doesn't save memory.\n * @returns The decompressed version of the data\n */\nexport function gunzipSync(data, out) {\n    return inflt(data.subarray(gzs(data), -8), out || new u8(gzl(data)));\n}\n/**\n * Streaming Zlib compression\n */\nvar Zlib = /*#__PURE__*/ (function () {\n    function Zlib(opts, cb) {\n        this.c = adler();\n        this.v = 1;\n        Deflate.call(this, opts, cb);\n    }\n    /**\n     * Pushes a chunk to be zlibbed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Zlib.prototype.push = function (chunk, final) {\n        Deflate.prototype.push.call(this, chunk, final);\n    };\n    Zlib.prototype.p = function (c, f) {\n        this.c.p(c);\n        var raw = dopt(c, this.o, this.v && 2, f && 4, !f);\n        if (this.v)\n            zlh(raw, this.o), this.v = 0;\n        if (f)\n            wbytes(raw, raw.length - 4, this.c.d());\n        this.ondata(raw, f);\n    };\n    return Zlib;\n}());\nexport { Zlib };\n/**\n * Asynchronous streaming Zlib compression\n */\nvar AsyncZlib = /*#__PURE__*/ (function () {\n    function AsyncZlib(opts, cb) {\n        astrmify([\n            bDflt,\n            zle,\n            function () { return [astrm, Deflate, Zlib]; }\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\n            var strm = new Zlib(ev.data);\n            onmessage = astrm(strm);\n        }, 10);\n    }\n    return AsyncZlib;\n}());\nexport { AsyncZlib };\nexport function zlib(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bDflt,\n        zle,\n        function () { return [zlibSync]; }\n    ], function (ev) { return pbf(zlibSync(ev.data[0], ev.data[1])); }, 4, cb);\n}\n/**\n * Compress data with Zlib\n * @param data The data to compress\n * @param opts The compression options\n * @returns The zlib-compressed version of the data\n */\nexport function zlibSync(data, opts) {\n    if (!opts)\n        opts = {};\n    var a = adler();\n    a.p(data);\n    var d = dopt(data, opts, 2, 4);\n    return zlh(d, opts), wbytes(d, d.length - 4, a.d()), d;\n}\n/**\n * Streaming Zlib decompression\n */\nvar Unzlib = /*#__PURE__*/ (function () {\n    /**\n     * Creates a Zlib decompression stream\n     * @param cb The callback to call whenever data is inflated\n     */\n    function Unzlib(cb) {\n        this.v = 1;\n        Inflate.call(this, cb);\n    }\n    /**\n     * Pushes a chunk to be unzlibbed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Unzlib.prototype.push = function (chunk, final) {\n        Inflate.prototype.e.call(this, chunk);\n        if (this.v) {\n            if (this.p.length < 2 && !final)\n                return;\n            this.p = this.p.subarray(2), this.v = 0;\n        }\n        if (final) {\n            if (this.p.length < 4)\n                throw 'invalid zlib stream';\n            this.p = this.p.subarray(0, -4);\n        }\n        // necessary to prevent TS from using the closure value\n        // This allows for workerization to function correctly\n        Inflate.prototype.c.call(this, final);\n    };\n    return Unzlib;\n}());\nexport { Unzlib };\n/**\n * Asynchronous streaming Zlib decompression\n */\nvar AsyncUnzlib = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous Zlib decompression stream\n     * @param cb The callback to call whenever data is deflated\n     */\n    function AsyncUnzlib(cb) {\n        this.ondata = cb;\n        astrmify([\n            bInflt,\n            zule,\n            function () { return [astrm, Inflate, Unzlib]; }\n        ], this, 0, function () {\n            var strm = new Unzlib();\n            onmessage = astrm(strm);\n        }, 11);\n    }\n    return AsyncUnzlib;\n}());\nexport { AsyncUnzlib };\nexport function unzlib(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bInflt,\n        zule,\n        function () { return [unzlibSync]; }\n    ], function (ev) { return pbf(unzlibSync(ev.data[0], gu8(ev.data[1]))); }, 5, cb);\n}\n/**\n * Expands Zlib data\n * @param data The data to decompress\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\n * @returns The decompressed version of the data\n */\nexport function unzlibSync(data, out) {\n    return inflt((zlv(data), data.subarray(2, -4)), out);\n}\n// Default algorithm for compression (used because having a known output size allows faster decompression)\nexport { gzip as compress, AsyncGzip as AsyncCompress };\n// Default algorithm for compression (used because having a known output size allows faster decompression)\nexport { gzipSync as compressSync, Gzip as Compress };\n/**\n * Streaming GZIP, Zlib, or raw DEFLATE decompression\n */\nvar Decompress = /*#__PURE__*/ (function () {\n    /**\n     * Creates a decompression stream\n     * @param cb The callback to call whenever data is decompressed\n     */\n    function Decompress(cb) {\n        this.G = Gunzip;\n        this.I = Inflate;\n        this.Z = Unzlib;\n        this.ondata = cb;\n    }\n    /**\n     * Pushes a chunk to be decompressed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Decompress.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            throw 'no stream handler';\n        if (!this.s) {\n            if (this.p && this.p.length) {\n                var n = new u8(this.p.length + chunk.length);\n                n.set(this.p), n.set(chunk, this.p.length);\n            }\n            else\n                this.p = chunk;\n            if (this.p.length > 2) {\n                var _this_1 = this;\n                var cb = function () { _this_1.ondata.apply(_this_1, arguments); };\n                this.s = (this.p[0] == 31 && this.p[1] == 139 && this.p[2] == 8)\n                    ? new this.G(cb)\n                    : ((this.p[0] & 15) != 8 || (this.p[0] >> 4) > 7 || ((this.p[0] << 8 | this.p[1]) % 31))\n                        ? new this.I(cb)\n                        : new this.Z(cb);\n                this.s.push(this.p, final);\n                this.p = null;\n            }\n        }\n        else\n            this.s.push(chunk, final);\n    };\n    return Decompress;\n}());\nexport { Decompress };\n/**\n * Asynchronous streaming GZIP, Zlib, or raw DEFLATE decompression\n */\nvar AsyncDecompress = /*#__PURE__*/ (function () {\n    /**\n   * Creates an asynchronous decompression stream\n   * @param cb The callback to call whenever data is decompressed\n   */\n    function AsyncDecompress(cb) {\n        this.G = AsyncGunzip;\n        this.I = AsyncInflate;\n        this.Z = AsyncUnzlib;\n        this.ondata = cb;\n    }\n    /**\n     * Pushes a chunk to be decompressed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    AsyncDecompress.prototype.push = function (chunk, final) {\n        Decompress.prototype.push.call(this, chunk, final);\n    };\n    return AsyncDecompress;\n}());\nexport { AsyncDecompress };\nexport function decompress(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return (data[0] == 31 && data[1] == 139 && data[2] == 8)\n        ? gunzip(data, opts, cb)\n        : ((data[0] & 15) != 8 || (data[0] >> 4) > 7 || ((data[0] << 8 | data[1]) % 31))\n            ? inflate(data, opts, cb)\n            : unzlib(data, opts, cb);\n}\n/**\n * Expands compressed GZIP, Zlib, or raw DEFLATE data, automatically detecting the format\n * @param data The data to decompress\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\n * @returns The decompressed version of the data\n */\nexport function decompressSync(data, out) {\n    return (data[0] == 31 && data[1] == 139 && data[2] == 8)\n        ? gunzipSync(data, out)\n        : ((data[0] & 15) != 8 || (data[0] >> 4) > 7 || ((data[0] << 8 | data[1]) % 31))\n            ? inflateSync(data, out)\n            : unzlibSync(data, out);\n}\n// flatten a directory structure\nvar fltn = function (d, p, t, o) {\n    for (var k in d) {\n        var val = d[k], n = p + k;\n        if (val instanceof u8)\n            t[n] = [val, o];\n        else if (Array.isArray(val))\n            t[n] = [val[0], mrg(o, val[1])];\n        else\n            fltn(val, n + '/', t, o);\n    }\n};\n// text encoder\nvar te = typeof TextEncoder != 'undefined' && /*#__PURE__*/ new TextEncoder();\n// text decoder\nvar td = typeof TextDecoder != 'undefined' && /*#__PURE__*/ new TextDecoder();\n// text decoder stream\nvar tds = 0;\ntry {\n    td.decode(et, { stream: true });\n    tds = 1;\n}\ncatch (e) { }\n// decode UTF8\nvar dutf8 = function (d) {\n    for (var r = '', i = 0;;) {\n        var c = d[i++];\n        var eb = (c > 127) + (c > 223) + (c > 239);\n        if (i + eb > d.length)\n            return [r, slc(d, i - 1)];\n        if (!eb)\n            r += String.fromCharCode(c);\n        else if (eb == 3) {\n            c = ((c & 15) << 18 | (d[i++] & 63) << 12 | (d[i++] & 63) << 6 | (d[i++] & 63)) - 65536,\n                r += String.fromCharCode(55296 | (c >> 10), 56320 | (c & 1023));\n        }\n        else if (eb & 1)\n            r += String.fromCharCode((c & 31) << 6 | (d[i++] & 63));\n        else\n            r += String.fromCharCode((c & 15) << 12 | (d[i++] & 63) << 6 | (d[i++] & 63));\n    }\n};\n/**\n * Streaming UTF-8 decoding\n */\nvar DecodeUTF8 = /*#__PURE__*/ (function () {\n    /**\n     * Creates a UTF-8 decoding stream\n     * @param cb The callback to call whenever data is decoded\n     */\n    function DecodeUTF8(cb) {\n        this.ondata = cb;\n        if (tds)\n            this.t = new TextDecoder();\n        else\n            this.p = et;\n    }\n    /**\n     * Pushes a chunk to be decoded from UTF-8 binary\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    DecodeUTF8.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            throw 'no callback';\n        final = !!final;\n        if (this.t) {\n            this.ondata(this.t.decode(chunk, { stream: true }), final);\n            if (final) {\n                if (this.t.decode().length)\n                    throw 'invalid utf-8 data';\n                this.t = null;\n            }\n            return;\n        }\n        if (!this.p)\n            throw 'stream finished';\n        var dat = new u8(this.p.length + chunk.length);\n        dat.set(this.p);\n        dat.set(chunk, this.p.length);\n        var _a = dutf8(dat), ch = _a[0], np = _a[1];\n        if (final) {\n            if (np.length)\n                throw 'invalid utf-8 data';\n            this.p = null;\n        }\n        else\n            this.p = np;\n        this.ondata(ch, final);\n    };\n    return DecodeUTF8;\n}());\nexport { DecodeUTF8 };\n/**\n * Streaming UTF-8 encoding\n */\nvar EncodeUTF8 = /*#__PURE__*/ (function () {\n    /**\n     * Creates a UTF-8 decoding stream\n     * @param cb The callback to call whenever data is encoded\n     */\n    function EncodeUTF8(cb) {\n        this.ondata = cb;\n    }\n    /**\n     * Pushes a chunk to be encoded to UTF-8\n     * @param chunk The string data to push\n     * @param final Whether this is the last chunk\n     */\n    EncodeUTF8.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            throw 'no callback';\n        if (this.d)\n            throw 'stream finished';\n        this.ondata(strToU8(chunk), this.d = final || false);\n    };\n    return EncodeUTF8;\n}());\nexport { EncodeUTF8 };\n/**\n * Converts a string into a Uint8Array for use with compression/decompression methods\n * @param str The string to encode\n * @param latin1 Whether or not to interpret the data as Latin-1. This should\n *               not need to be true unless decoding a binary string.\n * @returns The string encoded in UTF-8/Latin-1 binary\n */\nexport function strToU8(str, latin1) {\n    if (latin1) {\n        var ar_1 = new u8(str.length);\n        for (var i = 0; i < str.length; ++i)\n            ar_1[i] = str.charCodeAt(i);\n        return ar_1;\n    }\n    if (te)\n        return te.encode(str);\n    var l = str.length;\n    var ar = new u8(str.length + (str.length >> 1));\n    var ai = 0;\n    var w = function (v) { ar[ai++] = v; };\n    for (var i = 0; i < l; ++i) {\n        if (ai + 5 > ar.length) {\n            var n = new u8(ai + 8 + ((l - i) << 1));\n            n.set(ar);\n            ar = n;\n        }\n        var c = str.charCodeAt(i);\n        if (c < 128 || latin1)\n            w(c);\n        else if (c < 2048)\n            w(192 | (c >> 6)), w(128 | (c & 63));\n        else if (c > 55295 && c < 57344)\n            c = 65536 + (c & 1023 << 10) | (str.charCodeAt(++i) & 1023),\n                w(240 | (c >> 18)), w(128 | ((c >> 12) & 63)), w(128 | ((c >> 6) & 63)), w(128 | (c & 63));\n        else\n            w(224 | (c >> 12)), w(128 | ((c >> 6) & 63)), w(128 | (c & 63));\n    }\n    return slc(ar, 0, ai);\n}\n/**\n * Converts a Uint8Array to a string\n * @param dat The data to decode to string\n * @param latin1 Whether or not to interpret the data as Latin-1. This should\n *               not need to be true unless encoding to binary string.\n * @returns The original UTF-8/Latin-1 string\n */\nexport function strFromU8(dat, latin1) {\n    if (latin1) {\n        var r = '';\n        for (var i = 0; i < dat.length; i += 16384)\n            r += String.fromCharCode.apply(null, dat.subarray(i, i + 16384));\n        return r;\n    }\n    else if (td)\n        return td.decode(dat);\n    else {\n        var _a = dutf8(dat), out = _a[0], ext = _a[1];\n        if (ext.length)\n            throw 'invalid utf-8 data';\n        return out;\n    }\n}\n;\n// deflate bit flag\nvar dbf = function (l) { return l == 1 ? 3 : l < 6 ? 2 : l == 9 ? 1 : 0; };\n// skip local zip header\nvar slzh = function (d, b) { return b + 30 + b2(d, b + 26) + b2(d, b + 28); };\n// read zip header\nvar zh = function (d, b, z) {\n    var fnl = b2(d, b + 28), fn = strFromU8(d.subarray(b + 46, b + 46 + fnl), !(b2(d, b + 8) & 2048)), es = b + 46 + fnl, bs = b4(d, b + 20);\n    var _a = z && bs == 4294967295 ? z64e(d, es) : [bs, b4(d, b + 24), b4(d, b + 42)], sc = _a[0], su = _a[1], off = _a[2];\n    return [b2(d, b + 10), sc, su, fn, es + b2(d, b + 30) + b2(d, b + 32), off];\n};\n// read zip64 extra field\nvar z64e = function (d, b) {\n    for (; b2(d, b) != 1; b += 4 + b2(d, b + 2))\n        ;\n    return [b8(d, b + 12), b8(d, b + 4), b8(d, b + 20)];\n};\n// extra field length\nvar exfl = function (ex) {\n    var le = 0;\n    if (ex) {\n        for (var k in ex) {\n            var l = ex[k].length;\n            if (l > 65535)\n                throw 'extra field too long';\n            le += l + 4;\n        }\n    }\n    return le;\n};\n// write zip header\nvar wzh = function (d, b, f, fn, u, c, ce, co) {\n    var fl = fn.length, ex = f.extra, col = co && co.length;\n    var exl = exfl(ex);\n    wbytes(d, b, ce != null ? 0x2014B50 : 0x4034B50), b += 4;\n    if (ce != null)\n        d[b++] = 20, d[b++] = f.os;\n    d[b] = 20, b += 2; // spec compliance? what's that?\n    d[b++] = (f.flag << 1) | (c == null && 8), d[b++] = u && 8;\n    d[b++] = f.compression & 255, d[b++] = f.compression >> 8;\n    var dt = new Date(f.mtime == null ? Date.now() : f.mtime), y = dt.getFullYear() - 1980;\n    if (y < 0 || y > 119)\n        throw 'date not in range 1980-2099';\n    wbytes(d, b, (y << 25) | ((dt.getMonth() + 1) << 21) | (dt.getDate() << 16) | (dt.getHours() << 11) | (dt.getMinutes() << 5) | (dt.getSeconds() >>> 1)), b += 4;\n    if (c != null) {\n        wbytes(d, b, f.crc);\n        wbytes(d, b + 4, c);\n        wbytes(d, b + 8, f.size);\n    }\n    wbytes(d, b + 12, fl);\n    wbytes(d, b + 14, exl), b += 16;\n    if (ce != null) {\n        wbytes(d, b, col);\n        wbytes(d, b + 6, f.attrs);\n        wbytes(d, b + 10, ce), b += 14;\n    }\n    d.set(fn, b);\n    b += fl;\n    if (exl) {\n        for (var k in ex) {\n            var exf = ex[k], l = exf.length;\n            wbytes(d, b, +k);\n            wbytes(d, b + 2, l);\n            d.set(exf, b + 4), b += 4 + l;\n        }\n    }\n    if (col)\n        d.set(co, b), b += col;\n    return b;\n};\n// write zip footer (end of central directory)\nvar wzf = function (o, b, c, d, e) {\n    wbytes(o, b, 0x6054B50); // skip disk\n    wbytes(o, b + 8, c);\n    wbytes(o, b + 10, c);\n    wbytes(o, b + 12, d);\n    wbytes(o, b + 16, e);\n};\n/**\n * A pass-through stream to keep data uncompressed in a ZIP archive.\n */\nvar ZipPassThrough = /*#__PURE__*/ (function () {\n    /**\n     * Creates a pass-through stream that can be added to ZIP archives\n     * @param filename The filename to associate with this data stream\n     */\n    function ZipPassThrough(filename) {\n        this.filename = filename;\n        this.c = crc();\n        this.size = 0;\n        this.compression = 0;\n    }\n    /**\n     * Processes a chunk and pushes to the output stream. You can override this\n     * method in a subclass for custom behavior, but by default this passes\n     * the data through. You must call this.ondata(err, chunk, final) at some\n     * point in this method.\n     * @param chunk The chunk to process\n     * @param final Whether this is the last chunk\n     */\n    ZipPassThrough.prototype.process = function (chunk, final) {\n        this.ondata(null, chunk, final);\n    };\n    /**\n     * Pushes a chunk to be added. If you are subclassing this with a custom\n     * compression algorithm, note that you must push data from the source\n     * file only, pre-compression.\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    ZipPassThrough.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            throw 'no callback - add to ZIP archive before pushing';\n        this.c.p(chunk);\n        this.size += chunk.length;\n        if (final)\n            this.crc = this.c.d();\n        this.process(chunk, final || false);\n    };\n    return ZipPassThrough;\n}());\nexport { ZipPassThrough };\n// I don't extend because TypeScript extension adds 1kB of runtime bloat\n/**\n * Streaming DEFLATE compression for ZIP archives. Prefer using AsyncZipDeflate\n * for better performance\n */\nvar ZipDeflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE stream that can be added to ZIP archives\n     * @param filename The filename to associate with this data stream\n     * @param opts The compression options\n     */\n    function ZipDeflate(filename, opts) {\n        var _this_1 = this;\n        if (!opts)\n            opts = {};\n        ZipPassThrough.call(this, filename);\n        this.d = new Deflate(opts, function (dat, final) {\n            _this_1.ondata(null, dat, final);\n        });\n        this.compression = 8;\n        this.flag = dbf(opts.level);\n    }\n    ZipDeflate.prototype.process = function (chunk, final) {\n        try {\n            this.d.push(chunk, final);\n        }\n        catch (e) {\n            this.ondata(e, null, final);\n        }\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    ZipDeflate.prototype.push = function (chunk, final) {\n        ZipPassThrough.prototype.push.call(this, chunk, final);\n    };\n    return ZipDeflate;\n}());\nexport { ZipDeflate };\n/**\n * Asynchronous streaming DEFLATE compression for ZIP archives\n */\nvar AsyncZipDeflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE stream that can be added to ZIP archives\n     * @param filename The filename to associate with this data stream\n     * @param opts The compression options\n     */\n    function AsyncZipDeflate(filename, opts) {\n        var _this_1 = this;\n        if (!opts)\n            opts = {};\n        ZipPassThrough.call(this, filename);\n        this.d = new AsyncDeflate(opts, function (err, dat, final) {\n            _this_1.ondata(err, dat, final);\n        });\n        this.compression = 8;\n        this.flag = dbf(opts.level);\n        this.terminate = this.d.terminate;\n    }\n    AsyncZipDeflate.prototype.process = function (chunk, final) {\n        this.d.push(chunk, final);\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    AsyncZipDeflate.prototype.push = function (chunk, final) {\n        ZipPassThrough.prototype.push.call(this, chunk, final);\n    };\n    return AsyncZipDeflate;\n}());\nexport { AsyncZipDeflate };\n// TODO: Better tree shaking\n/**\n * A zippable archive to which files can incrementally be added\n */\nvar Zip = /*#__PURE__*/ (function () {\n    /**\n     * Creates an empty ZIP archive to which files can be added\n     * @param cb The callback to call whenever data for the generated ZIP archive\n     *           is available\n     */\n    function Zip(cb) {\n        this.ondata = cb;\n        this.u = [];\n        this.d = 1;\n    }\n    /**\n     * Adds a file to the ZIP archive\n     * @param file The file stream to add\n     */\n    Zip.prototype.add = function (file) {\n        var _this_1 = this;\n        if (this.d & 2)\n            throw 'stream finished';\n        var f = strToU8(file.filename), fl = f.length;\n        var com = file.comment, o = com && strToU8(com);\n        var u = fl != file.filename.length || (o && (com.length != o.length));\n        var hl = fl + exfl(file.extra) + 30;\n        if (fl > 65535)\n            throw 'filename too long';\n        var header = new u8(hl);\n        wzh(header, 0, file, f, u);\n        var chks = [header];\n        var pAll = function () {\n            for (var _i = 0, chks_1 = chks; _i < chks_1.length; _i++) {\n                var chk = chks_1[_i];\n                _this_1.ondata(null, chk, false);\n            }\n            chks = [];\n        };\n        var tr = this.d;\n        this.d = 0;\n        var ind = this.u.length;\n        var uf = mrg(file, {\n            f: f,\n            u: u,\n            o: o,\n            t: function () {\n                if (file.terminate)\n                    file.terminate();\n            },\n            r: function () {\n                pAll();\n                if (tr) {\n                    var nxt = _this_1.u[ind + 1];\n                    if (nxt)\n                        nxt.r();\n                    else\n                        _this_1.d = 1;\n                }\n                tr = 1;\n            }\n        });\n        var cl = 0;\n        file.ondata = function (err, dat, final) {\n            if (err) {\n                _this_1.ondata(err, dat, final);\n                _this_1.terminate();\n            }\n            else {\n                cl += dat.length;\n                chks.push(dat);\n                if (final) {\n                    var dd = new u8(16);\n                    wbytes(dd, 0, 0x8074B50);\n                    wbytes(dd, 4, file.crc);\n                    wbytes(dd, 8, cl);\n                    wbytes(dd, 12, file.size);\n                    chks.push(dd);\n                    uf.c = cl, uf.b = hl + cl + 16, uf.crc = file.crc, uf.size = file.size;\n                    if (tr)\n                        uf.r();\n                    tr = 1;\n                }\n                else if (tr)\n                    pAll();\n            }\n        };\n        this.u.push(uf);\n    };\n    /**\n     * Ends the process of adding files and prepares to emit the final chunks.\n     * This *must* be called after adding all desired files for the resulting\n     * ZIP file to work properly.\n     */\n    Zip.prototype.end = function () {\n        var _this_1 = this;\n        if (this.d & 2) {\n            if (this.d & 1)\n                throw 'stream finishing';\n            throw 'stream finished';\n        }\n        if (this.d)\n            this.e();\n        else\n            this.u.push({\n                r: function () {\n                    if (!(_this_1.d & 1))\n                        return;\n                    _this_1.u.splice(-1, 1);\n                    _this_1.e();\n                },\n                t: function () { }\n            });\n        this.d = 3;\n    };\n    Zip.prototype.e = function () {\n        var bt = 0, l = 0, tl = 0;\n        for (var _i = 0, _a = this.u; _i < _a.length; _i++) {\n            var f = _a[_i];\n            tl += 46 + f.f.length + exfl(f.extra) + (f.o ? f.o.length : 0);\n        }\n        var out = new u8(tl + 22);\n        for (var _b = 0, _c = this.u; _b < _c.length; _b++) {\n            var f = _c[_b];\n            wzh(out, bt, f, f.f, f.u, f.c, l, f.o);\n            bt += 46 + f.f.length + exfl(f.extra) + (f.o ? f.o.length : 0), l += f.b;\n        }\n        wzf(out, bt, this.u.length, tl, l);\n        this.ondata(null, out, true);\n        this.d = 2;\n    };\n    /**\n     * A method to terminate any internal workers used by the stream. Subsequent\n     * calls to add() will fail.\n     */\n    Zip.prototype.terminate = function () {\n        for (var _i = 0, _a = this.u; _i < _a.length; _i++) {\n            var f = _a[_i];\n            f.t();\n        }\n        this.d = 2;\n    };\n    return Zip;\n}());\nexport { Zip };\nexport function zip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    var r = {};\n    fltn(data, '', r, opts);\n    var k = Object.keys(r);\n    var lft = k.length, o = 0, tot = 0;\n    var slft = lft, files = new Array(lft);\n    var term = [];\n    var tAll = function () {\n        for (var i = 0; i < term.length; ++i)\n            term[i]();\n    };\n    var cbf = function () {\n        var out = new u8(tot + 22), oe = o, cdl = tot - o;\n        tot = 0;\n        for (var i = 0; i < slft; ++i) {\n            var f = files[i];\n            try {\n                var l = f.c.length;\n                wzh(out, tot, f, f.f, f.u, l);\n                var badd = 30 + f.f.length + exfl(f.extra);\n                var loc = tot + badd;\n                out.set(f.c, loc);\n                wzh(out, o, f, f.f, f.u, l, tot, f.m), o += 16 + badd + (f.m ? f.m.length : 0), tot = loc + l;\n            }\n            catch (e) {\n                return cb(e, null);\n            }\n        }\n        wzf(out, o, files.length, cdl, oe);\n        cb(null, out);\n    };\n    if (!lft)\n        cbf();\n    var _loop_1 = function (i) {\n        var fn = k[i];\n        var _a = r[fn], file = _a[0], p = _a[1];\n        var c = crc(), size = file.length;\n        c.p(file);\n        var f = strToU8(fn), s = f.length;\n        var com = p.comment, m = com && strToU8(com), ms = m && m.length;\n        var exl = exfl(p.extra);\n        var compression = p.level == 0 ? 0 : 8;\n        var cbl = function (e, d) {\n            if (e) {\n                tAll();\n                cb(e, null);\n            }\n            else {\n                var l = d.length;\n                files[i] = mrg(p, {\n                    size: size,\n                    crc: c.d(),\n                    c: d,\n                    f: f,\n                    m: m,\n                    u: s != fn.length || (m && (com.length != ms)),\n                    compression: compression\n                });\n                o += 30 + s + exl + l;\n                tot += 76 + 2 * (s + exl) + (ms || 0) + l;\n                if (!--lft)\n                    cbf();\n            }\n        };\n        if (s > 65535)\n            cbl('filename too long', null);\n        if (!compression)\n            cbl(null, file);\n        else if (size < 160000) {\n            try {\n                cbl(null, deflateSync(file, p));\n            }\n            catch (e) {\n                cbl(e, null);\n            }\n        }\n        else\n            term.push(deflate(file, p, cbl));\n    };\n    // Cannot use lft because it can decrease\n    for (var i = 0; i < slft; ++i) {\n        _loop_1(i);\n    }\n    return tAll;\n}\n/**\n * Synchronously creates a ZIP file. Prefer using `zip` for better performance\n * with more than one file.\n * @param data The directory structure for the ZIP archive\n * @param opts The main options, merged with per-file options\n * @returns The generated ZIP archive\n */\nexport function zipSync(data, opts) {\n    if (!opts)\n        opts = {};\n    var r = {};\n    var files = [];\n    fltn(data, '', r, opts);\n    var o = 0;\n    var tot = 0;\n    for (var fn in r) {\n        var _a = r[fn], file = _a[0], p = _a[1];\n        var compression = p.level == 0 ? 0 : 8;\n        var f = strToU8(fn), s = f.length;\n        var com = p.comment, m = com && strToU8(com), ms = m && m.length;\n        var exl = exfl(p.extra);\n        if (s > 65535)\n            throw 'filename too long';\n        var d = compression ? deflateSync(file, p) : file, l = d.length;\n        var c = crc();\n        c.p(file);\n        files.push(mrg(p, {\n            size: file.length,\n            crc: c.d(),\n            c: d,\n            f: f,\n            m: m,\n            u: s != fn.length || (m && (com.length != ms)),\n            o: o,\n            compression: compression\n        }));\n        o += 30 + s + exl + l;\n        tot += 76 + 2 * (s + exl) + (ms || 0) + l;\n    }\n    var out = new u8(tot + 22), oe = o, cdl = tot - o;\n    for (var i = 0; i < files.length; ++i) {\n        var f = files[i];\n        wzh(out, f.o, f, f.f, f.u, f.c.length);\n        var badd = 30 + f.f.length + exfl(f.extra);\n        out.set(f.c, f.o + badd);\n        wzh(out, o, f, f.f, f.u, f.c.length, f.o, f.m), o += 16 + badd + (f.m ? f.m.length : 0);\n    }\n    wzf(out, o, files.length, cdl, oe);\n    return out;\n}\n/**\n * Streaming pass-through decompression for ZIP archives\n */\nvar UnzipPassThrough = /*#__PURE__*/ (function () {\n    function UnzipPassThrough() {\n    }\n    UnzipPassThrough.prototype.push = function (data, final) {\n        this.ondata(null, data, final);\n    };\n    UnzipPassThrough.compression = 0;\n    return UnzipPassThrough;\n}());\nexport { UnzipPassThrough };\n/**\n * Streaming DEFLATE decompression for ZIP archives. Prefer AsyncZipInflate for\n * better performance.\n */\nvar UnzipInflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE decompression that can be used in ZIP archives\n     */\n    function UnzipInflate() {\n        var _this_1 = this;\n        this.i = new Inflate(function (dat, final) {\n            _this_1.ondata(null, dat, final);\n        });\n    }\n    UnzipInflate.prototype.push = function (data, final) {\n        try {\n            this.i.push(data, final);\n        }\n        catch (e) {\n            this.ondata(e, data, final);\n        }\n    };\n    UnzipInflate.compression = 8;\n    return UnzipInflate;\n}());\nexport { UnzipInflate };\n/**\n * Asynchronous streaming DEFLATE decompression for ZIP archives\n */\nvar AsyncUnzipInflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE decompression that can be used in ZIP archives\n     */\n    function AsyncUnzipInflate(_, sz) {\n        var _this_1 = this;\n        if (sz < 320000) {\n            this.i = new Inflate(function (dat, final) {\n                _this_1.ondata(null, dat, final);\n            });\n        }\n        else {\n            this.i = new AsyncInflate(function (err, dat, final) {\n                _this_1.ondata(err, dat, final);\n            });\n            this.terminate = this.i.terminate;\n        }\n    }\n    AsyncUnzipInflate.prototype.push = function (data, final) {\n        if (this.i.terminate)\n            data = slc(data, 0);\n        this.i.push(data, final);\n    };\n    AsyncUnzipInflate.compression = 8;\n    return AsyncUnzipInflate;\n}());\nexport { AsyncUnzipInflate };\n/**\n * A ZIP archive decompression stream that emits files as they are discovered\n */\nvar Unzip = /*#__PURE__*/ (function () {\n    /**\n     * Creates a ZIP decompression stream\n     * @param cb The callback to call whenever a file in the ZIP archive is found\n     */\n    function Unzip(cb) {\n        this.onfile = cb;\n        this.k = [];\n        this.o = {\n            0: UnzipPassThrough\n        };\n        this.p = et;\n    }\n    /**\n     * Pushes a chunk to be unzipped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Unzip.prototype.push = function (chunk, final) {\n        var _this_1 = this;\n        if (!this.onfile)\n            throw 'no callback';\n        if (!this.p)\n            throw 'stream finished';\n        if (this.c > 0) {\n            var len = Math.min(this.c, chunk.length);\n            var toAdd = chunk.subarray(0, len);\n            this.c -= len;\n            if (this.d)\n                this.d.push(toAdd, !this.c);\n            else\n                this.k[0].push(toAdd);\n            chunk = chunk.subarray(len);\n            if (chunk.length)\n                return this.push(chunk, final);\n        }\n        else {\n            var f = 0, i = 0, is = void 0, buf = void 0;\n            if (!this.p.length)\n                buf = chunk;\n            else if (!chunk.length)\n                buf = this.p;\n            else {\n                buf = new u8(this.p.length + chunk.length);\n                buf.set(this.p), buf.set(chunk, this.p.length);\n            }\n            var l = buf.length, oc = this.c, add = oc && this.d;\n            var _loop_2 = function () {\n                var _a;\n                var sig = b4(buf, i);\n                if (sig == 0x4034B50) {\n                    f = 1, is = i;\n                    this_1.d = null;\n                    this_1.c = 0;\n                    var bf = b2(buf, i + 6), cmp_1 = b2(buf, i + 8), u = bf & 2048, dd = bf & 8, fnl = b2(buf, i + 26), es = b2(buf, i + 28);\n                    if (l > i + 30 + fnl + es) {\n                        var chks_2 = [];\n                        this_1.k.unshift(chks_2);\n                        f = 2;\n                        var sc_1 = b4(buf, i + 18), su_1 = b4(buf, i + 22);\n                        var fn_1 = strFromU8(buf.subarray(i + 30, i += 30 + fnl), !u);\n                        if (sc_1 == 4294967295) {\n                            _a = dd ? [-2] : z64e(buf, i), sc_1 = _a[0], su_1 = _a[1];\n                        }\n                        else if (dd)\n                            sc_1 = -1;\n                        i += es;\n                        this_1.c = sc_1;\n                        var d_1;\n                        var file_1 = {\n                            name: fn_1,\n                            compression: cmp_1,\n                            start: function () {\n                                if (!file_1.ondata)\n                                    throw 'no callback';\n                                if (!sc_1)\n                                    file_1.ondata(null, et, true);\n                                else {\n                                    var ctr = _this_1.o[cmp_1];\n                                    if (!ctr)\n                                        throw 'unknown compression type ' + cmp_1;\n                                    d_1 = sc_1 < 0 ? new ctr(fn_1) : new ctr(fn_1, sc_1, su_1);\n                                    d_1.ondata = function (err, dat, final) { file_1.ondata(err, dat, final); };\n                                    for (var _i = 0, chks_3 = chks_2; _i < chks_3.length; _i++) {\n                                        var dat = chks_3[_i];\n                                        d_1.push(dat, false);\n                                    }\n                                    if (_this_1.k[0] == chks_2 && _this_1.c)\n                                        _this_1.d = d_1;\n                                    else\n                                        d_1.push(et, true);\n                                }\n                            },\n                            terminate: function () {\n                                if (d_1 && d_1.terminate)\n                                    d_1.terminate();\n                            }\n                        };\n                        if (sc_1 >= 0)\n                            file_1.size = sc_1, file_1.originalSize = su_1;\n                        this_1.onfile(file_1);\n                    }\n                    return \"break\";\n                }\n                else if (oc) {\n                    if (sig == 0x8074B50) {\n                        is = i += 12 + (oc == -2 && 8), f = 3, this_1.c = 0;\n                        return \"break\";\n                    }\n                    else if (sig == 0x2014B50) {\n                        is = i -= 4, f = 3, this_1.c = 0;\n                        return \"break\";\n                    }\n                }\n            };\n            var this_1 = this;\n            for (; i < l - 4; ++i) {\n                var state_1 = _loop_2();\n                if (state_1 === \"break\")\n                    break;\n            }\n            this.p = et;\n            if (oc < 0) {\n                var dat = f ? buf.subarray(0, is - 12 - (oc == -2 && 8) - (b4(buf, is - 16) == 0x8074B50 && 4)) : buf.subarray(0, i);\n                if (add)\n                    add.push(dat, !!f);\n                else\n                    this.k[+(f == 2)].push(dat);\n            }\n            if (f & 2)\n                return this.push(buf.subarray(i), final);\n            this.p = buf.subarray(i);\n        }\n        if (final) {\n            if (this.c)\n                throw 'invalid zip file';\n            this.p = null;\n        }\n    };\n    /**\n     * Registers a decoder with the stream, allowing for files compressed with\n     * the compression type provided to be expanded correctly\n     * @param decoder The decoder constructor\n     */\n    Unzip.prototype.register = function (decoder) {\n        this.o[decoder.compression] = decoder;\n    };\n    return Unzip;\n}());\nexport { Unzip };\n/**\n * Asynchronously decompresses a ZIP archive\n * @param data The raw compressed ZIP file\n * @param cb The callback to call with the decompressed files\n * @returns A function that can be used to immediately terminate the unzipping\n */\nexport function unzip(data, cb) {\n    if (typeof cb != 'function')\n        throw 'no callback';\n    var term = [];\n    var tAll = function () {\n        for (var i = 0; i < term.length; ++i)\n            term[i]();\n    };\n    var files = {};\n    var e = data.length - 22;\n    for (; b4(data, e) != 0x6054B50; --e) {\n        if (!e || data.length - e > 65558) {\n            cb('invalid zip file', null);\n            return;\n        }\n    }\n    ;\n    var lft = b2(data, e + 8);\n    if (!lft)\n        cb(null, {});\n    var c = lft;\n    var o = b4(data, e + 16);\n    var z = o == 4294967295;\n    if (z) {\n        e = b4(data, e - 12);\n        if (b4(data, e) != 0x6064B50) {\n            cb('invalid zip file', null);\n            return;\n        }\n        c = lft = b4(data, e + 32);\n        o = b4(data, e + 48);\n    }\n    var _loop_3 = function (i) {\n        var _a = zh(data, o, z), c_1 = _a[0], sc = _a[1], su = _a[2], fn = _a[3], no = _a[4], off = _a[5], b = slzh(data, off);\n        o = no;\n        var cbl = function (e, d) {\n            if (e) {\n                tAll();\n                cb(e, null);\n            }\n            else {\n                files[fn] = d;\n                if (!--lft)\n                    cb(null, files);\n            }\n        };\n        if (!c_1)\n            cbl(null, slc(data, b, b + sc));\n        else if (c_1 == 8) {\n            var infl = data.subarray(b, b + sc);\n            if (sc < 320000) {\n                try {\n                    cbl(null, inflateSync(infl, new u8(su)));\n                }\n                catch (e) {\n                    cbl(e, null);\n                }\n            }\n            else\n                term.push(inflate(infl, { size: su }, cbl));\n        }\n        else\n            cbl('unknown compression type ' + c_1, null);\n    };\n    for (var i = 0; i < c; ++i) {\n        _loop_3(i);\n    }\n    return tAll;\n}\n/**\n * Synchronously decompresses a ZIP archive. Prefer using `unzip` for better\n * performance with more than one file.\n * @param data The raw compressed ZIP file\n * @returns The decompressed files\n */\nexport function unzipSync(data) {\n    var files = {};\n    var e = data.length - 22;\n    for (; b4(data, e) != 0x6054B50; --e) {\n        if (!e || data.length - e > 65558)\n            throw 'invalid zip file';\n    }\n    ;\n    var c = b2(data, e + 8);\n    if (!c)\n        return {};\n    var o = b4(data, e + 16);\n    var z = o == 4294967295;\n    if (z) {\n        e = b4(data, e - 12);\n        if (b4(data, e) != 0x6064B50)\n            throw 'invalid zip file';\n        c = b4(data, e + 32);\n        o = b4(data, e + 48);\n    }\n    for (var i = 0; i < c; ++i) {\n        var _a = zh(data, o, z), c_2 = _a[0], sc = _a[1], su = _a[2], fn = _a[3], no = _a[4], off = _a[5], b = slzh(data, off);\n        o = no;\n        if (!c_2)\n            files[fn] = slc(data, b, b + sc);\n        else if (c_2 == 8)\n            files[fn] = inflateSync(data.subarray(b, b + sc), new u8(su));\n        else\n            throw 'unknown compression type ' + c_2;\n    }\n    return files;\n}\n","import {\n\tVector3,\n\tVector4\n} from 'three';\n\n/**\n * NURBS utils\n *\n * See NURBSCurve and NURBSSurface.\n **/\n\n\n/**************************************************************\n *\tNURBS Utils\n **************************************************************/\n\nclass NURBSUtils {\n\n\t/*\n\tFinds knot vector span.\n\n\tp : degree\n\tu : parametric value\n\tU : knot vector\n\n\treturns the span\n\t*/\n\tstatic findSpan( p, u, U ) {\n\n\t\tconst n = U.length - p - 1;\n\n\t\tif ( u >= U[ n ] ) {\n\n\t\t\treturn n - 1;\n\n\t\t}\n\n\t\tif ( u <= U[ p ] ) {\n\n\t\t\treturn p;\n\n\t\t}\n\n\t\tlet low = p;\n\t\tlet high = n;\n\t\tlet mid = Math.floor( ( low + high ) / 2 );\n\n\t\twhile ( u < U[ mid ] || u >= U[ mid + 1 ] ) {\n\n\t\t\tif ( u < U[ mid ] ) {\n\n\t\t\t\thigh = mid;\n\n\t\t\t} else {\n\n\t\t\t\tlow = mid;\n\n\t\t\t}\n\n\t\t\tmid = Math.floor( ( low + high ) / 2 );\n\n\t\t}\n\n\t\treturn mid;\n\n\t}\n\n\n\t/*\n\tCalculate basis functions. See The NURBS Book, page 70, algorithm A2.2\n\n\tspan : span in which u lies\n\tu    : parametric point\n\tp    : degree\n\tU    : knot vector\n\n\treturns array[p+1] with basis functions values.\n\t*/\n\tstatic calcBasisFunctions( span, u, p, U ) {\n\n\t\tconst N = [];\n\t\tconst left = [];\n\t\tconst right = [];\n\t\tN[ 0 ] = 1.0;\n\n\t\tfor ( let j = 1; j <= p; ++ j ) {\n\n\t\t\tleft[ j ] = u - U[ span + 1 - j ];\n\t\t\tright[ j ] = U[ span + j ] - u;\n\n\t\t\tlet saved = 0.0;\n\n\t\t\tfor ( let r = 0; r < j; ++ r ) {\n\n\t\t\t\tconst rv = right[ r + 1 ];\n\t\t\t\tconst lv = left[ j - r ];\n\t\t\t\tconst temp = N[ r ] / ( rv + lv );\n\t\t\t\tN[ r ] = saved + rv * temp;\n\t\t\t\tsaved = lv * temp;\n\n\t\t\t }\n\n\t\t\t N[ j ] = saved;\n\n\t\t }\n\n\t\t return N;\n\n\t}\n\n\n\t/*\n\tCalculate B-Spline curve points. See The NURBS Book, page 82, algorithm A3.1.\n\n\tp : degree of B-Spline\n\tU : knot vector\n\tP : control points (x, y, z, w)\n\tu : parametric point\n\n\treturns point for given u\n\t*/\n\tstatic calcBSplinePoint( p, U, P, u ) {\n\n\t\tconst span = this.findSpan( p, u, U );\n\t\tconst N = this.calcBasisFunctions( span, u, p, U );\n\t\tconst C = new Vector4( 0, 0, 0, 0 );\n\n\t\tfor ( let j = 0; j <= p; ++ j ) {\n\n\t\t\tconst point = P[ span - p + j ];\n\t\t\tconst Nj = N[ j ];\n\t\t\tconst wNj = point.w * Nj;\n\t\t\tC.x += point.x * wNj;\n\t\t\tC.y += point.y * wNj;\n\t\t\tC.z += point.z * wNj;\n\t\t\tC.w += point.w * Nj;\n\n\t\t}\n\n\t\treturn C;\n\n\t}\n\n\n\t/*\n\tCalculate basis functions derivatives. See The NURBS Book, page 72, algorithm A2.3.\n\n\tspan : span in which u lies\n\tu    : parametric point\n\tp    : degree\n\tn    : number of derivatives to calculate\n\tU    : knot vector\n\n\treturns array[n+1][p+1] with basis functions derivatives\n\t*/\n\tstatic calcBasisFunctionDerivatives( span, u, p, n, U ) {\n\n\t\tconst zeroArr = [];\n\t\tfor ( let i = 0; i <= p; ++ i )\n\t\t\tzeroArr[ i ] = 0.0;\n\n\t\tconst ders = [];\n\n\t\tfor ( let i = 0; i <= n; ++ i )\n\t\t\tders[ i ] = zeroArr.slice( 0 );\n\n\t\tconst ndu = [];\n\n\t\tfor ( let i = 0; i <= p; ++ i )\n\t\t\tndu[ i ] = zeroArr.slice( 0 );\n\n\t\tndu[ 0 ][ 0 ] = 1.0;\n\n\t\tconst left = zeroArr.slice( 0 );\n\t\tconst right = zeroArr.slice( 0 );\n\n\t\tfor ( let j = 1; j <= p; ++ j ) {\n\n\t\t\tleft[ j ] = u - U[ span + 1 - j ];\n\t\t\tright[ j ] = U[ span + j ] - u;\n\n\t\t\tlet saved = 0.0;\n\n\t\t\tfor ( let r = 0; r < j; ++ r ) {\n\n\t\t\t\tconst rv = right[ r + 1 ];\n\t\t\t\tconst lv = left[ j - r ];\n\t\t\t\tndu[ j ][ r ] = rv + lv;\n\n\t\t\t\tconst temp = ndu[ r ][ j - 1 ] / ndu[ j ][ r ];\n\t\t\t\tndu[ r ][ j ] = saved + rv * temp;\n\t\t\t\tsaved = lv * temp;\n\n\t\t\t}\n\n\t\t\tndu[ j ][ j ] = saved;\n\n\t\t}\n\n\t\tfor ( let j = 0; j <= p; ++ j ) {\n\n\t\t\tders[ 0 ][ j ] = ndu[ j ][ p ];\n\n\t\t}\n\n\t\tfor ( let r = 0; r <= p; ++ r ) {\n\n\t\t\tlet s1 = 0;\n\t\t\tlet s2 = 1;\n\n\t\t\tconst a = [];\n\t\t\tfor ( let i = 0; i <= p; ++ i ) {\n\n\t\t\t\ta[ i ] = zeroArr.slice( 0 );\n\n\t\t\t}\n\n\t\t\ta[ 0 ][ 0 ] = 1.0;\n\n\t\t\tfor ( let k = 1; k <= n; ++ k ) {\n\n\t\t\t\tlet d = 0.0;\n\t\t\t\tconst rk = r - k;\n\t\t\t\tconst pk = p - k;\n\n\t\t\t\tif ( r >= k ) {\n\n\t\t\t\t\ta[ s2 ][ 0 ] = a[ s1 ][ 0 ] / ndu[ pk + 1 ][ rk ];\n\t\t\t\t\td = a[ s2 ][ 0 ] * ndu[ rk ][ pk ];\n\n\t\t\t\t}\n\n\t\t\t\tconst j1 = ( rk >= - 1 ) ? 1 : - rk;\n\t\t\t\tconst j2 = ( r - 1 <= pk ) ? k - 1 : p - r;\n\n\t\t\t\tfor ( let j = j1; j <= j2; ++ j ) {\n\n\t\t\t\t\ta[ s2 ][ j ] = ( a[ s1 ][ j ] - a[ s1 ][ j - 1 ] ) / ndu[ pk + 1 ][ rk + j ];\n\t\t\t\t\td += a[ s2 ][ j ] * ndu[ rk + j ][ pk ];\n\n\t\t\t\t}\n\n\t\t\t\tif ( r <= pk ) {\n\n\t\t\t\t\ta[ s2 ][ k ] = - a[ s1 ][ k - 1 ] / ndu[ pk + 1 ][ r ];\n\t\t\t\t\td += a[ s2 ][ k ] * ndu[ r ][ pk ];\n\n\t\t\t\t}\n\n\t\t\t\tders[ k ][ r ] = d;\n\n\t\t\t\tconst j = s1;\n\t\t\t\ts1 = s2;\n\t\t\t\ts2 = j;\n\n\t\t\t}\n\n\t\t}\n\n\t\tlet r = p;\n\n\t\tfor ( let k = 1; k <= n; ++ k ) {\n\n\t\t\tfor ( let j = 0; j <= p; ++ j ) {\n\n\t\t\t\tders[ k ][ j ] *= r;\n\n\t\t\t}\n\n\t\t\tr *= p - k;\n\n\t\t}\n\n\t\treturn ders;\n\n\t}\n\n\n\t/*\n\t\tCalculate derivatives of a B-Spline. See The NURBS Book, page 93, algorithm A3.2.\n\n\t\tp  : degree\n\t\tU  : knot vector\n\t\tP  : control points\n\t\tu  : Parametric points\n\t\tnd : number of derivatives\n\n\t\treturns array[d+1] with derivatives\n\t\t*/\n\tstatic calcBSplineDerivatives( p, U, P, u, nd ) {\n\n\t\tconst du = nd < p ? nd : p;\n\t\tconst CK = [];\n\t\tconst span = this.findSpan( p, u, U );\n\t\tconst nders = this.calcBasisFunctionDerivatives( span, u, p, du, U );\n\t\tconst Pw = [];\n\n\t\tfor ( let i = 0; i < P.length; ++ i ) {\n\n\t\t\tconst point = P[ i ].clone();\n\t\t\tconst w = point.w;\n\n\t\t\tpoint.x *= w;\n\t\t\tpoint.y *= w;\n\t\t\tpoint.z *= w;\n\n\t\t\tPw[ i ] = point;\n\n\t\t}\n\n\t\tfor ( let k = 0; k <= du; ++ k ) {\n\n\t\t\tconst point = Pw[ span - p ].clone().multiplyScalar( nders[ k ][ 0 ] );\n\n\t\t\tfor ( let j = 1; j <= p; ++ j ) {\n\n\t\t\t\tpoint.add( Pw[ span - p + j ].clone().multiplyScalar( nders[ k ][ j ] ) );\n\n\t\t\t}\n\n\t\t\tCK[ k ] = point;\n\n\t\t}\n\n\t\tfor ( let k = du + 1; k <= nd + 1; ++ k ) {\n\n\t\t\tCK[ k ] = new Vector4( 0, 0, 0 );\n\n\t\t}\n\n\t\treturn CK;\n\n\t}\n\n\n\t/*\n\tCalculate \"K over I\"\n\n\treturns k!/(i!(k-i)!)\n\t*/\n\tstatic calcKoverI( k, i ) {\n\n\t\tlet nom = 1;\n\n\t\tfor ( let j = 2; j <= k; ++ j ) {\n\n\t\t\tnom *= j;\n\n\t\t}\n\n\t\tlet denom = 1;\n\n\t\tfor ( let j = 2; j <= i; ++ j ) {\n\n\t\t\tdenom *= j;\n\n\t\t}\n\n\t\tfor ( let j = 2; j <= k - i; ++ j ) {\n\n\t\t\tdenom *= j;\n\n\t\t}\n\n\t\treturn nom / denom;\n\n\t}\n\n\n\t/*\n\tCalculate derivatives (0-nd) of rational curve. See The NURBS Book, page 127, algorithm A4.2.\n\n\tPders : result of function calcBSplineDerivatives\n\n\treturns array with derivatives for rational curve.\n\t*/\n\tstatic calcRationalCurveDerivatives( Pders ) {\n\n\t\tconst nd = Pders.length;\n\t\tconst Aders = [];\n\t\tconst wders = [];\n\n\t\tfor ( let i = 0; i < nd; ++ i ) {\n\n\t\t\tconst point = Pders[ i ];\n\t\t\tAders[ i ] = new Vector3( point.x, point.y, point.z );\n\t\t\twders[ i ] = point.w;\n\n\t\t}\n\n\t\tconst CK = [];\n\n\t\tfor ( let k = 0; k < nd; ++ k ) {\n\n\t\t\tconst v = Aders[ k ].clone();\n\n\t\t\tfor ( let i = 1; i <= k; ++ i ) {\n\n\t\t\t\tv.sub( CK[ k - i ].clone().multiplyScalar( this.calcKoverI( k, i ) * wders[ i ] ) );\n\n\t\t\t}\n\n\t\t\tCK[ k ] = v.divideScalar( wders[ 0 ] );\n\n\t\t}\n\n\t\treturn CK;\n\n\t}\n\n\n\t/*\n\tCalculate NURBS curve derivatives. See The NURBS Book, page 127, algorithm A4.2.\n\n\tp  : degree\n\tU  : knot vector\n\tP  : control points in homogeneous space\n\tu  : parametric points\n\tnd : number of derivatives\n\n\treturns array with derivatives.\n\t*/\n\tstatic calcNURBSDerivatives( p, U, P, u, nd ) {\n\n\t\tconst Pders = this.calcBSplineDerivatives( p, U, P, u, nd );\n\t\treturn this.calcRationalCurveDerivatives( Pders );\n\n\t}\n\n\n\t/*\n\tCalculate rational B-Spline surface point. See The NURBS Book, page 134, algorithm A4.3.\n\n\tp1, p2 : degrees of B-Spline surface\n\tU1, U2 : knot vectors\n\tP      : control points (x, y, z, w)\n\tu, v   : parametric values\n\n\treturns point for given (u, v)\n\t*/\n\tstatic calcSurfacePoint( p, q, U, V, P, u, v, target ) {\n\n\t\tconst uspan = this.findSpan( p, u, U );\n\t\tconst vspan = this.findSpan( q, v, V );\n\t\tconst Nu = this.calcBasisFunctions( uspan, u, p, U );\n\t\tconst Nv = this.calcBasisFunctions( vspan, v, q, V );\n\t\tconst temp = [];\n\n\t\tfor ( let l = 0; l <= q; ++ l ) {\n\n\t\t\ttemp[ l ] = new Vector4( 0, 0, 0, 0 );\n\t\t\tfor ( let k = 0; k <= p; ++ k ) {\n\n\t\t\t\tconst point = P[ uspan - p + k ][ vspan - q + l ].clone();\n\t\t\t\tconst w = point.w;\n\t\t\t\tpoint.x *= w;\n\t\t\t\tpoint.y *= w;\n\t\t\t\tpoint.z *= w;\n\t\t\t\ttemp[ l ].add( point.multiplyScalar( Nu[ k ] ) );\n\n\t\t\t}\n\n\t\t}\n\n\t\tconst Sw = new Vector4( 0, 0, 0, 0 );\n\t\tfor ( let l = 0; l <= q; ++ l ) {\n\n\t\t\tSw.add( temp[ l ].multiplyScalar( Nv[ l ] ) );\n\n\t\t}\n\n\t\tSw.divideScalar( Sw.w );\n\t\ttarget.set( Sw.x, Sw.y, Sw.z );\n\n\t}\n\n}\n\nexport { NURBSUtils };\n","import {\n\tCurve,\n\tVector3,\n\tVector4\n} from 'three';\nimport { NURBSUtils } from '../curves/NURBSUtils.js';\n\n/**\n * NURBS curve object\n *\n * Derives from Curve, overriding getPoint and getTangent.\n *\n * Implementation is based on (x, y [, z=0 [, w=1]]) control points with w=weight.\n *\n **/\n\nclass NURBSCurve extends Curve {\n\n\tconstructor(\n\t\tdegree,\n\t\tknots /* array of reals */,\n\t\tcontrolPoints /* array of Vector(2|3|4) */,\n\t\tstartKnot /* index in knots */,\n\t\tendKnot /* index in knots */\n\t) {\n\n\t\tsuper();\n\n\t\tthis.degree = degree;\n\t\tthis.knots = knots;\n\t\tthis.controlPoints = [];\n\t\t// Used by periodic NURBS to remove hidden spans\n\t\tthis.startKnot = startKnot || 0;\n\t\tthis.endKnot = endKnot || ( this.knots.length - 1 );\n\n\t\tfor ( let i = 0; i < controlPoints.length; ++ i ) {\n\n\t\t\t// ensure Vector4 for control points\n\t\t\tconst point = controlPoints[ i ];\n\t\t\tthis.controlPoints[ i ] = new Vector4( point.x, point.y, point.z, point.w );\n\n\t\t}\n\n\t}\n\n\tgetPoint( t, optionalTarget = new Vector3() ) {\n\n\t\tconst point = optionalTarget;\n\n\t\tconst u = this.knots[ this.startKnot ] + t * ( this.knots[ this.endKnot ] - this.knots[ this.startKnot ] ); // linear mapping t->u\n\n\t\t// following results in (wx, wy, wz, w) homogeneous point\n\t\tconst hpoint = NURBSUtils.calcBSplinePoint( this.degree, this.knots, this.controlPoints, u );\n\n\t\tif ( hpoint.w !== 1.0 ) {\n\n\t\t\t// project to 3D space: (wx, wy, wz, w) -> (x, y, z, 1)\n\t\t\thpoint.divideScalar( hpoint.w );\n\n\t\t}\n\n\t\treturn point.set( hpoint.x, hpoint.y, hpoint.z );\n\n\t}\n\n\tgetTangent( t, optionalTarget = new Vector3() ) {\n\n\t\tconst tangent = optionalTarget;\n\n\t\tconst u = this.knots[ 0 ] + t * ( this.knots[ this.knots.length - 1 ] - this.knots[ 0 ] );\n\t\tconst ders = NURBSUtils.calcNURBSDerivatives( this.degree, this.knots, this.controlPoints, u, 1 );\n\t\ttangent.copy( ders[ 1 ] ).normalize();\n\n\t\treturn tangent;\n\n\t}\n\n}\n\nexport { NURBSCurve };\n","import {\n\tAmbientLight,\n\tAnimationClip,\n\tBone,\n\tBufferAttribute,\n\tBufferGeometry,\n\tClampToEdgeWrapping,\n\tColor,\n\tDirectionalLight,\n\tEquirectangularReflectionMapping,\n\tEuler,\n\tFileLoader,\n\tFloat32BufferAttribute,\n\tGroup,\n\tLine,\n\tLineBasicMaterial,\n\tLoader,\n\tLoaderUtils,\n\tMathUtils,\n\tMatrix3,\n\tMatrix4,\n\tMesh,\n\tMeshLambertMaterial,\n\tMeshPhongMaterial,\n\tNumberKeyframeTrack,\n\tObject3D,\n\tOrthographicCamera,\n\tPerspectiveCamera,\n\tPointLight,\n\tPropertyBinding,\n\tQuaternion,\n\tQuaternionKeyframeTrack,\n\tRepeatWrapping,\n\tSkeleton,\n\tSkinnedMesh,\n\tSpotLight,\n\tTexture,\n\tTextureLoader,\n\tUint16BufferAttribute,\n\tVector3,\n\tVector4,\n\tVectorKeyframeTrack,\n\tsRGBEncoding\n} from 'three';\nimport * as fflate from '../libs/fflate.module.js';\nimport { NURBSCurve } from '../curves/NURBSCurve.js';\n\n/**\n * Loader loads FBX file and generates Group representing FBX scene.\n * Requires FBX file to be >= 7.0 and in ASCII or >= 6400 in Binary format\n * Versions lower than this may load but will probably have errors\n *\n * Needs Support:\n *  Morph normals / blend shape normals\n *\n * FBX format references:\n * \thttps://wiki.blender.org/index.php/User:Mont29/Foundation/FBX_File_Structure\n * \thttp://help.autodesk.com/view/FBX/2017/ENU/?guid=__cpp_ref_index_html (C++ SDK reference)\n *\n * \tBinary format specification:\n *\t\thttps://code.blender.org/2013/08/fbx-binary-file-format-specification/\n */\n\n\nlet fbxTree;\nlet connections;\nlet sceneGraph;\n\nclass FBXLoader extends Loader {\n\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t}\n\n\tload( url, onLoad, onProgress, onError ) {\n\n\t\tconst scope = this;\n\n\t\tconst path = ( scope.path === '' ) ? LoaderUtils.extractUrlBase( url ) : scope.path;\n\n\t\tconst loader = new FileLoader( this.manager );\n\t\tloader.setPath( scope.path );\n\t\tloader.setResponseType( 'arraybuffer' );\n\t\tloader.setRequestHeader( scope.requestHeader );\n\t\tloader.setWithCredentials( scope.withCredentials );\n\n\t\tloader.load( url, function ( buffer ) {\n\n\t\t\ttry {\n\n\t\t\t\tonLoad( scope.parse( buffer, path ) );\n\n\t\t\t} catch ( e ) {\n\n\t\t\t\tif ( onError ) {\n\n\t\t\t\t\tonError( e );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.error( e );\n\n\t\t\t\t}\n\n\t\t\t\tscope.manager.itemError( url );\n\n\t\t\t}\n\n\t\t}, onProgress, onError );\n\n\t}\n\n\tparse( FBXBuffer, path ) {\n\n\t\tif ( isFbxFormatBinary( FBXBuffer ) ) {\n\n\t\t\tfbxTree = new BinaryParser().parse( FBXBuffer );\n\n\t\t} else {\n\n\t\t\tconst FBXText = convertArrayBufferToString( FBXBuffer );\n\n\t\t\tif ( ! isFbxFormatASCII( FBXText ) ) {\n\n\t\t\t\tthrow new Error( 'THREE.FBXLoader: Unknown format.' );\n\n\t\t\t}\n\n\t\t\tif ( getFbxVersion( FBXText ) < 7000 ) {\n\n\t\t\t\tthrow new Error( 'THREE.FBXLoader: FBX version not supported, FileVersion: ' + getFbxVersion( FBXText ) );\n\n\t\t\t}\n\n\t\t\tfbxTree = new TextParser().parse( FBXText );\n\n\t\t}\n\n\t\t// console.log( fbxTree );\n\n\t\tconst textureLoader = new TextureLoader( this.manager ).setPath( this.resourcePath || path ).setCrossOrigin( this.crossOrigin );\n\n\t\treturn new FBXTreeParser( textureLoader, this.manager ).parse( fbxTree );\n\n\t}\n\n}\n\n// Parse the FBXTree object returned by the BinaryParser or TextParser and return a Group\nclass FBXTreeParser {\n\n\tconstructor( textureLoader, manager ) {\n\n\t\tthis.textureLoader = textureLoader;\n\t\tthis.manager = manager;\n\n\t}\n\n\tparse() {\n\n\t\tconnections = this.parseConnections();\n\n\t\tconst images = this.parseImages();\n\t\tconst textures = this.parseTextures( images );\n\t\tconst materials = this.parseMaterials( textures );\n\t\tconst deformers = this.parseDeformers();\n\t\tconst geometryMap = new GeometryParser().parse( deformers );\n\n\t\tthis.parseScene( deformers, geometryMap, materials );\n\n\t\treturn sceneGraph;\n\n\t}\n\n\t// Parses FBXTree.Connections which holds parent-child connections between objects (e.g. material -> texture, model->geometry )\n\t// and details the connection type\n\tparseConnections() {\n\n\t\tconst connectionMap = new Map();\n\n\t\tif ( 'Connections' in fbxTree ) {\n\n\t\t\tconst rawConnections = fbxTree.Connections.connections;\n\n\t\t\trawConnections.forEach( function ( rawConnection ) {\n\n\t\t\t\tconst fromID = rawConnection[ 0 ];\n\t\t\t\tconst toID = rawConnection[ 1 ];\n\t\t\t\tconst relationship = rawConnection[ 2 ];\n\n\t\t\t\tif ( ! connectionMap.has( fromID ) ) {\n\n\t\t\t\t\tconnectionMap.set( fromID, {\n\t\t\t\t\t\tparents: [],\n\t\t\t\t\t\tchildren: []\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\n\t\t\t\tconst parentRelationship = { ID: toID, relationship: relationship };\n\t\t\t\tconnectionMap.get( fromID ).parents.push( parentRelationship );\n\n\t\t\t\tif ( ! connectionMap.has( toID ) ) {\n\n\t\t\t\t\tconnectionMap.set( toID, {\n\t\t\t\t\t\tparents: [],\n\t\t\t\t\t\tchildren: []\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\n\t\t\t\tconst childRelationship = { ID: fromID, relationship: relationship };\n\t\t\t\tconnectionMap.get( toID ).children.push( childRelationship );\n\n\t\t\t} );\n\n\t\t}\n\n\t\treturn connectionMap;\n\n\t}\n\n\t// Parse FBXTree.Objects.Video for embedded image data\n\t// These images are connected to textures in FBXTree.Objects.Textures\n\t// via FBXTree.Connections.\n\tparseImages() {\n\n\t\tconst images = {};\n\t\tconst blobs = {};\n\n\t\tif ( 'Video' in fbxTree.Objects ) {\n\n\t\t\tconst videoNodes = fbxTree.Objects.Video;\n\n\t\t\tfor ( const nodeID in videoNodes ) {\n\n\t\t\t\tconst videoNode = videoNodes[ nodeID ];\n\n\t\t\t\tconst id = parseInt( nodeID );\n\n\t\t\t\timages[ id ] = videoNode.RelativeFilename || videoNode.Filename;\n\n\t\t\t\t// raw image data is in videoNode.Content\n\t\t\t\tif ( 'Content' in videoNode ) {\n\n\t\t\t\t\tconst arrayBufferContent = ( videoNode.Content instanceof ArrayBuffer ) && ( videoNode.Content.byteLength > 0 );\n\t\t\t\t\tconst base64Content = ( typeof videoNode.Content === 'string' ) && ( videoNode.Content !== '' );\n\n\t\t\t\t\tif ( arrayBufferContent || base64Content ) {\n\n\t\t\t\t\t\tconst image = this.parseImage( videoNodes[ nodeID ] );\n\n\t\t\t\t\t\tblobs[ videoNode.RelativeFilename || videoNode.Filename ] = image;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfor ( const id in images ) {\n\n\t\t\tconst filename = images[ id ];\n\n\t\t\tif ( blobs[ filename ] !== undefined ) images[ id ] = blobs[ filename ];\n\t\t\telse images[ id ] = images[ id ].split( '\\\\' ).pop();\n\n\t\t}\n\n\t\treturn images;\n\n\t}\n\n\t// Parse embedded image data in FBXTree.Video.Content\n\tparseImage( videoNode ) {\n\n\t\tconst content = videoNode.Content;\n\t\tconst fileName = videoNode.RelativeFilename || videoNode.Filename;\n\t\tconst extension = fileName.slice( fileName.lastIndexOf( '.' ) + 1 ).toLowerCase();\n\n\t\tlet type;\n\n\t\tswitch ( extension ) {\n\n\t\t\tcase 'bmp':\n\n\t\t\t\ttype = 'image/bmp';\n\t\t\t\tbreak;\n\n\t\t\tcase 'jpg':\n\t\t\tcase 'jpeg':\n\n\t\t\t\ttype = 'image/jpeg';\n\t\t\t\tbreak;\n\n\t\t\tcase 'png':\n\n\t\t\t\ttype = 'image/png';\n\t\t\t\tbreak;\n\n\t\t\tcase 'tif':\n\n\t\t\t\ttype = 'image/tiff';\n\t\t\t\tbreak;\n\n\t\t\tcase 'tga':\n\n\t\t\t\tif ( this.manager.getHandler( '.tga' ) === null ) {\n\n\t\t\t\t\tconsole.warn( 'FBXLoader: TGA loader not found, skipping ', fileName );\n\n\t\t\t\t}\n\n\t\t\t\ttype = 'image/tga';\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tconsole.warn( 'FBXLoader: Image type \"' + extension + '\" is not supported.' );\n\t\t\t\treturn;\n\n\t\t}\n\n\t\tif ( typeof content === 'string' ) { // ASCII format\n\n\t\t\treturn 'data:' + type + ';base64,' + content;\n\n\t\t} else { // Binary Format\n\n\t\t\tconst array = new Uint8Array( content );\n\t\t\treturn window.URL.createObjectURL( new Blob( [ array ], { type: type } ) );\n\n\t\t}\n\n\t}\n\n\t// Parse nodes in FBXTree.Objects.Texture\n\t// These contain details such as UV scaling, cropping, rotation etc and are connected\n\t// to images in FBXTree.Objects.Video\n\tparseTextures( images ) {\n\n\t\tconst textureMap = new Map();\n\n\t\tif ( 'Texture' in fbxTree.Objects ) {\n\n\t\t\tconst textureNodes = fbxTree.Objects.Texture;\n\t\t\tfor ( const nodeID in textureNodes ) {\n\n\t\t\t\tconst texture = this.parseTexture( textureNodes[ nodeID ], images );\n\t\t\t\ttextureMap.set( parseInt( nodeID ), texture );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn textureMap;\n\n\t}\n\n\t// Parse individual node in FBXTree.Objects.Texture\n\tparseTexture( textureNode, images ) {\n\n\t\tconst texture = this.loadTexture( textureNode, images );\n\n\t\ttexture.ID = textureNode.id;\n\n\t\ttexture.name = textureNode.attrName;\n\n\t\tconst wrapModeU = textureNode.WrapModeU;\n\t\tconst wrapModeV = textureNode.WrapModeV;\n\n\t\tconst valueU = wrapModeU !== undefined ? wrapModeU.value : 0;\n\t\tconst valueV = wrapModeV !== undefined ? wrapModeV.value : 0;\n\n\t\t// http://download.autodesk.com/us/fbx/SDKdocs/FBX_SDK_Help/files/fbxsdkref/class_k_fbx_texture.html#889640e63e2e681259ea81061b85143a\n\t\t// 0: repeat(default), 1: clamp\n\n\t\ttexture.wrapS = valueU === 0 ? RepeatWrapping : ClampToEdgeWrapping;\n\t\ttexture.wrapT = valueV === 0 ? RepeatWrapping : ClampToEdgeWrapping;\n\n\t\tif ( 'Scaling' in textureNode ) {\n\n\t\t\tconst values = textureNode.Scaling.value;\n\n\t\t\ttexture.repeat.x = values[ 0 ];\n\t\t\ttexture.repeat.y = values[ 1 ];\n\n\t\t}\n\n\t\treturn texture;\n\n\t}\n\n\t// load a texture specified as a blob or data URI, or via an external URL using TextureLoader\n\tloadTexture( textureNode, images ) {\n\n\t\tlet fileName;\n\n\t\tconst currentPath = this.textureLoader.path;\n\n\t\tconst children = connections.get( textureNode.id ).children;\n\n\t\tif ( children !== undefined && children.length > 0 && images[ children[ 0 ].ID ] !== undefined ) {\n\n\t\t\tfileName = images[ children[ 0 ].ID ];\n\n\t\t\tif ( fileName.indexOf( 'blob:' ) === 0 || fileName.indexOf( 'data:' ) === 0 ) {\n\n\t\t\t\tthis.textureLoader.setPath( undefined );\n\n\t\t\t}\n\n\t\t}\n\n\t\tlet texture;\n\n\t\tconst extension = textureNode.FileName.slice( - 3 ).toLowerCase();\n\n\t\tif ( extension === 'tga' ) {\n\n\t\t\tconst loader = this.manager.getHandler( '.tga' );\n\n\t\t\tif ( loader === null ) {\n\n\t\t\t\tconsole.warn( 'FBXLoader: TGA loader not found, creating placeholder texture for', textureNode.RelativeFilename );\n\t\t\t\ttexture = new Texture();\n\n\t\t\t} else {\n\n\t\t\t\tloader.setPath( this.textureLoader.path );\n\t\t\t\ttexture = loader.load( fileName );\n\n\t\t\t}\n\n\t\t} else if ( extension === 'psd' ) {\n\n\t\t\tconsole.warn( 'FBXLoader: PSD textures are not supported, creating placeholder texture for', textureNode.RelativeFilename );\n\t\t\ttexture = new Texture();\n\n\t\t} else {\n\n\t\t\ttexture = this.textureLoader.load( fileName );\n\n\t\t}\n\n\t\tthis.textureLoader.setPath( currentPath );\n\n\t\treturn texture;\n\n\t}\n\n\t// Parse nodes in FBXTree.Objects.Material\n\tparseMaterials( textureMap ) {\n\n\t\tconst materialMap = new Map();\n\n\t\tif ( 'Material' in fbxTree.Objects ) {\n\n\t\t\tconst materialNodes = fbxTree.Objects.Material;\n\n\t\t\tfor ( const nodeID in materialNodes ) {\n\n\t\t\t\tconst material = this.parseMaterial( materialNodes[ nodeID ], textureMap );\n\n\t\t\t\tif ( material !== null ) materialMap.set( parseInt( nodeID ), material );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn materialMap;\n\n\t}\n\n\t// Parse single node in FBXTree.Objects.Material\n\t// Materials are connected to texture maps in FBXTree.Objects.Textures\n\t// FBX format currently only supports Lambert and Phong shading models\n\tparseMaterial( materialNode, textureMap ) {\n\n\t\tconst ID = materialNode.id;\n\t\tconst name = materialNode.attrName;\n\t\tlet type = materialNode.ShadingModel;\n\n\t\t// Case where FBX wraps shading model in property object.\n\t\tif ( typeof type === 'object' ) {\n\n\t\t\ttype = type.value;\n\n\t\t}\n\n\t\t// Ignore unused materials which don't have any connections.\n\t\tif ( ! connections.has( ID ) ) return null;\n\n\t\tconst parameters = this.parseParameters( materialNode, textureMap, ID );\n\n\t\tlet material;\n\n\t\tswitch ( type.toLowerCase() ) {\n\n\t\t\tcase 'phong':\n\t\t\t\tmaterial = new MeshPhongMaterial();\n\t\t\t\tbreak;\n\t\t\tcase 'lambert':\n\t\t\t\tmaterial = new MeshLambertMaterial();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tconsole.warn( 'THREE.FBXLoader: unknown material type \"%s\". Defaulting to MeshPhongMaterial.', type );\n\t\t\t\tmaterial = new MeshPhongMaterial();\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tmaterial.setValues( parameters );\n\t\tmaterial.name = name;\n\n\t\treturn material;\n\n\t}\n\n\t// Parse FBX material and return parameters suitable for a three.js material\n\t// Also parse the texture map and return any textures associated with the material\n\tparseParameters( materialNode, textureMap, ID ) {\n\n\t\tconst parameters = {};\n\n\t\tif ( materialNode.BumpFactor ) {\n\n\t\t\tparameters.bumpScale = materialNode.BumpFactor.value;\n\n\t\t}\n\n\t\tif ( materialNode.Diffuse ) {\n\n\t\t\tparameters.color = new Color().fromArray( materialNode.Diffuse.value );\n\n\t\t} else if ( materialNode.DiffuseColor && ( materialNode.DiffuseColor.type === 'Color' || materialNode.DiffuseColor.type === 'ColorRGB' ) ) {\n\n\t\t\t// The blender exporter exports diffuse here instead of in materialNode.Diffuse\n\t\t\tparameters.color = new Color().fromArray( materialNode.DiffuseColor.value );\n\n\t\t}\n\n\t\tif ( materialNode.DisplacementFactor ) {\n\n\t\t\tparameters.displacementScale = materialNode.DisplacementFactor.value;\n\n\t\t}\n\n\t\tif ( materialNode.Emissive ) {\n\n\t\t\tparameters.emissive = new Color().fromArray( materialNode.Emissive.value );\n\n\t\t} else if ( materialNode.EmissiveColor && ( materialNode.EmissiveColor.type === 'Color' || materialNode.EmissiveColor.type === 'ColorRGB' ) ) {\n\n\t\t\t// The blender exporter exports emissive color here instead of in materialNode.Emissive\n\t\t\tparameters.emissive = new Color().fromArray( materialNode.EmissiveColor.value );\n\n\t\t}\n\n\t\tif ( materialNode.EmissiveFactor ) {\n\n\t\t\tparameters.emissiveIntensity = parseFloat( materialNode.EmissiveFactor.value );\n\n\t\t}\n\n\t\tif ( materialNode.Opacity ) {\n\n\t\t\tparameters.opacity = parseFloat( materialNode.Opacity.value );\n\n\t\t}\n\n\t\tif ( parameters.opacity < 1.0 ) {\n\n\t\t\tparameters.transparent = true;\n\n\t\t}\n\n\t\tif ( materialNode.ReflectionFactor ) {\n\n\t\t\tparameters.reflectivity = materialNode.ReflectionFactor.value;\n\n\t\t}\n\n\t\tif ( materialNode.Shininess ) {\n\n\t\t\tparameters.shininess = materialNode.Shininess.value;\n\n\t\t}\n\n\t\tif ( materialNode.Specular ) {\n\n\t\t\tparameters.specular = new Color().fromArray( materialNode.Specular.value );\n\n\t\t} else if ( materialNode.SpecularColor && materialNode.SpecularColor.type === 'Color' ) {\n\n\t\t\t// The blender exporter exports specular color here instead of in materialNode.Specular\n\t\t\tparameters.specular = new Color().fromArray( materialNode.SpecularColor.value );\n\n\t\t}\n\n\t\tconst scope = this;\n\t\tconnections.get( ID ).children.forEach( function ( child ) {\n\n\t\t\tconst type = child.relationship;\n\n\t\t\tswitch ( type ) {\n\n\t\t\t\tcase 'Bump':\n\t\t\t\t\tparameters.bumpMap = scope.getTexture( textureMap, child.ID );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'Maya|TEX_ao_map':\n\t\t\t\t\tparameters.aoMap = scope.getTexture( textureMap, child.ID );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'DiffuseColor':\n\t\t\t\tcase 'Maya|TEX_color_map':\n\t\t\t\t\tparameters.map = scope.getTexture( textureMap, child.ID );\n\t\t\t\t\tparameters.map.encoding = sRGBEncoding;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'DisplacementColor':\n\t\t\t\t\tparameters.displacementMap = scope.getTexture( textureMap, child.ID );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'EmissiveColor':\n\t\t\t\t\tparameters.emissiveMap = scope.getTexture( textureMap, child.ID );\n\t\t\t\t\tparameters.emissiveMap.encoding = sRGBEncoding;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'NormalMap':\n\t\t\t\tcase 'Maya|TEX_normal_map':\n\t\t\t\t\tparameters.normalMap = scope.getTexture( textureMap, child.ID );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'ReflectionColor':\n\t\t\t\t\tparameters.envMap = scope.getTexture( textureMap, child.ID );\n\t\t\t\t\tparameters.envMap.mapping = EquirectangularReflectionMapping;\n\t\t\t\t\tparameters.envMap.encoding = sRGBEncoding;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'SpecularColor':\n\t\t\t\t\tparameters.specularMap = scope.getTexture( textureMap, child.ID );\n\t\t\t\t\tparameters.specularMap.encoding = sRGBEncoding;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'TransparentColor':\n\t\t\t\tcase 'TransparencyFactor':\n\t\t\t\t\tparameters.alphaMap = scope.getTexture( textureMap, child.ID );\n\t\t\t\t\tparameters.transparent = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'AmbientColor':\n\t\t\t\tcase 'ShininessExponent': // AKA glossiness map\n\t\t\t\tcase 'SpecularFactor': // AKA specularLevel\n\t\t\t\tcase 'VectorDisplacementColor': // NOTE: Seems to be a copy of DisplacementColor\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.warn( 'THREE.FBXLoader: %s map is not supported in three.js, skipping texture.', type );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t} );\n\n\t\treturn parameters;\n\n\t}\n\n\t// get a texture from the textureMap for use by a material.\n\tgetTexture( textureMap, id ) {\n\n\t\t// if the texture is a layered texture, just use the first layer and issue a warning\n\t\tif ( 'LayeredTexture' in fbxTree.Objects && id in fbxTree.Objects.LayeredTexture ) {\n\n\t\t\tconsole.warn( 'THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer.' );\n\t\t\tid = connections.get( id ).children[ 0 ].ID;\n\n\t\t}\n\n\t\treturn textureMap.get( id );\n\n\t}\n\n\t// Parse nodes in FBXTree.Objects.Deformer\n\t// Deformer node can contain skinning or Vertex Cache animation data, however only skinning is supported here\n\t// Generates map of Skeleton-like objects for use later when generating and binding skeletons.\n\tparseDeformers() {\n\n\t\tconst skeletons = {};\n\t\tconst morphTargets = {};\n\n\t\tif ( 'Deformer' in fbxTree.Objects ) {\n\n\t\t\tconst DeformerNodes = fbxTree.Objects.Deformer;\n\n\t\t\tfor ( const nodeID in DeformerNodes ) {\n\n\t\t\t\tconst deformerNode = DeformerNodes[ nodeID ];\n\n\t\t\t\tconst relationships = connections.get( parseInt( nodeID ) );\n\n\t\t\t\tif ( deformerNode.attrType === 'Skin' ) {\n\n\t\t\t\t\tconst skeleton = this.parseSkeleton( relationships, DeformerNodes );\n\t\t\t\t\tskeleton.ID = nodeID;\n\n\t\t\t\t\tif ( relationships.parents.length > 1 ) console.warn( 'THREE.FBXLoader: skeleton attached to more than one geometry is not supported.' );\n\t\t\t\t\tskeleton.geometryID = relationships.parents[ 0 ].ID;\n\n\t\t\t\t\tskeletons[ nodeID ] = skeleton;\n\n\t\t\t\t} else if ( deformerNode.attrType === 'BlendShape' ) {\n\n\t\t\t\t\tconst morphTarget = {\n\t\t\t\t\t\tid: nodeID,\n\t\t\t\t\t};\n\n\t\t\t\t\tmorphTarget.rawTargets = this.parseMorphTargets( relationships, DeformerNodes );\n\t\t\t\t\tmorphTarget.id = nodeID;\n\n\t\t\t\t\tif ( relationships.parents.length > 1 ) console.warn( 'THREE.FBXLoader: morph target attached to more than one geometry is not supported.' );\n\n\t\t\t\t\tmorphTargets[ nodeID ] = morphTarget;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn {\n\n\t\t\tskeletons: skeletons,\n\t\t\tmorphTargets: morphTargets,\n\n\t\t};\n\n\t}\n\n\t// Parse single nodes in FBXTree.Objects.Deformer\n\t// The top level skeleton node has type 'Skin' and sub nodes have type 'Cluster'\n\t// Each skin node represents a skeleton and each cluster node represents a bone\n\tparseSkeleton( relationships, deformerNodes ) {\n\n\t\tconst rawBones = [];\n\n\t\trelationships.children.forEach( function ( child ) {\n\n\t\t\tconst boneNode = deformerNodes[ child.ID ];\n\n\t\t\tif ( boneNode.attrType !== 'Cluster' ) return;\n\n\t\t\tconst rawBone = {\n\n\t\t\t\tID: child.ID,\n\t\t\t\tindices: [],\n\t\t\t\tweights: [],\n\t\t\t\ttransformLink: new Matrix4().fromArray( boneNode.TransformLink.a ),\n\t\t\t\t// transform: new Matrix4().fromArray( boneNode.Transform.a ),\n\t\t\t\t// linkMode: boneNode.Mode,\n\n\t\t\t};\n\n\t\t\tif ( 'Indexes' in boneNode ) {\n\n\t\t\t\trawBone.indices = boneNode.Indexes.a;\n\t\t\t\trawBone.weights = boneNode.Weights.a;\n\n\t\t\t}\n\n\t\t\trawBones.push( rawBone );\n\n\t\t} );\n\n\t\treturn {\n\n\t\t\trawBones: rawBones,\n\t\t\tbones: []\n\n\t\t};\n\n\t}\n\n\t// The top level morph deformer node has type \"BlendShape\" and sub nodes have type \"BlendShapeChannel\"\n\tparseMorphTargets( relationships, deformerNodes ) {\n\n\t\tconst rawMorphTargets = [];\n\n\t\tfor ( let i = 0; i < relationships.children.length; i ++ ) {\n\n\t\t\tconst child = relationships.children[ i ];\n\n\t\t\tconst morphTargetNode = deformerNodes[ child.ID ];\n\n\t\t\tconst rawMorphTarget = {\n\n\t\t\t\tname: morphTargetNode.attrName,\n\t\t\t\tinitialWeight: morphTargetNode.DeformPercent,\n\t\t\t\tid: morphTargetNode.id,\n\t\t\t\tfullWeights: morphTargetNode.FullWeights.a\n\n\t\t\t};\n\n\t\t\tif ( morphTargetNode.attrType !== 'BlendShapeChannel' ) return;\n\n\t\t\trawMorphTarget.geoID = connections.get( parseInt( child.ID ) ).children.filter( function ( child ) {\n\n\t\t\t\treturn child.relationship === undefined;\n\n\t\t\t} )[ 0 ].ID;\n\n\t\t\trawMorphTargets.push( rawMorphTarget );\n\n\t\t}\n\n\t\treturn rawMorphTargets;\n\n\t}\n\n\t// create the main Group() to be returned by the loader\n\tparseScene( deformers, geometryMap, materialMap ) {\n\n\t\tsceneGraph = new Group();\n\n\t\tconst modelMap = this.parseModels( deformers.skeletons, geometryMap, materialMap );\n\n\t\tconst modelNodes = fbxTree.Objects.Model;\n\n\t\tconst scope = this;\n\t\tmodelMap.forEach( function ( model ) {\n\n\t\t\tconst modelNode = modelNodes[ model.ID ];\n\t\t\tscope.setLookAtProperties( model, modelNode );\n\n\t\t\tconst parentConnections = connections.get( model.ID ).parents;\n\n\t\t\tparentConnections.forEach( function ( connection ) {\n\n\t\t\t\tconst parent = modelMap.get( connection.ID );\n\t\t\t\tif ( parent !== undefined ) parent.add( model );\n\n\t\t\t} );\n\n\t\t\tif ( model.parent === null ) {\n\n\t\t\t\tsceneGraph.add( model );\n\n\t\t\t}\n\n\n\t\t} );\n\n\t\tthis.bindSkeleton( deformers.skeletons, geometryMap, modelMap );\n\n\t\tthis.createAmbientLight();\n\n\t\tthis.setupMorphMaterials();\n\n\t\tsceneGraph.traverse( function ( node ) {\n\n\t\t\tif ( node.userData.transformData ) {\n\n\t\t\t\tif ( node.parent ) {\n\n\t\t\t\t\tnode.userData.transformData.parentMatrix = node.parent.matrix;\n\t\t\t\t\tnode.userData.transformData.parentMatrixWorld = node.parent.matrixWorld;\n\n\t\t\t\t}\n\n\t\t\t\tconst transform = generateTransform( node.userData.transformData );\n\n\t\t\t\tnode.applyMatrix4( transform );\n\t\t\t\tnode.updateWorldMatrix();\n\n\t\t\t}\n\n\t\t} );\n\n\t\tconst animations = new AnimationParser().parse();\n\n\t\t// if all the models where already combined in a single group, just return that\n\t\tif ( sceneGraph.children.length === 1 && sceneGraph.children[ 0 ].isGroup ) {\n\n\t\t\tsceneGraph.children[ 0 ].animations = animations;\n\t\t\tsceneGraph = sceneGraph.children[ 0 ];\n\n\t\t}\n\n\t\tsceneGraph.animations = animations;\n\n\t}\n\n\t// parse nodes in FBXTree.Objects.Model\n\tparseModels( skeletons, geometryMap, materialMap ) {\n\n\t\tconst modelMap = new Map();\n\t\tconst modelNodes = fbxTree.Objects.Model;\n\n\t\tfor ( const nodeID in modelNodes ) {\n\n\t\t\tconst id = parseInt( nodeID );\n\t\t\tconst node = modelNodes[ nodeID ];\n\t\t\tconst relationships = connections.get( id );\n\n\t\t\tlet model = this.buildSkeleton( relationships, skeletons, id, node.attrName );\n\n\t\t\tif ( ! model ) {\n\n\t\t\t\tswitch ( node.attrType ) {\n\n\t\t\t\t\tcase 'Camera':\n\t\t\t\t\t\tmodel = this.createCamera( relationships );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'Light':\n\t\t\t\t\t\tmodel = this.createLight( relationships );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'Mesh':\n\t\t\t\t\t\tmodel = this.createMesh( relationships, geometryMap, materialMap );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'NurbsCurve':\n\t\t\t\t\t\tmodel = this.createCurve( relationships, geometryMap );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'LimbNode':\n\t\t\t\t\tcase 'Root':\n\t\t\t\t\t\tmodel = new Bone();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'Null':\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tmodel = new Group();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t\tmodel.name = node.attrName ? PropertyBinding.sanitizeNodeName( node.attrName ) : '';\n\n\t\t\t\tmodel.ID = id;\n\n\t\t\t}\n\n\t\t\tthis.getTransformData( model, node );\n\t\t\tmodelMap.set( id, model );\n\n\t\t}\n\n\t\treturn modelMap;\n\n\t}\n\n\tbuildSkeleton( relationships, skeletons, id, name ) {\n\n\t\tlet bone = null;\n\n\t\trelationships.parents.forEach( function ( parent ) {\n\n\t\t\tfor ( const ID in skeletons ) {\n\n\t\t\t\tconst skeleton = skeletons[ ID ];\n\n\t\t\t\tskeleton.rawBones.forEach( function ( rawBone, i ) {\n\n\t\t\t\t\tif ( rawBone.ID === parent.ID ) {\n\n\t\t\t\t\t\tconst subBone = bone;\n\t\t\t\t\t\tbone = new Bone();\n\n\t\t\t\t\t\tbone.matrixWorld.copy( rawBone.transformLink );\n\n\t\t\t\t\t\t// set name and id here - otherwise in cases where \"subBone\" is created it will not have a name / id\n\n\t\t\t\t\t\tbone.name = name ? PropertyBinding.sanitizeNodeName( name ) : '';\n\t\t\t\t\t\tbone.ID = id;\n\n\t\t\t\t\t\tskeleton.bones[ i ] = bone;\n\n\t\t\t\t\t\t// In cases where a bone is shared between multiple meshes\n\t\t\t\t\t\t// duplicate the bone here and and it as a child of the first bone\n\t\t\t\t\t\tif ( subBone !== null ) {\n\n\t\t\t\t\t\t\tbone.add( subBone );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t} );\n\n\t\treturn bone;\n\n\t}\n\n\t// create a PerspectiveCamera or OrthographicCamera\n\tcreateCamera( relationships ) {\n\n\t\tlet model;\n\t\tlet cameraAttribute;\n\n\t\trelationships.children.forEach( function ( child ) {\n\n\t\t\tconst attr = fbxTree.Objects.NodeAttribute[ child.ID ];\n\n\t\t\tif ( attr !== undefined ) {\n\n\t\t\t\tcameraAttribute = attr;\n\n\t\t\t}\n\n\t\t} );\n\n\t\tif ( cameraAttribute === undefined ) {\n\n\t\t\tmodel = new Object3D();\n\n\t\t} else {\n\n\t\t\tlet type = 0;\n\t\t\tif ( cameraAttribute.CameraProjectionType !== undefined && cameraAttribute.CameraProjectionType.value === 1 ) {\n\n\t\t\t\ttype = 1;\n\n\t\t\t}\n\n\t\t\tlet nearClippingPlane = 1;\n\t\t\tif ( cameraAttribute.NearPlane !== undefined ) {\n\n\t\t\t\tnearClippingPlane = cameraAttribute.NearPlane.value / 1000;\n\n\t\t\t}\n\n\t\t\tlet farClippingPlane = 1000;\n\t\t\tif ( cameraAttribute.FarPlane !== undefined ) {\n\n\t\t\t\tfarClippingPlane = cameraAttribute.FarPlane.value / 1000;\n\n\t\t\t}\n\n\n\t\t\tlet width = window.innerWidth;\n\t\t\tlet height = window.innerHeight;\n\n\t\t\tif ( cameraAttribute.AspectWidth !== undefined && cameraAttribute.AspectHeight !== undefined ) {\n\n\t\t\t\twidth = cameraAttribute.AspectWidth.value;\n\t\t\t\theight = cameraAttribute.AspectHeight.value;\n\n\t\t\t}\n\n\t\t\tconst aspect = width / height;\n\n\t\t\tlet fov = 45;\n\t\t\tif ( cameraAttribute.FieldOfView !== undefined ) {\n\n\t\t\t\tfov = cameraAttribute.FieldOfView.value;\n\n\t\t\t}\n\n\t\t\tconst focalLength = cameraAttribute.FocalLength ? cameraAttribute.FocalLength.value : null;\n\n\t\t\tswitch ( type ) {\n\n\t\t\t\tcase 0: // Perspective\n\t\t\t\t\tmodel = new PerspectiveCamera( fov, aspect, nearClippingPlane, farClippingPlane );\n\t\t\t\t\tif ( focalLength !== null ) model.setFocalLength( focalLength );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 1: // Orthographic\n\t\t\t\t\tmodel = new OrthographicCamera( - width / 2, width / 2, height / 2, - height / 2, nearClippingPlane, farClippingPlane );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.warn( 'THREE.FBXLoader: Unknown camera type ' + type + '.' );\n\t\t\t\t\tmodel = new Object3D();\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn model;\n\n\t}\n\n\t// Create a DirectionalLight, PointLight or SpotLight\n\tcreateLight( relationships ) {\n\n\t\tlet model;\n\t\tlet lightAttribute;\n\n\t\trelationships.children.forEach( function ( child ) {\n\n\t\t\tconst attr = fbxTree.Objects.NodeAttribute[ child.ID ];\n\n\t\t\tif ( attr !== undefined ) {\n\n\t\t\t\tlightAttribute = attr;\n\n\t\t\t}\n\n\t\t} );\n\n\t\tif ( lightAttribute === undefined ) {\n\n\t\t\tmodel = new Object3D();\n\n\t\t} else {\n\n\t\t\tlet type;\n\n\t\t\t// LightType can be undefined for Point lights\n\t\t\tif ( lightAttribute.LightType === undefined ) {\n\n\t\t\t\ttype = 0;\n\n\t\t\t} else {\n\n\t\t\t\ttype = lightAttribute.LightType.value;\n\n\t\t\t}\n\n\t\t\tlet color = 0xffffff;\n\n\t\t\tif ( lightAttribute.Color !== undefined ) {\n\n\t\t\t\tcolor = new Color().fromArray( lightAttribute.Color.value );\n\n\t\t\t}\n\n\t\t\tlet intensity = ( lightAttribute.Intensity === undefined ) ? 1 : lightAttribute.Intensity.value / 100;\n\n\t\t\t// light disabled\n\t\t\tif ( lightAttribute.CastLightOnObject !== undefined && lightAttribute.CastLightOnObject.value === 0 ) {\n\n\t\t\t\tintensity = 0;\n\n\t\t\t}\n\n\t\t\tlet distance = 0;\n\t\t\tif ( lightAttribute.FarAttenuationEnd !== undefined ) {\n\n\t\t\t\tif ( lightAttribute.EnableFarAttenuation !== undefined && lightAttribute.EnableFarAttenuation.value === 0 ) {\n\n\t\t\t\t\tdistance = 0;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tdistance = lightAttribute.FarAttenuationEnd.value;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// TODO: could this be calculated linearly from FarAttenuationStart to FarAttenuationEnd?\n\t\t\tconst decay = 1;\n\n\t\t\tswitch ( type ) {\n\n\t\t\t\tcase 0: // Point\n\t\t\t\t\tmodel = new PointLight( color, intensity, distance, decay );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 1: // Directional\n\t\t\t\t\tmodel = new DirectionalLight( color, intensity );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2: // Spot\n\t\t\t\t\tlet angle = Math.PI / 3;\n\n\t\t\t\t\tif ( lightAttribute.InnerAngle !== undefined ) {\n\n\t\t\t\t\t\tangle = MathUtils.degToRad( lightAttribute.InnerAngle.value );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tlet penumbra = 0;\n\t\t\t\t\tif ( lightAttribute.OuterAngle !== undefined ) {\n\n\t\t\t\t\t\t// TODO: this is not correct - FBX calculates outer and inner angle in degrees\n\t\t\t\t\t\t// with OuterAngle > InnerAngle && OuterAngle <= Math.PI\n\t\t\t\t\t\t// while three.js uses a penumbra between (0, 1) to attenuate the inner angle\n\t\t\t\t\t\tpenumbra = MathUtils.degToRad( lightAttribute.OuterAngle.value );\n\t\t\t\t\t\tpenumbra = Math.max( penumbra, 1 );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tmodel = new SpotLight( color, intensity, distance, angle, penumbra, decay );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.warn( 'THREE.FBXLoader: Unknown light type ' + lightAttribute.LightType.value + ', defaulting to a PointLight.' );\n\t\t\t\t\tmodel = new PointLight( color, intensity );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tif ( lightAttribute.CastShadows !== undefined && lightAttribute.CastShadows.value === 1 ) {\n\n\t\t\t\tmodel.castShadow = true;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn model;\n\n\t}\n\n\tcreateMesh( relationships, geometryMap, materialMap ) {\n\n\t\tlet model;\n\t\tlet geometry = null;\n\t\tlet material = null;\n\t\tconst materials = [];\n\n\t\t// get geometry and materials(s) from connections\n\t\trelationships.children.forEach( function ( child ) {\n\n\t\t\tif ( geometryMap.has( child.ID ) ) {\n\n\t\t\t\tgeometry = geometryMap.get( child.ID );\n\n\t\t\t}\n\n\t\t\tif ( materialMap.has( child.ID ) ) {\n\n\t\t\t\tmaterials.push( materialMap.get( child.ID ) );\n\n\t\t\t}\n\n\t\t} );\n\n\t\tif ( materials.length > 1 ) {\n\n\t\t\tmaterial = materials;\n\n\t\t} else if ( materials.length > 0 ) {\n\n\t\t\tmaterial = materials[ 0 ];\n\n\t\t} else {\n\n\t\t\tmaterial = new MeshPhongMaterial( { color: 0xcccccc } );\n\t\t\tmaterials.push( material );\n\n\t\t}\n\n\t\tif ( 'color' in geometry.attributes ) {\n\n\t\t\tmaterials.forEach( function ( material ) {\n\n\t\t\t\tmaterial.vertexColors = true;\n\n\t\t\t} );\n\n\t\t}\n\n\t\tif ( geometry.FBX_Deformer ) {\n\n\t\t\tmodel = new SkinnedMesh( geometry, material );\n\t\t\tmodel.normalizeSkinWeights();\n\n\t\t} else {\n\n\t\t\tmodel = new Mesh( geometry, material );\n\n\t\t}\n\n\t\treturn model;\n\n\t}\n\n\tcreateCurve( relationships, geometryMap ) {\n\n\t\tconst geometry = relationships.children.reduce( function ( geo, child ) {\n\n\t\t\tif ( geometryMap.has( child.ID ) ) geo = geometryMap.get( child.ID );\n\n\t\t\treturn geo;\n\n\t\t}, null );\n\n\t\t// FBX does not list materials for Nurbs lines, so we'll just put our own in here.\n\t\tconst material = new LineBasicMaterial( { color: 0x3300ff, linewidth: 1 } );\n\t\treturn new Line( geometry, material );\n\n\t}\n\n\t// parse the model node for transform data\n\tgetTransformData( model, modelNode ) {\n\n\t\tconst transformData = {};\n\n\t\tif ( 'InheritType' in modelNode ) transformData.inheritType = parseInt( modelNode.InheritType.value );\n\n\t\tif ( 'RotationOrder' in modelNode ) transformData.eulerOrder = getEulerOrder( modelNode.RotationOrder.value );\n\t\telse transformData.eulerOrder = 'ZYX';\n\n\t\tif ( 'Lcl_Translation' in modelNode ) transformData.translation = modelNode.Lcl_Translation.value;\n\n\t\tif ( 'PreRotation' in modelNode ) transformData.preRotation = modelNode.PreRotation.value;\n\t\tif ( 'Lcl_Rotation' in modelNode ) transformData.rotation = modelNode.Lcl_Rotation.value;\n\t\tif ( 'PostRotation' in modelNode ) transformData.postRotation = modelNode.PostRotation.value;\n\n\t\tif ( 'Lcl_Scaling' in modelNode ) transformData.scale = modelNode.Lcl_Scaling.value;\n\n\t\tif ( 'ScalingOffset' in modelNode ) transformData.scalingOffset = modelNode.ScalingOffset.value;\n\t\tif ( 'ScalingPivot' in modelNode ) transformData.scalingPivot = modelNode.ScalingPivot.value;\n\n\t\tif ( 'RotationOffset' in modelNode ) transformData.rotationOffset = modelNode.RotationOffset.value;\n\t\tif ( 'RotationPivot' in modelNode ) transformData.rotationPivot = modelNode.RotationPivot.value;\n\n\t\tmodel.userData.transformData = transformData;\n\n\t}\n\n\tsetLookAtProperties( model, modelNode ) {\n\n\t\tif ( 'LookAtProperty' in modelNode ) {\n\n\t\t\tconst children = connections.get( model.ID ).children;\n\n\t\t\tchildren.forEach( function ( child ) {\n\n\t\t\t\tif ( child.relationship === 'LookAtProperty' ) {\n\n\t\t\t\t\tconst lookAtTarget = fbxTree.Objects.Model[ child.ID ];\n\n\t\t\t\t\tif ( 'Lcl_Translation' in lookAtTarget ) {\n\n\t\t\t\t\t\tconst pos = lookAtTarget.Lcl_Translation.value;\n\n\t\t\t\t\t\t// DirectionalLight, SpotLight\n\t\t\t\t\t\tif ( model.target !== undefined ) {\n\n\t\t\t\t\t\t\tmodel.target.position.fromArray( pos );\n\t\t\t\t\t\t\tsceneGraph.add( model.target );\n\n\t\t\t\t\t\t} else { // Cameras and other Object3Ds\n\n\t\t\t\t\t\t\tmodel.lookAt( new Vector3().fromArray( pos ) );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t}\n\n\t}\n\n\tbindSkeleton( skeletons, geometryMap, modelMap ) {\n\n\t\tconst bindMatrices = this.parsePoseNodes();\n\n\t\tfor ( const ID in skeletons ) {\n\n\t\t\tconst skeleton = skeletons[ ID ];\n\n\t\t\tconst parents = connections.get( parseInt( skeleton.ID ) ).parents;\n\n\t\t\tparents.forEach( function ( parent ) {\n\n\t\t\t\tif ( geometryMap.has( parent.ID ) ) {\n\n\t\t\t\t\tconst geoID = parent.ID;\n\t\t\t\t\tconst geoRelationships = connections.get( geoID );\n\n\t\t\t\t\tgeoRelationships.parents.forEach( function ( geoConnParent ) {\n\n\t\t\t\t\t\tif ( modelMap.has( geoConnParent.ID ) ) {\n\n\t\t\t\t\t\t\tconst model = modelMap.get( geoConnParent.ID );\n\n\t\t\t\t\t\t\tmodel.bind( new Skeleton( skeleton.bones ), bindMatrices[ geoConnParent.ID ] );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t}\n\n\t}\n\n\tparsePoseNodes() {\n\n\t\tconst bindMatrices = {};\n\n\t\tif ( 'Pose' in fbxTree.Objects ) {\n\n\t\t\tconst BindPoseNode = fbxTree.Objects.Pose;\n\n\t\t\tfor ( const nodeID in BindPoseNode ) {\n\n\t\t\t\tif ( BindPoseNode[ nodeID ].attrType === 'BindPose' ) {\n\n\t\t\t\t\tconst poseNodes = BindPoseNode[ nodeID ].PoseNode;\n\n\t\t\t\t\tif ( Array.isArray( poseNodes ) ) {\n\n\t\t\t\t\t\tposeNodes.forEach( function ( poseNode ) {\n\n\t\t\t\t\t\t\tbindMatrices[ poseNode.Node ] = new Matrix4().fromArray( poseNode.Matrix.a );\n\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tbindMatrices[ poseNodes.Node ] = new Matrix4().fromArray( poseNodes.Matrix.a );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn bindMatrices;\n\n\t}\n\n\t// Parse ambient color in FBXTree.GlobalSettings - if it's not set to black (default), create an ambient light\n\tcreateAmbientLight() {\n\n\t\tif ( 'GlobalSettings' in fbxTree && 'AmbientColor' in fbxTree.GlobalSettings ) {\n\n\t\t\tconst ambientColor = fbxTree.GlobalSettings.AmbientColor.value;\n\t\t\tconst r = ambientColor[ 0 ];\n\t\t\tconst g = ambientColor[ 1 ];\n\t\t\tconst b = ambientColor[ 2 ];\n\n\t\t\tif ( r !== 0 || g !== 0 || b !== 0 ) {\n\n\t\t\t\tconst color = new Color( r, g, b );\n\t\t\t\tsceneGraph.add( new AmbientLight( color, 1 ) );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tsetupMorphMaterials() {\n\n\t\tconst scope = this;\n\t\tsceneGraph.traverse( function ( child ) {\n\n\t\t\tif ( child.isMesh ) {\n\n\t\t\t\tif ( child.geometry.morphAttributes.position && child.geometry.morphAttributes.position.length ) {\n\n\t\t\t\t\tif ( Array.isArray( child.material ) ) {\n\n\t\t\t\t\t\tchild.material.forEach( function ( material, i ) {\n\n\t\t\t\t\t\t\tscope.setupMorphMaterial( child, material, i );\n\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tscope.setupMorphMaterial( child, child.material );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} );\n\n\t}\n\n\tsetupMorphMaterial( child, material, index ) {\n\n\t\tconst uuid = child.uuid;\n\t\tconst matUuid = material.uuid;\n\n\t\t// if a geometry has morph targets, it cannot share the material with other geometries\n\t\tlet sharedMat = false;\n\n\t\tsceneGraph.traverse( function ( node ) {\n\n\t\t\tif ( node.isMesh ) {\n\n\t\t\t\tif ( Array.isArray( node.material ) ) {\n\n\t\t\t\t\tnode.material.forEach( function ( mat ) {\n\n\t\t\t\t\t\tif ( mat.uuid === matUuid && node.uuid !== uuid ) sharedMat = true;\n\n\t\t\t\t\t} );\n\n\t\t\t\t} else if ( node.material.uuid === matUuid && node.uuid !== uuid ) sharedMat = true;\n\n\t\t\t}\n\n\t\t} );\n\n\t\tif ( sharedMat === true ) {\n\n\t\t\tconst clonedMat = material.clone();\n\t\t\tclonedMat.morphTargets = true;\n\n\t\t\tif ( index === undefined ) child.material = clonedMat;\n\t\t\telse child.material[ index ] = clonedMat;\n\n\t\t} else material.morphTargets = true;\n\n\t}\n\n}\n\n// parse Geometry data from FBXTree and return map of BufferGeometries\nclass GeometryParser {\n\n\t// Parse nodes in FBXTree.Objects.Geometry\n\tparse( deformers ) {\n\n\t\tconst geometryMap = new Map();\n\n\t\tif ( 'Geometry' in fbxTree.Objects ) {\n\n\t\t\tconst geoNodes = fbxTree.Objects.Geometry;\n\n\t\t\tfor ( const nodeID in geoNodes ) {\n\n\t\t\t\tconst relationships = connections.get( parseInt( nodeID ) );\n\t\t\t\tconst geo = this.parseGeometry( relationships, geoNodes[ nodeID ], deformers );\n\n\t\t\t\tgeometryMap.set( parseInt( nodeID ), geo );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn geometryMap;\n\n\t}\n\n\t// Parse single node in FBXTree.Objects.Geometry\n\tparseGeometry( relationships, geoNode, deformers ) {\n\n\t\tswitch ( geoNode.attrType ) {\n\n\t\t\tcase 'Mesh':\n\t\t\t\treturn this.parseMeshGeometry( relationships, geoNode, deformers );\n\t\t\t\tbreak;\n\n\t\t\tcase 'NurbsCurve':\n\t\t\t\treturn this.parseNurbsGeometry( geoNode );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t}\n\n\t// Parse single node mesh geometry in FBXTree.Objects.Geometry\n\tparseMeshGeometry( relationships, geoNode, deformers ) {\n\n\t\tconst skeletons = deformers.skeletons;\n\t\tconst morphTargets = [];\n\n\t\tconst modelNodes = relationships.parents.map( function ( parent ) {\n\n\t\t\treturn fbxTree.Objects.Model[ parent.ID ];\n\n\t\t} );\n\n\t\t// don't create geometry if it is not associated with any models\n\t\tif ( modelNodes.length === 0 ) return;\n\n\t\tconst skeleton = relationships.children.reduce( function ( skeleton, child ) {\n\n\t\t\tif ( skeletons[ child.ID ] !== undefined ) skeleton = skeletons[ child.ID ];\n\n\t\t\treturn skeleton;\n\n\t\t}, null );\n\n\t\trelationships.children.forEach( function ( child ) {\n\n\t\t\tif ( deformers.morphTargets[ child.ID ] !== undefined ) {\n\n\t\t\t\tmorphTargets.push( deformers.morphTargets[ child.ID ] );\n\n\t\t\t}\n\n\t\t} );\n\n\t\t// Assume one model and get the preRotation from that\n\t\t// if there is more than one model associated with the geometry this may cause problems\n\t\tconst modelNode = modelNodes[ 0 ];\n\n\t\tconst transformData = {};\n\n\t\tif ( 'RotationOrder' in modelNode ) transformData.eulerOrder = getEulerOrder( modelNode.RotationOrder.value );\n\t\tif ( 'InheritType' in modelNode ) transformData.inheritType = parseInt( modelNode.InheritType.value );\n\n\t\tif ( 'GeometricTranslation' in modelNode ) transformData.translation = modelNode.GeometricTranslation.value;\n\t\tif ( 'GeometricRotation' in modelNode ) transformData.rotation = modelNode.GeometricRotation.value;\n\t\tif ( 'GeometricScaling' in modelNode ) transformData.scale = modelNode.GeometricScaling.value;\n\n\t\tconst transform = generateTransform( transformData );\n\n\t\treturn this.genGeometry( geoNode, skeleton, morphTargets, transform );\n\n\t}\n\n\t// Generate a BufferGeometry from a node in FBXTree.Objects.Geometry\n\tgenGeometry( geoNode, skeleton, morphTargets, preTransform ) {\n\n\t\tconst geo = new BufferGeometry();\n\t\tif ( geoNode.attrName ) geo.name = geoNode.attrName;\n\n\t\tconst geoInfo = this.parseGeoNode( geoNode, skeleton );\n\t\tconst buffers = this.genBuffers( geoInfo );\n\n\t\tconst positionAttribute = new Float32BufferAttribute( buffers.vertex, 3 );\n\n\t\tpositionAttribute.applyMatrix4( preTransform );\n\n\t\tgeo.setAttribute( 'position', positionAttribute );\n\n\t\tif ( buffers.colors.length > 0 ) {\n\n\t\t\tgeo.setAttribute( 'color', new Float32BufferAttribute( buffers.colors, 3 ) );\n\n\t\t}\n\n\t\tif ( skeleton ) {\n\n\t\t\tgeo.setAttribute( 'skinIndex', new Uint16BufferAttribute( buffers.weightsIndices, 4 ) );\n\n\t\t\tgeo.setAttribute( 'skinWeight', new Float32BufferAttribute( buffers.vertexWeights, 4 ) );\n\n\t\t\t// used later to bind the skeleton to the model\n\t\t\tgeo.FBX_Deformer = skeleton;\n\n\t\t}\n\n\t\tif ( buffers.normal.length > 0 ) {\n\n\t\t\tconst normalMatrix = new Matrix3().getNormalMatrix( preTransform );\n\n\t\t\tconst normalAttribute = new Float32BufferAttribute( buffers.normal, 3 );\n\t\t\tnormalAttribute.applyNormalMatrix( normalMatrix );\n\n\t\t\tgeo.setAttribute( 'normal', normalAttribute );\n\n\t\t}\n\n\t\tbuffers.uvs.forEach( function ( uvBuffer, i ) {\n\n\t\t\t// subsequent uv buffers are called 'uv1', 'uv2', ...\n\t\t\tlet name = 'uv' + ( i + 1 ).toString();\n\n\t\t\t// the first uv buffer is just called 'uv'\n\t\t\tif ( i === 0 ) {\n\n\t\t\t\tname = 'uv';\n\n\t\t\t}\n\n\t\t\tgeo.setAttribute( name, new Float32BufferAttribute( buffers.uvs[ i ], 2 ) );\n\n\t\t} );\n\n\t\tif ( geoInfo.material && geoInfo.material.mappingType !== 'AllSame' ) {\n\n\t\t\t// Convert the material indices of each vertex into rendering groups on the geometry.\n\t\t\tlet prevMaterialIndex = buffers.materialIndex[ 0 ];\n\t\t\tlet startIndex = 0;\n\n\t\t\tbuffers.materialIndex.forEach( function ( currentIndex, i ) {\n\n\t\t\t\tif ( currentIndex !== prevMaterialIndex ) {\n\n\t\t\t\t\tgeo.addGroup( startIndex, i - startIndex, prevMaterialIndex );\n\n\t\t\t\t\tprevMaterialIndex = currentIndex;\n\t\t\t\t\tstartIndex = i;\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t\t// the loop above doesn't add the last group, do that here.\n\t\t\tif ( geo.groups.length > 0 ) {\n\n\t\t\t\tconst lastGroup = geo.groups[ geo.groups.length - 1 ];\n\t\t\t\tconst lastIndex = lastGroup.start + lastGroup.count;\n\n\t\t\t\tif ( lastIndex !== buffers.materialIndex.length ) {\n\n\t\t\t\t\tgeo.addGroup( lastIndex, buffers.materialIndex.length - lastIndex, prevMaterialIndex );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// case where there are multiple materials but the whole geometry is only\n\t\t\t// using one of them\n\t\t\tif ( geo.groups.length === 0 ) {\n\n\t\t\t\tgeo.addGroup( 0, buffers.materialIndex.length, buffers.materialIndex[ 0 ] );\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.addMorphTargets( geo, geoNode, morphTargets, preTransform );\n\n\t\treturn geo;\n\n\t}\n\n\tparseGeoNode( geoNode, skeleton ) {\n\n\t\tconst geoInfo = {};\n\n\t\tgeoInfo.vertexPositions = ( geoNode.Vertices !== undefined ) ? geoNode.Vertices.a : [];\n\t\tgeoInfo.vertexIndices = ( geoNode.PolygonVertexIndex !== undefined ) ? geoNode.PolygonVertexIndex.a : [];\n\n\t\tif ( geoNode.LayerElementColor ) {\n\n\t\t\tgeoInfo.color = this.parseVertexColors( geoNode.LayerElementColor[ 0 ] );\n\n\t\t}\n\n\t\tif ( geoNode.LayerElementMaterial ) {\n\n\t\t\tgeoInfo.material = this.parseMaterialIndices( geoNode.LayerElementMaterial[ 0 ] );\n\n\t\t}\n\n\t\tif ( geoNode.LayerElementNormal ) {\n\n\t\t\tgeoInfo.normal = this.parseNormals( geoNode.LayerElementNormal[ 0 ] );\n\n\t\t}\n\n\t\tif ( geoNode.LayerElementUV ) {\n\n\t\t\tgeoInfo.uv = [];\n\n\t\t\tlet i = 0;\n\t\t\twhile ( geoNode.LayerElementUV[ i ] ) {\n\n\t\t\t\tif ( geoNode.LayerElementUV[ i ].UV ) {\n\n\t\t\t\t\tgeoInfo.uv.push( this.parseUVs( geoNode.LayerElementUV[ i ] ) );\n\n\t\t\t\t}\n\n\t\t\t\ti ++;\n\n\t\t\t}\n\n\t\t}\n\n\t\tgeoInfo.weightTable = {};\n\n\t\tif ( skeleton !== null ) {\n\n\t\t\tgeoInfo.skeleton = skeleton;\n\n\t\t\tskeleton.rawBones.forEach( function ( rawBone, i ) {\n\n\t\t\t\t// loop over the bone's vertex indices and weights\n\t\t\t\trawBone.indices.forEach( function ( index, j ) {\n\n\t\t\t\t\tif ( geoInfo.weightTable[ index ] === undefined ) geoInfo.weightTable[ index ] = [];\n\n\t\t\t\t\tgeoInfo.weightTable[ index ].push( {\n\n\t\t\t\t\t\tid: i,\n\t\t\t\t\t\tweight: rawBone.weights[ j ],\n\n\t\t\t\t\t} );\n\n\t\t\t\t} );\n\n\t\t\t} );\n\n\t\t}\n\n\t\treturn geoInfo;\n\n\t}\n\n\tgenBuffers( geoInfo ) {\n\n\t\tconst buffers = {\n\t\t\tvertex: [],\n\t\t\tnormal: [],\n\t\t\tcolors: [],\n\t\t\tuvs: [],\n\t\t\tmaterialIndex: [],\n\t\t\tvertexWeights: [],\n\t\t\tweightsIndices: [],\n\t\t};\n\n\t\tlet polygonIndex = 0;\n\t\tlet faceLength = 0;\n\t\tlet displayedWeightsWarning = false;\n\n\t\t// these will hold data for a single face\n\t\tlet facePositionIndexes = [];\n\t\tlet faceNormals = [];\n\t\tlet faceColors = [];\n\t\tlet faceUVs = [];\n\t\tlet faceWeights = [];\n\t\tlet faceWeightIndices = [];\n\n\t\tconst scope = this;\n\t\tgeoInfo.vertexIndices.forEach( function ( vertexIndex, polygonVertexIndex ) {\n\n\t\t\tlet materialIndex;\n\t\t\tlet endOfFace = false;\n\n\t\t\t// Face index and vertex index arrays are combined in a single array\n\t\t\t// A cube with quad faces looks like this:\n\t\t\t// PolygonVertexIndex: *24 {\n\t\t\t//  a: 0, 1, 3, -3, 2, 3, 5, -5, 4, 5, 7, -7, 6, 7, 1, -1, 1, 7, 5, -4, 6, 0, 2, -5\n\t\t\t//  }\n\t\t\t// Negative numbers mark the end of a face - first face here is 0, 1, 3, -3\n\t\t\t// to find index of last vertex bit shift the index: ^ - 1\n\t\t\tif ( vertexIndex < 0 ) {\n\n\t\t\t\tvertexIndex = vertexIndex ^ - 1; // equivalent to ( x * -1 ) - 1\n\t\t\t\tendOfFace = true;\n\n\t\t\t}\n\n\t\t\tlet weightIndices = [];\n\t\t\tlet weights = [];\n\n\t\t\tfacePositionIndexes.push( vertexIndex * 3, vertexIndex * 3 + 1, vertexIndex * 3 + 2 );\n\n\t\t\tif ( geoInfo.color ) {\n\n\t\t\t\tconst data = getData( polygonVertexIndex, polygonIndex, vertexIndex, geoInfo.color );\n\n\t\t\t\tfaceColors.push( data[ 0 ], data[ 1 ], data[ 2 ] );\n\n\t\t\t}\n\n\t\t\tif ( geoInfo.skeleton ) {\n\n\t\t\t\tif ( geoInfo.weightTable[ vertexIndex ] !== undefined ) {\n\n\t\t\t\t\tgeoInfo.weightTable[ vertexIndex ].forEach( function ( wt ) {\n\n\t\t\t\t\t\tweights.push( wt.weight );\n\t\t\t\t\t\tweightIndices.push( wt.id );\n\n\t\t\t\t\t} );\n\n\n\t\t\t\t}\n\n\t\t\t\tif ( weights.length > 4 ) {\n\n\t\t\t\t\tif ( ! displayedWeightsWarning ) {\n\n\t\t\t\t\t\tconsole.warn( 'THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights.' );\n\t\t\t\t\t\tdisplayedWeightsWarning = true;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tconst wIndex = [ 0, 0, 0, 0 ];\n\t\t\t\t\tconst Weight = [ 0, 0, 0, 0 ];\n\n\t\t\t\t\tweights.forEach( function ( weight, weightIndex ) {\n\n\t\t\t\t\t\tlet currentWeight = weight;\n\t\t\t\t\t\tlet currentIndex = weightIndices[ weightIndex ];\n\n\t\t\t\t\t\tWeight.forEach( function ( comparedWeight, comparedWeightIndex, comparedWeightArray ) {\n\n\t\t\t\t\t\t\tif ( currentWeight > comparedWeight ) {\n\n\t\t\t\t\t\t\t\tcomparedWeightArray[ comparedWeightIndex ] = currentWeight;\n\t\t\t\t\t\t\t\tcurrentWeight = comparedWeight;\n\n\t\t\t\t\t\t\t\tconst tmp = wIndex[ comparedWeightIndex ];\n\t\t\t\t\t\t\t\twIndex[ comparedWeightIndex ] = currentIndex;\n\t\t\t\t\t\t\t\tcurrentIndex = tmp;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t} );\n\n\t\t\t\t\tweightIndices = wIndex;\n\t\t\t\t\tweights = Weight;\n\n\t\t\t\t}\n\n\t\t\t\t// if the weight array is shorter than 4 pad with 0s\n\t\t\t\twhile ( weights.length < 4 ) {\n\n\t\t\t\t\tweights.push( 0 );\n\t\t\t\t\tweightIndices.push( 0 );\n\n\t\t\t\t}\n\n\t\t\t\tfor ( let i = 0; i < 4; ++ i ) {\n\n\t\t\t\t\tfaceWeights.push( weights[ i ] );\n\t\t\t\t\tfaceWeightIndices.push( weightIndices[ i ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( geoInfo.normal ) {\n\n\t\t\t\tconst data = getData( polygonVertexIndex, polygonIndex, vertexIndex, geoInfo.normal );\n\n\t\t\t\tfaceNormals.push( data[ 0 ], data[ 1 ], data[ 2 ] );\n\n\t\t\t}\n\n\t\t\tif ( geoInfo.material && geoInfo.material.mappingType !== 'AllSame' ) {\n\n\t\t\t\tmaterialIndex = getData( polygonVertexIndex, polygonIndex, vertexIndex, geoInfo.material )[ 0 ];\n\n\t\t\t}\n\n\t\t\tif ( geoInfo.uv ) {\n\n\t\t\t\tgeoInfo.uv.forEach( function ( uv, i ) {\n\n\t\t\t\t\tconst data = getData( polygonVertexIndex, polygonIndex, vertexIndex, uv );\n\n\t\t\t\t\tif ( faceUVs[ i ] === undefined ) {\n\n\t\t\t\t\t\tfaceUVs[ i ] = [];\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfaceUVs[ i ].push( data[ 0 ] );\n\t\t\t\t\tfaceUVs[ i ].push( data[ 1 ] );\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\tfaceLength ++;\n\n\t\t\tif ( endOfFace ) {\n\n\t\t\t\tscope.genFace( buffers, geoInfo, facePositionIndexes, materialIndex, faceNormals, faceColors, faceUVs, faceWeights, faceWeightIndices, faceLength );\n\n\t\t\t\tpolygonIndex ++;\n\t\t\t\tfaceLength = 0;\n\n\t\t\t\t// reset arrays for the next face\n\t\t\t\tfacePositionIndexes = [];\n\t\t\t\tfaceNormals = [];\n\t\t\t\tfaceColors = [];\n\t\t\t\tfaceUVs = [];\n\t\t\t\tfaceWeights = [];\n\t\t\t\tfaceWeightIndices = [];\n\n\t\t\t}\n\n\t\t} );\n\n\t\treturn buffers;\n\n\t}\n\n\t// Generate data for a single face in a geometry. If the face is a quad then split it into 2 tris\n\tgenFace( buffers, geoInfo, facePositionIndexes, materialIndex, faceNormals, faceColors, faceUVs, faceWeights, faceWeightIndices, faceLength ) {\n\n\t\tfor ( let i = 2; i < faceLength; i ++ ) {\n\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ 0 ] ] );\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ 1 ] ] );\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ 2 ] ] );\n\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ ( i - 1 ) * 3 ] ] );\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ ( i - 1 ) * 3 + 1 ] ] );\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ ( i - 1 ) * 3 + 2 ] ] );\n\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ i * 3 ] ] );\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ i * 3 + 1 ] ] );\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ i * 3 + 2 ] ] );\n\n\t\t\tif ( geoInfo.skeleton ) {\n\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ 0 ] );\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ 1 ] );\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ 2 ] );\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ 3 ] );\n\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ ( i - 1 ) * 4 ] );\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ ( i - 1 ) * 4 + 1 ] );\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ ( i - 1 ) * 4 + 2 ] );\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ ( i - 1 ) * 4 + 3 ] );\n\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ i * 4 ] );\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ i * 4 + 1 ] );\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ i * 4 + 2 ] );\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ i * 4 + 3 ] );\n\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ 0 ] );\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ 1 ] );\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ 2 ] );\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ 3 ] );\n\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ ( i - 1 ) * 4 ] );\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ ( i - 1 ) * 4 + 1 ] );\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ ( i - 1 ) * 4 + 2 ] );\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ ( i - 1 ) * 4 + 3 ] );\n\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ i * 4 ] );\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ i * 4 + 1 ] );\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ i * 4 + 2 ] );\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ i * 4 + 3 ] );\n\n\t\t\t}\n\n\t\t\tif ( geoInfo.color ) {\n\n\t\t\t\tbuffers.colors.push( faceColors[ 0 ] );\n\t\t\t\tbuffers.colors.push( faceColors[ 1 ] );\n\t\t\t\tbuffers.colors.push( faceColors[ 2 ] );\n\n\t\t\t\tbuffers.colors.push( faceColors[ ( i - 1 ) * 3 ] );\n\t\t\t\tbuffers.colors.push( faceColors[ ( i - 1 ) * 3 + 1 ] );\n\t\t\t\tbuffers.colors.push( faceColors[ ( i - 1 ) * 3 + 2 ] );\n\n\t\t\t\tbuffers.colors.push( faceColors[ i * 3 ] );\n\t\t\t\tbuffers.colors.push( faceColors[ i * 3 + 1 ] );\n\t\t\t\tbuffers.colors.push( faceColors[ i * 3 + 2 ] );\n\n\t\t\t}\n\n\t\t\tif ( geoInfo.material && geoInfo.material.mappingType !== 'AllSame' ) {\n\n\t\t\t\tbuffers.materialIndex.push( materialIndex );\n\t\t\t\tbuffers.materialIndex.push( materialIndex );\n\t\t\t\tbuffers.materialIndex.push( materialIndex );\n\n\t\t\t}\n\n\t\t\tif ( geoInfo.normal ) {\n\n\t\t\t\tbuffers.normal.push( faceNormals[ 0 ] );\n\t\t\t\tbuffers.normal.push( faceNormals[ 1 ] );\n\t\t\t\tbuffers.normal.push( faceNormals[ 2 ] );\n\n\t\t\t\tbuffers.normal.push( faceNormals[ ( i - 1 ) * 3 ] );\n\t\t\t\tbuffers.normal.push( faceNormals[ ( i - 1 ) * 3 + 1 ] );\n\t\t\t\tbuffers.normal.push( faceNormals[ ( i - 1 ) * 3 + 2 ] );\n\n\t\t\t\tbuffers.normal.push( faceNormals[ i * 3 ] );\n\t\t\t\tbuffers.normal.push( faceNormals[ i * 3 + 1 ] );\n\t\t\t\tbuffers.normal.push( faceNormals[ i * 3 + 2 ] );\n\n\t\t\t}\n\n\t\t\tif ( geoInfo.uv ) {\n\n\t\t\t\tgeoInfo.uv.forEach( function ( uv, j ) {\n\n\t\t\t\t\tif ( buffers.uvs[ j ] === undefined ) buffers.uvs[ j ] = [];\n\n\t\t\t\t\tbuffers.uvs[ j ].push( faceUVs[ j ][ 0 ] );\n\t\t\t\t\tbuffers.uvs[ j ].push( faceUVs[ j ][ 1 ] );\n\n\t\t\t\t\tbuffers.uvs[ j ].push( faceUVs[ j ][ ( i - 1 ) * 2 ] );\n\t\t\t\t\tbuffers.uvs[ j ].push( faceUVs[ j ][ ( i - 1 ) * 2 + 1 ] );\n\n\t\t\t\t\tbuffers.uvs[ j ].push( faceUVs[ j ][ i * 2 ] );\n\t\t\t\t\tbuffers.uvs[ j ].push( faceUVs[ j ][ i * 2 + 1 ] );\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\taddMorphTargets( parentGeo, parentGeoNode, morphTargets, preTransform ) {\n\n\t\tif ( morphTargets.length === 0 ) return;\n\n\t\tparentGeo.morphTargetsRelative = true;\n\n\t\tparentGeo.morphAttributes.position = [];\n\t\t// parentGeo.morphAttributes.normal = []; // not implemented\n\n\t\tconst scope = this;\n\t\tmorphTargets.forEach( function ( morphTarget ) {\n\n\t\t\tmorphTarget.rawTargets.forEach( function ( rawTarget ) {\n\n\t\t\t\tconst morphGeoNode = fbxTree.Objects.Geometry[ rawTarget.geoID ];\n\n\t\t\t\tif ( morphGeoNode !== undefined ) {\n\n\t\t\t\t\tscope.genMorphGeometry( parentGeo, parentGeoNode, morphGeoNode, preTransform, rawTarget.name );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t} );\n\n\t}\n\n\t// a morph geometry node is similar to a standard  node, and the node is also contained\n\t// in FBXTree.Objects.Geometry, however it can only have attributes for position, normal\n\t// and a special attribute Index defining which vertices of the original geometry are affected\n\t// Normal and position attributes only have data for the vertices that are affected by the morph\n\tgenMorphGeometry( parentGeo, parentGeoNode, morphGeoNode, preTransform, name ) {\n\n\t\tconst vertexIndices = ( parentGeoNode.PolygonVertexIndex !== undefined ) ? parentGeoNode.PolygonVertexIndex.a : [];\n\n\t\tconst morphPositionsSparse = ( morphGeoNode.Vertices !== undefined ) ? morphGeoNode.Vertices.a : [];\n\t\tconst indices = ( morphGeoNode.Indexes !== undefined ) ? morphGeoNode.Indexes.a : [];\n\n\t\tconst length = parentGeo.attributes.position.count * 3;\n\t\tconst morphPositions = new Float32Array( length );\n\n\t\tfor ( let i = 0; i < indices.length; i ++ ) {\n\n\t\t\tconst morphIndex = indices[ i ] * 3;\n\n\t\t\tmorphPositions[ morphIndex ] = morphPositionsSparse[ i * 3 ];\n\t\t\tmorphPositions[ morphIndex + 1 ] = morphPositionsSparse[ i * 3 + 1 ];\n\t\t\tmorphPositions[ morphIndex + 2 ] = morphPositionsSparse[ i * 3 + 2 ];\n\n\t\t}\n\n\t\t// TODO: add morph normal support\n\t\tconst morphGeoInfo = {\n\t\t\tvertexIndices: vertexIndices,\n\t\t\tvertexPositions: morphPositions,\n\n\t\t};\n\n\t\tconst morphBuffers = this.genBuffers( morphGeoInfo );\n\n\t\tconst positionAttribute = new Float32BufferAttribute( morphBuffers.vertex, 3 );\n\t\tpositionAttribute.name = name || morphGeoNode.attrName;\n\n\t\tpositionAttribute.applyMatrix4( preTransform );\n\n\t\tparentGeo.morphAttributes.position.push( positionAttribute );\n\n\t}\n\n\t// Parse normal from FBXTree.Objects.Geometry.LayerElementNormal if it exists\n\tparseNormals( NormalNode ) {\n\n\t\tconst mappingType = NormalNode.MappingInformationType;\n\t\tconst referenceType = NormalNode.ReferenceInformationType;\n\t\tconst buffer = NormalNode.Normals.a;\n\t\tlet indexBuffer = [];\n\t\tif ( referenceType === 'IndexToDirect' ) {\n\n\t\t\tif ( 'NormalIndex' in NormalNode ) {\n\n\t\t\t\tindexBuffer = NormalNode.NormalIndex.a;\n\n\t\t\t} else if ( 'NormalsIndex' in NormalNode ) {\n\n\t\t\t\tindexBuffer = NormalNode.NormalsIndex.a;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn {\n\t\t\tdataSize: 3,\n\t\t\tbuffer: buffer,\n\t\t\tindices: indexBuffer,\n\t\t\tmappingType: mappingType,\n\t\t\treferenceType: referenceType\n\t\t};\n\n\t}\n\n\t// Parse UVs from FBXTree.Objects.Geometry.LayerElementUV if it exists\n\tparseUVs( UVNode ) {\n\n\t\tconst mappingType = UVNode.MappingInformationType;\n\t\tconst referenceType = UVNode.ReferenceInformationType;\n\t\tconst buffer = UVNode.UV.a;\n\t\tlet indexBuffer = [];\n\t\tif ( referenceType === 'IndexToDirect' ) {\n\n\t\t\tindexBuffer = UVNode.UVIndex.a;\n\n\t\t}\n\n\t\treturn {\n\t\t\tdataSize: 2,\n\t\t\tbuffer: buffer,\n\t\t\tindices: indexBuffer,\n\t\t\tmappingType: mappingType,\n\t\t\treferenceType: referenceType\n\t\t};\n\n\t}\n\n\t// Parse Vertex Colors from FBXTree.Objects.Geometry.LayerElementColor if it exists\n\tparseVertexColors( ColorNode ) {\n\n\t\tconst mappingType = ColorNode.MappingInformationType;\n\t\tconst referenceType = ColorNode.ReferenceInformationType;\n\t\tconst buffer = ColorNode.Colors.a;\n\t\tlet indexBuffer = [];\n\t\tif ( referenceType === 'IndexToDirect' ) {\n\n\t\t\tindexBuffer = ColorNode.ColorIndex.a;\n\n\t\t}\n\n\t\treturn {\n\t\t\tdataSize: 4,\n\t\t\tbuffer: buffer,\n\t\t\tindices: indexBuffer,\n\t\t\tmappingType: mappingType,\n\t\t\treferenceType: referenceType\n\t\t};\n\n\t}\n\n\t// Parse mapping and material data in FBXTree.Objects.Geometry.LayerElementMaterial if it exists\n\tparseMaterialIndices( MaterialNode ) {\n\n\t\tconst mappingType = MaterialNode.MappingInformationType;\n\t\tconst referenceType = MaterialNode.ReferenceInformationType;\n\n\t\tif ( mappingType === 'NoMappingInformation' ) {\n\n\t\t\treturn {\n\t\t\t\tdataSize: 1,\n\t\t\t\tbuffer: [ 0 ],\n\t\t\t\tindices: [ 0 ],\n\t\t\t\tmappingType: 'AllSame',\n\t\t\t\treferenceType: referenceType\n\t\t\t};\n\n\t\t}\n\n\t\tconst materialIndexBuffer = MaterialNode.Materials.a;\n\n\t\t// Since materials are stored as indices, there's a bit of a mismatch between FBX and what\n\t\t// we expect.So we create an intermediate buffer that points to the index in the buffer,\n\t\t// for conforming with the other functions we've written for other data.\n\t\tconst materialIndices = [];\n\n\t\tfor ( let i = 0; i < materialIndexBuffer.length; ++ i ) {\n\n\t\t\tmaterialIndices.push( i );\n\n\t\t}\n\n\t\treturn {\n\t\t\tdataSize: 1,\n\t\t\tbuffer: materialIndexBuffer,\n\t\t\tindices: materialIndices,\n\t\t\tmappingType: mappingType,\n\t\t\treferenceType: referenceType\n\t\t};\n\n\t}\n\n\t// Generate a NurbGeometry from a node in FBXTree.Objects.Geometry\n\tparseNurbsGeometry( geoNode ) {\n\n\t\tif ( NURBSCurve === undefined ) {\n\n\t\t\tconsole.error( 'THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry.' );\n\t\t\treturn new BufferGeometry();\n\n\t\t}\n\n\t\tconst order = parseInt( geoNode.Order );\n\n\t\tif ( isNaN( order ) ) {\n\n\t\t\tconsole.error( 'THREE.FBXLoader: Invalid Order %s given for geometry ID: %s', geoNode.Order, geoNode.id );\n\t\t\treturn new BufferGeometry();\n\n\t\t}\n\n\t\tconst degree = order - 1;\n\n\t\tconst knots = geoNode.KnotVector.a;\n\t\tconst controlPoints = [];\n\t\tconst pointsValues = geoNode.Points.a;\n\n\t\tfor ( let i = 0, l = pointsValues.length; i < l; i += 4 ) {\n\n\t\t\tcontrolPoints.push( new Vector4().fromArray( pointsValues, i ) );\n\n\t\t}\n\n\t\tlet startKnot, endKnot;\n\n\t\tif ( geoNode.Form === 'Closed' ) {\n\n\t\t\tcontrolPoints.push( controlPoints[ 0 ] );\n\n\t\t} else if ( geoNode.Form === 'Periodic' ) {\n\n\t\t\tstartKnot = degree;\n\t\t\tendKnot = knots.length - 1 - startKnot;\n\n\t\t\tfor ( let i = 0; i < degree; ++ i ) {\n\n\t\t\t\tcontrolPoints.push( controlPoints[ i ] );\n\n\t\t\t}\n\n\t\t}\n\n\t\tconst curve = new NURBSCurve( degree, knots, controlPoints, startKnot, endKnot );\n\t\tconst vertices = curve.getPoints( controlPoints.length * 7 );\n\n\t\tconst positions = new Float32Array( vertices.length * 3 );\n\n\t\tvertices.forEach( function ( vertex, i ) {\n\n\t\t\tvertex.toArray( positions, i * 3 );\n\n\t\t} );\n\n\t\tconst geometry = new BufferGeometry();\n\t\tgeometry.setAttribute( 'position', new BufferAttribute( positions, 3 ) );\n\n\t\treturn geometry;\n\n\t}\n\n}\n\n// parse animation data from FBXTree\nclass AnimationParser {\n\n\t// take raw animation clips and turn them into three.js animation clips\n\tparse() {\n\n\t\tconst animationClips = [];\n\n\t\tconst rawClips = this.parseClips();\n\n\t\tif ( rawClips !== undefined ) {\n\n\t\t\tfor ( const key in rawClips ) {\n\n\t\t\t\tconst rawClip = rawClips[ key ];\n\n\t\t\t\tconst clip = this.addClip( rawClip );\n\n\t\t\t\tanimationClips.push( clip );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn animationClips;\n\n\t}\n\n\tparseClips() {\n\n\t\t// since the actual transformation data is stored in FBXTree.Objects.AnimationCurve,\n\t\t// if this is undefined we can safely assume there are no animations\n\t\tif ( fbxTree.Objects.AnimationCurve === undefined ) return undefined;\n\n\t\tconst curveNodesMap = this.parseAnimationCurveNodes();\n\n\t\tthis.parseAnimationCurves( curveNodesMap );\n\n\t\tconst layersMap = this.parseAnimationLayers( curveNodesMap );\n\t\tconst rawClips = this.parseAnimStacks( layersMap );\n\n\t\treturn rawClips;\n\n\t}\n\n\t// parse nodes in FBXTree.Objects.AnimationCurveNode\n\t// each AnimationCurveNode holds data for an animation transform for a model (e.g. left arm rotation )\n\t// and is referenced by an AnimationLayer\n\tparseAnimationCurveNodes() {\n\n\t\tconst rawCurveNodes = fbxTree.Objects.AnimationCurveNode;\n\n\t\tconst curveNodesMap = new Map();\n\n\t\tfor ( const nodeID in rawCurveNodes ) {\n\n\t\t\tconst rawCurveNode = rawCurveNodes[ nodeID ];\n\n\t\t\tif ( rawCurveNode.attrName.match( /S|R|T|DeformPercent/ ) !== null ) {\n\n\t\t\t\tconst curveNode = {\n\n\t\t\t\t\tid: rawCurveNode.id,\n\t\t\t\t\tattr: rawCurveNode.attrName,\n\t\t\t\t\tcurves: {},\n\n\t\t\t\t};\n\n\t\t\t\tcurveNodesMap.set( curveNode.id, curveNode );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn curveNodesMap;\n\n\t}\n\n\t// parse nodes in FBXTree.Objects.AnimationCurve and connect them up to\n\t// previously parsed AnimationCurveNodes. Each AnimationCurve holds data for a single animated\n\t// axis ( e.g. times and values of x rotation)\n\tparseAnimationCurves( curveNodesMap ) {\n\n\t\tconst rawCurves = fbxTree.Objects.AnimationCurve;\n\n\t\t// TODO: Many values are identical up to roundoff error, but won't be optimised\n\t\t// e.g. position times: [0, 0.4, 0. 8]\n\t\t// position values: [7.23538335023477e-7, 93.67518615722656, -0.9982695579528809, 7.23538335023477e-7, 93.67518615722656, -0.9982695579528809, 7.235384487103147e-7, 93.67520904541016, -0.9982695579528809]\n\t\t// clearly, this should be optimised to\n\t\t// times: [0], positions [7.23538335023477e-7, 93.67518615722656, -0.9982695579528809]\n\t\t// this shows up in nearly every FBX file, and generally time array is length > 100\n\n\t\tfor ( const nodeID in rawCurves ) {\n\n\t\t\tconst animationCurve = {\n\n\t\t\t\tid: rawCurves[ nodeID ].id,\n\t\t\t\ttimes: rawCurves[ nodeID ].KeyTime.a.map( convertFBXTimeToSeconds ),\n\t\t\t\tvalues: rawCurves[ nodeID ].KeyValueFloat.a,\n\n\t\t\t};\n\n\t\t\tconst relationships = connections.get( animationCurve.id );\n\n\t\t\tif ( relationships !== undefined ) {\n\n\t\t\t\tconst animationCurveID = relationships.parents[ 0 ].ID;\n\t\t\t\tconst animationCurveRelationship = relationships.parents[ 0 ].relationship;\n\n\t\t\t\tif ( animationCurveRelationship.match( /X/ ) ) {\n\n\t\t\t\t\tcurveNodesMap.get( animationCurveID ).curves[ 'x' ] = animationCurve;\n\n\t\t\t\t} else if ( animationCurveRelationship.match( /Y/ ) ) {\n\n\t\t\t\t\tcurveNodesMap.get( animationCurveID ).curves[ 'y' ] = animationCurve;\n\n\t\t\t\t} else if ( animationCurveRelationship.match( /Z/ ) ) {\n\n\t\t\t\t\tcurveNodesMap.get( animationCurveID ).curves[ 'z' ] = animationCurve;\n\n\t\t\t\t} else if ( animationCurveRelationship.match( /d|DeformPercent/ ) && curveNodesMap.has( animationCurveID ) ) {\n\n\t\t\t\t\tcurveNodesMap.get( animationCurveID ).curves[ 'morph' ] = animationCurve;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t// parse nodes in FBXTree.Objects.AnimationLayer. Each layers holds references\n\t// to various AnimationCurveNodes and is referenced by an AnimationStack node\n\t// note: theoretically a stack can have multiple layers, however in practice there always seems to be one per stack\n\tparseAnimationLayers( curveNodesMap ) {\n\n\t\tconst rawLayers = fbxTree.Objects.AnimationLayer;\n\n\t\tconst layersMap = new Map();\n\n\t\tfor ( const nodeID in rawLayers ) {\n\n\t\t\tconst layerCurveNodes = [];\n\n\t\t\tconst connection = connections.get( parseInt( nodeID ) );\n\n\t\t\tif ( connection !== undefined ) {\n\n\t\t\t\t// all the animationCurveNodes used in the layer\n\t\t\t\tconst children = connection.children;\n\n\t\t\t\tchildren.forEach( function ( child, i ) {\n\n\t\t\t\t\tif ( curveNodesMap.has( child.ID ) ) {\n\n\t\t\t\t\t\tconst curveNode = curveNodesMap.get( child.ID );\n\n\t\t\t\t\t\t// check that the curves are defined for at least one axis, otherwise ignore the curveNode\n\t\t\t\t\t\tif ( curveNode.curves.x !== undefined || curveNode.curves.y !== undefined || curveNode.curves.z !== undefined ) {\n\n\t\t\t\t\t\t\tif ( layerCurveNodes[ i ] === undefined ) {\n\n\t\t\t\t\t\t\t\tconst modelID = connections.get( child.ID ).parents.filter( function ( parent ) {\n\n\t\t\t\t\t\t\t\t\treturn parent.relationship !== undefined;\n\n\t\t\t\t\t\t\t\t} )[ 0 ].ID;\n\n\t\t\t\t\t\t\t\tif ( modelID !== undefined ) {\n\n\t\t\t\t\t\t\t\t\tconst rawModel = fbxTree.Objects.Model[ modelID.toString() ];\n\n\t\t\t\t\t\t\t\t\tif ( rawModel === undefined ) {\n\n\t\t\t\t\t\t\t\t\t\tconsole.warn( 'THREE.FBXLoader: Encountered a unused curve.', child );\n\t\t\t\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tconst node = {\n\n\t\t\t\t\t\t\t\t\t\tmodelName: rawModel.attrName ? PropertyBinding.sanitizeNodeName( rawModel.attrName ) : '',\n\t\t\t\t\t\t\t\t\t\tID: rawModel.id,\n\t\t\t\t\t\t\t\t\t\tinitialPosition: [ 0, 0, 0 ],\n\t\t\t\t\t\t\t\t\t\tinitialRotation: [ 0, 0, 0 ],\n\t\t\t\t\t\t\t\t\t\tinitialScale: [ 1, 1, 1 ],\n\n\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\tsceneGraph.traverse( function ( child ) {\n\n\t\t\t\t\t\t\t\t\t\tif ( child.ID === rawModel.id ) {\n\n\t\t\t\t\t\t\t\t\t\t\tnode.transform = child.matrix;\n\n\t\t\t\t\t\t\t\t\t\t\tif ( child.userData.transformData ) node.eulerOrder = child.userData.transformData.eulerOrder;\n\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t\t\t\tif ( ! node.transform ) node.transform = new Matrix4();\n\n\t\t\t\t\t\t\t\t\t// if the animated model is pre rotated, we'll have to apply the pre rotations to every\n\t\t\t\t\t\t\t\t\t// animation value as well\n\t\t\t\t\t\t\t\t\tif ( 'PreRotation' in rawModel ) node.preRotation = rawModel.PreRotation.value;\n\t\t\t\t\t\t\t\t\tif ( 'PostRotation' in rawModel ) node.postRotation = rawModel.PostRotation.value;\n\n\t\t\t\t\t\t\t\t\tlayerCurveNodes[ i ] = node;\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( layerCurveNodes[ i ] ) layerCurveNodes[ i ][ curveNode.attr ] = curveNode;\n\n\t\t\t\t\t\t} else if ( curveNode.curves.morph !== undefined ) {\n\n\t\t\t\t\t\t\tif ( layerCurveNodes[ i ] === undefined ) {\n\n\t\t\t\t\t\t\t\tconst deformerID = connections.get( child.ID ).parents.filter( function ( parent ) {\n\n\t\t\t\t\t\t\t\t\treturn parent.relationship !== undefined;\n\n\t\t\t\t\t\t\t\t} )[ 0 ].ID;\n\n\t\t\t\t\t\t\t\tconst morpherID = connections.get( deformerID ).parents[ 0 ].ID;\n\t\t\t\t\t\t\t\tconst geoID = connections.get( morpherID ).parents[ 0 ].ID;\n\n\t\t\t\t\t\t\t\t// assuming geometry is not used in more than one model\n\t\t\t\t\t\t\t\tconst modelID = connections.get( geoID ).parents[ 0 ].ID;\n\n\t\t\t\t\t\t\t\tconst rawModel = fbxTree.Objects.Model[ modelID ];\n\n\t\t\t\t\t\t\t\tconst node = {\n\n\t\t\t\t\t\t\t\t\tmodelName: rawModel.attrName ? PropertyBinding.sanitizeNodeName( rawModel.attrName ) : '',\n\t\t\t\t\t\t\t\t\tmorphName: fbxTree.Objects.Deformer[ deformerID ].attrName,\n\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\tlayerCurveNodes[ i ] = node;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlayerCurveNodes[ i ][ curveNode.attr ] = curveNode;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t\tlayersMap.set( parseInt( nodeID ), layerCurveNodes );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn layersMap;\n\n\t}\n\n\t// parse nodes in FBXTree.Objects.AnimationStack. These are the top level node in the animation\n\t// hierarchy. Each Stack node will be used to create a AnimationClip\n\tparseAnimStacks( layersMap ) {\n\n\t\tconst rawStacks = fbxTree.Objects.AnimationStack;\n\n\t\t// connect the stacks (clips) up to the layers\n\t\tconst rawClips = {};\n\n\t\tfor ( const nodeID in rawStacks ) {\n\n\t\t\tconst children = connections.get( parseInt( nodeID ) ).children;\n\n\t\t\tif ( children.length > 1 ) {\n\n\t\t\t\t// it seems like stacks will always be associated with a single layer. But just in case there are files\n\t\t\t\t// where there are multiple layers per stack, we'll display a warning\n\t\t\t\tconsole.warn( 'THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.' );\n\n\t\t\t}\n\n\t\t\tconst layer = layersMap.get( children[ 0 ].ID );\n\n\t\t\trawClips[ nodeID ] = {\n\n\t\t\t\tname: rawStacks[ nodeID ].attrName,\n\t\t\t\tlayer: layer,\n\n\t\t\t};\n\n\t\t}\n\n\t\treturn rawClips;\n\n\t}\n\n\taddClip( rawClip ) {\n\n\t\tlet tracks = [];\n\n\t\tconst scope = this;\n\t\trawClip.layer.forEach( function ( rawTracks ) {\n\n\t\t\ttracks = tracks.concat( scope.generateTracks( rawTracks ) );\n\n\t\t} );\n\n\t\treturn new AnimationClip( rawClip.name, - 1, tracks );\n\n\t}\n\n\tgenerateTracks( rawTracks ) {\n\n\t\tconst tracks = [];\n\n\t\tlet initialPosition = new Vector3();\n\t\tlet initialRotation = new Quaternion();\n\t\tlet initialScale = new Vector3();\n\n\t\tif ( rawTracks.transform ) rawTracks.transform.decompose( initialPosition, initialRotation, initialScale );\n\n\t\tinitialPosition = initialPosition.toArray();\n\t\tinitialRotation = new Euler().setFromQuaternion( initialRotation, rawTracks.eulerOrder ).toArray();\n\t\tinitialScale = initialScale.toArray();\n\n\t\tif ( rawTracks.T !== undefined && Object.keys( rawTracks.T.curves ).length > 0 ) {\n\n\t\t\tconst positionTrack = this.generateVectorTrack( rawTracks.modelName, rawTracks.T.curves, initialPosition, 'position' );\n\t\t\tif ( positionTrack !== undefined ) tracks.push( positionTrack );\n\n\t\t}\n\n\t\tif ( rawTracks.R !== undefined && Object.keys( rawTracks.R.curves ).length > 0 ) {\n\n\t\t\tconst rotationTrack = this.generateRotationTrack( rawTracks.modelName, rawTracks.R.curves, initialRotation, rawTracks.preRotation, rawTracks.postRotation, rawTracks.eulerOrder );\n\t\t\tif ( rotationTrack !== undefined ) tracks.push( rotationTrack );\n\n\t\t}\n\n\t\tif ( rawTracks.S !== undefined && Object.keys( rawTracks.S.curves ).length > 0 ) {\n\n\t\t\tconst scaleTrack = this.generateVectorTrack( rawTracks.modelName, rawTracks.S.curves, initialScale, 'scale' );\n\t\t\tif ( scaleTrack !== undefined ) tracks.push( scaleTrack );\n\n\t\t}\n\n\t\tif ( rawTracks.DeformPercent !== undefined ) {\n\n\t\t\tconst morphTrack = this.generateMorphTrack( rawTracks );\n\t\t\tif ( morphTrack !== undefined ) tracks.push( morphTrack );\n\n\t\t}\n\n\t\treturn tracks;\n\n\t}\n\n\tgenerateVectorTrack( modelName, curves, initialValue, type ) {\n\n\t\tconst times = this.getTimesForAllAxes( curves );\n\t\tconst values = this.getKeyframeTrackValues( times, curves, initialValue );\n\n\t\treturn new VectorKeyframeTrack( modelName + '.' + type, times, values );\n\n\t}\n\n\tgenerateRotationTrack( modelName, curves, initialValue, preRotation, postRotation, eulerOrder ) {\n\n\t\tif ( curves.x !== undefined ) {\n\n\t\t\tthis.interpolateRotations( curves.x );\n\t\t\tcurves.x.values = curves.x.values.map( MathUtils.degToRad );\n\n\t\t}\n\n\t\tif ( curves.y !== undefined ) {\n\n\t\t\tthis.interpolateRotations( curves.y );\n\t\t\tcurves.y.values = curves.y.values.map( MathUtils.degToRad );\n\n\t\t}\n\n\t\tif ( curves.z !== undefined ) {\n\n\t\t\tthis.interpolateRotations( curves.z );\n\t\t\tcurves.z.values = curves.z.values.map( MathUtils.degToRad );\n\n\t\t}\n\n\t\tconst times = this.getTimesForAllAxes( curves );\n\t\tconst values = this.getKeyframeTrackValues( times, curves, initialValue );\n\n\t\tif ( preRotation !== undefined ) {\n\n\t\t\tpreRotation = preRotation.map( MathUtils.degToRad );\n\t\t\tpreRotation.push( eulerOrder );\n\n\t\t\tpreRotation = new Euler().fromArray( preRotation );\n\t\t\tpreRotation = new Quaternion().setFromEuler( preRotation );\n\n\t\t}\n\n\t\tif ( postRotation !== undefined ) {\n\n\t\t\tpostRotation = postRotation.map( MathUtils.degToRad );\n\t\t\tpostRotation.push( eulerOrder );\n\n\t\t\tpostRotation = new Euler().fromArray( postRotation );\n\t\t\tpostRotation = new Quaternion().setFromEuler( postRotation ).invert();\n\n\t\t}\n\n\t\tconst quaternion = new Quaternion();\n\t\tconst euler = new Euler();\n\n\t\tconst quaternionValues = [];\n\n\t\tfor ( let i = 0; i < values.length; i += 3 ) {\n\n\t\t\teuler.set( values[ i ], values[ i + 1 ], values[ i + 2 ], eulerOrder );\n\n\t\t\tquaternion.setFromEuler( euler );\n\n\t\t\tif ( preRotation !== undefined ) quaternion.premultiply( preRotation );\n\t\t\tif ( postRotation !== undefined ) quaternion.multiply( postRotation );\n\n\t\t\tquaternion.toArray( quaternionValues, ( i / 3 ) * 4 );\n\n\t\t}\n\n\t\treturn new QuaternionKeyframeTrack( modelName + '.quaternion', times, quaternionValues );\n\n\t}\n\n\tgenerateMorphTrack( rawTracks ) {\n\n\t\tconst curves = rawTracks.DeformPercent.curves.morph;\n\t\tconst values = curves.values.map( function ( val ) {\n\n\t\t\treturn val / 100;\n\n\t\t} );\n\n\t\tconst morphNum = sceneGraph.getObjectByName( rawTracks.modelName ).morphTargetDictionary[ rawTracks.morphName ];\n\n\t\treturn new NumberKeyframeTrack( rawTracks.modelName + '.morphTargetInfluences[' + morphNum + ']', curves.times, values );\n\n\t}\n\n\t// For all animated objects, times are defined separately for each axis\n\t// Here we'll combine the times into one sorted array without duplicates\n\tgetTimesForAllAxes( curves ) {\n\n\t\tlet times = [];\n\n\t\t// first join together the times for each axis, if defined\n\t\tif ( curves.x !== undefined ) times = times.concat( curves.x.times );\n\t\tif ( curves.y !== undefined ) times = times.concat( curves.y.times );\n\t\tif ( curves.z !== undefined ) times = times.concat( curves.z.times );\n\n\t\t// then sort them\n\t\ttimes = times.sort( function ( a, b ) {\n\n\t\t\treturn a - b;\n\n\t\t} );\n\n\t\t// and remove duplicates\n\t\tif ( times.length > 1 ) {\n\n\t\t\tlet targetIndex = 1;\n\t\t\tlet lastValue = times[ 0 ];\n\t\t\tfor ( let i = 1; i < times.length; i ++ ) {\n\n\t\t\t\tconst currentValue = times[ i ];\n\t\t\t\tif ( currentValue !== lastValue ) {\n\n\t\t\t\t\ttimes[ targetIndex ] = currentValue;\n\t\t\t\t\tlastValue = currentValue;\n\t\t\t\t\ttargetIndex ++;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\ttimes = times.slice( 0, targetIndex );\n\n\t\t}\n\n\t\treturn times;\n\n\t}\n\n\tgetKeyframeTrackValues( times, curves, initialValue ) {\n\n\t\tconst prevValue = initialValue;\n\n\t\tconst values = [];\n\n\t\tlet xIndex = - 1;\n\t\tlet yIndex = - 1;\n\t\tlet zIndex = - 1;\n\n\t\ttimes.forEach( function ( time ) {\n\n\t\t\tif ( curves.x ) xIndex = curves.x.times.indexOf( time );\n\t\t\tif ( curves.y ) yIndex = curves.y.times.indexOf( time );\n\t\t\tif ( curves.z ) zIndex = curves.z.times.indexOf( time );\n\n\t\t\t// if there is an x value defined for this frame, use that\n\t\t\tif ( xIndex !== - 1 ) {\n\n\t\t\t\tconst xValue = curves.x.values[ xIndex ];\n\t\t\t\tvalues.push( xValue );\n\t\t\t\tprevValue[ 0 ] = xValue;\n\n\t\t\t} else {\n\n\t\t\t\t// otherwise use the x value from the previous frame\n\t\t\t\tvalues.push( prevValue[ 0 ] );\n\n\t\t\t}\n\n\t\t\tif ( yIndex !== - 1 ) {\n\n\t\t\t\tconst yValue = curves.y.values[ yIndex ];\n\t\t\t\tvalues.push( yValue );\n\t\t\t\tprevValue[ 1 ] = yValue;\n\n\t\t\t} else {\n\n\t\t\t\tvalues.push( prevValue[ 1 ] );\n\n\t\t\t}\n\n\t\t\tif ( zIndex !== - 1 ) {\n\n\t\t\t\tconst zValue = curves.z.values[ zIndex ];\n\t\t\t\tvalues.push( zValue );\n\t\t\t\tprevValue[ 2 ] = zValue;\n\n\t\t\t} else {\n\n\t\t\t\tvalues.push( prevValue[ 2 ] );\n\n\t\t\t}\n\n\t\t} );\n\n\t\treturn values;\n\n\t}\n\n\t// Rotations are defined as Euler angles which can have values  of any size\n\t// These will be converted to quaternions which don't support values greater than\n\t// PI, so we'll interpolate large rotations\n\tinterpolateRotations( curve ) {\n\n\t\tfor ( let i = 1; i < curve.values.length; i ++ ) {\n\n\t\t\tconst initialValue = curve.values[ i - 1 ];\n\t\t\tconst valuesSpan = curve.values[ i ] - initialValue;\n\n\t\t\tconst absoluteSpan = Math.abs( valuesSpan );\n\n\t\t\tif ( absoluteSpan >= 180 ) {\n\n\t\t\t\tconst numSubIntervals = absoluteSpan / 180;\n\n\t\t\t\tconst step = valuesSpan / numSubIntervals;\n\t\t\t\tlet nextValue = initialValue + step;\n\n\t\t\t\tconst initialTime = curve.times[ i - 1 ];\n\t\t\t\tconst timeSpan = curve.times[ i ] - initialTime;\n\t\t\t\tconst interval = timeSpan / numSubIntervals;\n\t\t\t\tlet nextTime = initialTime + interval;\n\n\t\t\t\tconst interpolatedTimes = [];\n\t\t\t\tconst interpolatedValues = [];\n\n\t\t\t\twhile ( nextTime < curve.times[ i ] ) {\n\n\t\t\t\t\tinterpolatedTimes.push( nextTime );\n\t\t\t\t\tnextTime += interval;\n\n\t\t\t\t\tinterpolatedValues.push( nextValue );\n\t\t\t\t\tnextValue += step;\n\n\t\t\t\t}\n\n\t\t\t\tcurve.times = inject( curve.times, i, interpolatedTimes );\n\t\t\t\tcurve.values = inject( curve.values, i, interpolatedValues );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n}\n\n// parse an FBX file in ASCII format\nclass TextParser {\n\n\tgetPrevNode() {\n\n\t\treturn this.nodeStack[ this.currentIndent - 2 ];\n\n\t}\n\n\tgetCurrentNode() {\n\n\t\treturn this.nodeStack[ this.currentIndent - 1 ];\n\n\t}\n\n\tgetCurrentProp() {\n\n\t\treturn this.currentProp;\n\n\t}\n\n\tpushStack( node ) {\n\n\t\tthis.nodeStack.push( node );\n\t\tthis.currentIndent += 1;\n\n\t}\n\n\tpopStack() {\n\n\t\tthis.nodeStack.pop();\n\t\tthis.currentIndent -= 1;\n\n\t}\n\n\tsetCurrentProp( val, name ) {\n\n\t\tthis.currentProp = val;\n\t\tthis.currentPropName = name;\n\n\t}\n\n\tparse( text ) {\n\n\t\tthis.currentIndent = 0;\n\n\t\tthis.allNodes = new FBXTree();\n\t\tthis.nodeStack = [];\n\t\tthis.currentProp = [];\n\t\tthis.currentPropName = '';\n\n\t\tconst scope = this;\n\n\t\tconst split = text.split( /[\\r\\n]+/ );\n\n\t\tsplit.forEach( function ( line, i ) {\n\n\t\t\tconst matchComment = line.match( /^[\\s\\t]*;/ );\n\t\t\tconst matchEmpty = line.match( /^[\\s\\t]*$/ );\n\n\t\t\tif ( matchComment || matchEmpty ) return;\n\n\t\t\tconst matchBeginning = line.match( '^\\\\t{' + scope.currentIndent + '}(\\\\w+):(.*){', '' );\n\t\t\tconst matchProperty = line.match( '^\\\\t{' + ( scope.currentIndent ) + '}(\\\\w+):[\\\\s\\\\t\\\\r\\\\n](.*)' );\n\t\t\tconst matchEnd = line.match( '^\\\\t{' + ( scope.currentIndent - 1 ) + '}}' );\n\n\t\t\tif ( matchBeginning ) {\n\n\t\t\t\tscope.parseNodeBegin( line, matchBeginning );\n\n\t\t\t} else if ( matchProperty ) {\n\n\t\t\t\tscope.parseNodeProperty( line, matchProperty, split[ ++ i ] );\n\n\t\t\t} else if ( matchEnd ) {\n\n\t\t\t\tscope.popStack();\n\n\t\t\t} else if ( line.match( /^[^\\s\\t}]/ ) ) {\n\n\t\t\t\t// large arrays are split over multiple lines terminated with a ',' character\n\t\t\t\t// if this is encountered the line needs to be joined to the previous line\n\t\t\t\tscope.parseNodePropertyContinued( line );\n\n\t\t\t}\n\n\t\t} );\n\n\t\treturn this.allNodes;\n\n\t}\n\n\tparseNodeBegin( line, property ) {\n\n\t\tconst nodeName = property[ 1 ].trim().replace( /^\"/, '' ).replace( /\"$/, '' );\n\n\t\tconst nodeAttrs = property[ 2 ].split( ',' ).map( function ( attr ) {\n\n\t\t\treturn attr.trim().replace( /^\"/, '' ).replace( /\"$/, '' );\n\n\t\t} );\n\n\t\tconst node = { name: nodeName };\n\t\tconst attrs = this.parseNodeAttr( nodeAttrs );\n\n\t\tconst currentNode = this.getCurrentNode();\n\n\t\t// a top node\n\t\tif ( this.currentIndent === 0 ) {\n\n\t\t\tthis.allNodes.add( nodeName, node );\n\n\t\t} else { // a subnode\n\n\t\t\t// if the subnode already exists, append it\n\t\t\tif ( nodeName in currentNode ) {\n\n\t\t\t\t// special case Pose needs PoseNodes as an array\n\t\t\t\tif ( nodeName === 'PoseNode' ) {\n\n\t\t\t\t\tcurrentNode.PoseNode.push( node );\n\n\t\t\t\t} else if ( currentNode[ nodeName ].id !== undefined ) {\n\n\t\t\t\t\tcurrentNode[ nodeName ] = {};\n\t\t\t\t\tcurrentNode[ nodeName ][ currentNode[ nodeName ].id ] = currentNode[ nodeName ];\n\n\t\t\t\t}\n\n\t\t\t\tif ( attrs.id !== '' ) currentNode[ nodeName ][ attrs.id ] = node;\n\n\t\t\t} else if ( typeof attrs.id === 'number' ) {\n\n\t\t\t\tcurrentNode[ nodeName ] = {};\n\t\t\t\tcurrentNode[ nodeName ][ attrs.id ] = node;\n\n\t\t\t} else if ( nodeName !== 'Properties70' ) {\n\n\t\t\t\tif ( nodeName === 'PoseNode' )\tcurrentNode[ nodeName ] = [ node ];\n\t\t\t\telse currentNode[ nodeName ] = node;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( typeof attrs.id === 'number' ) node.id = attrs.id;\n\t\tif ( attrs.name !== '' ) node.attrName = attrs.name;\n\t\tif ( attrs.type !== '' ) node.attrType = attrs.type;\n\n\t\tthis.pushStack( node );\n\n\t}\n\n\tparseNodeAttr( attrs ) {\n\n\t\tlet id = attrs[ 0 ];\n\n\t\tif ( attrs[ 0 ] !== '' ) {\n\n\t\t\tid = parseInt( attrs[ 0 ] );\n\n\t\t\tif ( isNaN( id ) ) {\n\n\t\t\t\tid = attrs[ 0 ];\n\n\t\t\t}\n\n\t\t}\n\n\t\tlet name = '', type = '';\n\n\t\tif ( attrs.length > 1 ) {\n\n\t\t\tname = attrs[ 1 ].replace( /^(\\w+)::/, '' );\n\t\t\ttype = attrs[ 2 ];\n\n\t\t}\n\n\t\treturn { id: id, name: name, type: type };\n\n\t}\n\n\tparseNodeProperty( line, property, contentLine ) {\n\n\t\tlet propName = property[ 1 ].replace( /^\"/, '' ).replace( /\"$/, '' ).trim();\n\t\tlet propValue = property[ 2 ].replace( /^\"/, '' ).replace( /\"$/, '' ).trim();\n\n\t\t// for special case: base64 image data follows \"Content: ,\" line\n\t\t//\tContent: ,\n\t\t//\t \"/9j/4RDaRXhpZgAATU0A...\"\n\t\tif ( propName === 'Content' && propValue === ',' ) {\n\n\t\t\tpropValue = contentLine.replace( /\"/g, '' ).replace( /,$/, '' ).trim();\n\n\t\t}\n\n\t\tconst currentNode = this.getCurrentNode();\n\t\tconst parentName = currentNode.name;\n\n\t\tif ( parentName === 'Properties70' ) {\n\n\t\t\tthis.parseNodeSpecialProperty( line, propName, propValue );\n\t\t\treturn;\n\n\t\t}\n\n\t\t// Connections\n\t\tif ( propName === 'C' ) {\n\n\t\t\tconst connProps = propValue.split( ',' ).slice( 1 );\n\t\t\tconst from = parseInt( connProps[ 0 ] );\n\t\t\tconst to = parseInt( connProps[ 1 ] );\n\n\t\t\tlet rest = propValue.split( ',' ).slice( 3 );\n\n\t\t\trest = rest.map( function ( elem ) {\n\n\t\t\t\treturn elem.trim().replace( /^\"/, '' );\n\n\t\t\t} );\n\n\t\t\tpropName = 'connections';\n\t\t\tpropValue = [ from, to ];\n\t\t\tappend( propValue, rest );\n\n\t\t\tif ( currentNode[ propName ] === undefined ) {\n\n\t\t\t\tcurrentNode[ propName ] = [];\n\n\t\t\t}\n\n\t\t}\n\n\t\t// Node\n\t\tif ( propName === 'Node' ) currentNode.id = propValue;\n\n\t\t// connections\n\t\tif ( propName in currentNode && Array.isArray( currentNode[ propName ] ) ) {\n\n\t\t\tcurrentNode[ propName ].push( propValue );\n\n\t\t} else {\n\n\t\t\tif ( propName !== 'a' ) currentNode[ propName ] = propValue;\n\t\t\telse currentNode.a = propValue;\n\n\t\t}\n\n\t\tthis.setCurrentProp( currentNode, propName );\n\n\t\t// convert string to array, unless it ends in ',' in which case more will be added to it\n\t\tif ( propName === 'a' && propValue.slice( - 1 ) !== ',' ) {\n\n\t\t\tcurrentNode.a = parseNumberArray( propValue );\n\n\t\t}\n\n\t}\n\n\tparseNodePropertyContinued( line ) {\n\n\t\tconst currentNode = this.getCurrentNode();\n\n\t\tcurrentNode.a += line;\n\n\t\t// if the line doesn't end in ',' we have reached the end of the property value\n\t\t// so convert the string to an array\n\t\tif ( line.slice( - 1 ) !== ',' ) {\n\n\t\t\tcurrentNode.a = parseNumberArray( currentNode.a );\n\n\t\t}\n\n\t}\n\n\t// parse \"Property70\"\n\tparseNodeSpecialProperty( line, propName, propValue ) {\n\n\t\t// split this\n\t\t// P: \"Lcl Scaling\", \"Lcl Scaling\", \"\", \"A\",1,1,1\n\t\t// into array like below\n\t\t// [\"Lcl Scaling\", \"Lcl Scaling\", \"\", \"A\", \"1,1,1\" ]\n\t\tconst props = propValue.split( '\",' ).map( function ( prop ) {\n\n\t\t\treturn prop.trim().replace( /^\\\"/, '' ).replace( /\\s/, '_' );\n\n\t\t} );\n\n\t\tconst innerPropName = props[ 0 ];\n\t\tconst innerPropType1 = props[ 1 ];\n\t\tconst innerPropType2 = props[ 2 ];\n\t\tconst innerPropFlag = props[ 3 ];\n\t\tlet innerPropValue = props[ 4 ];\n\n\t\t// cast values where needed, otherwise leave as strings\n\t\tswitch ( innerPropType1 ) {\n\n\t\t\tcase 'int':\n\t\t\tcase 'enum':\n\t\t\tcase 'bool':\n\t\t\tcase 'ULongLong':\n\t\t\tcase 'double':\n\t\t\tcase 'Number':\n\t\t\tcase 'FieldOfView':\n\t\t\t\tinnerPropValue = parseFloat( innerPropValue );\n\t\t\t\tbreak;\n\n\t\t\tcase 'Color':\n\t\t\tcase 'ColorRGB':\n\t\t\tcase 'Vector3D':\n\t\t\tcase 'Lcl_Translation':\n\t\t\tcase 'Lcl_Rotation':\n\t\t\tcase 'Lcl_Scaling':\n\t\t\t\tinnerPropValue = parseNumberArray( innerPropValue );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\t// CAUTION: these props must append to parent's parent\n\t\tthis.getPrevNode()[ innerPropName ] = {\n\n\t\t\t'type': innerPropType1,\n\t\t\t'type2': innerPropType2,\n\t\t\t'flag': innerPropFlag,\n\t\t\t'value': innerPropValue\n\n\t\t};\n\n\t\tthis.setCurrentProp( this.getPrevNode(), innerPropName );\n\n\t}\n\n}\n\n// Parse an FBX file in Binary format\nclass BinaryParser {\n\n\tparse( buffer ) {\n\n\t\tconst reader = new BinaryReader( buffer );\n\t\treader.skip( 23 ); // skip magic 23 bytes\n\n\t\tconst version = reader.getUint32();\n\n\t\tif ( version < 6400 ) {\n\n\t\t\tthrow new Error( 'THREE.FBXLoader: FBX version not supported, FileVersion: ' + version );\n\n\t\t}\n\n\t\tconst allNodes = new FBXTree();\n\n\t\twhile ( ! this.endOfContent( reader ) ) {\n\n\t\t\tconst node = this.parseNode( reader, version );\n\t\t\tif ( node !== null ) allNodes.add( node.name, node );\n\n\t\t}\n\n\t\treturn allNodes;\n\n\t}\n\n\t// Check if reader has reached the end of content.\n\tendOfContent( reader ) {\n\n\t\t// footer size: 160bytes + 16-byte alignment padding\n\t\t// - 16bytes: magic\n\t\t// - padding til 16-byte alignment (at least 1byte?)\n\t\t//\t(seems like some exporters embed fixed 15 or 16bytes?)\n\t\t// - 4bytes: magic\n\t\t// - 4bytes: version\n\t\t// - 120bytes: zero\n\t\t// - 16bytes: magic\n\t\tif ( reader.size() % 16 === 0 ) {\n\n\t\t\treturn ( ( reader.getOffset() + 160 + 16 ) & ~ 0xf ) >= reader.size();\n\n\t\t} else {\n\n\t\t\treturn reader.getOffset() + 160 + 16 >= reader.size();\n\n\t\t}\n\n\t}\n\n\t// recursively parse nodes until the end of the file is reached\n\tparseNode( reader, version ) {\n\n\t\tconst node = {};\n\n\t\t// The first three data sizes depends on version.\n\t\tconst endOffset = ( version >= 7500 ) ? reader.getUint64() : reader.getUint32();\n\t\tconst numProperties = ( version >= 7500 ) ? reader.getUint64() : reader.getUint32();\n\n\t\t( version >= 7500 ) ? reader.getUint64() : reader.getUint32(); // the returned propertyListLen is not used\n\n\t\tconst nameLen = reader.getUint8();\n\t\tconst name = reader.getString( nameLen );\n\n\t\t// Regards this node as NULL-record if endOffset is zero\n\t\tif ( endOffset === 0 ) return null;\n\n\t\tconst propertyList = [];\n\n\t\tfor ( let i = 0; i < numProperties; i ++ ) {\n\n\t\t\tpropertyList.push( this.parseProperty( reader ) );\n\n\t\t}\n\n\t\t// Regards the first three elements in propertyList as id, attrName, and attrType\n\t\tconst id = propertyList.length > 0 ? propertyList[ 0 ] : '';\n\t\tconst attrName = propertyList.length > 1 ? propertyList[ 1 ] : '';\n\t\tconst attrType = propertyList.length > 2 ? propertyList[ 2 ] : '';\n\n\t\t// check if this node represents just a single property\n\t\t// like (name, 0) set or (name2, [0, 1, 2]) set of {name: 0, name2: [0, 1, 2]}\n\t\tnode.singleProperty = ( numProperties === 1 && reader.getOffset() === endOffset ) ? true : false;\n\n\t\twhile ( endOffset > reader.getOffset() ) {\n\n\t\t\tconst subNode = this.parseNode( reader, version );\n\n\t\t\tif ( subNode !== null ) this.parseSubNode( name, node, subNode );\n\n\t\t}\n\n\t\tnode.propertyList = propertyList; // raw property list used by parent\n\n\t\tif ( typeof id === 'number' ) node.id = id;\n\t\tif ( attrName !== '' ) node.attrName = attrName;\n\t\tif ( attrType !== '' ) node.attrType = attrType;\n\t\tif ( name !== '' ) node.name = name;\n\n\t\treturn node;\n\n\t}\n\n\tparseSubNode( name, node, subNode ) {\n\n\t\t// special case: child node is single property\n\t\tif ( subNode.singleProperty === true ) {\n\n\t\t\tconst value = subNode.propertyList[ 0 ];\n\n\t\t\tif ( Array.isArray( value ) ) {\n\n\t\t\t\tnode[ subNode.name ] = subNode;\n\n\t\t\t\tsubNode.a = value;\n\n\t\t\t} else {\n\n\t\t\t\tnode[ subNode.name ] = value;\n\n\t\t\t}\n\n\t\t} else if ( name === 'Connections' && subNode.name === 'C' ) {\n\n\t\t\tconst array = [];\n\n\t\t\tsubNode.propertyList.forEach( function ( property, i ) {\n\n\t\t\t\t// first Connection is FBX type (OO, OP, etc.). We'll discard these\n\t\t\t\tif ( i !== 0 ) array.push( property );\n\n\t\t\t} );\n\n\t\t\tif ( node.connections === undefined ) {\n\n\t\t\t\tnode.connections = [];\n\n\t\t\t}\n\n\t\t\tnode.connections.push( array );\n\n\t\t} else if ( subNode.name === 'Properties70' ) {\n\n\t\t\tconst keys = Object.keys( subNode );\n\n\t\t\tkeys.forEach( function ( key ) {\n\n\t\t\t\tnode[ key ] = subNode[ key ];\n\n\t\t\t} );\n\n\t\t} else if ( name === 'Properties70' && subNode.name === 'P' ) {\n\n\t\t\tlet innerPropName = subNode.propertyList[ 0 ];\n\t\t\tlet innerPropType1 = subNode.propertyList[ 1 ];\n\t\t\tconst innerPropType2 = subNode.propertyList[ 2 ];\n\t\t\tconst innerPropFlag = subNode.propertyList[ 3 ];\n\t\t\tlet innerPropValue;\n\n\t\t\tif ( innerPropName.indexOf( 'Lcl ' ) === 0 ) innerPropName = innerPropName.replace( 'Lcl ', 'Lcl_' );\n\t\t\tif ( innerPropType1.indexOf( 'Lcl ' ) === 0 ) innerPropType1 = innerPropType1.replace( 'Lcl ', 'Lcl_' );\n\n\t\t\tif ( innerPropType1 === 'Color' || innerPropType1 === 'ColorRGB' || innerPropType1 === 'Vector' || innerPropType1 === 'Vector3D' || innerPropType1.indexOf( 'Lcl_' ) === 0 ) {\n\n\t\t\t\tinnerPropValue = [\n\t\t\t\t\tsubNode.propertyList[ 4 ],\n\t\t\t\t\tsubNode.propertyList[ 5 ],\n\t\t\t\t\tsubNode.propertyList[ 6 ]\n\t\t\t\t];\n\n\t\t\t} else {\n\n\t\t\t\tinnerPropValue = subNode.propertyList[ 4 ];\n\n\t\t\t}\n\n\t\t\t// this will be copied to parent, see above\n\t\t\tnode[ innerPropName ] = {\n\n\t\t\t\t'type': innerPropType1,\n\t\t\t\t'type2': innerPropType2,\n\t\t\t\t'flag': innerPropFlag,\n\t\t\t\t'value': innerPropValue\n\n\t\t\t};\n\n\t\t} else if ( node[ subNode.name ] === undefined ) {\n\n\t\t\tif ( typeof subNode.id === 'number' ) {\n\n\t\t\t\tnode[ subNode.name ] = {};\n\t\t\t\tnode[ subNode.name ][ subNode.id ] = subNode;\n\n\t\t\t} else {\n\n\t\t\t\tnode[ subNode.name ] = subNode;\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tif ( subNode.name === 'PoseNode' ) {\n\n\t\t\t\tif ( ! Array.isArray( node[ subNode.name ] ) ) {\n\n\t\t\t\t\tnode[ subNode.name ] = [ node[ subNode.name ] ];\n\n\t\t\t\t}\n\n\t\t\t\tnode[ subNode.name ].push( subNode );\n\n\t\t\t} else if ( node[ subNode.name ][ subNode.id ] === undefined ) {\n\n\t\t\t\tnode[ subNode.name ][ subNode.id ] = subNode;\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tparseProperty( reader ) {\n\n\t\tconst type = reader.getString( 1 );\n\t\tlet length;\n\n\t\tswitch ( type ) {\n\n\t\t\tcase 'C':\n\t\t\t\treturn reader.getBoolean();\n\n\t\t\tcase 'D':\n\t\t\t\treturn reader.getFloat64();\n\n\t\t\tcase 'F':\n\t\t\t\treturn reader.getFloat32();\n\n\t\t\tcase 'I':\n\t\t\t\treturn reader.getInt32();\n\n\t\t\tcase 'L':\n\t\t\t\treturn reader.getInt64();\n\n\t\t\tcase 'R':\n\t\t\t\tlength = reader.getUint32();\n\t\t\t\treturn reader.getArrayBuffer( length );\n\n\t\t\tcase 'S':\n\t\t\t\tlength = reader.getUint32();\n\t\t\t\treturn reader.getString( length );\n\n\t\t\tcase 'Y':\n\t\t\t\treturn reader.getInt16();\n\n\t\t\tcase 'b':\n\t\t\tcase 'c':\n\t\t\tcase 'd':\n\t\t\tcase 'f':\n\t\t\tcase 'i':\n\t\t\tcase 'l':\n\n\t\t\t\tconst arrayLength = reader.getUint32();\n\t\t\t\tconst encoding = reader.getUint32(); // 0: non-compressed, 1: compressed\n\t\t\t\tconst compressedLength = reader.getUint32();\n\n\t\t\t\tif ( encoding === 0 ) {\n\n\t\t\t\t\tswitch ( type ) {\n\n\t\t\t\t\t\tcase 'b':\n\t\t\t\t\t\tcase 'c':\n\t\t\t\t\t\t\treturn reader.getBooleanArray( arrayLength );\n\n\t\t\t\t\t\tcase 'd':\n\t\t\t\t\t\t\treturn reader.getFloat64Array( arrayLength );\n\n\t\t\t\t\t\tcase 'f':\n\t\t\t\t\t\t\treturn reader.getFloat32Array( arrayLength );\n\n\t\t\t\t\t\tcase 'i':\n\t\t\t\t\t\t\treturn reader.getInt32Array( arrayLength );\n\n\t\t\t\t\t\tcase 'l':\n\t\t\t\t\t\t\treturn reader.getInt64Array( arrayLength );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( typeof fflate === 'undefined' ) {\n\n\t\t\t\t\tconsole.error( 'THREE.FBXLoader: External library fflate.min.js required.' );\n\n\t\t\t\t}\n\n\t\t\t\tconst data = fflate.unzlibSync( new Uint8Array( reader.getArrayBuffer( compressedLength ) ) ); // eslint-disable-line no-undef\n\t\t\t\tconst reader2 = new BinaryReader( data.buffer );\n\n\t\t\t\tswitch ( type ) {\n\n\t\t\t\t\tcase 'b':\n\t\t\t\t\tcase 'c':\n\t\t\t\t\t\treturn reader2.getBooleanArray( arrayLength );\n\n\t\t\t\t\tcase 'd':\n\t\t\t\t\t\treturn reader2.getFloat64Array( arrayLength );\n\n\t\t\t\t\tcase 'f':\n\t\t\t\t\t\treturn reader2.getFloat32Array( arrayLength );\n\n\t\t\t\t\tcase 'i':\n\t\t\t\t\t\treturn reader2.getInt32Array( arrayLength );\n\n\t\t\t\t\tcase 'l':\n\t\t\t\t\t\treturn reader2.getInt64Array( arrayLength );\n\n\t\t\t\t}\n\n\t\t\tdefault:\n\t\t\t\tthrow new Error( 'THREE.FBXLoader: Unknown property type ' + type );\n\n\t\t}\n\n\t}\n\n}\n\nclass BinaryReader {\n\n\tconstructor( buffer, littleEndian ) {\n\n\t\tthis.dv = new DataView( buffer );\n\t\tthis.offset = 0;\n\t\tthis.littleEndian = ( littleEndian !== undefined ) ? littleEndian : true;\n\n\t}\n\n\tgetOffset() {\n\n\t\treturn this.offset;\n\n\t}\n\n\tsize() {\n\n\t\treturn this.dv.buffer.byteLength;\n\n\t}\n\n\tskip( length ) {\n\n\t\tthis.offset += length;\n\n\t}\n\n\t// seems like true/false representation depends on exporter.\n\t// true: 1 or 'Y'(=0x59), false: 0 or 'T'(=0x54)\n\t// then sees LSB.\n\tgetBoolean() {\n\n\t\treturn ( this.getUint8() & 1 ) === 1;\n\n\t}\n\n\tgetBooleanArray( size ) {\n\n\t\tconst a = [];\n\n\t\tfor ( let i = 0; i < size; i ++ ) {\n\n\t\t\ta.push( this.getBoolean() );\n\n\t\t}\n\n\t\treturn a;\n\n\t}\n\n\tgetUint8() {\n\n\t\tconst value = this.dv.getUint8( this.offset );\n\t\tthis.offset += 1;\n\t\treturn value;\n\n\t}\n\n\tgetInt16() {\n\n\t\tconst value = this.dv.getInt16( this.offset, this.littleEndian );\n\t\tthis.offset += 2;\n\t\treturn value;\n\n\t}\n\n\tgetInt32() {\n\n\t\tconst value = this.dv.getInt32( this.offset, this.littleEndian );\n\t\tthis.offset += 4;\n\t\treturn value;\n\n\t}\n\n\tgetInt32Array( size ) {\n\n\t\tconst a = [];\n\n\t\tfor ( let i = 0; i < size; i ++ ) {\n\n\t\t\ta.push( this.getInt32() );\n\n\t\t}\n\n\t\treturn a;\n\n\t}\n\n\tgetUint32() {\n\n\t\tconst value = this.dv.getUint32( this.offset, this.littleEndian );\n\t\tthis.offset += 4;\n\t\treturn value;\n\n\t}\n\n\t// JavaScript doesn't support 64-bit integer so calculate this here\n\t// 1 << 32 will return 1 so using multiply operation instead here.\n\t// There's a possibility that this method returns wrong value if the value\n\t// is out of the range between Number.MAX_SAFE_INTEGER and Number.MIN_SAFE_INTEGER.\n\t// TODO: safely handle 64-bit integer\n\tgetInt64() {\n\n\t\tlet low, high;\n\n\t\tif ( this.littleEndian ) {\n\n\t\t\tlow = this.getUint32();\n\t\t\thigh = this.getUint32();\n\n\t\t} else {\n\n\t\t\thigh = this.getUint32();\n\t\t\tlow = this.getUint32();\n\n\t\t}\n\n\t\t// calculate negative value\n\t\tif ( high & 0x80000000 ) {\n\n\t\t\thigh = ~ high & 0xFFFFFFFF;\n\t\t\tlow = ~ low & 0xFFFFFFFF;\n\n\t\t\tif ( low === 0xFFFFFFFF ) high = ( high + 1 ) & 0xFFFFFFFF;\n\n\t\t\tlow = ( low + 1 ) & 0xFFFFFFFF;\n\n\t\t\treturn - ( high * 0x100000000 + low );\n\n\t\t}\n\n\t\treturn high * 0x100000000 + low;\n\n\t}\n\n\tgetInt64Array( size ) {\n\n\t\tconst a = [];\n\n\t\tfor ( let i = 0; i < size; i ++ ) {\n\n\t\t\ta.push( this.getInt64() );\n\n\t\t}\n\n\t\treturn a;\n\n\t}\n\n\t// Note: see getInt64() comment\n\tgetUint64() {\n\n\t\tlet low, high;\n\n\t\tif ( this.littleEndian ) {\n\n\t\t\tlow = this.getUint32();\n\t\t\thigh = this.getUint32();\n\n\t\t} else {\n\n\t\t\thigh = this.getUint32();\n\t\t\tlow = this.getUint32();\n\n\t\t}\n\n\t\treturn high * 0x100000000 + low;\n\n\t}\n\n\tgetFloat32() {\n\n\t\tconst value = this.dv.getFloat32( this.offset, this.littleEndian );\n\t\tthis.offset += 4;\n\t\treturn value;\n\n\t}\n\n\tgetFloat32Array( size ) {\n\n\t\tconst a = [];\n\n\t\tfor ( let i = 0; i < size; i ++ ) {\n\n\t\t\ta.push( this.getFloat32() );\n\n\t\t}\n\n\t\treturn a;\n\n\t}\n\n\tgetFloat64() {\n\n\t\tconst value = this.dv.getFloat64( this.offset, this.littleEndian );\n\t\tthis.offset += 8;\n\t\treturn value;\n\n\t}\n\n\tgetFloat64Array( size ) {\n\n\t\tconst a = [];\n\n\t\tfor ( let i = 0; i < size; i ++ ) {\n\n\t\t\ta.push( this.getFloat64() );\n\n\t\t}\n\n\t\treturn a;\n\n\t}\n\n\tgetArrayBuffer( size ) {\n\n\t\tconst value = this.dv.buffer.slice( this.offset, this.offset + size );\n\t\tthis.offset += size;\n\t\treturn value;\n\n\t}\n\n\tgetString( size ) {\n\n\t\t// note: safari 9 doesn't support Uint8Array.indexOf; create intermediate array instead\n\t\tlet a = [];\n\n\t\tfor ( let i = 0; i < size; i ++ ) {\n\n\t\t\ta[ i ] = this.getUint8();\n\n\t\t}\n\n\t\tconst nullByte = a.indexOf( 0 );\n\t\tif ( nullByte >= 0 ) a = a.slice( 0, nullByte );\n\n\t\treturn LoaderUtils.decodeText( new Uint8Array( a ) );\n\n\t}\n\n}\n\n// FBXTree holds a representation of the FBX data, returned by the TextParser ( FBX ASCII format)\n// and BinaryParser( FBX Binary format)\nclass FBXTree {\n\n\tadd( key, val ) {\n\n\t\tthis[ key ] = val;\n\n\t}\n\n}\n\n// ************** UTILITY FUNCTIONS **************\n\nfunction isFbxFormatBinary( buffer ) {\n\n\tconst CORRECT = 'Kaydara\\u0020FBX\\u0020Binary\\u0020\\u0020\\0';\n\n\treturn buffer.byteLength >= CORRECT.length && CORRECT === convertArrayBufferToString( buffer, 0, CORRECT.length );\n\n}\n\nfunction isFbxFormatASCII( text ) {\n\n\tconst CORRECT = [ 'K', 'a', 'y', 'd', 'a', 'r', 'a', '\\\\', 'F', 'B', 'X', '\\\\', 'B', 'i', 'n', 'a', 'r', 'y', '\\\\', '\\\\' ];\n\n\tlet cursor = 0;\n\n\tfunction read( offset ) {\n\n\t\tconst result = text[ offset - 1 ];\n\t\ttext = text.slice( cursor + offset );\n\t\tcursor ++;\n\t\treturn result;\n\n\t}\n\n\tfor ( let i = 0; i < CORRECT.length; ++ i ) {\n\n\t\tconst num = read( 1 );\n\t\tif ( num === CORRECT[ i ] ) {\n\n\t\t\treturn false;\n\n\t\t}\n\n\t}\n\n\treturn true;\n\n}\n\nfunction getFbxVersion( text ) {\n\n\tconst versionRegExp = /FBXVersion: (\\d+)/;\n\tconst match = text.match( versionRegExp );\n\n\tif ( match ) {\n\n\t\tconst version = parseInt( match[ 1 ] );\n\t\treturn version;\n\n\t}\n\n\tthrow new Error( 'THREE.FBXLoader: Cannot find the version number for the file given.' );\n\n}\n\n// Converts FBX ticks into real time seconds.\nfunction convertFBXTimeToSeconds( time ) {\n\n\treturn time / 46186158000;\n\n}\n\nconst dataArray = [];\n\n// extracts the data from the correct position in the FBX array based on indexing type\nfunction getData( polygonVertexIndex, polygonIndex, vertexIndex, infoObject ) {\n\n\tlet index;\n\n\tswitch ( infoObject.mappingType ) {\n\n\t\tcase 'ByPolygonVertex' :\n\t\t\tindex = polygonVertexIndex;\n\t\t\tbreak;\n\t\tcase 'ByPolygon' :\n\t\t\tindex = polygonIndex;\n\t\t\tbreak;\n\t\tcase 'ByVertice' :\n\t\t\tindex = vertexIndex;\n\t\t\tbreak;\n\t\tcase 'AllSame' :\n\t\t\tindex = infoObject.indices[ 0 ];\n\t\t\tbreak;\n\t\tdefault :\n\t\t\tconsole.warn( 'THREE.FBXLoader: unknown attribute mapping type ' + infoObject.mappingType );\n\n\t}\n\n\tif ( infoObject.referenceType === 'IndexToDirect' ) index = infoObject.indices[ index ];\n\n\tconst from = index * infoObject.dataSize;\n\tconst to = from + infoObject.dataSize;\n\n\treturn slice( dataArray, infoObject.buffer, from, to );\n\n}\n\nconst tempEuler = new Euler();\nconst tempVec = new Vector3();\n\n// generate transformation from FBX transform data\n// ref: https://help.autodesk.com/view/FBX/2017/ENU/?guid=__files_GUID_10CDD63C_79C1_4F2D_BB28_AD2BE65A02ED_htm\n// ref: http://docs.autodesk.com/FBX/2014/ENU/FBX-SDK-Documentation/index.html?url=cpp_ref/_transformations_2main_8cxx-example.html,topicNumber=cpp_ref__transformations_2main_8cxx_example_htmlfc10a1e1-b18d-4e72-9dc0-70d0f1959f5e\nfunction generateTransform( transformData ) {\n\n\tconst lTranslationM = new Matrix4();\n\tconst lPreRotationM = new Matrix4();\n\tconst lRotationM = new Matrix4();\n\tconst lPostRotationM = new Matrix4();\n\n\tconst lScalingM = new Matrix4();\n\tconst lScalingPivotM = new Matrix4();\n\tconst lScalingOffsetM = new Matrix4();\n\tconst lRotationOffsetM = new Matrix4();\n\tconst lRotationPivotM = new Matrix4();\n\n\tconst lParentGX = new Matrix4();\n\tconst lParentLX = new Matrix4();\n\tconst lGlobalT = new Matrix4();\n\n\tconst inheritType = ( transformData.inheritType ) ? transformData.inheritType : 0;\n\n\tif ( transformData.translation ) lTranslationM.setPosition( tempVec.fromArray( transformData.translation ) );\n\n\tif ( transformData.preRotation ) {\n\n\t\tconst array = transformData.preRotation.map( MathUtils.degToRad );\n\t\tarray.push( transformData.eulerOrder );\n\t\tlPreRotationM.makeRotationFromEuler( tempEuler.fromArray( array ) );\n\n\t}\n\n\tif ( transformData.rotation ) {\n\n\t\tconst array = transformData.rotation.map( MathUtils.degToRad );\n\t\tarray.push( transformData.eulerOrder );\n\t\tlRotationM.makeRotationFromEuler( tempEuler.fromArray( array ) );\n\n\t}\n\n\tif ( transformData.postRotation ) {\n\n\t\tconst array = transformData.postRotation.map( MathUtils.degToRad );\n\t\tarray.push( transformData.eulerOrder );\n\t\tlPostRotationM.makeRotationFromEuler( tempEuler.fromArray( array ) );\n\t\tlPostRotationM.invert();\n\n\t}\n\n\tif ( transformData.scale ) lScalingM.scale( tempVec.fromArray( transformData.scale ) );\n\n\t// Pivots and offsets\n\tif ( transformData.scalingOffset ) lScalingOffsetM.setPosition( tempVec.fromArray( transformData.scalingOffset ) );\n\tif ( transformData.scalingPivot ) lScalingPivotM.setPosition( tempVec.fromArray( transformData.scalingPivot ) );\n\tif ( transformData.rotationOffset ) lRotationOffsetM.setPosition( tempVec.fromArray( transformData.rotationOffset ) );\n\tif ( transformData.rotationPivot ) lRotationPivotM.setPosition( tempVec.fromArray( transformData.rotationPivot ) );\n\n\t// parent transform\n\tif ( transformData.parentMatrixWorld ) {\n\n\t\tlParentLX.copy( transformData.parentMatrix );\n\t\tlParentGX.copy( transformData.parentMatrixWorld );\n\n\t}\n\n\tconst lLRM = lPreRotationM.clone().multiply( lRotationM ).multiply( lPostRotationM );\n\t// Global Rotation\n\tconst lParentGRM = new Matrix4();\n\tlParentGRM.extractRotation( lParentGX );\n\n\t// Global Shear*Scaling\n\tconst lParentTM = new Matrix4();\n\tlParentTM.copyPosition( lParentGX );\n\n\tconst lParentGRSM = lParentTM.clone().invert().multiply( lParentGX );\n\tconst lParentGSM = lParentGRM.clone().invert().multiply( lParentGRSM );\n\tconst lLSM = lScalingM;\n\n\tconst lGlobalRS = new Matrix4();\n\n\tif ( inheritType === 0 ) {\n\n\t\tlGlobalRS.copy( lParentGRM ).multiply( lLRM ).multiply( lParentGSM ).multiply( lLSM );\n\n\t} else if ( inheritType === 1 ) {\n\n\t\tlGlobalRS.copy( lParentGRM ).multiply( lParentGSM ).multiply( lLRM ).multiply( lLSM );\n\n\t} else {\n\n\t\tconst lParentLSM = new Matrix4().scale( new Vector3().setFromMatrixScale( lParentLX ) );\n\t\tconst lParentLSM_inv = lParentLSM.clone().invert();\n\t\tconst lParentGSM_noLocal = lParentGSM.clone().multiply( lParentLSM_inv );\n\n\t\tlGlobalRS.copy( lParentGRM ).multiply( lLRM ).multiply( lParentGSM_noLocal ).multiply( lLSM );\n\n\t}\n\n\tconst lRotationPivotM_inv = lRotationPivotM.clone().invert();\n\tconst lScalingPivotM_inv = lScalingPivotM.clone().invert();\n\t// Calculate the local transform matrix\n\tlet lTransform = lTranslationM.clone().multiply( lRotationOffsetM ).multiply( lRotationPivotM ).multiply( lPreRotationM ).multiply( lRotationM ).multiply( lPostRotationM ).multiply( lRotationPivotM_inv ).multiply( lScalingOffsetM ).multiply( lScalingPivotM ).multiply( lScalingM ).multiply( lScalingPivotM_inv );\n\n\tconst lLocalTWithAllPivotAndOffsetInfo = new Matrix4().copyPosition( lTransform );\n\n\tconst lGlobalTranslation = lParentGX.clone().multiply( lLocalTWithAllPivotAndOffsetInfo );\n\tlGlobalT.copyPosition( lGlobalTranslation );\n\n\tlTransform = lGlobalT.clone().multiply( lGlobalRS );\n\n\t// from global to local\n\tlTransform.premultiply( lParentGX.invert() );\n\n\treturn lTransform;\n\n}\n\n// Returns the three.js intrinsic Euler order corresponding to FBX extrinsic Euler order\n// ref: http://help.autodesk.com/view/FBX/2017/ENU/?guid=__cpp_ref_class_fbx_euler_html\nfunction getEulerOrder( order ) {\n\n\torder = order || 0;\n\n\tconst enums = [\n\t\t'ZYX', // -> XYZ extrinsic\n\t\t'YZX', // -> XZY extrinsic\n\t\t'XZY', // -> YZX extrinsic\n\t\t'ZXY', // -> YXZ extrinsic\n\t\t'YXZ', // -> ZXY extrinsic\n\t\t'XYZ', // -> ZYX extrinsic\n\t\t//'SphericXYZ', // not possible to support\n\t];\n\n\tif ( order === 6 ) {\n\n\t\tconsole.warn( 'THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect.' );\n\t\treturn enums[ 0 ];\n\n\t}\n\n\treturn enums[ order ];\n\n}\n\n// Parses comma separated list of numbers and returns them an array.\n// Used internally by the TextParser\nfunction parseNumberArray( value ) {\n\n\tconst array = value.split( ',' ).map( function ( val ) {\n\n\t\treturn parseFloat( val );\n\n\t} );\n\n\treturn array;\n\n}\n\nfunction convertArrayBufferToString( buffer, from, to ) {\n\n\tif ( from === undefined ) from = 0;\n\tif ( to === undefined ) to = buffer.byteLength;\n\n\treturn LoaderUtils.decodeText( new Uint8Array( buffer, from, to ) );\n\n}\n\nfunction append( a, b ) {\n\n\tfor ( let i = 0, j = a.length, l = b.length; i < l; i ++, j ++ ) {\n\n\t\ta[ j ] = b[ i ];\n\n\t}\n\n}\n\nfunction slice( a, b, from, to ) {\n\n\tfor ( let i = from, j = 0; i < to; i ++, j ++ ) {\n\n\t\ta[ j ] = b[ i ];\n\n\t}\n\n\treturn a;\n\n}\n\n// inject array a2 into array a1 at index\nfunction inject( a1, index, a2 ) {\n\n\treturn a1.slice( 0, index ).concat( a2 ).concat( a1.slice( index ) );\n\n}\n\nexport { FBXLoader };\n","import {\n\tAnimationClip,\n\tBone,\n\tBox3,\n\tBufferAttribute,\n\tBufferGeometry,\n\tClampToEdgeWrapping,\n\tColor,\n\tDirectionalLight,\n\tDoubleSide,\n\tFileLoader,\n\tFrontSide,\n\tGroup,\n\tImageBitmapLoader,\n\tInterleavedBuffer,\n\tInterleavedBufferAttribute,\n\tInterpolant,\n\tInterpolateDiscrete,\n\tInterpolateLinear,\n\tLine,\n\tLineBasicMaterial,\n\tLineLoop,\n\tLineSegments,\n\tLinearFilter,\n\tLinearMipmapLinearFilter,\n\tLinearMipmapNearestFilter,\n\tLoader,\n\tLoaderUtils,\n\tMaterial,\n\tMathUtils,\n\tMatrix4,\n\tMesh,\n\tMeshBasicMaterial,\n\tMeshPhysicalMaterial,\n\tMeshStandardMaterial,\n\tMirroredRepeatWrapping,\n\tNearestFilter,\n\tNearestMipmapLinearFilter,\n\tNearestMipmapNearestFilter,\n\tNumberKeyframeTrack,\n\tObject3D,\n\tOrthographicCamera,\n\tPerspectiveCamera,\n\tPointLight,\n\tPoints,\n\tPointsMaterial,\n\tPropertyBinding,\n\tQuaternionKeyframeTrack,\n\tRGBFormat,\n\tRepeatWrapping,\n\tSkeleton,\n\tSkinnedMesh,\n\tSphere,\n\tSpotLight,\n\tTangentSpaceNormalMap,\n\tTexture,\n\tTextureLoader,\n\tTriangleFanDrawMode,\n\tTriangleStripDrawMode,\n\tVector2,\n\tVector3,\n\tVectorKeyframeTrack,\n\tsRGBEncoding\n} from 'three';\n\nclass GLTFLoader extends Loader {\n\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t\tthis.dracoLoader = null;\n\t\tthis.ktx2Loader = null;\n\t\tthis.meshoptDecoder = null;\n\n\t\tthis.pluginCallbacks = [];\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsClearcoatExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFTextureBasisUExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFTextureWebPExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsTransmissionExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFLightsExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMeshoptCompression( parser );\n\n\t\t} );\n\n\t}\n\n\tload( url, onLoad, onProgress, onError ) {\n\n\t\tconst scope = this;\n\n\t\tlet resourcePath;\n\n\t\tif ( this.resourcePath !== '' ) {\n\n\t\t\tresourcePath = this.resourcePath;\n\n\t\t} else if ( this.path !== '' ) {\n\n\t\t\tresourcePath = this.path;\n\n\t\t} else {\n\n\t\t\tresourcePath = LoaderUtils.extractUrlBase( url );\n\n\t\t}\n\n\t\t// Tells the LoadingManager to track an extra item, which resolves after\n\t\t// the model is fully loaded. This means the count of items loaded will\n\t\t// be incorrect, but ensures manager.onLoad() does not fire early.\n\t\tthis.manager.itemStart( url );\n\n\t\tconst _onError = function ( e ) {\n\n\t\t\tif ( onError ) {\n\n\t\t\t\tonError( e );\n\n\t\t\t} else {\n\n\t\t\t\tconsole.error( e );\n\n\t\t\t}\n\n\t\t\tscope.manager.itemError( url );\n\t\t\tscope.manager.itemEnd( url );\n\n\t\t};\n\n\t\tconst loader = new FileLoader( this.manager );\n\n\t\tloader.setPath( this.path );\n\t\tloader.setResponseType( 'arraybuffer' );\n\t\tloader.setRequestHeader( this.requestHeader );\n\t\tloader.setWithCredentials( this.withCredentials );\n\n\t\tloader.load( url, function ( data ) {\n\n\t\t\ttry {\n\n\t\t\t\tscope.parse( data, resourcePath, function ( gltf ) {\n\n\t\t\t\t\tonLoad( gltf );\n\n\t\t\t\t\tscope.manager.itemEnd( url );\n\n\t\t\t\t}, _onError );\n\n\t\t\t} catch ( e ) {\n\n\t\t\t\t_onError( e );\n\n\t\t\t}\n\n\t\t}, onProgress, _onError );\n\n\t}\n\n\tsetDRACOLoader( dracoLoader ) {\n\n\t\tthis.dracoLoader = dracoLoader;\n\t\treturn this;\n\n\t}\n\n\tsetDDSLoader() {\n\n\t\tthrow new Error(\n\n\t\t\t'THREE.GLTFLoader: \"MSFT_texture_dds\" no longer supported. Please update to \"KHR_texture_basisu\".'\n\n\t\t);\n\n\t}\n\n\tsetKTX2Loader( ktx2Loader ) {\n\n\t\tthis.ktx2Loader = ktx2Loader;\n\t\treturn this;\n\n\t}\n\n\tsetMeshoptDecoder( meshoptDecoder ) {\n\n\t\tthis.meshoptDecoder = meshoptDecoder;\n\t\treturn this;\n\n\t}\n\n\tregister( callback ) {\n\n\t\tif ( this.pluginCallbacks.indexOf( callback ) === - 1 ) {\n\n\t\t\tthis.pluginCallbacks.push( callback );\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\tunregister( callback ) {\n\n\t\tif ( this.pluginCallbacks.indexOf( callback ) !== - 1 ) {\n\n\t\t\tthis.pluginCallbacks.splice( this.pluginCallbacks.indexOf( callback ), 1 );\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\tparse( data, path, onLoad, onError ) {\n\n\t\tlet content;\n\t\tconst extensions = {};\n\t\tconst plugins = {};\n\n\t\tif ( typeof data === 'string' ) {\n\n\t\t\tcontent = data;\n\n\t\t} else {\n\n\t\t\tconst magic = LoaderUtils.decodeText( new Uint8Array( data, 0, 4 ) );\n\n\t\t\tif ( magic === BINARY_EXTENSION_HEADER_MAGIC ) {\n\n\t\t\t\ttry {\n\n\t\t\t\t\textensions[ EXTENSIONS.KHR_BINARY_GLTF ] = new GLTFBinaryExtension( data );\n\n\t\t\t\t} catch ( error ) {\n\n\t\t\t\t\tif ( onError ) onError( error );\n\t\t\t\t\treturn;\n\n\t\t\t\t}\n\n\t\t\t\tcontent = extensions[ EXTENSIONS.KHR_BINARY_GLTF ].content;\n\n\t\t\t} else {\n\n\t\t\t\tcontent = LoaderUtils.decodeText( new Uint8Array( data ) );\n\n\t\t\t}\n\n\t\t}\n\n\t\tconst json = JSON.parse( content );\n\n\t\tif ( json.asset === undefined || json.asset.version[ 0 ] < 2 ) {\n\n\t\t\tif ( onError ) onError( new Error( 'THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.' ) );\n\t\t\treturn;\n\n\t\t}\n\n\t\tconst parser = new GLTFParser( json, {\n\n\t\t\tpath: path || this.resourcePath || '',\n\t\t\tcrossOrigin: this.crossOrigin,\n\t\t\trequestHeader: this.requestHeader,\n\t\t\tmanager: this.manager,\n\t\t\tktx2Loader: this.ktx2Loader,\n\t\t\tmeshoptDecoder: this.meshoptDecoder\n\n\t\t} );\n\n\t\tparser.fileLoader.setRequestHeader( this.requestHeader );\n\n\t\tfor ( let i = 0; i < this.pluginCallbacks.length; i ++ ) {\n\n\t\t\tconst plugin = this.pluginCallbacks[ i ]( parser );\n\t\t\tplugins[ plugin.name ] = plugin;\n\n\t\t\t// Workaround to avoid determining as unknown extension\n\t\t\t// in addUnknownExtensionsToUserData().\n\t\t\t// Remove this workaround if we move all the existing\n\t\t\t// extension handlers to plugin system\n\t\t\textensions[ plugin.name ] = true;\n\n\t\t}\n\n\t\tif ( json.extensionsUsed ) {\n\n\t\t\tfor ( let i = 0; i < json.extensionsUsed.length; ++ i ) {\n\n\t\t\t\tconst extensionName = json.extensionsUsed[ i ];\n\t\t\t\tconst extensionsRequired = json.extensionsRequired || [];\n\n\t\t\t\tswitch ( extensionName ) {\n\n\t\t\t\t\tcase EXTENSIONS.KHR_MATERIALS_UNLIT:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFMaterialsUnlitExtension();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFMaterialsPbrSpecularGlossinessExtension();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFDracoMeshCompressionExtension( json, this.dracoLoader );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase EXTENSIONS.KHR_TEXTURE_TRANSFORM:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFTextureTransformExtension();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase EXTENSIONS.KHR_MESH_QUANTIZATION:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFMeshQuantizationExtension();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tif ( extensionsRequired.indexOf( extensionName ) >= 0 && plugins[ extensionName ] === undefined ) {\n\n\t\t\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Unknown extension \"' + extensionName + '\".' );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tparser.setExtensions( extensions );\n\t\tparser.setPlugins( plugins );\n\t\tparser.parse( onLoad, onError );\n\n\t}\n\n}\n\n/* GLTFREGISTRY */\n\nfunction GLTFRegistry() {\n\n\tlet objects = {};\n\n\treturn\t{\n\n\t\tget: function ( key ) {\n\n\t\t\treturn objects[ key ];\n\n\t\t},\n\n\t\tadd: function ( key, object ) {\n\n\t\t\tobjects[ key ] = object;\n\n\t\t},\n\n\t\tremove: function ( key ) {\n\n\t\t\tdelete objects[ key ];\n\n\t\t},\n\n\t\tremoveAll: function () {\n\n\t\t\tobjects = {};\n\n\t\t}\n\n\t};\n\n}\n\n/*********************************/\n/********** EXTENSIONS ***********/\n/*********************************/\n\nconst EXTENSIONS = {\n\tKHR_BINARY_GLTF: 'KHR_binary_glTF',\n\tKHR_DRACO_MESH_COMPRESSION: 'KHR_draco_mesh_compression',\n\tKHR_LIGHTS_PUNCTUAL: 'KHR_lights_punctual',\n\tKHR_MATERIALS_CLEARCOAT: 'KHR_materials_clearcoat',\n\tKHR_MATERIALS_PBR_SPECULAR_GLOSSINESS: 'KHR_materials_pbrSpecularGlossiness',\n\tKHR_MATERIALS_TRANSMISSION: 'KHR_materials_transmission',\n\tKHR_MATERIALS_UNLIT: 'KHR_materials_unlit',\n\tKHR_TEXTURE_BASISU: 'KHR_texture_basisu',\n\tKHR_TEXTURE_TRANSFORM: 'KHR_texture_transform',\n\tKHR_MESH_QUANTIZATION: 'KHR_mesh_quantization',\n\tEXT_TEXTURE_WEBP: 'EXT_texture_webp',\n\tEXT_MESHOPT_COMPRESSION: 'EXT_meshopt_compression'\n};\n\n/**\n * Punctual Lights Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_lights_punctual\n */\nclass GLTFLightsExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_LIGHTS_PUNCTUAL;\n\n\t\t// Object3D instance caches\n\t\tthis.cache = { refs: {}, uses: {} };\n\n\t}\n\n\t_markDefs() {\n\n\t\tconst parser = this.parser;\n\t\tconst nodeDefs = this.parser.json.nodes || [];\n\n\t\tfor ( let nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {\n\n\t\t\tconst nodeDef = nodeDefs[ nodeIndex ];\n\n\t\t\tif ( nodeDef.extensions\n\t\t\t\t\t&& nodeDef.extensions[ this.name ]\n\t\t\t\t\t&& nodeDef.extensions[ this.name ].light !== undefined ) {\n\n\t\t\t\tparser._addNodeRef( this.cache, nodeDef.extensions[ this.name ].light );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t_loadLight( lightIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst cacheKey = 'light:' + lightIndex;\n\t\tlet dependency = parser.cache.get( cacheKey );\n\n\t\tif ( dependency ) return dependency;\n\n\t\tconst json = parser.json;\n\t\tconst extensions = ( json.extensions && json.extensions[ this.name ] ) || {};\n\t\tconst lightDefs = extensions.lights || [];\n\t\tconst lightDef = lightDefs[ lightIndex ];\n\t\tlet lightNode;\n\n\t\tconst color = new Color( 0xffffff );\n\n\t\tif ( lightDef.color !== undefined ) color.fromArray( lightDef.color );\n\n\t\tconst range = lightDef.range !== undefined ? lightDef.range : 0;\n\n\t\tswitch ( lightDef.type ) {\n\n\t\t\tcase 'directional':\n\t\t\t\tlightNode = new DirectionalLight( color );\n\t\t\t\tlightNode.target.position.set( 0, 0, - 1 );\n\t\t\t\tlightNode.add( lightNode.target );\n\t\t\t\tbreak;\n\n\t\t\tcase 'point':\n\t\t\t\tlightNode = new PointLight( color );\n\t\t\t\tlightNode.distance = range;\n\t\t\t\tbreak;\n\n\t\t\tcase 'spot':\n\t\t\t\tlightNode = new SpotLight( color );\n\t\t\t\tlightNode.distance = range;\n\t\t\t\t// Handle spotlight properties.\n\t\t\t\tlightDef.spot = lightDef.spot || {};\n\t\t\t\tlightDef.spot.innerConeAngle = lightDef.spot.innerConeAngle !== undefined ? lightDef.spot.innerConeAngle : 0;\n\t\t\t\tlightDef.spot.outerConeAngle = lightDef.spot.outerConeAngle !== undefined ? lightDef.spot.outerConeAngle : Math.PI / 4.0;\n\t\t\t\tlightNode.angle = lightDef.spot.outerConeAngle;\n\t\t\t\tlightNode.penumbra = 1.0 - lightDef.spot.innerConeAngle / lightDef.spot.outerConeAngle;\n\t\t\t\tlightNode.target.position.set( 0, 0, - 1 );\n\t\t\t\tlightNode.add( lightNode.target );\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Unexpected light type: ' + lightDef.type );\n\n\t\t}\n\n\t\t// Some lights (e.g. spot) default to a position other than the origin. Reset the position\n\t\t// here, because node-level parsing will only override position if explicitly specified.\n\t\tlightNode.position.set( 0, 0, 0 );\n\n\t\tlightNode.decay = 2;\n\n\t\tif ( lightDef.intensity !== undefined ) lightNode.intensity = lightDef.intensity;\n\n\t\tlightNode.name = parser.createUniqueName( lightDef.name || ( 'light_' + lightIndex ) );\n\n\t\tdependency = Promise.resolve( lightNode );\n\n\t\tparser.cache.add( cacheKey, dependency );\n\n\t\treturn dependency;\n\n\t}\n\n\tcreateNodeAttachment( nodeIndex ) {\n\n\t\tconst self = this;\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\t\tconst lightDef = ( nodeDef.extensions && nodeDef.extensions[ this.name ] ) || {};\n\t\tconst lightIndex = lightDef.light;\n\n\t\tif ( lightIndex === undefined ) return null;\n\n\t\treturn this._loadLight( lightIndex ).then( function ( light ) {\n\n\t\t\treturn parser._getNodeRef( self.cache, lightIndex, light );\n\n\t\t} );\n\n\t}\n\n}\n\n/**\n * Unlit Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_unlit\n */\nclass GLTFMaterialsUnlitExtension {\n\n\tconstructor() {\n\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_UNLIT;\n\n\t}\n\n\tgetMaterialType() {\n\n\t\treturn MeshBasicMaterial;\n\n\t}\n\n\textendParams( materialParams, materialDef, parser ) {\n\n\t\tconst pending = [];\n\n\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\n\t\tmaterialParams.opacity = 1.0;\n\n\t\tconst metallicRoughness = materialDef.pbrMetallicRoughness;\n\n\t\tif ( metallicRoughness ) {\n\n\t\t\tif ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\n\n\t\t\t\tconst array = metallicRoughness.baseColorFactor;\n\n\t\t\t\tmaterialParams.color.fromArray( array );\n\t\t\t\tmaterialParams.opacity = array[ 3 ];\n\n\t\t\t}\n\n\t\t\tif ( metallicRoughness.baseColorTexture !== undefined ) {\n\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture ) );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Clearcoat Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_clearcoat\n */\nclass GLTFMaterialsClearcoatExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_CLEARCOAT;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.clearcoatFactor !== undefined ) {\n\n\t\t\tmaterialParams.clearcoat = extension.clearcoatFactor;\n\n\t\t}\n\n\t\tif ( extension.clearcoatTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatMap', extension.clearcoatTexture ) );\n\n\t\t}\n\n\t\tif ( extension.clearcoatRoughnessFactor !== undefined ) {\n\n\t\t\tmaterialParams.clearcoatRoughness = extension.clearcoatRoughnessFactor;\n\n\t\t}\n\n\t\tif ( extension.clearcoatRoughnessTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatRoughnessMap', extension.clearcoatRoughnessTexture ) );\n\n\t\t}\n\n\t\tif ( extension.clearcoatNormalTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatNormalMap', extension.clearcoatNormalTexture ) );\n\n\t\t\tif ( extension.clearcoatNormalTexture.scale !== undefined ) {\n\n\t\t\t\tconst scale = extension.clearcoatNormalTexture.scale;\n\n\t\t\t\t// https://github.com/mrdoob/three.js/issues/11438#issuecomment-507003995\n\t\t\t\tmaterialParams.clearcoatNormalScale = new Vector2( scale, - scale );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Transmission Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_transmission\n * Draft: https://github.com/KhronosGroup/glTF/pull/1698\n */\nclass GLTFMaterialsTransmissionExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_TRANSMISSION;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.transmissionFactor !== undefined ) {\n\n\t\t\tmaterialParams.transmission = extension.transmissionFactor;\n\n\t\t}\n\n\t\tif ( extension.transmissionTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'transmissionMap', extension.transmissionTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * BasisU Texture Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_basisu\n */\nclass GLTFTextureBasisUExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_TEXTURE_BASISU;\n\n\t}\n\n\tloadTexture( textureIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\n\t\tif ( ! textureDef.extensions || ! textureDef.extensions[ this.name ] ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst extension = textureDef.extensions[ this.name ];\n\t\tconst source = json.images[ extension.source ];\n\t\tconst loader = parser.options.ktx2Loader;\n\n\t\tif ( ! loader ) {\n\n\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( this.name ) >= 0 ) {\n\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures' );\n\n\t\t\t} else {\n\n\t\t\t\t// Assumes that the extension is optional and that a fallback texture is present\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn parser.loadTextureImage( textureIndex, source, loader );\n\n\t}\n\n}\n\n/**\n * WebP Texture Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_texture_webp\n */\nclass GLTFTextureWebPExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.EXT_TEXTURE_WEBP;\n\t\tthis.isSupported = null;\n\n\t}\n\n\tloadTexture( textureIndex ) {\n\n\t\tconst name = this.name;\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\n\t\tif ( ! textureDef.extensions || ! textureDef.extensions[ name ] ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst extension = textureDef.extensions[ name ];\n\t\tconst source = json.images[ extension.source ];\n\n\t\tlet loader = parser.textureLoader;\n\t\tif ( source.uri ) {\n\n\t\t\tconst handler = parser.options.manager.getHandler( source.uri );\n\t\t\tif ( handler !== null ) loader = handler;\n\n\t\t}\n\n\t\treturn this.detectSupport().then( function ( isSupported ) {\n\n\t\t\tif ( isSupported ) return parser.loadTextureImage( textureIndex, source, loader );\n\n\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( name ) >= 0 ) {\n\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: WebP required by asset but unsupported.' );\n\n\t\t\t}\n\n\t\t\t// Fall back to PNG or JPEG.\n\t\t\treturn parser.loadTexture( textureIndex );\n\n\t\t} );\n\n\t}\n\n\tdetectSupport() {\n\n\t\tif ( ! this.isSupported ) {\n\n\t\t\tthis.isSupported = new Promise( function ( resolve ) {\n\n\t\t\t\tconst image = new Image();\n\n\t\t\t\t// Lossy test image. Support for lossy images doesn't guarantee support for all\n\t\t\t\t// WebP images, unfortunately.\n\t\t\t\timage.src = 'data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA';\n\n\t\t\t\timage.onload = image.onerror = function () {\n\n\t\t\t\t\tresolve( image.height === 1 );\n\n\t\t\t\t};\n\n\t\t\t} );\n\n\t\t}\n\n\t\treturn this.isSupported;\n\n\t}\n\n}\n\n/**\n * meshopt BufferView Compression Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_meshopt_compression\n */\nclass GLTFMeshoptCompression {\n\n\tconstructor( parser ) {\n\n\t\tthis.name = EXTENSIONS.EXT_MESHOPT_COMPRESSION;\n\t\tthis.parser = parser;\n\n\t}\n\n\tloadBufferView( index ) {\n\n\t\tconst json = this.parser.json;\n\t\tconst bufferView = json.bufferViews[ index ];\n\n\t\tif ( bufferView.extensions && bufferView.extensions[ this.name ] ) {\n\n\t\t\tconst extensionDef = bufferView.extensions[ this.name ];\n\n\t\t\tconst buffer = this.parser.getDependency( 'buffer', extensionDef.buffer );\n\t\t\tconst decoder = this.parser.options.meshoptDecoder;\n\n\t\t\tif ( ! decoder || ! decoder.supported ) {\n\n\t\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( this.name ) >= 0 ) {\n\n\t\t\t\t\tthrow new Error( 'THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files' );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// Assumes that the extension is optional and that fallback buffer data is present\n\t\t\t\t\treturn null;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn Promise.all( [ buffer, decoder.ready ] ).then( function ( res ) {\n\n\t\t\t\tconst byteOffset = extensionDef.byteOffset || 0;\n\t\t\t\tconst byteLength = extensionDef.byteLength || 0;\n\n\t\t\t\tconst count = extensionDef.count;\n\t\t\t\tconst stride = extensionDef.byteStride;\n\n\t\t\t\tconst result = new ArrayBuffer( count * stride );\n\t\t\t\tconst source = new Uint8Array( res[ 0 ], byteOffset, byteLength );\n\n\t\t\t\tdecoder.decodeGltfBuffer( new Uint8Array( result ), count, stride, source, extensionDef.mode, extensionDef.filter );\n\t\t\t\treturn result;\n\n\t\t\t} );\n\n\t\t} else {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t}\n\n}\n\n/* BINARY EXTENSION */\nconst BINARY_EXTENSION_HEADER_MAGIC = 'glTF';\nconst BINARY_EXTENSION_HEADER_LENGTH = 12;\nconst BINARY_EXTENSION_CHUNK_TYPES = { JSON: 0x4E4F534A, BIN: 0x004E4942 };\n\nclass GLTFBinaryExtension {\n\n\tconstructor( data ) {\n\n\t\tthis.name = EXTENSIONS.KHR_BINARY_GLTF;\n\t\tthis.content = null;\n\t\tthis.body = null;\n\n\t\tconst headerView = new DataView( data, 0, BINARY_EXTENSION_HEADER_LENGTH );\n\n\t\tthis.header = {\n\t\t\tmagic: LoaderUtils.decodeText( new Uint8Array( data.slice( 0, 4 ) ) ),\n\t\t\tversion: headerView.getUint32( 4, true ),\n\t\t\tlength: headerView.getUint32( 8, true )\n\t\t};\n\n\t\tif ( this.header.magic !== BINARY_EXTENSION_HEADER_MAGIC ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Unsupported glTF-Binary header.' );\n\n\t\t} else if ( this.header.version < 2.0 ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Legacy binary file detected.' );\n\n\t\t}\n\n\t\tconst chunkContentsLength = this.header.length - BINARY_EXTENSION_HEADER_LENGTH;\n\t\tconst chunkView = new DataView( data, BINARY_EXTENSION_HEADER_LENGTH );\n\t\tlet chunkIndex = 0;\n\n\t\twhile ( chunkIndex < chunkContentsLength ) {\n\n\t\t\tconst chunkLength = chunkView.getUint32( chunkIndex, true );\n\t\t\tchunkIndex += 4;\n\n\t\t\tconst chunkType = chunkView.getUint32( chunkIndex, true );\n\t\t\tchunkIndex += 4;\n\n\t\t\tif ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.JSON ) {\n\n\t\t\t\tconst contentArray = new Uint8Array( data, BINARY_EXTENSION_HEADER_LENGTH + chunkIndex, chunkLength );\n\t\t\t\tthis.content = LoaderUtils.decodeText( contentArray );\n\n\t\t\t} else if ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.BIN ) {\n\n\t\t\t\tconst byteOffset = BINARY_EXTENSION_HEADER_LENGTH + chunkIndex;\n\t\t\t\tthis.body = data.slice( byteOffset, byteOffset + chunkLength );\n\n\t\t\t}\n\n\t\t\t// Clients must ignore chunks with unknown types.\n\n\t\t\tchunkIndex += chunkLength;\n\n\t\t}\n\n\t\tif ( this.content === null ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: JSON content not found.' );\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * DRACO Mesh Compression Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_draco_mesh_compression\n */\nclass GLTFDracoMeshCompressionExtension {\n\n\tconstructor( json, dracoLoader ) {\n\n\t\tif ( ! dracoLoader ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: No DRACOLoader instance provided.' );\n\n\t\t}\n\n\t\tthis.name = EXTENSIONS.KHR_DRACO_MESH_COMPRESSION;\n\t\tthis.json = json;\n\t\tthis.dracoLoader = dracoLoader;\n\t\tthis.dracoLoader.preload();\n\n\t}\n\n\tdecodePrimitive( primitive, parser ) {\n\n\t\tconst json = this.json;\n\t\tconst dracoLoader = this.dracoLoader;\n\t\tconst bufferViewIndex = primitive.extensions[ this.name ].bufferView;\n\t\tconst gltfAttributeMap = primitive.extensions[ this.name ].attributes;\n\t\tconst threeAttributeMap = {};\n\t\tconst attributeNormalizedMap = {};\n\t\tconst attributeTypeMap = {};\n\n\t\tfor ( const attributeName in gltfAttributeMap ) {\n\n\t\t\tconst threeAttributeName = ATTRIBUTES[ attributeName ] || attributeName.toLowerCase();\n\n\t\t\tthreeAttributeMap[ threeAttributeName ] = gltfAttributeMap[ attributeName ];\n\n\t\t}\n\n\t\tfor ( const attributeName in primitive.attributes ) {\n\n\t\t\tconst threeAttributeName = ATTRIBUTES[ attributeName ] || attributeName.toLowerCase();\n\n\t\t\tif ( gltfAttributeMap[ attributeName ] !== undefined ) {\n\n\t\t\t\tconst accessorDef = json.accessors[ primitive.attributes[ attributeName ] ];\n\t\t\t\tconst componentType = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\n\n\t\t\t\tattributeTypeMap[ threeAttributeName ] = componentType;\n\t\t\t\tattributeNormalizedMap[ threeAttributeName ] = accessorDef.normalized === true;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn parser.getDependency( 'bufferView', bufferViewIndex ).then( function ( bufferView ) {\n\n\t\t\treturn new Promise( function ( resolve ) {\n\n\t\t\t\tdracoLoader.decodeDracoFile( bufferView, function ( geometry ) {\n\n\t\t\t\t\tfor ( const attributeName in geometry.attributes ) {\n\n\t\t\t\t\t\tconst attribute = geometry.attributes[ attributeName ];\n\t\t\t\t\t\tconst normalized = attributeNormalizedMap[ attributeName ];\n\n\t\t\t\t\t\tif ( normalized !== undefined ) attribute.normalized = normalized;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve( geometry );\n\n\t\t\t\t}, threeAttributeMap, attributeTypeMap );\n\n\t\t\t} );\n\n\t\t} );\n\n\t}\n\n}\n\n/**\n * Texture Transform Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_transform\n */\nclass GLTFTextureTransformExtension {\n\n\tconstructor() {\n\n\t\tthis.name = EXTENSIONS.KHR_TEXTURE_TRANSFORM;\n\n\t}\n\n\textendTexture( texture, transform ) {\n\n\t\tif ( transform.texCoord !== undefined ) {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Custom UV sets in \"' + this.name + '\" extension not yet supported.' );\n\n\t\t}\n\n\t\tif ( transform.offset === undefined && transform.rotation === undefined && transform.scale === undefined ) {\n\n\t\t\t// See https://github.com/mrdoob/three.js/issues/21819.\n\t\t\treturn texture;\n\n\t\t}\n\n\t\ttexture = texture.clone();\n\n\t\tif ( transform.offset !== undefined ) {\n\n\t\t\ttexture.offset.fromArray( transform.offset );\n\n\t\t}\n\n\t\tif ( transform.rotation !== undefined ) {\n\n\t\t\ttexture.rotation = transform.rotation;\n\n\t\t}\n\n\t\tif ( transform.scale !== undefined ) {\n\n\t\t\ttexture.repeat.fromArray( transform.scale );\n\n\t\t}\n\n\t\ttexture.needsUpdate = true;\n\n\t\treturn texture;\n\n\t}\n\n}\n\n/**\n * Specular-Glossiness Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_pbrSpecularGlossiness\n */\n\n/**\n * A sub class of StandardMaterial with some of the functionality\n * changed via the `onBeforeCompile` callback\n * @pailhead\n */\nclass GLTFMeshStandardSGMaterial extends MeshStandardMaterial {\n\n\tconstructor( params ) {\n\n\t\tsuper();\n\n\t\tthis.isGLTFSpecularGlossinessMaterial = true;\n\n\t\t//various chunks that need replacing\n\t\tconst specularMapParsFragmentChunk = [\n\t\t\t'#ifdef USE_SPECULARMAP',\n\t\t\t'\tuniform sampler2D specularMap;',\n\t\t\t'#endif'\n\t\t].join( '\\n' );\n\n\t\tconst glossinessMapParsFragmentChunk = [\n\t\t\t'#ifdef USE_GLOSSINESSMAP',\n\t\t\t'\tuniform sampler2D glossinessMap;',\n\t\t\t'#endif'\n\t\t].join( '\\n' );\n\n\t\tconst specularMapFragmentChunk = [\n\t\t\t'vec3 specularFactor = specular;',\n\t\t\t'#ifdef USE_SPECULARMAP',\n\t\t\t'\tvec4 texelSpecular = texture2D( specularMap, vUv );',\n\t\t\t'\ttexelSpecular = sRGBToLinear( texelSpecular );',\n\t\t\t'\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture',\n\t\t\t'\tspecularFactor *= texelSpecular.rgb;',\n\t\t\t'#endif'\n\t\t].join( '\\n' );\n\n\t\tconst glossinessMapFragmentChunk = [\n\t\t\t'float glossinessFactor = glossiness;',\n\t\t\t'#ifdef USE_GLOSSINESSMAP',\n\t\t\t'\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );',\n\t\t\t'\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture',\n\t\t\t'\tglossinessFactor *= texelGlossiness.a;',\n\t\t\t'#endif'\n\t\t].join( '\\n' );\n\n\t\tconst lightPhysicalFragmentChunk = [\n\t\t\t'PhysicalMaterial material;',\n\t\t\t'material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );',\n\t\t\t'vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );',\n\t\t\t'float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );',\n\t\t\t'material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.',\n\t\t\t'material.specularRoughness += geometryRoughness;',\n\t\t\t'material.specularRoughness = min( material.specularRoughness, 1.0 );',\n\t\t\t'material.specularColor = specularFactor;',\n\t\t].join( '\\n' );\n\n\t\tconst uniforms = {\n\t\t\tspecular: { value: new Color().setHex( 0xffffff ) },\n\t\t\tglossiness: { value: 1 },\n\t\t\tspecularMap: { value: null },\n\t\t\tglossinessMap: { value: null }\n\t\t};\n\n\t\tthis._extraUniforms = uniforms;\n\n\t\tthis.onBeforeCompile = function ( shader ) {\n\n\t\t\tfor ( const uniformName in uniforms ) {\n\n\t\t\t\tshader.uniforms[ uniformName ] = uniforms[ uniformName ];\n\n\t\t\t}\n\n\t\t\tshader.fragmentShader = shader.fragmentShader\n\t\t\t\t.replace( 'uniform float roughness;', 'uniform vec3 specular;' )\n\t\t\t\t.replace( 'uniform float metalness;', 'uniform float glossiness;' )\n\t\t\t\t.replace( '#include <roughnessmap_pars_fragment>', specularMapParsFragmentChunk )\n\t\t\t\t.replace( '#include <metalnessmap_pars_fragment>', glossinessMapParsFragmentChunk )\n\t\t\t\t.replace( '#include <roughnessmap_fragment>', specularMapFragmentChunk )\n\t\t\t\t.replace( '#include <metalnessmap_fragment>', glossinessMapFragmentChunk )\n\t\t\t\t.replace( '#include <lights_physical_fragment>', lightPhysicalFragmentChunk );\n\n\t\t};\n\n\t\tObject.defineProperties( this, {\n\n\t\t\tspecular: {\n\t\t\t\tget: function () {\n\n\t\t\t\t\treturn uniforms.specular.value;\n\n\t\t\t\t},\n\t\t\t\tset: function ( v ) {\n\n\t\t\t\t\tuniforms.specular.value = v;\n\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tspecularMap: {\n\t\t\t\tget: function () {\n\n\t\t\t\t\treturn uniforms.specularMap.value;\n\n\t\t\t\t},\n\t\t\t\tset: function ( v ) {\n\n\t\t\t\t\tuniforms.specularMap.value = v;\n\n\t\t\t\t\tif ( v ) {\n\n\t\t\t\t\t\tthis.defines.USE_SPECULARMAP = ''; // USE_UV is set by the renderer for specular maps\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tdelete this.defines.USE_SPECULARMAP;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tglossiness: {\n\t\t\t\tget: function () {\n\n\t\t\t\t\treturn uniforms.glossiness.value;\n\n\t\t\t\t},\n\t\t\t\tset: function ( v ) {\n\n\t\t\t\t\tuniforms.glossiness.value = v;\n\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tglossinessMap: {\n\t\t\t\tget: function () {\n\n\t\t\t\t\treturn uniforms.glossinessMap.value;\n\n\t\t\t\t},\n\t\t\t\tset: function ( v ) {\n\n\t\t\t\t\tuniforms.glossinessMap.value = v;\n\n\t\t\t\t\tif ( v ) {\n\n\t\t\t\t\t\tthis.defines.USE_GLOSSINESSMAP = '';\n\t\t\t\t\t\tthis.defines.USE_UV = '';\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tdelete this.defines.USE_GLOSSINESSMAP;\n\t\t\t\t\t\tdelete this.defines.USE_UV;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t} );\n\n\t\tdelete this.metalness;\n\t\tdelete this.roughness;\n\t\tdelete this.metalnessMap;\n\t\tdelete this.roughnessMap;\n\n\t\tthis.setValues( params );\n\n\t}\n\n\tcopy( source ) {\n\n\t\tsuper.copy( source );\n\n\t\tthis.specularMap = source.specularMap;\n\t\tthis.specular.copy( source.specular );\n\t\tthis.glossinessMap = source.glossinessMap;\n\t\tthis.glossiness = source.glossiness;\n\t\tdelete this.metalness;\n\t\tdelete this.roughness;\n\t\tdelete this.metalnessMap;\n\t\tdelete this.roughnessMap;\n\t\treturn this;\n\n\t}\n\n}\n\n\nclass GLTFMaterialsPbrSpecularGlossinessExtension {\n\n\tconstructor() {\n\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS;\n\n\t\tthis.specularGlossinessParams = [\n\t\t\t'color',\n\t\t\t'map',\n\t\t\t'lightMap',\n\t\t\t'lightMapIntensity',\n\t\t\t'aoMap',\n\t\t\t'aoMapIntensity',\n\t\t\t'emissive',\n\t\t\t'emissiveIntensity',\n\t\t\t'emissiveMap',\n\t\t\t'bumpMap',\n\t\t\t'bumpScale',\n\t\t\t'normalMap',\n\t\t\t'normalMapType',\n\t\t\t'displacementMap',\n\t\t\t'displacementScale',\n\t\t\t'displacementBias',\n\t\t\t'specularMap',\n\t\t\t'specular',\n\t\t\t'glossinessMap',\n\t\t\t'glossiness',\n\t\t\t'alphaMap',\n\t\t\t'envMap',\n\t\t\t'envMapIntensity',\n\t\t\t'refractionRatio',\n\t\t];\n\n\t}\n\n\tgetMaterialType() {\n\n\t\treturn GLTFMeshStandardSGMaterial;\n\n\t}\n\n\textendParams( materialParams, materialDef, parser ) {\n\n\t\tconst pbrSpecularGlossiness = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\n\t\tmaterialParams.opacity = 1.0;\n\n\t\tconst pending = [];\n\n\t\tif ( Array.isArray( pbrSpecularGlossiness.diffuseFactor ) ) {\n\n\t\t\tconst array = pbrSpecularGlossiness.diffuseFactor;\n\n\t\t\tmaterialParams.color.fromArray( array );\n\t\t\tmaterialParams.opacity = array[ 3 ];\n\n\t\t}\n\n\t\tif ( pbrSpecularGlossiness.diffuseTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'map', pbrSpecularGlossiness.diffuseTexture ) );\n\n\t\t}\n\n\t\tmaterialParams.emissive = new Color( 0.0, 0.0, 0.0 );\n\t\tmaterialParams.glossiness = pbrSpecularGlossiness.glossinessFactor !== undefined ? pbrSpecularGlossiness.glossinessFactor : 1.0;\n\t\tmaterialParams.specular = new Color( 1.0, 1.0, 1.0 );\n\n\t\tif ( Array.isArray( pbrSpecularGlossiness.specularFactor ) ) {\n\n\t\t\tmaterialParams.specular.fromArray( pbrSpecularGlossiness.specularFactor );\n\n\t\t}\n\n\t\tif ( pbrSpecularGlossiness.specularGlossinessTexture !== undefined ) {\n\n\t\t\tconst specGlossMapDef = pbrSpecularGlossiness.specularGlossinessTexture;\n\t\t\tpending.push( parser.assignTexture( materialParams, 'glossinessMap', specGlossMapDef ) );\n\t\t\tpending.push( parser.assignTexture( materialParams, 'specularMap', specGlossMapDef ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n\tcreateMaterial( materialParams ) {\n\n\t\tconst material = new GLTFMeshStandardSGMaterial( materialParams );\n\t\tmaterial.fog = true;\n\n\t\tmaterial.color = materialParams.color;\n\n\t\tmaterial.map = materialParams.map === undefined ? null : materialParams.map;\n\n\t\tmaterial.lightMap = null;\n\t\tmaterial.lightMapIntensity = 1.0;\n\n\t\tmaterial.aoMap = materialParams.aoMap === undefined ? null : materialParams.aoMap;\n\t\tmaterial.aoMapIntensity = 1.0;\n\n\t\tmaterial.emissive = materialParams.emissive;\n\t\tmaterial.emissiveIntensity = 1.0;\n\t\tmaterial.emissiveMap = materialParams.emissiveMap === undefined ? null : materialParams.emissiveMap;\n\n\t\tmaterial.bumpMap = materialParams.bumpMap === undefined ? null : materialParams.bumpMap;\n\t\tmaterial.bumpScale = 1;\n\n\t\tmaterial.normalMap = materialParams.normalMap === undefined ? null : materialParams.normalMap;\n\t\tmaterial.normalMapType = TangentSpaceNormalMap;\n\n\t\tif ( materialParams.normalScale ) material.normalScale = materialParams.normalScale;\n\n\t\tmaterial.displacementMap = null;\n\t\tmaterial.displacementScale = 1;\n\t\tmaterial.displacementBias = 0;\n\n\t\tmaterial.specularMap = materialParams.specularMap === undefined ? null : materialParams.specularMap;\n\t\tmaterial.specular = materialParams.specular;\n\n\t\tmaterial.glossinessMap = materialParams.glossinessMap === undefined ? null : materialParams.glossinessMap;\n\t\tmaterial.glossiness = materialParams.glossiness;\n\n\t\tmaterial.alphaMap = null;\n\n\t\tmaterial.envMap = materialParams.envMap === undefined ? null : materialParams.envMap;\n\t\tmaterial.envMapIntensity = 1.0;\n\n\t\tmaterial.refractionRatio = 0.98;\n\n\t\treturn material;\n\n\t}\n\n}\n\n/**\n * Mesh Quantization Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_mesh_quantization\n */\nclass GLTFMeshQuantizationExtension {\n\n\tconstructor() {\n\n\t\tthis.name = EXTENSIONS.KHR_MESH_QUANTIZATION;\n\n\t}\n\n}\n\n/*********************************/\n/********** INTERPOLATION ********/\n/*********************************/\n\n// Spline Interpolation\n// Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#appendix-c-spline-interpolation\nclass GLTFCubicSplineInterpolant extends Interpolant {\n\n\tconstructor( parameterPositions, sampleValues, sampleSize, resultBuffer ) {\n\n\t\tsuper( parameterPositions, sampleValues, sampleSize, resultBuffer );\n\n\t}\n\n\tcopySampleValue_( index ) {\n\n\t\t// Copies a sample value to the result buffer. See description of glTF\n\t\t// CUBICSPLINE values layout in interpolate_() function below.\n\n\t\tconst result = this.resultBuffer,\n\t\t\tvalues = this.sampleValues,\n\t\t\tvalueSize = this.valueSize,\n\t\t\toffset = index * valueSize * 3 + valueSize;\n\n\t\tfor ( let i = 0; i !== valueSize; i ++ ) {\n\n\t\t\tresult[ i ] = values[ offset + i ];\n\n\t\t}\n\n\t\treturn result;\n\n\t}\n\n}\n\nGLTFCubicSplineInterpolant.prototype.beforeStart_ = GLTFCubicSplineInterpolant.prototype.copySampleValue_;\n\nGLTFCubicSplineInterpolant.prototype.afterEnd_ = GLTFCubicSplineInterpolant.prototype.copySampleValue_;\n\nGLTFCubicSplineInterpolant.prototype.interpolate_ = function ( i1, t0, t, t1 ) {\n\n\tconst result = this.resultBuffer;\n\tconst values = this.sampleValues;\n\tconst stride = this.valueSize;\n\n\tconst stride2 = stride * 2;\n\tconst stride3 = stride * 3;\n\n\tconst td = t1 - t0;\n\n\tconst p = ( t - t0 ) / td;\n\tconst pp = p * p;\n\tconst ppp = pp * p;\n\n\tconst offset1 = i1 * stride3;\n\tconst offset0 = offset1 - stride3;\n\n\tconst s2 = - 2 * ppp + 3 * pp;\n\tconst s3 = ppp - pp;\n\tconst s0 = 1 - s2;\n\tconst s1 = s3 - pp + p;\n\n\t// Layout of keyframe output values for CUBICSPLINE animations:\n\t//   [ inTangent_1, splineVertex_1, outTangent_1, inTangent_2, splineVertex_2, ... ]\n\tfor ( let i = 0; i !== stride; i ++ ) {\n\n\t\tconst p0 = values[ offset0 + i + stride ]; // splineVertex_k\n\t\tconst m0 = values[ offset0 + i + stride2 ] * td; // outTangent_k * (t_k+1 - t_k)\n\t\tconst p1 = values[ offset1 + i + stride ]; // splineVertex_k+1\n\t\tconst m1 = values[ offset1 + i ] * td; // inTangent_k+1 * (t_k+1 - t_k)\n\n\t\tresult[ i ] = s0 * p0 + s1 * m0 + s2 * p1 + s3 * m1;\n\n\t}\n\n\treturn result;\n\n};\n\n/*********************************/\n/********** INTERNALS ************/\n/*********************************/\n\n/* CONSTANTS */\n\nconst WEBGL_CONSTANTS = {\n\tFLOAT: 5126,\n\t//FLOAT_MAT2: 35674,\n\tFLOAT_MAT3: 35675,\n\tFLOAT_MAT4: 35676,\n\tFLOAT_VEC2: 35664,\n\tFLOAT_VEC3: 35665,\n\tFLOAT_VEC4: 35666,\n\tLINEAR: 9729,\n\tREPEAT: 10497,\n\tSAMPLER_2D: 35678,\n\tPOINTS: 0,\n\tLINES: 1,\n\tLINE_LOOP: 2,\n\tLINE_STRIP: 3,\n\tTRIANGLES: 4,\n\tTRIANGLE_STRIP: 5,\n\tTRIANGLE_FAN: 6,\n\tUNSIGNED_BYTE: 5121,\n\tUNSIGNED_SHORT: 5123\n};\n\nconst WEBGL_COMPONENT_TYPES = {\n\t5120: Int8Array,\n\t5121: Uint8Array,\n\t5122: Int16Array,\n\t5123: Uint16Array,\n\t5125: Uint32Array,\n\t5126: Float32Array\n};\n\nconst WEBGL_FILTERS = {\n\t9728: NearestFilter,\n\t9729: LinearFilter,\n\t9984: NearestMipmapNearestFilter,\n\t9985: LinearMipmapNearestFilter,\n\t9986: NearestMipmapLinearFilter,\n\t9987: LinearMipmapLinearFilter\n};\n\nconst WEBGL_WRAPPINGS = {\n\t33071: ClampToEdgeWrapping,\n\t33648: MirroredRepeatWrapping,\n\t10497: RepeatWrapping\n};\n\nconst WEBGL_TYPE_SIZES = {\n\t'SCALAR': 1,\n\t'VEC2': 2,\n\t'VEC3': 3,\n\t'VEC4': 4,\n\t'MAT2': 4,\n\t'MAT3': 9,\n\t'MAT4': 16\n};\n\nconst ATTRIBUTES = {\n\tPOSITION: 'position',\n\tNORMAL: 'normal',\n\tTANGENT: 'tangent',\n\tTEXCOORD_0: 'uv',\n\tTEXCOORD_1: 'uv2',\n\tCOLOR_0: 'color',\n\tWEIGHTS_0: 'skinWeight',\n\tJOINTS_0: 'skinIndex',\n};\n\nconst PATH_PROPERTIES = {\n\tscale: 'scale',\n\ttranslation: 'position',\n\trotation: 'quaternion',\n\tweights: 'morphTargetInfluences'\n};\n\nconst INTERPOLATION = {\n\tCUBICSPLINE: undefined, // We use a custom interpolant (GLTFCubicSplineInterpolation) for CUBICSPLINE tracks. Each\n\t\t                        // keyframe track will be initialized with a default interpolation type, then modified.\n\tLINEAR: InterpolateLinear,\n\tSTEP: InterpolateDiscrete\n};\n\nconst ALPHA_MODES = {\n\tOPAQUE: 'OPAQUE',\n\tMASK: 'MASK',\n\tBLEND: 'BLEND'\n};\n\n/* UTILITY FUNCTIONS */\n\nfunction resolveURL( url, path ) {\n\n\t// Invalid URL\n\tif ( typeof url !== 'string' || url === '' ) return '';\n\n\t// Host Relative URL\n\tif ( /^https?:\\/\\//i.test( path ) && /^\\//.test( url ) ) {\n\n\t\tpath = path.replace( /(^https?:\\/\\/[^\\/]+).*/i, '$1' );\n\n\t}\n\n\t// Absolute URL http://,https://,//\n\tif ( /^(https?:)?\\/\\//i.test( url ) ) return url;\n\n\t// Data URI\n\tif ( /^data:.*,.*$/i.test( url ) ) return url;\n\n\t// Blob URL\n\tif ( /^blob:.*$/i.test( url ) ) return url;\n\n\t// Relative URL\n\treturn path + url;\n\n}\n\n/**\n * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#default-material\n */\nfunction createDefaultMaterial( cache ) {\n\n\tif ( cache[ 'DefaultMaterial' ] === undefined ) {\n\n\t\tcache[ 'DefaultMaterial' ] = new MeshStandardMaterial( {\n\t\t\tcolor: 0xFFFFFF,\n\t\t\temissive: 0x000000,\n\t\t\tmetalness: 1,\n\t\t\troughness: 1,\n\t\t\ttransparent: false,\n\t\t\tdepthTest: true,\n\t\t\tside: FrontSide\n\t\t} );\n\n\t}\n\n\treturn cache[ 'DefaultMaterial' ];\n\n}\n\nfunction addUnknownExtensionsToUserData( knownExtensions, object, objectDef ) {\n\n\t// Add unknown glTF extensions to an object's userData.\n\n\tfor ( const name in objectDef.extensions ) {\n\n\t\tif ( knownExtensions[ name ] === undefined ) {\n\n\t\t\tobject.userData.gltfExtensions = object.userData.gltfExtensions || {};\n\t\t\tobject.userData.gltfExtensions[ name ] = objectDef.extensions[ name ];\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * @param {Object3D|Material|BufferGeometry} object\n * @param {GLTF.definition} gltfDef\n */\nfunction assignExtrasToUserData( object, gltfDef ) {\n\n\tif ( gltfDef.extras !== undefined ) {\n\n\t\tif ( typeof gltfDef.extras === 'object' ) {\n\n\t\t\tObject.assign( object.userData, gltfDef.extras );\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Ignoring primitive type .extras, ' + gltfDef.extras );\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#morph-targets\n *\n * @param {BufferGeometry} geometry\n * @param {Array<GLTF.Target>} targets\n * @param {GLTFParser} parser\n * @return {Promise<BufferGeometry>}\n */\nfunction addMorphTargets( geometry, targets, parser ) {\n\n\tlet hasMorphPosition = false;\n\tlet hasMorphNormal = false;\n\n\tfor ( let i = 0, il = targets.length; i < il; i ++ ) {\n\n\t\tconst target = targets[ i ];\n\n\t\tif ( target.POSITION !== undefined ) hasMorphPosition = true;\n\t\tif ( target.NORMAL !== undefined ) hasMorphNormal = true;\n\n\t\tif ( hasMorphPosition && hasMorphNormal ) break;\n\n\t}\n\n\tif ( ! hasMorphPosition && ! hasMorphNormal ) return Promise.resolve( geometry );\n\n\tconst pendingPositionAccessors = [];\n\tconst pendingNormalAccessors = [];\n\n\tfor ( let i = 0, il = targets.length; i < il; i ++ ) {\n\n\t\tconst target = targets[ i ];\n\n\t\tif ( hasMorphPosition ) {\n\n\t\t\tconst pendingAccessor = target.POSITION !== undefined\n\t\t\t\t? parser.getDependency( 'accessor', target.POSITION )\n\t\t\t\t: geometry.attributes.position;\n\n\t\t\tpendingPositionAccessors.push( pendingAccessor );\n\n\t\t}\n\n\t\tif ( hasMorphNormal ) {\n\n\t\t\tconst pendingAccessor = target.NORMAL !== undefined\n\t\t\t\t? parser.getDependency( 'accessor', target.NORMAL )\n\t\t\t\t: geometry.attributes.normal;\n\n\t\t\tpendingNormalAccessors.push( pendingAccessor );\n\n\t\t}\n\n\t}\n\n\treturn Promise.all( [\n\t\tPromise.all( pendingPositionAccessors ),\n\t\tPromise.all( pendingNormalAccessors )\n\t] ).then( function ( accessors ) {\n\n\t\tconst morphPositions = accessors[ 0 ];\n\t\tconst morphNormals = accessors[ 1 ];\n\n\t\tif ( hasMorphPosition ) geometry.morphAttributes.position = morphPositions;\n\t\tif ( hasMorphNormal ) geometry.morphAttributes.normal = morphNormals;\n\t\tgeometry.morphTargetsRelative = true;\n\n\t\treturn geometry;\n\n\t} );\n\n}\n\n/**\n * @param {Mesh} mesh\n * @param {GLTF.Mesh} meshDef\n */\nfunction updateMorphTargets( mesh, meshDef ) {\n\n\tmesh.updateMorphTargets();\n\n\tif ( meshDef.weights !== undefined ) {\n\n\t\tfor ( let i = 0, il = meshDef.weights.length; i < il; i ++ ) {\n\n\t\t\tmesh.morphTargetInfluences[ i ] = meshDef.weights[ i ];\n\n\t\t}\n\n\t}\n\n\t// .extras has user-defined data, so check that .extras.targetNames is an array.\n\tif ( meshDef.extras && Array.isArray( meshDef.extras.targetNames ) ) {\n\n\t\tconst targetNames = meshDef.extras.targetNames;\n\n\t\tif ( mesh.morphTargetInfluences.length === targetNames.length ) {\n\n\t\t\tmesh.morphTargetDictionary = {};\n\n\t\t\tfor ( let i = 0, il = targetNames.length; i < il; i ++ ) {\n\n\t\t\t\tmesh.morphTargetDictionary[ targetNames[ i ] ] = i;\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.' );\n\n\t\t}\n\n\t}\n\n}\n\nfunction createPrimitiveKey( primitiveDef ) {\n\n\tconst dracoExtension = primitiveDef.extensions && primitiveDef.extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ];\n\tlet geometryKey;\n\n\tif ( dracoExtension ) {\n\n\t\tgeometryKey = 'draco:' + dracoExtension.bufferView\n\t\t\t\t+ ':' + dracoExtension.indices\n\t\t\t\t+ ':' + createAttributesKey( dracoExtension.attributes );\n\n\t} else {\n\n\t\tgeometryKey = primitiveDef.indices + ':' + createAttributesKey( primitiveDef.attributes ) + ':' + primitiveDef.mode;\n\n\t}\n\n\treturn geometryKey;\n\n}\n\nfunction createAttributesKey( attributes ) {\n\n\tlet attributesKey = '';\n\n\tconst keys = Object.keys( attributes ).sort();\n\n\tfor ( let i = 0, il = keys.length; i < il; i ++ ) {\n\n\t\tattributesKey += keys[ i ] + ':' + attributes[ keys[ i ] ] + ';';\n\n\t}\n\n\treturn attributesKey;\n\n}\n\nfunction getNormalizedComponentScale( constructor ) {\n\n\t// Reference:\n\t// https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_mesh_quantization#encoding-quantized-data\n\n\tswitch ( constructor ) {\n\n\t\tcase Int8Array:\n\t\t\treturn 1 / 127;\n\n\t\tcase Uint8Array:\n\t\t\treturn 1 / 255;\n\n\t\tcase Int16Array:\n\t\t\treturn 1 / 32767;\n\n\t\tcase Uint16Array:\n\t\t\treturn 1 / 65535;\n\n\t\tdefault:\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Unsupported normalized accessor component type.' );\n\n\t}\n\n}\n\n/* GLTF PARSER */\n\nclass GLTFParser {\n\n\tconstructor( json = {}, options = {} ) {\n\n\t\tthis.json = json;\n\t\tthis.extensions = {};\n\t\tthis.plugins = {};\n\t\tthis.options = options;\n\n\t\t// loader object cache\n\t\tthis.cache = new GLTFRegistry();\n\n\t\t// associations between Three.js objects and glTF elements\n\t\tthis.associations = new Map();\n\n\t\t// BufferGeometry caching\n\t\tthis.primitiveCache = {};\n\n\t\t// Object3D instance caches\n\t\tthis.meshCache = { refs: {}, uses: {} };\n\t\tthis.cameraCache = { refs: {}, uses: {} };\n\t\tthis.lightCache = { refs: {}, uses: {} };\n\n\t\tthis.textureCache = {};\n\n\t\t// Track node names, to ensure no duplicates\n\t\tthis.nodeNamesUsed = {};\n\n\t\t// Use an ImageBitmapLoader if imageBitmaps are supported. Moves much of the\n\t\t// expensive work of uploading a texture to the GPU off the main thread.\n\t\tif ( typeof createImageBitmap !== 'undefined' && /Firefox/.test( navigator.userAgent ) === false ) {\n\n\t\t\tthis.textureLoader = new ImageBitmapLoader( this.options.manager );\n\n\t\t} else {\n\n\t\t\tthis.textureLoader = new TextureLoader( this.options.manager );\n\n\t\t}\n\n\t\tthis.textureLoader.setCrossOrigin( this.options.crossOrigin );\n\t\tthis.textureLoader.setRequestHeader( this.options.requestHeader );\n\n\t\tthis.fileLoader = new FileLoader( this.options.manager );\n\t\tthis.fileLoader.setResponseType( 'arraybuffer' );\n\n\t\tif ( this.options.crossOrigin === 'use-credentials' ) {\n\n\t\t\tthis.fileLoader.setWithCredentials( true );\n\n\t\t}\n\n\t}\n\n\tsetExtensions( extensions ) {\n\n\t\tthis.extensions = extensions;\n\n\t}\n\n\tsetPlugins( plugins ) {\n\n\t\tthis.plugins = plugins;\n\n\t}\n\n\tparse( onLoad, onError ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\n\t\t// Clear the loader cache\n\t\tthis.cache.removeAll();\n\n\t\t// Mark the special nodes/meshes in json for efficient parse\n\t\tthis._invokeAll( function ( ext ) {\n\n\t\t\treturn ext._markDefs && ext._markDefs();\n\n\t\t} );\n\n\t\tPromise.all( this._invokeAll( function ( ext ) {\n\n\t\t\treturn ext.beforeRoot && ext.beforeRoot();\n\n\t\t} ) ).then( function () {\n\n\t\t\treturn Promise.all( [\n\n\t\t\t\tparser.getDependencies( 'scene' ),\n\t\t\t\tparser.getDependencies( 'animation' ),\n\t\t\t\tparser.getDependencies( 'camera' ),\n\n\t\t\t] );\n\n\t\t} ).then( function ( dependencies ) {\n\n\t\t\tconst result = {\n\t\t\t\tscene: dependencies[ 0 ][ json.scene || 0 ],\n\t\t\t\tscenes: dependencies[ 0 ],\n\t\t\t\tanimations: dependencies[ 1 ],\n\t\t\t\tcameras: dependencies[ 2 ],\n\t\t\t\tasset: json.asset,\n\t\t\t\tparser: parser,\n\t\t\t\tuserData: {}\n\t\t\t};\n\n\t\t\taddUnknownExtensionsToUserData( extensions, result, json );\n\n\t\t\tassignExtrasToUserData( result, json );\n\n\t\t\tPromise.all( parser._invokeAll( function ( ext ) {\n\n\t\t\t\treturn ext.afterRoot && ext.afterRoot( result );\n\n\t\t\t} ) ).then( function () {\n\n\t\t\t\tonLoad( result );\n\n\t\t\t} );\n\n\t\t} ).catch( onError );\n\n\t}\n\n\t/**\n\t * Marks the special nodes/meshes in json for efficient parse.\n\t */\n\t_markDefs() {\n\n\t\tconst nodeDefs = this.json.nodes || [];\n\t\tconst skinDefs = this.json.skins || [];\n\t\tconst meshDefs = this.json.meshes || [];\n\n\t\t// Nothing in the node definition indicates whether it is a Bone or an\n\t\t// Object3D. Use the skins' joint references to mark bones.\n\t\tfor ( let skinIndex = 0, skinLength = skinDefs.length; skinIndex < skinLength; skinIndex ++ ) {\n\n\t\t\tconst joints = skinDefs[ skinIndex ].joints;\n\n\t\t\tfor ( let i = 0, il = joints.length; i < il; i ++ ) {\n\n\t\t\t\tnodeDefs[ joints[ i ] ].isBone = true;\n\n\t\t\t}\n\n\t\t}\n\n\t\t// Iterate over all nodes, marking references to shared resources,\n\t\t// as well as skeleton joints.\n\t\tfor ( let nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {\n\n\t\t\tconst nodeDef = nodeDefs[ nodeIndex ];\n\n\t\t\tif ( nodeDef.mesh !== undefined ) {\n\n\t\t\t\tthis._addNodeRef( this.meshCache, nodeDef.mesh );\n\n\t\t\t\t// Nothing in the mesh definition indicates whether it is\n\t\t\t\t// a SkinnedMesh or Mesh. Use the node's mesh reference\n\t\t\t\t// to mark SkinnedMesh if node has skin.\n\t\t\t\tif ( nodeDef.skin !== undefined ) {\n\n\t\t\t\t\tmeshDefs[ nodeDef.mesh ].isSkinnedMesh = true;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( nodeDef.camera !== undefined ) {\n\n\t\t\t\tthis._addNodeRef( this.cameraCache, nodeDef.camera );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Counts references to shared node / Object3D resources. These resources\n\t * can be reused, or \"instantiated\", at multiple nodes in the scene\n\t * hierarchy. Mesh, Camera, and Light instances are instantiated and must\n\t * be marked. Non-scenegraph resources (like Materials, Geometries, and\n\t * Textures) can be reused directly and are not marked here.\n\t *\n\t * Example: CesiumMilkTruck sample model reuses \"Wheel\" meshes.\n\t */\n\t_addNodeRef( cache, index ) {\n\n\t\tif ( index === undefined ) return;\n\n\t\tif ( cache.refs[ index ] === undefined ) {\n\n\t\t\tcache.refs[ index ] = cache.uses[ index ] = 0;\n\n\t\t}\n\n\t\tcache.refs[ index ] ++;\n\n\t}\n\n\t/** Returns a reference to a shared resource, cloning it if necessary. */\n\t_getNodeRef( cache, index, object ) {\n\n\t\tif ( cache.refs[ index ] <= 1 ) return object;\n\n\t\tconst ref = object.clone();\n\n\t\tref.name += '_instance_' + ( cache.uses[ index ] ++ );\n\n\t\treturn ref;\n\n\t}\n\n\t_invokeOne( func ) {\n\n\t\tconst extensions = Object.values( this.plugins );\n\t\textensions.push( this );\n\n\t\tfor ( let i = 0; i < extensions.length; i ++ ) {\n\n\t\t\tconst result = func( extensions[ i ] );\n\n\t\t\tif ( result ) return result;\n\n\t\t}\n\n\t\treturn null;\n\n\t}\n\n\t_invokeAll( func ) {\n\n\t\tconst extensions = Object.values( this.plugins );\n\t\textensions.unshift( this );\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0; i < extensions.length; i ++ ) {\n\n\t\t\tconst result = func( extensions[ i ] );\n\n\t\t\tif ( result ) pending.push( result );\n\n\t\t}\n\n\t\treturn pending;\n\n\t}\n\n\t/**\n\t * Requests the specified dependency asynchronously, with caching.\n\t * @param {string} type\n\t * @param {number} index\n\t * @return {Promise<Object3D|Material|THREE.Texture|AnimationClip|ArrayBuffer|Object>}\n\t */\n\tgetDependency( type, index ) {\n\n\t\tconst cacheKey = type + ':' + index;\n\t\tlet dependency = this.cache.get( cacheKey );\n\n\t\tif ( ! dependency ) {\n\n\t\t\tswitch ( type ) {\n\n\t\t\t\tcase 'scene':\n\t\t\t\t\tdependency = this.loadScene( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'node':\n\t\t\t\t\tdependency = this.loadNode( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'mesh':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadMesh && ext.loadMesh( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'accessor':\n\t\t\t\t\tdependency = this.loadAccessor( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'bufferView':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadBufferView && ext.loadBufferView( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'buffer':\n\t\t\t\t\tdependency = this.loadBuffer( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'material':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadMaterial && ext.loadMaterial( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'texture':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadTexture && ext.loadTexture( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'skin':\n\t\t\t\t\tdependency = this.loadSkin( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'animation':\n\t\t\t\t\tdependency = this.loadAnimation( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'camera':\n\t\t\t\t\tdependency = this.loadCamera( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error( 'Unknown type: ' + type );\n\n\t\t\t}\n\n\t\t\tthis.cache.add( cacheKey, dependency );\n\n\t\t}\n\n\t\treturn dependency;\n\n\t}\n\n\t/**\n\t * Requests all dependencies of the specified type asynchronously, with caching.\n\t * @param {string} type\n\t * @return {Promise<Array<Object>>}\n\t */\n\tgetDependencies( type ) {\n\n\t\tlet dependencies = this.cache.get( type );\n\n\t\tif ( ! dependencies ) {\n\n\t\t\tconst parser = this;\n\t\t\tconst defs = this.json[ type + ( type === 'mesh' ? 'es' : 's' ) ] || [];\n\n\t\t\tdependencies = Promise.all( defs.map( function ( def, index ) {\n\n\t\t\t\treturn parser.getDependency( type, index );\n\n\t\t\t} ) );\n\n\t\t\tthis.cache.add( type, dependencies );\n\n\t\t}\n\n\t\treturn dependencies;\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\n\t * @param {number} bufferIndex\n\t * @return {Promise<ArrayBuffer>}\n\t */\n\tloadBuffer( bufferIndex ) {\n\n\t\tconst bufferDef = this.json.buffers[ bufferIndex ];\n\t\tconst loader = this.fileLoader;\n\n\t\tif ( bufferDef.type && bufferDef.type !== 'arraybuffer' ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: ' + bufferDef.type + ' buffer type is not supported.' );\n\n\t\t}\n\n\t\t// If present, GLB container is required to be the first buffer.\n\t\tif ( bufferDef.uri === undefined && bufferIndex === 0 ) {\n\n\t\t\treturn Promise.resolve( this.extensions[ EXTENSIONS.KHR_BINARY_GLTF ].body );\n\n\t\t}\n\n\t\tconst options = this.options;\n\n\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\tloader.load( resolveURL( bufferDef.uri, options.path ), resolve, undefined, function () {\n\n\t\t\t\treject( new Error( 'THREE.GLTFLoader: Failed to load buffer \"' + bufferDef.uri + '\".' ) );\n\n\t\t\t} );\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\n\t * @param {number} bufferViewIndex\n\t * @return {Promise<ArrayBuffer>}\n\t */\n\tloadBufferView( bufferViewIndex ) {\n\n\t\tconst bufferViewDef = this.json.bufferViews[ bufferViewIndex ];\n\n\t\treturn this.getDependency( 'buffer', bufferViewDef.buffer ).then( function ( buffer ) {\n\n\t\t\tconst byteLength = bufferViewDef.byteLength || 0;\n\t\t\tconst byteOffset = bufferViewDef.byteOffset || 0;\n\t\t\treturn buffer.slice( byteOffset, byteOffset + byteLength );\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#accessors\n\t * @param {number} accessorIndex\n\t * @return {Promise<BufferAttribute|InterleavedBufferAttribute>}\n\t */\n\tloadAccessor( accessorIndex ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\n\t\tconst accessorDef = this.json.accessors[ accessorIndex ];\n\n\t\tif ( accessorDef.bufferView === undefined && accessorDef.sparse === undefined ) {\n\n\t\t\t// Ignore empty accessors, which may be used to declare runtime\n\t\t\t// information about attributes coming from another source (e.g. Draco\n\t\t\t// compression extension).\n\t\t\treturn Promise.resolve( null );\n\n\t\t}\n\n\t\tconst pendingBufferViews = [];\n\n\t\tif ( accessorDef.bufferView !== undefined ) {\n\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.bufferView ) );\n\n\t\t} else {\n\n\t\t\tpendingBufferViews.push( null );\n\n\t\t}\n\n\t\tif ( accessorDef.sparse !== undefined ) {\n\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.indices.bufferView ) );\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.values.bufferView ) );\n\n\t\t}\n\n\t\treturn Promise.all( pendingBufferViews ).then( function ( bufferViews ) {\n\n\t\t\tconst bufferView = bufferViews[ 0 ];\n\n\t\t\tconst itemSize = WEBGL_TYPE_SIZES[ accessorDef.type ];\n\t\t\tconst TypedArray = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\n\n\t\t\t// For VEC3: itemSize is 3, elementBytes is 4, itemBytes is 12.\n\t\t\tconst elementBytes = TypedArray.BYTES_PER_ELEMENT;\n\t\t\tconst itemBytes = elementBytes * itemSize;\n\t\t\tconst byteOffset = accessorDef.byteOffset || 0;\n\t\t\tconst byteStride = accessorDef.bufferView !== undefined ? json.bufferViews[ accessorDef.bufferView ].byteStride : undefined;\n\t\t\tconst normalized = accessorDef.normalized === true;\n\t\t\tlet array, bufferAttribute;\n\n\t\t\t// The buffer is not interleaved if the stride is the item size in bytes.\n\t\t\tif ( byteStride && byteStride !== itemBytes ) {\n\n\t\t\t\t// Each \"slice\" of the buffer, as defined by 'count' elements of 'byteStride' bytes, gets its own InterleavedBuffer\n\t\t\t\t// This makes sure that IBA.count reflects accessor.count properly\n\t\t\t\tconst ibSlice = Math.floor( byteOffset / byteStride );\n\t\t\t\tconst ibCacheKey = 'InterleavedBuffer:' + accessorDef.bufferView + ':' + accessorDef.componentType + ':' + ibSlice + ':' + accessorDef.count;\n\t\t\t\tlet ib = parser.cache.get( ibCacheKey );\n\n\t\t\t\tif ( ! ib ) {\n\n\t\t\t\t\tarray = new TypedArray( bufferView, ibSlice * byteStride, accessorDef.count * byteStride / elementBytes );\n\n\t\t\t\t\t// Integer parameters to IB/IBA are in array elements, not bytes.\n\t\t\t\t\tib = new InterleavedBuffer( array, byteStride / elementBytes );\n\n\t\t\t\t\tparser.cache.add( ibCacheKey, ib );\n\n\t\t\t\t}\n\n\t\t\t\tbufferAttribute = new InterleavedBufferAttribute( ib, itemSize, ( byteOffset % byteStride ) / elementBytes, normalized );\n\n\t\t\t} else {\n\n\t\t\t\tif ( bufferView === null ) {\n\n\t\t\t\t\tarray = new TypedArray( accessorDef.count * itemSize );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tarray = new TypedArray( bufferView, byteOffset, accessorDef.count * itemSize );\n\n\t\t\t\t}\n\n\t\t\t\tbufferAttribute = new BufferAttribute( array, itemSize, normalized );\n\n\t\t\t}\n\n\t\t\t// https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#sparse-accessors\n\t\t\tif ( accessorDef.sparse !== undefined ) {\n\n\t\t\t\tconst itemSizeIndices = WEBGL_TYPE_SIZES.SCALAR;\n\t\t\t\tconst TypedArrayIndices = WEBGL_COMPONENT_TYPES[ accessorDef.sparse.indices.componentType ];\n\n\t\t\t\tconst byteOffsetIndices = accessorDef.sparse.indices.byteOffset || 0;\n\t\t\t\tconst byteOffsetValues = accessorDef.sparse.values.byteOffset || 0;\n\n\t\t\t\tconst sparseIndices = new TypedArrayIndices( bufferViews[ 1 ], byteOffsetIndices, accessorDef.sparse.count * itemSizeIndices );\n\t\t\t\tconst sparseValues = new TypedArray( bufferViews[ 2 ], byteOffsetValues, accessorDef.sparse.count * itemSize );\n\n\t\t\t\tif ( bufferView !== null ) {\n\n\t\t\t\t\t// Avoid modifying the original ArrayBuffer, if the bufferView wasn't initialized with zeroes.\n\t\t\t\t\tbufferAttribute = new BufferAttribute( bufferAttribute.array.slice(), bufferAttribute.itemSize, bufferAttribute.normalized );\n\n\t\t\t\t}\n\n\t\t\t\tfor ( let i = 0, il = sparseIndices.length; i < il; i ++ ) {\n\n\t\t\t\t\tconst index = sparseIndices[ i ];\n\n\t\t\t\t\tbufferAttribute.setX( index, sparseValues[ i * itemSize ] );\n\t\t\t\t\tif ( itemSize >= 2 ) bufferAttribute.setY( index, sparseValues[ i * itemSize + 1 ] );\n\t\t\t\t\tif ( itemSize >= 3 ) bufferAttribute.setZ( index, sparseValues[ i * itemSize + 2 ] );\n\t\t\t\t\tif ( itemSize >= 4 ) bufferAttribute.setW( index, sparseValues[ i * itemSize + 3 ] );\n\t\t\t\t\tif ( itemSize >= 5 ) throw new Error( 'THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.' );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn bufferAttribute;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#textures\n\t * @param {number} textureIndex\n\t * @return {Promise<THREE.Texture>}\n\t */\n\tloadTexture( textureIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst options = this.options;\n\t\tconst textureDef = json.textures[ textureIndex ];\n\t\tconst source = json.images[ textureDef.source ];\n\n\t\tlet loader = this.textureLoader;\n\n\t\tif ( source.uri ) {\n\n\t\t\tconst handler = options.manager.getHandler( source.uri );\n\t\t\tif ( handler !== null ) loader = handler;\n\n\t\t}\n\n\t\treturn this.loadTextureImage( textureIndex, source, loader );\n\n\t}\n\n\tloadTextureImage( textureIndex, source, loader ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst options = this.options;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\n\t\tconst cacheKey = ( source.uri || source.bufferView ) + ':' + textureDef.sampler;\n\n\t\tif ( this.textureCache[ cacheKey ] ) {\n\n\t\t\t// See https://github.com/mrdoob/three.js/issues/21559.\n\t\t\treturn this.textureCache[ cacheKey ];\n\n\t\t}\n\n\t\tconst URL = self.URL || self.webkitURL;\n\n\t\tlet sourceURI = source.uri || '';\n\t\tlet isObjectURL = false;\n\t\tlet hasAlpha = true;\n\n\t\tconst isJPEG = sourceURI.search( /\\.jpe?g($|\\?)/i ) > 0 || sourceURI.search( /^data\\:image\\/jpeg/ ) === 0;\n\n\t\tif ( source.mimeType === 'image/jpeg' || isJPEG ) hasAlpha = false;\n\n\t\tif ( source.bufferView !== undefined ) {\n\n\t\t\t// Load binary image data from bufferView, if provided.\n\n\t\t\tsourceURI = parser.getDependency( 'bufferView', source.bufferView ).then( function ( bufferView ) {\n\n\t\t\t\tif ( source.mimeType === 'image/png' ) {\n\n\t\t\t\t\t// Inspect the PNG 'IHDR' chunk to determine whether the image could have an\n\t\t\t\t\t// alpha channel. This check is conservative  the image could have an alpha\n\t\t\t\t\t// channel with all values == 1, and the indexed type (colorType == 3) only\n\t\t\t\t\t// sometimes contains alpha.\n\t\t\t\t\t//\n\t\t\t\t\t// https://en.wikipedia.org/wiki/Portable_Network_Graphics#File_header\n\t\t\t\t\tconst colorType = new DataView( bufferView, 25, 1 ).getUint8( 0, false );\n\t\t\t\t\thasAlpha = colorType === 6 || colorType === 4 || colorType === 3;\n\n\t\t\t\t}\n\n\t\t\t\tisObjectURL = true;\n\t\t\t\tconst blob = new Blob( [ bufferView ], { type: source.mimeType } );\n\t\t\t\tsourceURI = URL.createObjectURL( blob );\n\t\t\t\treturn sourceURI;\n\n\t\t\t} );\n\n\t\t} else if ( source.uri === undefined ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Image ' + textureIndex + ' is missing URI and bufferView' );\n\n\t\t}\n\n\t\tconst promise = Promise.resolve( sourceURI ).then( function ( sourceURI ) {\n\n\t\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\t\tlet onLoad = resolve;\n\n\t\t\t\tif ( loader.isImageBitmapLoader === true ) {\n\n\t\t\t\t\tonLoad = function ( imageBitmap ) {\n\n\t\t\t\t\t\tconst texture = new Texture( imageBitmap );\n\t\t\t\t\t\ttexture.needsUpdate = true;\n\n\t\t\t\t\t\tresolve( texture );\n\n\t\t\t\t\t};\n\n\t\t\t\t}\n\n\t\t\t\tloader.load( resolveURL( sourceURI, options.path ), onLoad, undefined, reject );\n\n\t\t\t} );\n\n\t\t} ).then( function ( texture ) {\n\n\t\t\t// Clean up resources and configure Texture.\n\n\t\t\tif ( isObjectURL === true ) {\n\n\t\t\t\tURL.revokeObjectURL( sourceURI );\n\n\t\t\t}\n\n\t\t\ttexture.flipY = false;\n\n\t\t\tif ( textureDef.name ) texture.name = textureDef.name;\n\n\t\t\t// When there is definitely no alpha channel in the texture, set RGBFormat to save space.\n\t\t\tif ( ! hasAlpha ) texture.format = RGBFormat;\n\n\t\t\tconst samplers = json.samplers || {};\n\t\t\tconst sampler = samplers[ textureDef.sampler ] || {};\n\n\t\t\ttexture.magFilter = WEBGL_FILTERS[ sampler.magFilter ] || LinearFilter;\n\t\t\ttexture.minFilter = WEBGL_FILTERS[ sampler.minFilter ] || LinearMipmapLinearFilter;\n\t\t\ttexture.wrapS = WEBGL_WRAPPINGS[ sampler.wrapS ] || RepeatWrapping;\n\t\t\ttexture.wrapT = WEBGL_WRAPPINGS[ sampler.wrapT ] || RepeatWrapping;\n\n\t\t\tparser.associations.set( texture, {\n\t\t\t\ttype: 'textures',\n\t\t\t\tindex: textureIndex\n\t\t\t} );\n\n\t\t\treturn texture;\n\n\t\t} ).catch( function () {\n\n\t\t\tconsole.error( 'THREE.GLTFLoader: Couldn\\'t load texture', sourceURI );\n\t\t\treturn null;\n\n\t\t} );\n\n\t\tthis.textureCache[ cacheKey ] = promise;\n\n\t\treturn promise;\n\n\t}\n\n\t/**\n\t * Asynchronously assigns a texture to the given material parameters.\n\t * @param {Object} materialParams\n\t * @param {string} mapName\n\t * @param {Object} mapDef\n\t * @return {Promise}\n\t */\n\tassignTexture( materialParams, mapName, mapDef ) {\n\n\t\tconst parser = this;\n\n\t\treturn this.getDependency( 'texture', mapDef.index ).then( function ( texture ) {\n\n\t\t\t// Materials sample aoMap from UV set 1 and other maps from UV set 0 - this can't be configured\n\t\t\t// However, we will copy UV set 0 to UV set 1 on demand for aoMap\n\t\t\tif ( mapDef.texCoord !== undefined && mapDef.texCoord != 0 && ! ( mapName === 'aoMap' && mapDef.texCoord == 1 ) ) {\n\n\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Custom UV set ' + mapDef.texCoord + ' for texture ' + mapName + ' not yet supported.' );\n\n\t\t\t}\n\n\t\t\tif ( parser.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ] ) {\n\n\t\t\t\tconst transform = mapDef.extensions !== undefined ? mapDef.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ] : undefined;\n\n\t\t\t\tif ( transform ) {\n\n\t\t\t\t\tconst gltfReference = parser.associations.get( texture );\n\t\t\t\t\ttexture = parser.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ].extendTexture( texture, transform );\n\t\t\t\t\tparser.associations.set( texture, gltfReference );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tmaterialParams[ mapName ] = texture;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Assigns final material to a Mesh, Line, or Points instance. The instance\n\t * already has a material (generated from the glTF material options alone)\n\t * but reuse of the same glTF material may require multiple threejs materials\n\t * to accommodate different primitive types, defines, etc. New materials will\n\t * be created if necessary, and reused from a cache.\n\t * @param  {Object3D} mesh Mesh, Line, or Points instance.\n\t */\n\tassignFinalMaterial( mesh ) {\n\n\t\tconst geometry = mesh.geometry;\n\t\tlet material = mesh.material;\n\n\t\tconst useVertexTangents = geometry.attributes.tangent !== undefined;\n\t\tconst useVertexColors = geometry.attributes.color !== undefined;\n\t\tconst useFlatShading = geometry.attributes.normal === undefined;\n\t\tconst useMorphTargets = Object.keys( geometry.morphAttributes ).length > 0;\n\t\tconst useMorphNormals = useMorphTargets && geometry.morphAttributes.normal !== undefined;\n\n\t\tif ( mesh.isPoints ) {\n\n\t\t\tconst cacheKey = 'PointsMaterial:' + material.uuid;\n\n\t\t\tlet pointsMaterial = this.cache.get( cacheKey );\n\n\t\t\tif ( ! pointsMaterial ) {\n\n\t\t\t\tpointsMaterial = new PointsMaterial();\n\t\t\t\tMaterial.prototype.copy.call( pointsMaterial, material );\n\t\t\t\tpointsMaterial.color.copy( material.color );\n\t\t\t\tpointsMaterial.map = material.map;\n\t\t\t\tpointsMaterial.sizeAttenuation = false; // glTF spec says points should be 1px\n\n\t\t\t\tthis.cache.add( cacheKey, pointsMaterial );\n\n\t\t\t}\n\n\t\t\tmaterial = pointsMaterial;\n\n\t\t} else if ( mesh.isLine ) {\n\n\t\t\tconst cacheKey = 'LineBasicMaterial:' + material.uuid;\n\n\t\t\tlet lineMaterial = this.cache.get( cacheKey );\n\n\t\t\tif ( ! lineMaterial ) {\n\n\t\t\t\tlineMaterial = new LineBasicMaterial();\n\t\t\t\tMaterial.prototype.copy.call( lineMaterial, material );\n\t\t\t\tlineMaterial.color.copy( material.color );\n\n\t\t\t\tthis.cache.add( cacheKey, lineMaterial );\n\n\t\t\t}\n\n\t\t\tmaterial = lineMaterial;\n\n\t\t}\n\n\t\t// Clone the material if it will be modified\n\t\tif ( useVertexTangents || useVertexColors || useFlatShading || useMorphTargets ) {\n\n\t\t\tlet cacheKey = 'ClonedMaterial:' + material.uuid + ':';\n\n\t\t\tif ( material.isGLTFSpecularGlossinessMaterial ) cacheKey += 'specular-glossiness:';\n\t\t\tif ( useVertexTangents ) cacheKey += 'vertex-tangents:';\n\t\t\tif ( useVertexColors ) cacheKey += 'vertex-colors:';\n\t\t\tif ( useFlatShading ) cacheKey += 'flat-shading:';\n\t\t\tif ( useMorphTargets ) cacheKey += 'morph-targets:';\n\t\t\tif ( useMorphNormals ) cacheKey += 'morph-normals:';\n\n\t\t\tlet cachedMaterial = this.cache.get( cacheKey );\n\n\t\t\tif ( ! cachedMaterial ) {\n\n\t\t\t\tcachedMaterial = material.clone();\n\n\t\t\t\tif ( useVertexColors ) cachedMaterial.vertexColors = true;\n\t\t\t\tif ( useFlatShading ) cachedMaterial.flatShading = true;\n\t\t\t\tif ( useMorphTargets ) cachedMaterial.morphTargets = true;\n\t\t\t\tif ( useMorphNormals ) cachedMaterial.morphNormals = true;\n\n\t\t\t\tif ( useVertexTangents ) {\n\n\t\t\t\t\tcachedMaterial.vertexTangents = true;\n\n\t\t\t\t\t// https://github.com/mrdoob/three.js/issues/11438#issuecomment-507003995\n\t\t\t\t\tif ( cachedMaterial.normalScale ) cachedMaterial.normalScale.y *= - 1;\n\t\t\t\t\tif ( cachedMaterial.clearcoatNormalScale ) cachedMaterial.clearcoatNormalScale.y *= - 1;\n\n\t\t\t\t}\n\n\t\t\t\tthis.cache.add( cacheKey, cachedMaterial );\n\n\t\t\t\tthis.associations.set( cachedMaterial, this.associations.get( material ) );\n\n\t\t\t}\n\n\t\t\tmaterial = cachedMaterial;\n\n\t\t}\n\n\t\t// workarounds for mesh and geometry\n\n\t\tif ( material.aoMap && geometry.attributes.uv2 === undefined && geometry.attributes.uv !== undefined ) {\n\n\t\t\tgeometry.setAttribute( 'uv2', geometry.attributes.uv );\n\n\t\t}\n\n\t\tmesh.material = material;\n\n\t}\n\n\tgetMaterialType( /* materialIndex */ ) {\n\n\t\treturn MeshStandardMaterial;\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#materials\n\t * @param {number} materialIndex\n\t * @return {Promise<Material>}\n\t */\n\tloadMaterial( materialIndex ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\t\tconst materialDef = json.materials[ materialIndex ];\n\n\t\tlet materialType;\n\t\tconst materialParams = {};\n\t\tconst materialExtensions = materialDef.extensions || {};\n\n\t\tconst pending = [];\n\n\t\tif ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ] ) {\n\n\t\t\tconst sgExtension = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ];\n\t\t\tmaterialType = sgExtension.getMaterialType();\n\t\t\tpending.push( sgExtension.extendParams( materialParams, materialDef, parser ) );\n\n\t\t} else if ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_UNLIT ] ) {\n\n\t\t\tconst kmuExtension = extensions[ EXTENSIONS.KHR_MATERIALS_UNLIT ];\n\t\t\tmaterialType = kmuExtension.getMaterialType();\n\t\t\tpending.push( kmuExtension.extendParams( materialParams, materialDef, parser ) );\n\n\t\t} else {\n\n\t\t\t// Specification:\n\t\t\t// https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#metallic-roughness-material\n\n\t\t\tconst metallicRoughness = materialDef.pbrMetallicRoughness || {};\n\n\t\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\n\t\t\tmaterialParams.opacity = 1.0;\n\n\t\t\tif ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\n\n\t\t\t\tconst array = metallicRoughness.baseColorFactor;\n\n\t\t\t\tmaterialParams.color.fromArray( array );\n\t\t\t\tmaterialParams.opacity = array[ 3 ];\n\n\t\t\t}\n\n\t\t\tif ( metallicRoughness.baseColorTexture !== undefined ) {\n\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture ) );\n\n\t\t\t}\n\n\t\t\tmaterialParams.metalness = metallicRoughness.metallicFactor !== undefined ? metallicRoughness.metallicFactor : 1.0;\n\t\t\tmaterialParams.roughness = metallicRoughness.roughnessFactor !== undefined ? metallicRoughness.roughnessFactor : 1.0;\n\n\t\t\tif ( metallicRoughness.metallicRoughnessTexture !== undefined ) {\n\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'metalnessMap', metallicRoughness.metallicRoughnessTexture ) );\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'roughnessMap', metallicRoughness.metallicRoughnessTexture ) );\n\n\t\t\t}\n\n\t\t\tmaterialType = this._invokeOne( function ( ext ) {\n\n\t\t\t\treturn ext.getMaterialType && ext.getMaterialType( materialIndex );\n\n\t\t\t} );\n\n\t\t\tpending.push( Promise.all( this._invokeAll( function ( ext ) {\n\n\t\t\t\treturn ext.extendMaterialParams && ext.extendMaterialParams( materialIndex, materialParams );\n\n\t\t\t} ) ) );\n\n\t\t}\n\n\t\tif ( materialDef.doubleSided === true ) {\n\n\t\t\tmaterialParams.side = DoubleSide;\n\n\t\t}\n\n\t\tconst alphaMode = materialDef.alphaMode || ALPHA_MODES.OPAQUE;\n\n\t\tif ( alphaMode === ALPHA_MODES.BLEND ) {\n\n\t\t\tmaterialParams.transparent = true;\n\n\t\t\t// See: https://github.com/mrdoob/three.js/issues/17706\n\t\t\tmaterialParams.depthWrite = false;\n\n\t\t} else {\n\n\t\t\tmaterialParams.transparent = false;\n\n\t\t\tif ( alphaMode === ALPHA_MODES.MASK ) {\n\n\t\t\t\tmaterialParams.alphaTest = materialDef.alphaCutoff !== undefined ? materialDef.alphaCutoff : 0.5;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( materialDef.normalTexture !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'normalMap', materialDef.normalTexture ) );\n\n\t\t\t// https://github.com/mrdoob/three.js/issues/11438#issuecomment-507003995\n\t\t\tmaterialParams.normalScale = new Vector2( 1, - 1 );\n\n\t\t\tif ( materialDef.normalTexture.scale !== undefined ) {\n\n\t\t\t\tmaterialParams.normalScale.set( materialDef.normalTexture.scale, - materialDef.normalTexture.scale );\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( materialDef.occlusionTexture !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'aoMap', materialDef.occlusionTexture ) );\n\n\t\t\tif ( materialDef.occlusionTexture.strength !== undefined ) {\n\n\t\t\t\tmaterialParams.aoMapIntensity = materialDef.occlusionTexture.strength;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( materialDef.emissiveFactor !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tmaterialParams.emissive = new Color().fromArray( materialDef.emissiveFactor );\n\n\t\t}\n\n\t\tif ( materialDef.emissiveTexture !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'emissiveMap', materialDef.emissiveTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending ).then( function () {\n\n\t\t\tlet material;\n\n\t\t\tif ( materialType === GLTFMeshStandardSGMaterial ) {\n\n\t\t\t\tmaterial = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ].createMaterial( materialParams );\n\n\t\t\t} else {\n\n\t\t\t\tmaterial = new materialType( materialParams );\n\n\t\t\t}\n\n\t\t\tif ( materialDef.name ) material.name = materialDef.name;\n\n\t\t\t// baseColorTexture, emissiveTexture, and specularGlossinessTexture use sRGB encoding.\n\t\t\tif ( material.map ) material.map.encoding = sRGBEncoding;\n\t\t\tif ( material.emissiveMap ) material.emissiveMap.encoding = sRGBEncoding;\n\n\t\t\tassignExtrasToUserData( material, materialDef );\n\n\t\t\tparser.associations.set( material, { type: 'materials', index: materialIndex } );\n\n\t\t\tif ( materialDef.extensions ) addUnknownExtensionsToUserData( extensions, material, materialDef );\n\n\t\t\treturn material;\n\n\t\t} );\n\n\t}\n\n\t/** When Object3D instances are targeted by animation, they need unique names. */\n\tcreateUniqueName( originalName ) {\n\n\t\tconst sanitizedName = PropertyBinding.sanitizeNodeName( originalName || '' );\n\n\t\tlet name = sanitizedName;\n\n\t\tfor ( let i = 1; this.nodeNamesUsed[ name ]; ++ i ) {\n\n\t\t\tname = sanitizedName + '_' + i;\n\n\t\t}\n\n\t\tthis.nodeNamesUsed[ name ] = true;\n\n\t\treturn name;\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#geometry\n\t *\n\t * Creates BufferGeometries from primitives.\n\t *\n\t * @param {Array<GLTF.Primitive>} primitives\n\t * @return {Promise<Array<BufferGeometry>>}\n\t */\n\tloadGeometries( primitives ) {\n\n\t\tconst parser = this;\n\t\tconst extensions = this.extensions;\n\t\tconst cache = this.primitiveCache;\n\n\t\tfunction createDracoPrimitive( primitive ) {\n\n\t\t\treturn extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ]\n\t\t\t\t.decodePrimitive( primitive, parser )\n\t\t\t\t.then( function ( geometry ) {\n\n\t\t\t\t\treturn addPrimitiveAttributes( geometry, primitive, parser );\n\n\t\t\t\t} );\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = primitives.length; i < il; i ++ ) {\n\n\t\t\tconst primitive = primitives[ i ];\n\t\t\tconst cacheKey = createPrimitiveKey( primitive );\n\n\t\t\t// See if we've already created this geometry\n\t\t\tconst cached = cache[ cacheKey ];\n\n\t\t\tif ( cached ) {\n\n\t\t\t\t// Use the cached geometry if it exists\n\t\t\t\tpending.push( cached.promise );\n\n\t\t\t} else {\n\n\t\t\t\tlet geometryPromise;\n\n\t\t\t\tif ( primitive.extensions && primitive.extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ] ) {\n\n\t\t\t\t\t// Use DRACO geometry if available\n\t\t\t\t\tgeometryPromise = createDracoPrimitive( primitive );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// Otherwise create a new geometry\n\t\t\t\t\tgeometryPromise = addPrimitiveAttributes( new BufferGeometry(), primitive, parser );\n\n\t\t\t\t}\n\n\t\t\t\t// Cache this geometry\n\t\t\t\tcache[ cacheKey ] = { primitive: primitive, promise: geometryPromise };\n\n\t\t\t\tpending.push( geometryPromise );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#meshes\n\t * @param {number} meshIndex\n\t * @return {Promise<Group|Mesh|SkinnedMesh>}\n\t */\n\tloadMesh( meshIndex ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\n\t\tconst meshDef = json.meshes[ meshIndex ];\n\t\tconst primitives = meshDef.primitives;\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = primitives.length; i < il; i ++ ) {\n\n\t\t\tconst material = primitives[ i ].material === undefined\n\t\t\t\t? createDefaultMaterial( this.cache )\n\t\t\t\t: this.getDependency( 'material', primitives[ i ].material );\n\n\t\t\tpending.push( material );\n\n\t\t}\n\n\t\tpending.push( parser.loadGeometries( primitives ) );\n\n\t\treturn Promise.all( pending ).then( function ( results ) {\n\n\t\t\tconst materials = results.slice( 0, results.length - 1 );\n\t\t\tconst geometries = results[ results.length - 1 ];\n\n\t\t\tconst meshes = [];\n\n\t\t\tfor ( let i = 0, il = geometries.length; i < il; i ++ ) {\n\n\t\t\t\tconst geometry = geometries[ i ];\n\t\t\t\tconst primitive = primitives[ i ];\n\n\t\t\t\t// 1. create Mesh\n\n\t\t\t\tlet mesh;\n\n\t\t\t\tconst material = materials[ i ];\n\n\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLES ||\n\t\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ||\n\t\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ||\n\t\t\t\t\t\tprimitive.mode === undefined ) {\n\n\t\t\t\t\t// .isSkinnedMesh isn't in glTF spec. See ._markDefs()\n\t\t\t\t\tmesh = meshDef.isSkinnedMesh === true\n\t\t\t\t\t\t? new SkinnedMesh( geometry, material )\n\t\t\t\t\t\t: new Mesh( geometry, material );\n\n\t\t\t\t\tif ( mesh.isSkinnedMesh === true && ! mesh.geometry.attributes.skinWeight.normalized ) {\n\n\t\t\t\t\t\t// we normalize floating point skin weight array to fix malformed assets (see #15319)\n\t\t\t\t\t\t// it's important to skip this for non-float32 data since normalizeSkinWeights assumes non-normalized inputs\n\t\t\t\t\t\tmesh.normalizeSkinWeights();\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ) {\n\n\t\t\t\t\t\tmesh.geometry = toTrianglesDrawMode( mesh.geometry, TriangleStripDrawMode );\n\n\t\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ) {\n\n\t\t\t\t\t\tmesh.geometry = toTrianglesDrawMode( mesh.geometry, TriangleFanDrawMode );\n\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINES ) {\n\n\t\t\t\t\tmesh = new LineSegments( geometry, material );\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_STRIP ) {\n\n\t\t\t\t\tmesh = new Line( geometry, material );\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_LOOP ) {\n\n\t\t\t\t\tmesh = new LineLoop( geometry, material );\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.POINTS ) {\n\n\t\t\t\t\tmesh = new Points( geometry, material );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Primitive mode unsupported: ' + primitive.mode );\n\n\t\t\t\t}\n\n\t\t\t\tif ( Object.keys( mesh.geometry.morphAttributes ).length > 0 ) {\n\n\t\t\t\t\tupdateMorphTargets( mesh, meshDef );\n\n\t\t\t\t}\n\n\t\t\t\tmesh.name = parser.createUniqueName( meshDef.name || ( 'mesh_' + meshIndex ) );\n\n\t\t\t\tassignExtrasToUserData( mesh, meshDef );\n\n\t\t\t\tif ( primitive.extensions ) addUnknownExtensionsToUserData( extensions, mesh, primitive );\n\n\t\t\t\tparser.assignFinalMaterial( mesh );\n\n\t\t\t\tmeshes.push( mesh );\n\n\t\t\t}\n\n\t\t\tif ( meshes.length === 1 ) {\n\n\t\t\t\treturn meshes[ 0 ];\n\n\t\t\t}\n\n\t\t\tconst group = new Group();\n\n\t\t\tfor ( let i = 0, il = meshes.length; i < il; i ++ ) {\n\n\t\t\t\tgroup.add( meshes[ i ] );\n\n\t\t\t}\n\n\t\t\treturn group;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#cameras\n\t * @param {number} cameraIndex\n\t * @return {Promise<THREE.Camera>}\n\t */\n\tloadCamera( cameraIndex ) {\n\n\t\tlet camera;\n\t\tconst cameraDef = this.json.cameras[ cameraIndex ];\n\t\tconst params = cameraDef[ cameraDef.type ];\n\n\t\tif ( ! params ) {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing camera parameters.' );\n\t\t\treturn;\n\n\t\t}\n\n\t\tif ( cameraDef.type === 'perspective' ) {\n\n\t\t\tcamera = new PerspectiveCamera( MathUtils.radToDeg( params.yfov ), params.aspectRatio || 1, params.znear || 1, params.zfar || 2e6 );\n\n\t\t} else if ( cameraDef.type === 'orthographic' ) {\n\n\t\t\tcamera = new OrthographicCamera( - params.xmag, params.xmag, params.ymag, - params.ymag, params.znear, params.zfar );\n\n\t\t}\n\n\t\tif ( cameraDef.name ) camera.name = this.createUniqueName( cameraDef.name );\n\n\t\tassignExtrasToUserData( camera, cameraDef );\n\n\t\treturn Promise.resolve( camera );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#skins\n\t * @param {number} skinIndex\n\t * @return {Promise<Object>}\n\t */\n\tloadSkin( skinIndex ) {\n\n\t\tconst skinDef = this.json.skins[ skinIndex ];\n\n\t\tconst skinEntry = { joints: skinDef.joints };\n\n\t\tif ( skinDef.inverseBindMatrices === undefined ) {\n\n\t\t\treturn Promise.resolve( skinEntry );\n\n\t\t}\n\n\t\treturn this.getDependency( 'accessor', skinDef.inverseBindMatrices ).then( function ( accessor ) {\n\n\t\t\tskinEntry.inverseBindMatrices = accessor;\n\n\t\t\treturn skinEntry;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#animations\n\t * @param {number} animationIndex\n\t * @return {Promise<AnimationClip>}\n\t */\n\tloadAnimation( animationIndex ) {\n\n\t\tconst json = this.json;\n\n\t\tconst animationDef = json.animations[ animationIndex ];\n\n\t\tconst pendingNodes = [];\n\t\tconst pendingInputAccessors = [];\n\t\tconst pendingOutputAccessors = [];\n\t\tconst pendingSamplers = [];\n\t\tconst pendingTargets = [];\n\n\t\tfor ( let i = 0, il = animationDef.channels.length; i < il; i ++ ) {\n\n\t\t\tconst channel = animationDef.channels[ i ];\n\t\t\tconst sampler = animationDef.samplers[ channel.sampler ];\n\t\t\tconst target = channel.target;\n\t\t\tconst name = target.node !== undefined ? target.node : target.id; // NOTE: target.id is deprecated.\n\t\t\tconst input = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.input ] : sampler.input;\n\t\t\tconst output = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.output ] : sampler.output;\n\n\t\t\tpendingNodes.push( this.getDependency( 'node', name ) );\n\t\t\tpendingInputAccessors.push( this.getDependency( 'accessor', input ) );\n\t\t\tpendingOutputAccessors.push( this.getDependency( 'accessor', output ) );\n\t\t\tpendingSamplers.push( sampler );\n\t\t\tpendingTargets.push( target );\n\n\t\t}\n\n\t\treturn Promise.all( [\n\n\t\t\tPromise.all( pendingNodes ),\n\t\t\tPromise.all( pendingInputAccessors ),\n\t\t\tPromise.all( pendingOutputAccessors ),\n\t\t\tPromise.all( pendingSamplers ),\n\t\t\tPromise.all( pendingTargets )\n\n\t\t] ).then( function ( dependencies ) {\n\n\t\t\tconst nodes = dependencies[ 0 ];\n\t\t\tconst inputAccessors = dependencies[ 1 ];\n\t\t\tconst outputAccessors = dependencies[ 2 ];\n\t\t\tconst samplers = dependencies[ 3 ];\n\t\t\tconst targets = dependencies[ 4 ];\n\n\t\t\tconst tracks = [];\n\n\t\t\tfor ( let i = 0, il = nodes.length; i < il; i ++ ) {\n\n\t\t\t\tconst node = nodes[ i ];\n\t\t\t\tconst inputAccessor = inputAccessors[ i ];\n\t\t\t\tconst outputAccessor = outputAccessors[ i ];\n\t\t\t\tconst sampler = samplers[ i ];\n\t\t\t\tconst target = targets[ i ];\n\n\t\t\t\tif ( node === undefined ) continue;\n\n\t\t\t\tnode.updateMatrix();\n\t\t\t\tnode.matrixAutoUpdate = true;\n\n\t\t\t\tlet TypedKeyframeTrack;\n\n\t\t\t\tswitch ( PATH_PROPERTIES[ target.path ] ) {\n\n\t\t\t\t\tcase PATH_PROPERTIES.weights:\n\n\t\t\t\t\t\tTypedKeyframeTrack = NumberKeyframeTrack;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase PATH_PROPERTIES.rotation:\n\n\t\t\t\t\t\tTypedKeyframeTrack = QuaternionKeyframeTrack;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase PATH_PROPERTIES.position:\n\t\t\t\t\tcase PATH_PROPERTIES.scale:\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tTypedKeyframeTrack = VectorKeyframeTrack;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t\tconst targetName = node.name ? node.name : node.uuid;\n\n\t\t\t\tconst interpolation = sampler.interpolation !== undefined ? INTERPOLATION[ sampler.interpolation ] : InterpolateLinear;\n\n\t\t\t\tconst targetNames = [];\n\n\t\t\t\tif ( PATH_PROPERTIES[ target.path ] === PATH_PROPERTIES.weights ) {\n\n\t\t\t\t\t// Node may be a Group (glTF mesh with several primitives) or a Mesh.\n\t\t\t\t\tnode.traverse( function ( object ) {\n\n\t\t\t\t\t\tif ( object.isMesh === true && object.morphTargetInfluences ) {\n\n\t\t\t\t\t\t\ttargetNames.push( object.name ? object.name : object.uuid );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} );\n\n\t\t\t\t} else {\n\n\t\t\t\t\ttargetNames.push( targetName );\n\n\t\t\t\t}\n\n\t\t\t\tlet outputArray = outputAccessor.array;\n\n\t\t\t\tif ( outputAccessor.normalized ) {\n\n\t\t\t\t\tconst scale = getNormalizedComponentScale( outputArray.constructor );\n\t\t\t\t\tconst scaled = new Float32Array( outputArray.length );\n\n\t\t\t\t\tfor ( let j = 0, jl = outputArray.length; j < jl; j ++ ) {\n\n\t\t\t\t\t\tscaled[ j ] = outputArray[ j ] * scale;\n\n\t\t\t\t\t}\n\n\t\t\t\t\toutputArray = scaled;\n\n\t\t\t\t}\n\n\t\t\t\tfor ( let j = 0, jl = targetNames.length; j < jl; j ++ ) {\n\n\t\t\t\t\tconst track = new TypedKeyframeTrack(\n\t\t\t\t\t\ttargetNames[ j ] + '.' + PATH_PROPERTIES[ target.path ],\n\t\t\t\t\t\tinputAccessor.array,\n\t\t\t\t\t\toutputArray,\n\t\t\t\t\t\tinterpolation\n\t\t\t\t\t);\n\n\t\t\t\t\t// Override interpolation with custom factory method.\n\t\t\t\t\tif ( sampler.interpolation === 'CUBICSPLINE' ) {\n\n\t\t\t\t\t\ttrack.createInterpolant = function InterpolantFactoryMethodGLTFCubicSpline( result ) {\n\n\t\t\t\t\t\t\t// A CUBICSPLINE keyframe in glTF has three output values for each input value,\n\t\t\t\t\t\t\t// representing inTangent, splineVertex, and outTangent. As a result, track.getValueSize()\n\t\t\t\t\t\t\t// must be divided by three to get the interpolant's sampleSize argument.\n\n\t\t\t\t\t\t\treturn new GLTFCubicSplineInterpolant( this.times, this.values, this.getValueSize() / 3, result );\n\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t// Mark as CUBICSPLINE. `track.getInterpolation()` doesn't support custom interpolants.\n\t\t\t\t\t\ttrack.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline = true;\n\n\t\t\t\t\t}\n\n\t\t\t\t\ttracks.push( track );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tconst name = animationDef.name ? animationDef.name : 'animation_' + animationIndex;\n\n\t\t\treturn new AnimationClip( name, undefined, tracks );\n\n\t\t} );\n\n\t}\n\n\tcreateNodeMesh( nodeIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst parser = this;\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\n\t\tif ( nodeDef.mesh === undefined ) return null;\n\n\t\treturn parser.getDependency( 'mesh', nodeDef.mesh ).then( function ( mesh ) {\n\n\t\t\tconst node = parser._getNodeRef( parser.meshCache, nodeDef.mesh, mesh );\n\n\t\t\t// if weights are provided on the node, override weights on the mesh.\n\t\t\tif ( nodeDef.weights !== undefined ) {\n\n\t\t\t\tnode.traverse( function ( o ) {\n\n\t\t\t\t\tif ( ! o.isMesh ) return;\n\n\t\t\t\t\tfor ( let i = 0, il = nodeDef.weights.length; i < il; i ++ ) {\n\n\t\t\t\t\t\to.morphTargetInfluences[ i ] = nodeDef.weights[ i ];\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\treturn node;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#nodes-and-hierarchy\n\t * @param {number} nodeIndex\n\t * @return {Promise<Object3D>}\n\t */\n\tloadNode( nodeIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\t\tconst parser = this;\n\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\n\t\t// reserve node's name before its dependencies, so the root has the intended name.\n\t\tconst nodeName = nodeDef.name ? parser.createUniqueName( nodeDef.name ) : '';\n\n\t\treturn ( function () {\n\n\t\t\tconst pending = [];\n\n\t\t\tconst meshPromise = parser._invokeOne( function ( ext ) {\n\n\t\t\t\treturn ext.createNodeMesh && ext.createNodeMesh( nodeIndex );\n\n\t\t\t} );\n\n\t\t\tif ( meshPromise ) {\n\n\t\t\t\tpending.push( meshPromise );\n\n\t\t\t}\n\n\t\t\tif ( nodeDef.camera !== undefined ) {\n\n\t\t\t\tpending.push( parser.getDependency( 'camera', nodeDef.camera ).then( function ( camera ) {\n\n\t\t\t\t\treturn parser._getNodeRef( parser.cameraCache, nodeDef.camera, camera );\n\n\t\t\t\t} ) );\n\n\t\t\t}\n\n\t\t\tparser._invokeAll( function ( ext ) {\n\n\t\t\t\treturn ext.createNodeAttachment && ext.createNodeAttachment( nodeIndex );\n\n\t\t\t} ).forEach( function ( promise ) {\n\n\t\t\t\tpending.push( promise );\n\n\t\t\t} );\n\n\t\t\treturn Promise.all( pending );\n\n\t\t}() ).then( function ( objects ) {\n\n\t\t\tlet node;\n\n\t\t\t// .isBone isn't in glTF spec. See ._markDefs\n\t\t\tif ( nodeDef.isBone === true ) {\n\n\t\t\t\tnode = new Bone();\n\n\t\t\t} else if ( objects.length > 1 ) {\n\n\t\t\t\tnode = new Group();\n\n\t\t\t} else if ( objects.length === 1 ) {\n\n\t\t\t\tnode = objects[ 0 ];\n\n\t\t\t} else {\n\n\t\t\t\tnode = new Object3D();\n\n\t\t\t}\n\n\t\t\tif ( node !== objects[ 0 ] ) {\n\n\t\t\t\tfor ( let i = 0, il = objects.length; i < il; i ++ ) {\n\n\t\t\t\t\tnode.add( objects[ i ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( nodeDef.name ) {\n\n\t\t\t\tnode.userData.name = nodeDef.name;\n\t\t\t\tnode.name = nodeName;\n\n\t\t\t}\n\n\t\t\tassignExtrasToUserData( node, nodeDef );\n\n\t\t\tif ( nodeDef.extensions ) addUnknownExtensionsToUserData( extensions, node, nodeDef );\n\n\t\t\tif ( nodeDef.matrix !== undefined ) {\n\n\t\t\t\tconst matrix = new Matrix4();\n\t\t\t\tmatrix.fromArray( nodeDef.matrix );\n\t\t\t\tnode.applyMatrix4( matrix );\n\n\t\t\t} else {\n\n\t\t\t\tif ( nodeDef.translation !== undefined ) {\n\n\t\t\t\t\tnode.position.fromArray( nodeDef.translation );\n\n\t\t\t\t}\n\n\t\t\t\tif ( nodeDef.rotation !== undefined ) {\n\n\t\t\t\t\tnode.quaternion.fromArray( nodeDef.rotation );\n\n\t\t\t\t}\n\n\t\t\t\tif ( nodeDef.scale !== undefined ) {\n\n\t\t\t\t\tnode.scale.fromArray( nodeDef.scale );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tparser.associations.set( node, { type: 'nodes', index: nodeIndex } );\n\n\t\t\treturn node;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#scenes\n\t * @param {number} sceneIndex\n\t * @return {Promise<Group>}\n\t */\n\tloadScene( sceneIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\t\tconst sceneDef = this.json.scenes[ sceneIndex ];\n\t\tconst parser = this;\n\n\t\t// Loader returns Group, not Scene.\n\t\t// See: https://github.com/mrdoob/three.js/issues/18342#issuecomment-578981172\n\t\tconst scene = new Group();\n\t\tif ( sceneDef.name ) scene.name = parser.createUniqueName( sceneDef.name );\n\n\t\tassignExtrasToUserData( scene, sceneDef );\n\n\t\tif ( sceneDef.extensions ) addUnknownExtensionsToUserData( extensions, scene, sceneDef );\n\n\t\tconst nodeIds = sceneDef.nodes || [];\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = nodeIds.length; i < il; i ++ ) {\n\n\t\t\tpending.push( buildNodeHierachy( nodeIds[ i ], scene, json, parser ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending ).then( function () {\n\n\t\t\treturn scene;\n\n\t\t} );\n\n\t}\n\n}\n\nfunction buildNodeHierachy( nodeId, parentObject, json, parser ) {\n\n\tconst nodeDef = json.nodes[ nodeId ];\n\n\treturn parser.getDependency( 'node', nodeId ).then( function ( node ) {\n\n\t\tif ( nodeDef.skin === undefined ) return node;\n\n\t\t// build skeleton here as well\n\n\t\tlet skinEntry;\n\n\t\treturn parser.getDependency( 'skin', nodeDef.skin ).then( function ( skin ) {\n\n\t\t\tskinEntry = skin;\n\n\t\t\tconst pendingJoints = [];\n\n\t\t\tfor ( let i = 0, il = skinEntry.joints.length; i < il; i ++ ) {\n\n\t\t\t\tpendingJoints.push( parser.getDependency( 'node', skinEntry.joints[ i ] ) );\n\n\t\t\t}\n\n\t\t\treturn Promise.all( pendingJoints );\n\n\t\t} ).then( function ( jointNodes ) {\n\n\t\t\tnode.traverse( function ( mesh ) {\n\n\t\t\t\tif ( ! mesh.isMesh ) return;\n\n\t\t\t\tconst bones = [];\n\t\t\t\tconst boneInverses = [];\n\n\t\t\t\tfor ( let j = 0, jl = jointNodes.length; j < jl; j ++ ) {\n\n\t\t\t\t\tconst jointNode = jointNodes[ j ];\n\n\t\t\t\t\tif ( jointNode ) {\n\n\t\t\t\t\t\tbones.push( jointNode );\n\n\t\t\t\t\t\tconst mat = new Matrix4();\n\n\t\t\t\t\t\tif ( skinEntry.inverseBindMatrices !== undefined ) {\n\n\t\t\t\t\t\t\tmat.fromArray( skinEntry.inverseBindMatrices.array, j * 16 );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tboneInverses.push( mat );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Joint \"%s\" could not be found.', skinEntry.joints[ j ] );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tmesh.bind( new Skeleton( bones, boneInverses ), mesh.matrixWorld );\n\n\t\t\t} );\n\n\t\t\treturn node;\n\n\t\t} );\n\n\t} ).then( function ( node ) {\n\n\t\t// build node hierachy\n\n\t\tparentObject.add( node );\n\n\t\tconst pending = [];\n\n\t\tif ( nodeDef.children ) {\n\n\t\t\tconst children = nodeDef.children;\n\n\t\t\tfor ( let i = 0, il = children.length; i < il; i ++ ) {\n\n\t\t\t\tconst child = children[ i ];\n\t\t\t\tpending.push( buildNodeHierachy( child, node, json, parser ) );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t} );\n\n}\n\n/**\n * @param {BufferGeometry} geometry\n * @param {GLTF.Primitive} primitiveDef\n * @param {GLTFParser} parser\n */\nfunction computeBounds( geometry, primitiveDef, parser ) {\n\n\tconst attributes = primitiveDef.attributes;\n\n\tconst box = new Box3();\n\n\tif ( attributes.POSITION !== undefined ) {\n\n\t\tconst accessor = parser.json.accessors[ attributes.POSITION ];\n\n\t\tconst min = accessor.min;\n\t\tconst max = accessor.max;\n\n\t\t// glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\n\n\t\tif ( min !== undefined && max !== undefined ) {\n\n\t\t\tbox.set(\n\t\t\t\tnew Vector3( min[ 0 ], min[ 1 ], min[ 2 ] ),\n\t\t\t\tnew Vector3( max[ 0 ], max[ 1 ], max[ 2 ] )\n\t\t\t);\n\n\t\t\tif ( accessor.normalized ) {\n\n\t\t\t\tconst boxScale = getNormalizedComponentScale( WEBGL_COMPONENT_TYPES[ accessor.componentType ] );\n\t\t\t\tbox.min.multiplyScalar( boxScale );\n\t\t\t\tbox.max.multiplyScalar( boxScale );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing min/max properties for accessor POSITION.' );\n\n\t\t\treturn;\n\n\t\t}\n\n\t} else {\n\n\t\treturn;\n\n\t}\n\n\tconst targets = primitiveDef.targets;\n\n\tif ( targets !== undefined ) {\n\n\t\tconst maxDisplacement = new Vector3();\n\t\tconst vector = new Vector3();\n\n\t\tfor ( let i = 0, il = targets.length; i < il; i ++ ) {\n\n\t\t\tconst target = targets[ i ];\n\n\t\t\tif ( target.POSITION !== undefined ) {\n\n\t\t\t\tconst accessor = parser.json.accessors[ target.POSITION ];\n\t\t\t\tconst min = accessor.min;\n\t\t\t\tconst max = accessor.max;\n\n\t\t\t\t// glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\n\n\t\t\t\tif ( min !== undefined && max !== undefined ) {\n\n\t\t\t\t\t// we need to get max of absolute components because target weight is [-1,1]\n\t\t\t\t\tvector.setX( Math.max( Math.abs( min[ 0 ] ), Math.abs( max[ 0 ] ) ) );\n\t\t\t\t\tvector.setY( Math.max( Math.abs( min[ 1 ] ), Math.abs( max[ 1 ] ) ) );\n\t\t\t\t\tvector.setZ( Math.max( Math.abs( min[ 2 ] ), Math.abs( max[ 2 ] ) ) );\n\n\n\t\t\t\t\tif ( accessor.normalized ) {\n\n\t\t\t\t\t\tconst boxScale = getNormalizedComponentScale( WEBGL_COMPONENT_TYPES[ accessor.componentType ] );\n\t\t\t\t\t\tvector.multiplyScalar( boxScale );\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// Note: this assumes that the sum of all weights is at most 1. This isn't quite correct - it's more conservative\n\t\t\t\t\t// to assume that each target can have a max weight of 1. However, for some use cases - notably, when morph targets\n\t\t\t\t\t// are used to implement key-frame animations and as such only two are active at a time - this results in very large\n\t\t\t\t\t// boxes. So for now we make a box that's sometimes a touch too small but is hopefully mostly of reasonable size.\n\t\t\t\t\tmaxDisplacement.max( vector );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing min/max properties for accessor POSITION.' );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\t// As per comment above this box isn't conservative, but has a reasonable size for a very large number of morph targets.\n\t\tbox.expandByVector( maxDisplacement );\n\n\t}\n\n\tgeometry.boundingBox = box;\n\n\tconst sphere = new Sphere();\n\n\tbox.getCenter( sphere.center );\n\tsphere.radius = box.min.distanceTo( box.max ) / 2;\n\n\tgeometry.boundingSphere = sphere;\n\n}\n\n/**\n * @param {BufferGeometry} geometry\n * @param {GLTF.Primitive} primitiveDef\n * @param {GLTFParser} parser\n * @return {Promise<BufferGeometry>}\n */\nfunction addPrimitiveAttributes( geometry, primitiveDef, parser ) {\n\n\tconst attributes = primitiveDef.attributes;\n\n\tconst pending = [];\n\n\tfunction assignAttributeAccessor( accessorIndex, attributeName ) {\n\n\t\treturn parser.getDependency( 'accessor', accessorIndex )\n\t\t\t.then( function ( accessor ) {\n\n\t\t\t\tgeometry.setAttribute( attributeName, accessor );\n\n\t\t\t} );\n\n\t}\n\n\tfor ( const gltfAttributeName in attributes ) {\n\n\t\tconst threeAttributeName = ATTRIBUTES[ gltfAttributeName ] || gltfAttributeName.toLowerCase();\n\n\t\t// Skip attributes already provided by e.g. Draco extension.\n\t\tif ( threeAttributeName in geometry.attributes ) continue;\n\n\t\tpending.push( assignAttributeAccessor( attributes[ gltfAttributeName ], threeAttributeName ) );\n\n\t}\n\n\tif ( primitiveDef.indices !== undefined && ! geometry.index ) {\n\n\t\tconst accessor = parser.getDependency( 'accessor', primitiveDef.indices ).then( function ( accessor ) {\n\n\t\t\tgeometry.setIndex( accessor );\n\n\t\t} );\n\n\t\tpending.push( accessor );\n\n\t}\n\n\tassignExtrasToUserData( geometry, primitiveDef );\n\n\tcomputeBounds( geometry, primitiveDef, parser );\n\n\treturn Promise.all( pending ).then( function () {\n\n\t\treturn primitiveDef.targets !== undefined\n\t\t\t? addMorphTargets( geometry, primitiveDef.targets, parser )\n\t\t\t: geometry;\n\n\t} );\n\n}\n\n/**\n * @param {BufferGeometry} geometry\n * @param {Number} drawMode\n * @return {BufferGeometry}\n */\nfunction toTrianglesDrawMode( geometry, drawMode ) {\n\n\tlet index = geometry.getIndex();\n\n\t// generate index if not present\n\n\tif ( index === null ) {\n\n\t\tconst indices = [];\n\n\t\tconst position = geometry.getAttribute( 'position' );\n\n\t\tif ( position !== undefined ) {\n\n\t\t\tfor ( let i = 0; i < position.count; i ++ ) {\n\n\t\t\t\tindices.push( i );\n\n\t\t\t}\n\n\t\t\tgeometry.setIndex( indices );\n\t\t\tindex = geometry.getIndex();\n\n\t\t} else {\n\n\t\t\tconsole.error( 'THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible.' );\n\t\t\treturn geometry;\n\n\t\t}\n\n\t}\n\n\t//\n\n\tconst numberOfTriangles = index.count - 2;\n\tconst newIndices = [];\n\n\tif ( drawMode === TriangleFanDrawMode ) {\n\n\t\t// gl.TRIANGLE_FAN\n\n\t\tfor ( let i = 1; i <= numberOfTriangles; i ++ ) {\n\n\t\t\tnewIndices.push( index.getX( 0 ) );\n\t\t\tnewIndices.push( index.getX( i ) );\n\t\t\tnewIndices.push( index.getX( i + 1 ) );\n\n\t\t}\n\n\t} else {\n\n\t\t// gl.TRIANGLE_STRIP\n\n\t\tfor ( let i = 0; i < numberOfTriangles; i ++ ) {\n\n\t\t\tif ( i % 2 === 0 ) {\n\n\t\t\t\tnewIndices.push( index.getX( i ) );\n\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\n\t\t\t\tnewIndices.push( index.getX( i + 2 ) );\n\n\n\t\t\t} else {\n\n\t\t\t\tnewIndices.push( index.getX( i + 2 ) );\n\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\n\t\t\t\tnewIndices.push( index.getX( i ) );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tif ( ( newIndices.length / 3 ) !== numberOfTriangles ) {\n\n\t\tconsole.error( 'THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.' );\n\n\t}\n\n\t// build final geometry\n\n\tconst newGeometry = geometry.clone();\n\tnewGeometry.setIndex( newIndices );\n\n\treturn newGeometry;\n\n}\n\nexport { GLTFLoader };\n","import {\n\tBox2,\n\tBufferGeometry,\n\tFileLoader,\n\tFloat32BufferAttribute,\n\tLoader,\n\tMatrix3,\n\tPath,\n\tShape,\n\tShapePath,\n\tShapeUtils,\n\tVector2,\n\tVector3\n} from 'three';\n\nclass SVGLoader extends Loader {\n\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t\t// Default dots per inch\n\t\tthis.defaultDPI = 90;\n\n\t\t// Accepted units: 'mm', 'cm', 'in', 'pt', 'pc', 'px'\n\t\tthis.defaultUnit = 'px';\n\n\t}\n\n\tload( url, onLoad, onProgress, onError ) {\n\n\t\tconst scope = this;\n\n\t\tconst loader = new FileLoader( scope.manager );\n\t\tloader.setPath( scope.path );\n\t\tloader.setRequestHeader( scope.requestHeader );\n\t\tloader.setWithCredentials( scope.withCredentials );\n\t\tloader.load( url, function ( text ) {\n\n\t\t\ttry {\n\n\t\t\t\tonLoad( scope.parse( text ) );\n\n\t\t\t} catch ( e ) {\n\n\t\t\t\tif ( onError ) {\n\n\t\t\t\t\tonError( e );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.error( e );\n\n\t\t\t\t}\n\n\t\t\t\tscope.manager.itemError( url );\n\n\t\t\t}\n\n\t\t}, onProgress, onError );\n\n\t}\n\n\tparse( text ) {\n\n\t\tconst scope = this;\n\n\t\tfunction parseNode( node, style ) {\n\n\t\t\tif ( node.nodeType !== 1 ) return;\n\n\t\t\tconst transform = getNodeTransform( node );\n\n\t\t\tlet traverseChildNodes = true;\n\n\t\t\tlet path = null;\n\n\t\t\tswitch ( node.nodeName ) {\n\n\t\t\t\tcase 'svg':\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'style':\n\t\t\t\t\tparseCSSStylesheet( node );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'g':\n\t\t\t\t\tstyle = parseStyle( node, style );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'path':\n\t\t\t\t\tstyle = parseStyle( node, style );\n\t\t\t\t\tif ( node.hasAttribute( 'd' ) ) path = parsePathNode( node );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'rect':\n\t\t\t\t\tstyle = parseStyle( node, style );\n\t\t\t\t\tpath = parseRectNode( node );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'polygon':\n\t\t\t\t\tstyle = parseStyle( node, style );\n\t\t\t\t\tpath = parsePolygonNode( node );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'polyline':\n\t\t\t\t\tstyle = parseStyle( node, style );\n\t\t\t\t\tpath = parsePolylineNode( node );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'circle':\n\t\t\t\t\tstyle = parseStyle( node, style );\n\t\t\t\t\tpath = parseCircleNode( node );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'ellipse':\n\t\t\t\t\tstyle = parseStyle( node, style );\n\t\t\t\t\tpath = parseEllipseNode( node );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'line':\n\t\t\t\t\tstyle = parseStyle( node, style );\n\t\t\t\t\tpath = parseLineNode( node );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'defs':\n\t\t\t\t\ttraverseChildNodes = false;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'use':\n\t\t\t\t\tstyle = parseStyle( node, style );\n\t\t\t\t\tconst usedNodeId = node.href.baseVal.substring( 1 );\n\t\t\t\t\tconst usedNode = node.viewportElement.getElementById( usedNodeId );\n\t\t\t\t\tif ( usedNode ) {\n\n\t\t\t\t\t\tparseNode( usedNode, style );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tconsole.warn( 'SVGLoader: \\'use node\\' references non-existent node id: ' + usedNodeId );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\t// console.log( node );\n\n\t\t\t}\n\n\t\t\tif ( path ) {\n\n\t\t\t\tif ( style.fill !== undefined && style.fill !== 'none' ) {\n\n\t\t\t\t\tpath.color.setStyle( style.fill );\n\n\t\t\t\t}\n\n\t\t\t\ttransformPath( path, currentTransform );\n\n\t\t\t\tpaths.push( path );\n\n\t\t\t\tpath.userData = { node: node, style: style };\n\n\t\t\t}\n\n\t\t\tif ( traverseChildNodes ) {\n\n\t\t\t\tconst nodes = node.childNodes;\n\n\t\t\t\tfor ( let i = 0; i < nodes.length; i ++ ) {\n\n\t\t\t\t\tparseNode( nodes[ i ], style );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( transform ) {\n\n\t\t\t\ttransformStack.pop();\n\n\t\t\t\tif ( transformStack.length > 0 ) {\n\n\t\t\t\t\tcurrentTransform.copy( transformStack[ transformStack.length - 1 ] );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tcurrentTransform.identity();\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction parsePathNode( node ) {\n\n\t\t\tconst path = new ShapePath();\n\n\t\t\tconst point = new Vector2();\n\t\t\tconst control = new Vector2();\n\n\t\t\tconst firstPoint = new Vector2();\n\t\t\tlet isFirstPoint = true;\n\t\t\tlet doSetFirstPoint = false;\n\n\t\t\tconst d = node.getAttribute( 'd' );\n\n\t\t\t// console.log( d );\n\n\t\t\tconst commands = d.match( /[a-df-z][^a-df-z]*/ig );\n\n\t\t\tfor ( let i = 0, l = commands.length; i < l; i ++ ) {\n\n\t\t\t\tconst command = commands[ i ];\n\n\t\t\t\tconst type = command.charAt( 0 );\n\t\t\t\tconst data = command.substr( 1 ).trim();\n\n\t\t\t\tif ( isFirstPoint === true ) {\n\n\t\t\t\t\tdoSetFirstPoint = true;\n\t\t\t\t\tisFirstPoint = false;\n\n\t\t\t\t}\n\n\t\t\t\tlet numbers;\n\n\t\t\t\tswitch ( type ) {\n\n\t\t\t\t\tcase 'M':\n\t\t\t\t\t\tnumbers = parseFloats( data );\n\t\t\t\t\t\tfor ( let j = 0, jl = numbers.length; j < jl; j += 2 ) {\n\n\t\t\t\t\t\t\tpoint.x = numbers[ j + 0 ];\n\t\t\t\t\t\t\tpoint.y = numbers[ j + 1 ];\n\t\t\t\t\t\t\tcontrol.x = point.x;\n\t\t\t\t\t\t\tcontrol.y = point.y;\n\n\t\t\t\t\t\t\tif ( j === 0 ) {\n\n\t\t\t\t\t\t\t\tpath.moveTo( point.x, point.y );\n\n\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\tpath.lineTo( point.x, point.y );\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( j === 0 && doSetFirstPoint === true ) firstPoint.copy( point );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'H':\n\t\t\t\t\t\tnumbers = parseFloats( data );\n\n\t\t\t\t\t\tfor ( let j = 0, jl = numbers.length; j < jl; j ++ ) {\n\n\t\t\t\t\t\t\tpoint.x = numbers[ j ];\n\t\t\t\t\t\t\tcontrol.x = point.x;\n\t\t\t\t\t\t\tcontrol.y = point.y;\n\t\t\t\t\t\t\tpath.lineTo( point.x, point.y );\n\n\t\t\t\t\t\t\tif ( j === 0 && doSetFirstPoint === true ) firstPoint.copy( point );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'V':\n\t\t\t\t\t\tnumbers = parseFloats( data );\n\n\t\t\t\t\t\tfor ( let j = 0, jl = numbers.length; j < jl; j ++ ) {\n\n\t\t\t\t\t\t\tpoint.y = numbers[ j ];\n\t\t\t\t\t\t\tcontrol.x = point.x;\n\t\t\t\t\t\t\tcontrol.y = point.y;\n\t\t\t\t\t\t\tpath.lineTo( point.x, point.y );\n\n\t\t\t\t\t\t\tif ( j === 0 && doSetFirstPoint === true ) firstPoint.copy( point );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'L':\n\t\t\t\t\t\tnumbers = parseFloats( data );\n\n\t\t\t\t\t\tfor ( let j = 0, jl = numbers.length; j < jl; j += 2 ) {\n\n\t\t\t\t\t\t\tpoint.x = numbers[ j + 0 ];\n\t\t\t\t\t\t\tpoint.y = numbers[ j + 1 ];\n\t\t\t\t\t\t\tcontrol.x = point.x;\n\t\t\t\t\t\t\tcontrol.y = point.y;\n\t\t\t\t\t\t\tpath.lineTo( point.x, point.y );\n\n\t\t\t\t\t\t\tif ( j === 0 && doSetFirstPoint === true ) firstPoint.copy( point );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'C':\n\t\t\t\t\t\tnumbers = parseFloats( data );\n\n\t\t\t\t\t\tfor ( let j = 0, jl = numbers.length; j < jl; j += 6 ) {\n\n\t\t\t\t\t\t\tpath.bezierCurveTo(\n\t\t\t\t\t\t\t\tnumbers[ j + 0 ],\n\t\t\t\t\t\t\t\tnumbers[ j + 1 ],\n\t\t\t\t\t\t\t\tnumbers[ j + 2 ],\n\t\t\t\t\t\t\t\tnumbers[ j + 3 ],\n\t\t\t\t\t\t\t\tnumbers[ j + 4 ],\n\t\t\t\t\t\t\t\tnumbers[ j + 5 ]\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tcontrol.x = numbers[ j + 2 ];\n\t\t\t\t\t\t\tcontrol.y = numbers[ j + 3 ];\n\t\t\t\t\t\t\tpoint.x = numbers[ j + 4 ];\n\t\t\t\t\t\t\tpoint.y = numbers[ j + 5 ];\n\n\t\t\t\t\t\t\tif ( j === 0 && doSetFirstPoint === true ) firstPoint.copy( point );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'S':\n\t\t\t\t\t\tnumbers = parseFloats( data );\n\n\t\t\t\t\t\tfor ( let j = 0, jl = numbers.length; j < jl; j += 4 ) {\n\n\t\t\t\t\t\t\tpath.bezierCurveTo(\n\t\t\t\t\t\t\t\tgetReflection( point.x, control.x ),\n\t\t\t\t\t\t\t\tgetReflection( point.y, control.y ),\n\t\t\t\t\t\t\t\tnumbers[ j + 0 ],\n\t\t\t\t\t\t\t\tnumbers[ j + 1 ],\n\t\t\t\t\t\t\t\tnumbers[ j + 2 ],\n\t\t\t\t\t\t\t\tnumbers[ j + 3 ]\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tcontrol.x = numbers[ j + 0 ];\n\t\t\t\t\t\t\tcontrol.y = numbers[ j + 1 ];\n\t\t\t\t\t\t\tpoint.x = numbers[ j + 2 ];\n\t\t\t\t\t\t\tpoint.y = numbers[ j + 3 ];\n\n\t\t\t\t\t\t\tif ( j === 0 && doSetFirstPoint === true ) firstPoint.copy( point );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'Q':\n\t\t\t\t\t\tnumbers = parseFloats( data );\n\n\t\t\t\t\t\tfor ( let j = 0, jl = numbers.length; j < jl; j += 4 ) {\n\n\t\t\t\t\t\t\tpath.quadraticCurveTo(\n\t\t\t\t\t\t\t\tnumbers[ j + 0 ],\n\t\t\t\t\t\t\t\tnumbers[ j + 1 ],\n\t\t\t\t\t\t\t\tnumbers[ j + 2 ],\n\t\t\t\t\t\t\t\tnumbers[ j + 3 ]\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tcontrol.x = numbers[ j + 0 ];\n\t\t\t\t\t\t\tcontrol.y = numbers[ j + 1 ];\n\t\t\t\t\t\t\tpoint.x = numbers[ j + 2 ];\n\t\t\t\t\t\t\tpoint.y = numbers[ j + 3 ];\n\n\t\t\t\t\t\t\tif ( j === 0 && doSetFirstPoint === true ) firstPoint.copy( point );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'T':\n\t\t\t\t\t\tnumbers = parseFloats( data );\n\n\t\t\t\t\t\tfor ( let j = 0, jl = numbers.length; j < jl; j += 2 ) {\n\n\t\t\t\t\t\t\tconst rx = getReflection( point.x, control.x );\n\t\t\t\t\t\t\tconst ry = getReflection( point.y, control.y );\n\t\t\t\t\t\t\tpath.quadraticCurveTo(\n\t\t\t\t\t\t\t\trx,\n\t\t\t\t\t\t\t\try,\n\t\t\t\t\t\t\t\tnumbers[ j + 0 ],\n\t\t\t\t\t\t\t\tnumbers[ j + 1 ]\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tcontrol.x = rx;\n\t\t\t\t\t\t\tcontrol.y = ry;\n\t\t\t\t\t\t\tpoint.x = numbers[ j + 0 ];\n\t\t\t\t\t\t\tpoint.y = numbers[ j + 1 ];\n\n\t\t\t\t\t\t\tif ( j === 0 && doSetFirstPoint === true ) firstPoint.copy( point );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'A':\n\t\t\t\t\t\tnumbers = parseFloats( data, [ 3, 4 ], 7 );\n\n\t\t\t\t\t\tfor ( let j = 0, jl = numbers.length; j < jl; j += 7 ) {\n\n\t\t\t\t\t\t\t// skip command if start point == end point\n\t\t\t\t\t\t\tif ( numbers[ j + 5 ] == point.x && numbers[ j + 6 ] == point.y ) continue;\n\n\t\t\t\t\t\t\tconst start = point.clone();\n\t\t\t\t\t\t\tpoint.x = numbers[ j + 5 ];\n\t\t\t\t\t\t\tpoint.y = numbers[ j + 6 ];\n\t\t\t\t\t\t\tcontrol.x = point.x;\n\t\t\t\t\t\t\tcontrol.y = point.y;\n\t\t\t\t\t\t\tparseArcCommand(\n\t\t\t\t\t\t\t\tpath, numbers[ j ], numbers[ j + 1 ], numbers[ j + 2 ], numbers[ j + 3 ], numbers[ j + 4 ], start, point\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tif ( j === 0 && doSetFirstPoint === true ) firstPoint.copy( point );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'm':\n\t\t\t\t\t\tnumbers = parseFloats( data );\n\n\t\t\t\t\t\tfor ( let j = 0, jl = numbers.length; j < jl; j += 2 ) {\n\n\t\t\t\t\t\t\tpoint.x += numbers[ j + 0 ];\n\t\t\t\t\t\t\tpoint.y += numbers[ j + 1 ];\n\t\t\t\t\t\t\tcontrol.x = point.x;\n\t\t\t\t\t\t\tcontrol.y = point.y;\n\n\t\t\t\t\t\t\tif ( j === 0 ) {\n\n\t\t\t\t\t\t\t\tpath.moveTo( point.x, point.y );\n\n\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\tpath.lineTo( point.x, point.y );\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( j === 0 && doSetFirstPoint === true ) firstPoint.copy( point );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'h':\n\t\t\t\t\t\tnumbers = parseFloats( data );\n\n\t\t\t\t\t\tfor ( let j = 0, jl = numbers.length; j < jl; j ++ ) {\n\n\t\t\t\t\t\t\tpoint.x += numbers[ j ];\n\t\t\t\t\t\t\tcontrol.x = point.x;\n\t\t\t\t\t\t\tcontrol.y = point.y;\n\t\t\t\t\t\t\tpath.lineTo( point.x, point.y );\n\n\t\t\t\t\t\t\tif ( j === 0 && doSetFirstPoint === true ) firstPoint.copy( point );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'v':\n\t\t\t\t\t\tnumbers = parseFloats( data );\n\n\t\t\t\t\t\tfor ( let j = 0, jl = numbers.length; j < jl; j ++ ) {\n\n\t\t\t\t\t\t\tpoint.y += numbers[ j ];\n\t\t\t\t\t\t\tcontrol.x = point.x;\n\t\t\t\t\t\t\tcontrol.y = point.y;\n\t\t\t\t\t\t\tpath.lineTo( point.x, point.y );\n\n\t\t\t\t\t\t\tif ( j === 0 && doSetFirstPoint === true ) firstPoint.copy( point );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'l':\n\t\t\t\t\t\tnumbers = parseFloats( data );\n\n\t\t\t\t\t\tfor ( let j = 0, jl = numbers.length; j < jl; j += 2 ) {\n\n\t\t\t\t\t\t\tpoint.x += numbers[ j + 0 ];\n\t\t\t\t\t\t\tpoint.y += numbers[ j + 1 ];\n\t\t\t\t\t\t\tcontrol.x = point.x;\n\t\t\t\t\t\t\tcontrol.y = point.y;\n\t\t\t\t\t\t\tpath.lineTo( point.x, point.y );\n\n\t\t\t\t\t\t\tif ( j === 0 && doSetFirstPoint === true ) firstPoint.copy( point );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'c':\n\t\t\t\t\t\tnumbers = parseFloats( data );\n\n\t\t\t\t\t\tfor ( let j = 0, jl = numbers.length; j < jl; j += 6 ) {\n\n\t\t\t\t\t\t\tpath.bezierCurveTo(\n\t\t\t\t\t\t\t\tpoint.x + numbers[ j + 0 ],\n\t\t\t\t\t\t\t\tpoint.y + numbers[ j + 1 ],\n\t\t\t\t\t\t\t\tpoint.x + numbers[ j + 2 ],\n\t\t\t\t\t\t\t\tpoint.y + numbers[ j + 3 ],\n\t\t\t\t\t\t\t\tpoint.x + numbers[ j + 4 ],\n\t\t\t\t\t\t\t\tpoint.y + numbers[ j + 5 ]\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tcontrol.x = point.x + numbers[ j + 2 ];\n\t\t\t\t\t\t\tcontrol.y = point.y + numbers[ j + 3 ];\n\t\t\t\t\t\t\tpoint.x += numbers[ j + 4 ];\n\t\t\t\t\t\t\tpoint.y += numbers[ j + 5 ];\n\n\t\t\t\t\t\t\tif ( j === 0 && doSetFirstPoint === true ) firstPoint.copy( point );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 's':\n\t\t\t\t\t\tnumbers = parseFloats( data );\n\n\t\t\t\t\t\tfor ( let j = 0, jl = numbers.length; j < jl; j += 4 ) {\n\n\t\t\t\t\t\t\tpath.bezierCurveTo(\n\t\t\t\t\t\t\t\tgetReflection( point.x, control.x ),\n\t\t\t\t\t\t\t\tgetReflection( point.y, control.y ),\n\t\t\t\t\t\t\t\tpoint.x + numbers[ j + 0 ],\n\t\t\t\t\t\t\t\tpoint.y + numbers[ j + 1 ],\n\t\t\t\t\t\t\t\tpoint.x + numbers[ j + 2 ],\n\t\t\t\t\t\t\t\tpoint.y + numbers[ j + 3 ]\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tcontrol.x = point.x + numbers[ j + 0 ];\n\t\t\t\t\t\t\tcontrol.y = point.y + numbers[ j + 1 ];\n\t\t\t\t\t\t\tpoint.x += numbers[ j + 2 ];\n\t\t\t\t\t\t\tpoint.y += numbers[ j + 3 ];\n\n\t\t\t\t\t\t\tif ( j === 0 && doSetFirstPoint === true ) firstPoint.copy( point );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'q':\n\t\t\t\t\t\tnumbers = parseFloats( data );\n\n\t\t\t\t\t\tfor ( let j = 0, jl = numbers.length; j < jl; j += 4 ) {\n\n\t\t\t\t\t\t\tpath.quadraticCurveTo(\n\t\t\t\t\t\t\t\tpoint.x + numbers[ j + 0 ],\n\t\t\t\t\t\t\t\tpoint.y + numbers[ j + 1 ],\n\t\t\t\t\t\t\t\tpoint.x + numbers[ j + 2 ],\n\t\t\t\t\t\t\t\tpoint.y + numbers[ j + 3 ]\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tcontrol.x = point.x + numbers[ j + 0 ];\n\t\t\t\t\t\t\tcontrol.y = point.y + numbers[ j + 1 ];\n\t\t\t\t\t\t\tpoint.x += numbers[ j + 2 ];\n\t\t\t\t\t\t\tpoint.y += numbers[ j + 3 ];\n\n\t\t\t\t\t\t\tif ( j === 0 && doSetFirstPoint === true ) firstPoint.copy( point );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 't':\n\t\t\t\t\t\tnumbers = parseFloats( data );\n\n\t\t\t\t\t\tfor ( let j = 0, jl = numbers.length; j < jl; j += 2 ) {\n\n\t\t\t\t\t\t\tconst rx = getReflection( point.x, control.x );\n\t\t\t\t\t\t\tconst ry = getReflection( point.y, control.y );\n\t\t\t\t\t\t\tpath.quadraticCurveTo(\n\t\t\t\t\t\t\t\trx,\n\t\t\t\t\t\t\t\try,\n\t\t\t\t\t\t\t\tpoint.x + numbers[ j + 0 ],\n\t\t\t\t\t\t\t\tpoint.y + numbers[ j + 1 ]\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tcontrol.x = rx;\n\t\t\t\t\t\t\tcontrol.y = ry;\n\t\t\t\t\t\t\tpoint.x = point.x + numbers[ j + 0 ];\n\t\t\t\t\t\t\tpoint.y = point.y + numbers[ j + 1 ];\n\n\t\t\t\t\t\t\tif ( j === 0 && doSetFirstPoint === true ) firstPoint.copy( point );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'a':\n\t\t\t\t\t\tnumbers = parseFloats( data, [ 3, 4 ], 7 );\n\n\t\t\t\t\t\tfor ( let j = 0, jl = numbers.length; j < jl; j += 7 ) {\n\n\t\t\t\t\t\t\t// skip command if no displacement\n\t\t\t\t\t\t\tif ( numbers[ j + 5 ] == 0 && numbers[ j + 6 ] == 0 ) continue;\n\n\t\t\t\t\t\t\tconst start = point.clone();\n\t\t\t\t\t\t\tpoint.x += numbers[ j + 5 ];\n\t\t\t\t\t\t\tpoint.y += numbers[ j + 6 ];\n\t\t\t\t\t\t\tcontrol.x = point.x;\n\t\t\t\t\t\t\tcontrol.y = point.y;\n\t\t\t\t\t\t\tparseArcCommand(\n\t\t\t\t\t\t\t\tpath, numbers[ j ], numbers[ j + 1 ], numbers[ j + 2 ], numbers[ j + 3 ], numbers[ j + 4 ], start, point\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tif ( j === 0 && doSetFirstPoint === true ) firstPoint.copy( point );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'Z':\n\t\t\t\t\tcase 'z':\n\t\t\t\t\t\tpath.currentPath.autoClose = true;\n\n\t\t\t\t\t\tif ( path.currentPath.curves.length > 0 ) {\n\n\t\t\t\t\t\t\t// Reset point to beginning of Path\n\t\t\t\t\t\t\tpoint.copy( firstPoint );\n\t\t\t\t\t\t\tpath.currentPath.currentPoint.copy( point );\n\t\t\t\t\t\t\tisFirstPoint = true;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tconsole.warn( command );\n\n\t\t\t\t}\n\n\t\t\t\t// console.log( type, parseFloats( data ), parseFloats( data ).length  )\n\n\t\t\t\tdoSetFirstPoint = false;\n\n\t\t\t}\n\n\t\t\treturn path;\n\n\t\t}\n\n\t\tfunction parseCSSStylesheet( node ) {\n\n\t\t\tif ( ! node.sheet || ! node.sheet.cssRules || ! node.sheet.cssRules.length ) return;\n\n\t\t\tfor ( let i = 0; i < node.sheet.cssRules.length; i ++ ) {\n\n\t\t\t\tconst stylesheet = node.sheet.cssRules[ i ];\n\n\t\t\t\tif ( stylesheet.type !== 1 ) continue;\n\n\t\t\t\tconst selectorList = stylesheet.selectorText\n\t\t\t\t\t.split( /,/gm )\n\t\t\t\t\t.filter( Boolean )\n\t\t\t\t\t.map( i => i.trim() );\n\n\t\t\t\tfor ( let j = 0; j < selectorList.length; j ++ ) {\n\n\t\t\t\t\tstylesheets[ selectorList[ j ] ] = Object.assign(\n\t\t\t\t\t\tstylesheets[ selectorList[ j ] ] || {},\n\t\t\t\t\t\tstylesheet.style\n\t\t\t\t\t);\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\t/**\n\t\t * https://www.w3.org/TR/SVG/implnote.html#ArcImplementationNotes\n\t\t * https://mortoray.com/2017/02/16/rendering-an-svg-elliptical-arc-as-bezier-curves/ Appendix: Endpoint to center arc conversion\n\t\t * From\n\t\t * rx ry x-axis-rotation large-arc-flag sweep-flag x y\n\t\t * To\n\t\t * aX, aY, xRadius, yRadius, aStartAngle, aEndAngle, aClockwise, aRotation\n\t\t */\n\n\t\tfunction parseArcCommand( path, rx, ry, x_axis_rotation, large_arc_flag, sweep_flag, start, end ) {\n\n\t\t\tif ( rx == 0 || ry == 0 ) {\n\n\t\t\t\t// draw a line if either of the radii == 0\n\t\t\t\tpath.lineTo( end.x, end.y );\n\t\t\t\treturn;\n\n\t\t\t}\n\n\t\t\tx_axis_rotation = x_axis_rotation * Math.PI / 180;\n\n\t\t\t// Ensure radii are positive\n\t\t\trx = Math.abs( rx );\n\t\t\try = Math.abs( ry );\n\n\t\t\t// Compute (x1', y1')\n\t\t\tconst dx2 = ( start.x - end.x ) / 2.0;\n\t\t\tconst dy2 = ( start.y - end.y ) / 2.0;\n\t\t\tconst x1p = Math.cos( x_axis_rotation ) * dx2 + Math.sin( x_axis_rotation ) * dy2;\n\t\t\tconst y1p = - Math.sin( x_axis_rotation ) * dx2 + Math.cos( x_axis_rotation ) * dy2;\n\n\t\t\t// Compute (cx', cy')\n\t\t\tlet rxs = rx * rx;\n\t\t\tlet rys = ry * ry;\n\t\t\tconst x1ps = x1p * x1p;\n\t\t\tconst y1ps = y1p * y1p;\n\n\t\t\t// Ensure radii are large enough\n\t\t\tconst cr = x1ps / rxs + y1ps / rys;\n\n\t\t\tif ( cr > 1 ) {\n\n\t\t\t\t// scale up rx,ry equally so cr == 1\n\t\t\t\tconst s = Math.sqrt( cr );\n\t\t\t\trx = s * rx;\n\t\t\t\try = s * ry;\n\t\t\t\trxs = rx * rx;\n\t\t\t\trys = ry * ry;\n\n\t\t\t}\n\n\t\t\tconst dq = ( rxs * y1ps + rys * x1ps );\n\t\t\tconst pq = ( rxs * rys - dq ) / dq;\n\t\t\tlet q = Math.sqrt( Math.max( 0, pq ) );\n\t\t\tif ( large_arc_flag === sweep_flag ) q = - q;\n\t\t\tconst cxp = q * rx * y1p / ry;\n\t\t\tconst cyp = - q * ry * x1p / rx;\n\n\t\t\t// Step 3: Compute (cx, cy) from (cx', cy')\n\t\t\tconst cx = Math.cos( x_axis_rotation ) * cxp - Math.sin( x_axis_rotation ) * cyp + ( start.x + end.x ) / 2;\n\t\t\tconst cy = Math.sin( x_axis_rotation ) * cxp + Math.cos( x_axis_rotation ) * cyp + ( start.y + end.y ) / 2;\n\n\t\t\t// Step 4: Compute 1 and \n\t\t\tconst theta = svgAngle( 1, 0, ( x1p - cxp ) / rx, ( y1p - cyp ) / ry );\n\t\t\tconst delta = svgAngle( ( x1p - cxp ) / rx, ( y1p - cyp ) / ry, ( - x1p - cxp ) / rx, ( - y1p - cyp ) / ry ) % ( Math.PI * 2 );\n\n\t\t\tpath.currentPath.absellipse( cx, cy, rx, ry, theta, theta + delta, sweep_flag === 0, x_axis_rotation );\n\n\t\t}\n\n\t\tfunction svgAngle( ux, uy, vx, vy ) {\n\n\t\t\tconst dot = ux * vx + uy * vy;\n\t\t\tconst len = Math.sqrt( ux * ux + uy * uy ) * Math.sqrt( vx * vx + vy * vy );\n\t\t\tlet ang = Math.acos( Math.max( - 1, Math.min( 1, dot / len ) ) ); // floating point precision, slightly over values appear\n\t\t\tif ( ( ux * vy - uy * vx ) < 0 ) ang = - ang;\n\t\t\treturn ang;\n\n\t\t}\n\n\t\t/*\n\t\t* According to https://www.w3.org/TR/SVG/shapes.html#RectElementRXAttribute\n\t\t* rounded corner should be rendered to elliptical arc, but bezier curve does the job well enough\n\t\t*/\n\t\tfunction parseRectNode( node ) {\n\n\t\t\tconst x = parseFloatWithUnits( node.getAttribute( 'x' ) || 0 );\n\t\t\tconst y = parseFloatWithUnits( node.getAttribute( 'y' ) || 0 );\n\t\t\tconst rx = parseFloatWithUnits( node.getAttribute( 'rx' ) || 0 );\n\t\t\tconst ry = parseFloatWithUnits( node.getAttribute( 'ry' ) || 0 );\n\t\t\tconst w = parseFloatWithUnits( node.getAttribute( 'width' ) );\n\t\t\tconst h = parseFloatWithUnits( node.getAttribute( 'height' ) );\n\n\t\t\tconst path = new ShapePath();\n\t\t\tpath.moveTo( x + 2 * rx, y );\n\t\t\tpath.lineTo( x + w - 2 * rx, y );\n\t\t\tif ( rx !== 0 || ry !== 0 ) path.bezierCurveTo( x + w, y, x + w, y, x + w, y + 2 * ry );\n\t\t\tpath.lineTo( x + w, y + h - 2 * ry );\n\t\t\tif ( rx !== 0 || ry !== 0 ) path.bezierCurveTo( x + w, y + h, x + w, y + h, x + w - 2 * rx, y + h );\n\t\t\tpath.lineTo( x + 2 * rx, y + h );\n\n\t\t\tif ( rx !== 0 || ry !== 0 ) {\n\n\t\t\t\tpath.bezierCurveTo( x, y + h, x, y + h, x, y + h - 2 * ry );\n\n\t\t\t}\n\n\t\t\tpath.lineTo( x, y + 2 * ry );\n\n\t\t\tif ( rx !== 0 || ry !== 0 ) {\n\n\t\t\t\tpath.bezierCurveTo( x, y, x, y, x + 2 * rx, y );\n\n\t\t\t}\n\n\t\t\treturn path;\n\n\t\t}\n\n\t\tfunction parsePolygonNode( node ) {\n\n\t\t\tfunction iterator( match, a, b ) {\n\n\t\t\t\tconst x = parseFloatWithUnits( a );\n\t\t\t\tconst y = parseFloatWithUnits( b );\n\n\t\t\t\tif ( index === 0 ) {\n\n\t\t\t\t\tpath.moveTo( x, y );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tpath.lineTo( x, y );\n\n\t\t\t\t}\n\n\t\t\t\tindex ++;\n\n\t\t\t}\n\n\t\t\tconst regex = /(-?[\\d\\.?]+)[,|\\s](-?[\\d\\.?]+)/g;\n\n\t\t\tconst path = new ShapePath();\n\n\t\t\tlet index = 0;\n\n\t\t\tnode.getAttribute( 'points' ).replace( regex, iterator );\n\n\t\t\tpath.currentPath.autoClose = true;\n\n\t\t\treturn path;\n\n\t\t}\n\n\t\tfunction parsePolylineNode( node ) {\n\n\t\t\tfunction iterator( match, a, b ) {\n\n\t\t\t\tconst x = parseFloatWithUnits( a );\n\t\t\t\tconst y = parseFloatWithUnits( b );\n\n\t\t\t\tif ( index === 0 ) {\n\n\t\t\t\t\tpath.moveTo( x, y );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tpath.lineTo( x, y );\n\n\t\t\t\t}\n\n\t\t\t\tindex ++;\n\n\t\t\t}\n\n\t\t\tconst regex = /(-?[\\d\\.?]+)[,|\\s](-?[\\d\\.?]+)/g;\n\n\t\t\tconst path = new ShapePath();\n\n\t\t\tlet index = 0;\n\n\t\t\tnode.getAttribute( 'points' ).replace( regex, iterator );\n\n\t\t\tpath.currentPath.autoClose = false;\n\n\t\t\treturn path;\n\n\t\t}\n\n\t\tfunction parseCircleNode( node ) {\n\n\t\t\tconst x = parseFloatWithUnits( node.getAttribute( 'cx' ) || 0 );\n\t\t\tconst y = parseFloatWithUnits( node.getAttribute( 'cy' ) || 0 );\n\t\t\tconst r = parseFloatWithUnits( node.getAttribute( 'r' ) || 0 );\n\n\t\t\tconst subpath = new Path();\n\t\t\tsubpath.absarc( x, y, r, 0, Math.PI * 2 );\n\n\t\t\tconst path = new ShapePath();\n\t\t\tpath.subPaths.push( subpath );\n\n\t\t\treturn path;\n\n\t\t}\n\n\t\tfunction parseEllipseNode( node ) {\n\n\t\t\tconst x = parseFloatWithUnits( node.getAttribute( 'cx' ) || 0 );\n\t\t\tconst y = parseFloatWithUnits( node.getAttribute( 'cy' ) || 0 );\n\t\t\tconst rx = parseFloatWithUnits( node.getAttribute( 'rx' ) || 0 );\n\t\t\tconst ry = parseFloatWithUnits( node.getAttribute( 'ry' ) || 0 );\n\n\t\t\tconst subpath = new Path();\n\t\t\tsubpath.absellipse( x, y, rx, ry, 0, Math.PI * 2 );\n\n\t\t\tconst path = new ShapePath();\n\t\t\tpath.subPaths.push( subpath );\n\n\t\t\treturn path;\n\n\t\t}\n\n\t\tfunction parseLineNode( node ) {\n\n\t\t\tconst x1 = parseFloatWithUnits( node.getAttribute( 'x1' ) || 0 );\n\t\t\tconst y1 = parseFloatWithUnits( node.getAttribute( 'y1' ) || 0 );\n\t\t\tconst x2 = parseFloatWithUnits( node.getAttribute( 'x2' ) || 0 );\n\t\t\tconst y2 = parseFloatWithUnits( node.getAttribute( 'y2' ) || 0 );\n\n\t\t\tconst path = new ShapePath();\n\t\t\tpath.moveTo( x1, y1 );\n\t\t\tpath.lineTo( x2, y2 );\n\t\t\tpath.currentPath.autoClose = false;\n\n\t\t\treturn path;\n\n\t\t}\n\n\t\t//\n\n\t\tfunction parseStyle( node, style ) {\n\n\t\t\tstyle = Object.assign( {}, style ); // clone style\n\n\t\t\tlet stylesheetStyles = {};\n\n\t\t\tif ( node.hasAttribute( 'class' ) ) {\n\n\t\t\t\tconst classSelectors = node.getAttribute( 'class' )\n\t\t\t\t\t.split( /\\s/ )\n\t\t\t\t\t.filter( Boolean )\n\t\t\t\t\t.map( i => i.trim() );\n\n\t\t\t\tfor ( let i = 0; i < classSelectors.length; i ++ ) {\n\n\t\t\t\t\tstylesheetStyles = Object.assign( stylesheetStyles, stylesheets[ '.' + classSelectors[ i ] ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( node.hasAttribute( 'id' ) ) {\n\n\t\t\t\tstylesheetStyles = Object.assign( stylesheetStyles, stylesheets[ '#' + node.getAttribute( 'id' ) ] );\n\n\t\t\t}\n\n\t\t\tfunction addStyle( svgName, jsName, adjustFunction ) {\n\n\t\t\t\tif ( adjustFunction === undefined ) adjustFunction = function copy( v ) {\n\n\t\t\t\t\tif ( v.startsWith( 'url' ) ) console.warn( 'SVGLoader: url access in attributes is not implemented.' );\n\n\t\t\t\t\treturn v;\n\n\t\t\t\t};\n\n\t\t\t\tif ( node.hasAttribute( svgName ) ) style[ jsName ] = adjustFunction( node.getAttribute( svgName ) );\n\t\t\t\tif ( stylesheetStyles[ svgName ] ) style[ jsName ] = adjustFunction( stylesheetStyles[ svgName ] );\n\t\t\t\tif ( node.style && node.style[ svgName ] !== '' ) style[ jsName ] = adjustFunction( node.style[ svgName ] );\n\n\t\t\t}\n\n\t\t\tfunction clamp( v ) {\n\n\t\t\t\treturn Math.max( 0, Math.min( 1, parseFloatWithUnits( v ) ) );\n\n\t\t\t}\n\n\t\t\tfunction positive( v ) {\n\n\t\t\t\treturn Math.max( 0, parseFloatWithUnits( v ) );\n\n\t\t\t}\n\n\t\t\taddStyle( 'fill', 'fill' );\n\t\t\taddStyle( 'fill-opacity', 'fillOpacity', clamp );\n\t\t\taddStyle( 'opacity', 'opacity', clamp );\n\t\t\taddStyle( 'stroke', 'stroke' );\n\t\t\taddStyle( 'stroke-opacity', 'strokeOpacity', clamp );\n\t\t\taddStyle( 'stroke-width', 'strokeWidth', positive );\n\t\t\taddStyle( 'stroke-linejoin', 'strokeLineJoin' );\n\t\t\taddStyle( 'stroke-linecap', 'strokeLineCap' );\n\t\t\taddStyle( 'stroke-miterlimit', 'strokeMiterLimit', positive );\n\t\t\taddStyle( 'visibility', 'visibility' );\n\n\t\t\treturn style;\n\n\t\t}\n\n\t\t// http://www.w3.org/TR/SVG11/implnote.html#PathElementImplementationNotes\n\n\t\tfunction getReflection( a, b ) {\n\n\t\t\treturn a - ( b - a );\n\n\t\t}\n\n\t\t// from https://github.com/ppvg/svg-numbers (MIT License)\n\n\t\tfunction parseFloats( input, flags, stride ) {\n\n\t\t\tif ( typeof input !== 'string' ) {\n\n\t\t\t\tthrow new TypeError( 'Invalid input: ' + typeof input );\n\n\t\t\t}\n\n\t\t\t// Character groups\n\t\t\tconst RE = {\n\t\t\t\tSEPARATOR: /[ \\t\\r\\n\\,.\\-+]/,\n\t\t\t\tWHITESPACE: /[ \\t\\r\\n]/,\n\t\t\t\tDIGIT: /[\\d]/,\n\t\t\t\tSIGN: /[-+]/,\n\t\t\t\tPOINT: /\\./,\n\t\t\t\tCOMMA: /,/,\n\t\t\t\tEXP: /e/i,\n\t\t\t\tFLAGS: /[01]/\n\t\t\t};\n\n\t\t\t// States\n\t\t\tconst SEP = 0;\n\t\t\tconst INT = 1;\n\t\t\tconst FLOAT = 2;\n\t\t\tconst EXP = 3;\n\n\t\t\tlet state = SEP;\n\t\t\tlet seenComma = true;\n\t\t\tlet number = '', exponent = '';\n\t\t\tconst result = [];\n\n\t\t\tfunction throwSyntaxError( current, i, partial ) {\n\n\t\t\t\tconst error = new SyntaxError( 'Unexpected character \"' + current + '\" at index ' + i + '.' );\n\t\t\t\terror.partial = partial;\n\t\t\t\tthrow error;\n\n\t\t\t}\n\n\t\t\tfunction newNumber() {\n\n\t\t\t\tif ( number !== '' ) {\n\n\t\t\t\t\tif ( exponent === '' ) result.push( Number( number ) );\n\t\t\t\t\telse result.push( Number( number ) * Math.pow( 10, Number( exponent ) ) );\n\n\t\t\t\t}\n\n\t\t\t\tnumber = '';\n\t\t\t\texponent = '';\n\n\t\t\t}\n\n\t\t\tlet current;\n\t\t\tconst length = input.length;\n\n\t\t\tfor ( let i = 0; i < length; i ++ ) {\n\n\t\t\t\tcurrent = input[ i ];\n\n\t\t\t\t// check for flags\n\t\t\t\tif ( Array.isArray( flags ) && flags.includes( result.length % stride ) && RE.FLAGS.test( current ) ) {\n\n\t\t\t\t\tstate = INT;\n\t\t\t\t\tnumber = current;\n\t\t\t\t\tnewNumber();\n\t\t\t\t\tcontinue;\n\n\t\t\t\t}\n\n\t\t\t\t// parse until next number\n\t\t\t\tif ( state === SEP ) {\n\n\t\t\t\t\t// eat whitespace\n\t\t\t\t\tif ( RE.WHITESPACE.test( current ) ) {\n\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// start new number\n\t\t\t\t\tif ( RE.DIGIT.test( current ) || RE.SIGN.test( current ) ) {\n\n\t\t\t\t\t\tstate = INT;\n\t\t\t\t\t\tnumber = current;\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( RE.POINT.test( current ) ) {\n\n\t\t\t\t\t\tstate = FLOAT;\n\t\t\t\t\t\tnumber = current;\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// throw on double commas (e.g. \"1, , 2\")\n\t\t\t\t\tif ( RE.COMMA.test( current ) ) {\n\n\t\t\t\t\t\tif ( seenComma ) {\n\n\t\t\t\t\t\t\tthrowSyntaxError( current, i, result );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tseenComma = true;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// parse integer part\n\t\t\t\tif ( state === INT ) {\n\n\t\t\t\t\tif ( RE.DIGIT.test( current ) ) {\n\n\t\t\t\t\t\tnumber += current;\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( RE.POINT.test( current ) ) {\n\n\t\t\t\t\t\tnumber += current;\n\t\t\t\t\t\tstate = FLOAT;\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( RE.EXP.test( current ) ) {\n\n\t\t\t\t\t\tstate = EXP;\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// throw on double signs (\"-+1\"), but not on sign as separator (\"-1-2\")\n\t\t\t\t\tif ( RE.SIGN.test( current )\n\t\t\t\t\t\t\t&& number.length === 1\n\t\t\t\t\t\t\t&& RE.SIGN.test( number[ 0 ] ) ) {\n\n\t\t\t\t\t\tthrowSyntaxError( current, i, result );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// parse decimal part\n\t\t\t\tif ( state === FLOAT ) {\n\n\t\t\t\t\tif ( RE.DIGIT.test( current ) ) {\n\n\t\t\t\t\t\tnumber += current;\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( RE.EXP.test( current ) ) {\n\n\t\t\t\t\t\tstate = EXP;\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// throw on double decimal points (e.g. \"1..2\")\n\t\t\t\t\tif ( RE.POINT.test( current ) && number[ number.length - 1 ] === '.' ) {\n\n\t\t\t\t\t\tthrowSyntaxError( current, i, result );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// parse exponent part\n\t\t\t\tif ( state === EXP ) {\n\n\t\t\t\t\tif ( RE.DIGIT.test( current ) ) {\n\n\t\t\t\t\t\texponent += current;\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( RE.SIGN.test( current ) ) {\n\n\t\t\t\t\t\tif ( exponent === '' ) {\n\n\t\t\t\t\t\t\texponent += current;\n\t\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( exponent.length === 1 && RE.SIGN.test( exponent ) ) {\n\n\t\t\t\t\t\t\tthrowSyntaxError( current, i, result );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\n\t\t\t\t// end of number\n\t\t\t\tif ( RE.WHITESPACE.test( current ) ) {\n\n\t\t\t\t\tnewNumber();\n\t\t\t\t\tstate = SEP;\n\t\t\t\t\tseenComma = false;\n\n\t\t\t\t} else if ( RE.COMMA.test( current ) ) {\n\n\t\t\t\t\tnewNumber();\n\t\t\t\t\tstate = SEP;\n\t\t\t\t\tseenComma = true;\n\n\t\t\t\t} else if ( RE.SIGN.test( current ) ) {\n\n\t\t\t\t\tnewNumber();\n\t\t\t\t\tstate = INT;\n\t\t\t\t\tnumber = current;\n\n\t\t\t\t} else if ( RE.POINT.test( current ) ) {\n\n\t\t\t\t\tnewNumber();\n\t\t\t\t\tstate = FLOAT;\n\t\t\t\t\tnumber = current;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tthrowSyntaxError( current, i, result );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// add the last number found (if any)\n\t\t\tnewNumber();\n\n\t\t\treturn result;\n\n\t\t}\n\n\t\t// Units\n\n\t\tconst units = [ 'mm', 'cm', 'in', 'pt', 'pc', 'px' ];\n\n\t\t// Conversion: [ fromUnit ][ toUnit ] (-1 means dpi dependent)\n\t\tconst unitConversion = {\n\n\t\t\t'mm': {\n\t\t\t\t'mm': 1,\n\t\t\t\t'cm': 0.1,\n\t\t\t\t'in': 1 / 25.4,\n\t\t\t\t'pt': 72 / 25.4,\n\t\t\t\t'pc': 6 / 25.4,\n\t\t\t\t'px': - 1\n\t\t\t},\n\t\t\t'cm': {\n\t\t\t\t'mm': 10,\n\t\t\t\t'cm': 1,\n\t\t\t\t'in': 1 / 2.54,\n\t\t\t\t'pt': 72 / 2.54,\n\t\t\t\t'pc': 6 / 2.54,\n\t\t\t\t'px': - 1\n\t\t\t},\n\t\t\t'in': {\n\t\t\t\t'mm': 25.4,\n\t\t\t\t'cm': 2.54,\n\t\t\t\t'in': 1,\n\t\t\t\t'pt': 72,\n\t\t\t\t'pc': 6,\n\t\t\t\t'px': - 1\n\t\t\t},\n\t\t\t'pt': {\n\t\t\t\t'mm': 25.4 / 72,\n\t\t\t\t'cm': 2.54 / 72,\n\t\t\t\t'in': 1 / 72,\n\t\t\t\t'pt': 1,\n\t\t\t\t'pc': 6 / 72,\n\t\t\t\t'px': - 1\n\t\t\t},\n\t\t\t'pc': {\n\t\t\t\t'mm': 25.4 / 6,\n\t\t\t\t'cm': 2.54 / 6,\n\t\t\t\t'in': 1 / 6,\n\t\t\t\t'pt': 72 / 6,\n\t\t\t\t'pc': 1,\n\t\t\t\t'px': - 1\n\t\t\t},\n\t\t\t'px': {\n\t\t\t\t'px': 1\n\t\t\t}\n\n\t\t};\n\n\t\tfunction parseFloatWithUnits( string ) {\n\n\t\t\tlet theUnit = 'px';\n\n\t\t\tif ( typeof string === 'string' || string instanceof String ) {\n\n\t\t\t\tfor ( let i = 0, n = units.length; i < n; i ++ ) {\n\n\t\t\t\t\tconst u = units[ i ];\n\n\t\t\t\t\tif ( string.endsWith( u ) ) {\n\n\t\t\t\t\t\ttheUnit = u;\n\t\t\t\t\t\tstring = string.substring( 0, string.length - u.length );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlet scale = undefined;\n\n\t\t\tif ( theUnit === 'px' && scope.defaultUnit !== 'px' ) {\n\n\t\t\t\t// Conversion scale from  pixels to inches, then to default units\n\n\t\t\t\tscale = unitConversion[ 'in' ][ scope.defaultUnit ] / scope.defaultDPI;\n\n\t\t\t} else {\n\n\t\t\t\tscale = unitConversion[ theUnit ][ scope.defaultUnit ];\n\n\t\t\t\tif ( scale < 0 ) {\n\n\t\t\t\t\t// Conversion scale to pixels\n\n\t\t\t\t\tscale = unitConversion[ theUnit ][ 'in' ] * scope.defaultDPI;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn scale * parseFloat( string );\n\n\t\t}\n\n\t\t// Transforms\n\n\t\tfunction getNodeTransform( node ) {\n\n\t\t\tif ( ! ( node.hasAttribute( 'transform' ) || ( node.nodeName === 'use' && ( node.hasAttribute( 'x' ) || node.hasAttribute( 'y' ) ) ) ) ) {\n\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t\tconst transform = parseNodeTransform( node );\n\n\t\t\tif ( transformStack.length > 0 ) {\n\n\t\t\t\ttransform.premultiply( transformStack[ transformStack.length - 1 ] );\n\n\t\t\t}\n\n\t\t\tcurrentTransform.copy( transform );\n\t\t\ttransformStack.push( transform );\n\n\t\t\treturn transform;\n\n\t\t}\n\n\t\tfunction parseNodeTransform( node ) {\n\n\t\t\tconst transform = new Matrix3();\n\t\t\tconst currentTransform = tempTransform0;\n\n\t\t\tif ( node.nodeName === 'use' && ( node.hasAttribute( 'x' ) || node.hasAttribute( 'y' ) ) ) {\n\n\t\t\t\tconst tx = parseFloatWithUnits( node.getAttribute( 'x' ) );\n\t\t\t\tconst ty = parseFloatWithUnits( node.getAttribute( 'y' ) );\n\n\t\t\t\ttransform.translate( tx, ty );\n\n\t\t\t}\n\n\t\t\tif ( node.hasAttribute( 'transform' ) ) {\n\n\t\t\t\tconst transformsTexts = node.getAttribute( 'transform' ).split( ')' );\n\n\t\t\t\tfor ( let tIndex = transformsTexts.length - 1; tIndex >= 0; tIndex -- ) {\n\n\t\t\t\t\tconst transformText = transformsTexts[ tIndex ].trim();\n\n\t\t\t\t\tif ( transformText === '' ) continue;\n\n\t\t\t\t\tconst openParPos = transformText.indexOf( '(' );\n\t\t\t\t\tconst closeParPos = transformText.length;\n\n\t\t\t\t\tif ( openParPos > 0 && openParPos < closeParPos ) {\n\n\t\t\t\t\t\tconst transformType = transformText.substr( 0, openParPos );\n\n\t\t\t\t\t\tconst array = parseFloats( transformText.substr( openParPos + 1, closeParPos - openParPos - 1 ) );\n\n\t\t\t\t\t\tcurrentTransform.identity();\n\n\t\t\t\t\t\tswitch ( transformType ) {\n\n\t\t\t\t\t\t\tcase 'translate':\n\n\t\t\t\t\t\t\t\tif ( array.length >= 1 ) {\n\n\t\t\t\t\t\t\t\t\tconst tx = array[ 0 ];\n\t\t\t\t\t\t\t\t\tlet ty = tx;\n\n\t\t\t\t\t\t\t\t\tif ( array.length >= 2 ) {\n\n\t\t\t\t\t\t\t\t\t\tty = array[ 1 ];\n\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tcurrentTransform.translate( tx, ty );\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'rotate':\n\n\t\t\t\t\t\t\t\tif ( array.length >= 1 ) {\n\n\t\t\t\t\t\t\t\t\tlet angle = 0;\n\t\t\t\t\t\t\t\t\tlet cx = 0;\n\t\t\t\t\t\t\t\t\tlet cy = 0;\n\n\t\t\t\t\t\t\t\t\t// Angle\n\t\t\t\t\t\t\t\t\tangle = - array[ 0 ] * Math.PI / 180;\n\n\t\t\t\t\t\t\t\t\tif ( array.length >= 3 ) {\n\n\t\t\t\t\t\t\t\t\t\t// Center x, y\n\t\t\t\t\t\t\t\t\t\tcx = array[ 1 ];\n\t\t\t\t\t\t\t\t\t\tcy = array[ 2 ];\n\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// Rotate around center (cx, cy)\n\t\t\t\t\t\t\t\t\ttempTransform1.identity().translate( - cx, - cy );\n\t\t\t\t\t\t\t\t\ttempTransform2.identity().rotate( angle );\n\t\t\t\t\t\t\t\t\ttempTransform3.multiplyMatrices( tempTransform2, tempTransform1 );\n\t\t\t\t\t\t\t\t\ttempTransform1.identity().translate( cx, cy );\n\t\t\t\t\t\t\t\t\tcurrentTransform.multiplyMatrices( tempTransform1, tempTransform3 );\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'scale':\n\n\t\t\t\t\t\t\t\tif ( array.length >= 1 ) {\n\n\t\t\t\t\t\t\t\t\tconst scaleX = array[ 0 ];\n\t\t\t\t\t\t\t\t\tlet scaleY = scaleX;\n\n\t\t\t\t\t\t\t\t\tif ( array.length >= 2 ) {\n\n\t\t\t\t\t\t\t\t\t\tscaleY = array[ 1 ];\n\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tcurrentTransform.scale( scaleX, scaleY );\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'skewX':\n\n\t\t\t\t\t\t\t\tif ( array.length === 1 ) {\n\n\t\t\t\t\t\t\t\t\tcurrentTransform.set(\n\t\t\t\t\t\t\t\t\t\t1, Math.tan( array[ 0 ] * Math.PI / 180 ), 0,\n\t\t\t\t\t\t\t\t\t\t0, 1, 0,\n\t\t\t\t\t\t\t\t\t\t0, 0, 1\n\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'skewY':\n\n\t\t\t\t\t\t\t\tif ( array.length === 1 ) {\n\n\t\t\t\t\t\t\t\t\tcurrentTransform.set(\n\t\t\t\t\t\t\t\t\t\t1, 0, 0,\n\t\t\t\t\t\t\t\t\t\tMath.tan( array[ 0 ] * Math.PI / 180 ), 1, 0,\n\t\t\t\t\t\t\t\t\t\t0, 0, 1\n\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'matrix':\n\n\t\t\t\t\t\t\t\tif ( array.length === 6 ) {\n\n\t\t\t\t\t\t\t\t\tcurrentTransform.set(\n\t\t\t\t\t\t\t\t\t\tarray[ 0 ], array[ 2 ], array[ 4 ],\n\t\t\t\t\t\t\t\t\t\tarray[ 1 ], array[ 3 ], array[ 5 ],\n\t\t\t\t\t\t\t\t\t\t0, 0, 1\n\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\ttransform.premultiply( currentTransform );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn transform;\n\n\t\t}\n\n\t\tfunction transformPath( path, m ) {\n\n\t\t\tfunction transfVec2( v2 ) {\n\n\t\t\t\ttempV3.set( v2.x, v2.y, 1 ).applyMatrix3( m );\n\n\t\t\t\tv2.set( tempV3.x, tempV3.y );\n\n\t\t\t}\n\n\t\t\tconst isRotated = isTransformRotated( m );\n\n\t\t\tconst subPaths = path.subPaths;\n\n\t\t\tfor ( let i = 0, n = subPaths.length; i < n; i ++ ) {\n\n\t\t\t\tconst subPath = subPaths[ i ];\n\t\t\t\tconst curves = subPath.curves;\n\n\t\t\t\tfor ( let j = 0; j < curves.length; j ++ ) {\n\n\t\t\t\t\tconst curve = curves[ j ];\n\n\t\t\t\t\tif ( curve.isLineCurve ) {\n\n\t\t\t\t\t\ttransfVec2( curve.v1 );\n\t\t\t\t\t\ttransfVec2( curve.v2 );\n\n\t\t\t\t\t} else if ( curve.isCubicBezierCurve ) {\n\n\t\t\t\t\t\ttransfVec2( curve.v0 );\n\t\t\t\t\t\ttransfVec2( curve.v1 );\n\t\t\t\t\t\ttransfVec2( curve.v2 );\n\t\t\t\t\t\ttransfVec2( curve.v3 );\n\n\t\t\t\t\t} else if ( curve.isQuadraticBezierCurve ) {\n\n\t\t\t\t\t\ttransfVec2( curve.v0 );\n\t\t\t\t\t\ttransfVec2( curve.v1 );\n\t\t\t\t\t\ttransfVec2( curve.v2 );\n\n\t\t\t\t\t} else if ( curve.isEllipseCurve ) {\n\n\t\t\t\t\t\tif ( isRotated ) {\n\n\t\t\t\t\t\t\tconsole.warn( 'SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented.' );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttempV2.set( curve.aX, curve.aY );\n\t\t\t\t\t\ttransfVec2( tempV2 );\n\t\t\t\t\t\tcurve.aX = tempV2.x;\n\t\t\t\t\t\tcurve.aY = tempV2.y;\n\n\t\t\t\t\t\tcurve.xRadius *= getTransformScaleX( m );\n\t\t\t\t\t\tcurve.yRadius *= getTransformScaleY( m );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction isTransformRotated( m ) {\n\n\t\t\treturn m.elements[ 1 ] !== 0 || m.elements[ 3 ] !== 0;\n\n\t\t}\n\n\t\tfunction getTransformScaleX( m ) {\n\n\t\t\tconst te = m.elements;\n\t\t\treturn Math.sqrt( te[ 0 ] * te[ 0 ] + te[ 1 ] * te[ 1 ] );\n\n\t\t}\n\n\t\tfunction getTransformScaleY( m ) {\n\n\t\t\tconst te = m.elements;\n\t\t\treturn Math.sqrt( te[ 3 ] * te[ 3 ] + te[ 4 ] * te[ 4 ] );\n\n\t\t}\n\n\t\t//\n\n\t\tconst paths = [];\n\t\tconst stylesheets = {};\n\n\t\tconst transformStack = [];\n\n\t\tconst tempTransform0 = new Matrix3();\n\t\tconst tempTransform1 = new Matrix3();\n\t\tconst tempTransform2 = new Matrix3();\n\t\tconst tempTransform3 = new Matrix3();\n\t\tconst tempV2 = new Vector2();\n\t\tconst tempV3 = new Vector3();\n\n\t\tconst currentTransform = new Matrix3();\n\n\t\tconst xml = new DOMParser().parseFromString( text, 'image/svg+xml' ); // application/xml\n\n\t\tparseNode( xml.documentElement, {\n\t\t\tfill: '#000',\n\t\t\tfillOpacity: 1,\n\t\t\tstrokeOpacity: 1,\n\t\t\tstrokeWidth: 1,\n\t\t\tstrokeLineJoin: 'miter',\n\t\t\tstrokeLineCap: 'butt',\n\t\t\tstrokeMiterLimit: 4\n\t\t} );\n\n\t\tconst data = { paths: paths, xml: xml.documentElement };\n\n\t\t// console.log( paths );\n\t\treturn data;\n\n\t}\n\n\tstatic createShapes( shapePath ) {\n\n\t\t// Param shapePath: a shapepath as returned by the parse function of this class\n\t\t// Returns Shape object\n\n\t\tconst BIGNUMBER = 999999999;\n\n\t\tconst IntersectionLocationType = {\n\t\t\tORIGIN: 0,\n\t\t\tDESTINATION: 1,\n\t\t\tBETWEEN: 2,\n\t\t\tLEFT: 3,\n\t\t\tRIGHT: 4,\n\t\t\tBEHIND: 5,\n\t\t\tBEYOND: 6\n\t\t};\n\n\t\tconst classifyResult = {\n\t\t\tloc: IntersectionLocationType.ORIGIN,\n\t\t\tt: 0\n\t\t};\n\n\t\tfunction findEdgeIntersection( a0, a1, b0, b1 ) {\n\n\t\t\tconst x1 = a0.x;\n\t\t\tconst x2 = a1.x;\n\t\t\tconst x3 = b0.x;\n\t\t\tconst x4 = b1.x;\n\t\t\tconst y1 = a0.y;\n\t\t\tconst y2 = a1.y;\n\t\t\tconst y3 = b0.y;\n\t\t\tconst y4 = b1.y;\n\t\t\tconst nom1 = ( x4 - x3 ) * ( y1 - y3 ) - ( y4 - y3 ) * ( x1 - x3 );\n\t\t\tconst nom2 = ( x2 - x1 ) * ( y1 - y3 ) - ( y2 - y1 ) * ( x1 - x3 );\n\t\t\tconst denom = ( y4 - y3 ) * ( x2 - x1 ) - ( x4 - x3 ) * ( y2 - y1 );\n\t\t\tconst t1 = nom1 / denom;\n\t\t\tconst t2 = nom2 / denom;\n\n\t\t\tif ( ( ( denom === 0 ) && ( nom1 !== 0 ) ) || ( t1 <= 0 ) || ( t1 >= 1 ) || ( t2 < 0 ) || ( t2 > 1 ) ) {\n\n\t\t\t\t//1. lines are parallel or edges don't intersect\n\n\t\t\t\treturn null;\n\n\t\t\t} else if ( ( nom1 === 0 ) && ( denom === 0 ) ) {\n\n\t\t\t\t//2. lines are colinear\n\n\t\t\t\t//check if endpoints of edge2 (b0-b1) lies on edge1 (a0-a1)\n\t\t\t\tfor ( let i = 0; i < 2; i ++ ) {\n\n\t\t\t\t\tclassifyPoint( i === 0 ? b0 : b1, a0, a1 );\n\t\t\t\t\t//find position of this endpoints relatively to edge1\n\t\t\t\t\tif ( classifyResult.loc == IntersectionLocationType.ORIGIN ) {\n\n\t\t\t\t\t\tconst point = ( i === 0 ? b0 : b1 );\n\t\t\t\t\t\treturn { x: point.x, y: point.y, t: classifyResult.t };\n\n\t\t\t\t\t} else if ( classifyResult.loc == IntersectionLocationType.BETWEEN ) {\n\n\t\t\t\t\t\tconst x = + ( ( x1 + classifyResult.t * ( x2 - x1 ) ).toPrecision( 10 ) );\n\t\t\t\t\t\tconst y = + ( ( y1 + classifyResult.t * ( y2 - y1 ) ).toPrecision( 10 ) );\n\t\t\t\t\t\treturn { x: x, y: y, t: classifyResult.t, };\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\n\t\t\t} else {\n\n\t\t\t\t//3. edges intersect\n\n\t\t\t\tfor ( let i = 0; i < 2; i ++ ) {\n\n\t\t\t\t\tclassifyPoint( i === 0 ? b0 : b1, a0, a1 );\n\n\t\t\t\t\tif ( classifyResult.loc == IntersectionLocationType.ORIGIN ) {\n\n\t\t\t\t\t\tconst point = ( i === 0 ? b0 : b1 );\n\t\t\t\t\t\treturn { x: point.x, y: point.y, t: classifyResult.t };\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tconst x = + ( ( x1 + t1 * ( x2 - x1 ) ).toPrecision( 10 ) );\n\t\t\t\tconst y = + ( ( y1 + t1 * ( y2 - y1 ) ).toPrecision( 10 ) );\n\t\t\t\treturn { x: x, y: y, t: t1 };\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction classifyPoint( p, edgeStart, edgeEnd ) {\n\n\t\t\tconst ax = edgeEnd.x - edgeStart.x;\n\t\t\tconst ay = edgeEnd.y - edgeStart.y;\n\t\t\tconst bx = p.x - edgeStart.x;\n\t\t\tconst by = p.y - edgeStart.y;\n\t\t\tconst sa = ax * by - bx * ay;\n\n\t\t\tif ( ( p.x === edgeStart.x ) && ( p.y === edgeStart.y ) ) {\n\n\t\t\t\tclassifyResult.loc = IntersectionLocationType.ORIGIN;\n\t\t\t\tclassifyResult.t = 0;\n\t\t\t\treturn;\n\n\t\t\t}\n\n\t\t\tif ( ( p.x === edgeEnd.x ) && ( p.y === edgeEnd.y ) ) {\n\n\t\t\t\tclassifyResult.loc = IntersectionLocationType.DESTINATION;\n\t\t\t\tclassifyResult.t = 1;\n\t\t\t\treturn;\n\n\t\t\t}\n\n\t\t\tif ( sa < - Number.EPSILON ) {\n\n\t\t\t\tclassifyResult.loc = IntersectionLocationType.LEFT;\n\t\t\t\treturn;\n\n\t\t\t}\n\n\t\t\tif ( sa > Number.EPSILON ) {\n\n\t\t\t\tclassifyResult.loc = IntersectionLocationType.RIGHT;\n\t\t\t\treturn;\n\n\n\t\t\t}\n\n\t\t\tif ( ( ( ax * bx ) < 0 ) || ( ( ay * by ) < 0 ) ) {\n\n\t\t\t\tclassifyResult.loc = IntersectionLocationType.BEHIND;\n\t\t\t\treturn;\n\n\t\t\t}\n\n\t\t\tif ( ( Math.sqrt( ax * ax + ay * ay ) ) < ( Math.sqrt( bx * bx + by * by ) ) ) {\n\n\t\t\t\tclassifyResult.loc = IntersectionLocationType.BEYOND;\n\t\t\t\treturn;\n\n\t\t\t}\n\n\t\t\tlet t;\n\n\t\t\tif ( ax !== 0 ) {\n\n\t\t\t\tt = bx / ax;\n\n\t\t\t} else {\n\n\t\t\t\tt = by / ay;\n\n\t\t\t}\n\n\t\t\tclassifyResult.loc = IntersectionLocationType.BETWEEN;\n\t\t\tclassifyResult.t = t;\n\n\t\t}\n\n\t\tfunction getIntersections( path1, path2 ) {\n\n\t\t\tconst intersectionsRaw = [];\n\t\t\tconst intersections = [];\n\n\t\t\tfor ( let index = 1; index < path1.length; index ++ ) {\n\n\t\t\t\tconst path1EdgeStart = path1[ index - 1 ];\n\t\t\t\tconst path1EdgeEnd = path1[ index ];\n\n\t\t\t\tfor ( let index2 = 1; index2 < path2.length; index2 ++ ) {\n\n\t\t\t\t\tconst path2EdgeStart = path2[ index2 - 1 ];\n\t\t\t\t\tconst path2EdgeEnd = path2[ index2 ];\n\n\t\t\t\t\tconst intersection = findEdgeIntersection( path1EdgeStart, path1EdgeEnd, path2EdgeStart, path2EdgeEnd );\n\n\t\t\t\t\tif ( intersection !== null && intersectionsRaw.find( i => i.t <= intersection.t + Number.EPSILON && i.t >= intersection.t - Number.EPSILON ) === undefined ) {\n\n\t\t\t\t\t\tintersectionsRaw.push( intersection );\n\t\t\t\t\t\tintersections.push( new Vector2( intersection.x, intersection.y ) );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn intersections;\n\n\t\t}\n\n\t\tfunction getScanlineIntersections( scanline, boundingBox, paths ) {\n\n\t\t\tconst center = new Vector2();\n\t\t\tboundingBox.getCenter( center );\n\n\t\t\tconst allIntersections = [];\n\n\t\t\tpaths.forEach( path => {\n\n\t\t\t\t// check if the center of the bounding box is in the bounding box of the paths.\n\t\t\t\t// this is a pruning method to limit the search of intersections in paths that can't envelop of the current path.\n\t\t\t\t// if a path envelops another path. The center of that oter path, has to be inside the bounding box of the enveloping path.\n\t\t\t\tif ( path.boundingBox.containsPoint( center ) ) {\n\n\t\t\t\t\tconst intersections = getIntersections( scanline, path.points );\n\n\t\t\t\t\tintersections.forEach( p => {\n\n\t\t\t\t\t\tallIntersections.push( { identifier: path.identifier, isCW: path.isCW, point: p } );\n\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t\tallIntersections.sort( ( i1, i2 ) => {\n\n\t\t\t\treturn i1.point.x - i2.point.x;\n\n\t\t\t} );\n\n\t\t\treturn allIntersections;\n\n\t\t}\n\n\t\tfunction isHoleTo( simplePath, allPaths, scanlineMinX, scanlineMaxX, _fillRule ) {\n\n\t\t\tif ( _fillRule === null || _fillRule === undefined || _fillRule === '' ) {\n\n\t\t\t\t_fillRule = 'nonzero';\n\n\t\t\t}\n\n\t\t\tconst centerBoundingBox = new Vector2();\n\t\t\tsimplePath.boundingBox.getCenter( centerBoundingBox );\n\n\t\t\tconst scanline = [ new Vector2( scanlineMinX, centerBoundingBox.y ), new Vector2( scanlineMaxX, centerBoundingBox.y ) ];\n\n\t\t\tconst scanlineIntersections = getScanlineIntersections( scanline, simplePath.boundingBox, allPaths );\n\n\t\t\tscanlineIntersections.sort( ( i1, i2 ) => {\n\n\t\t\t\treturn i1.point.x - i2.point.x;\n\n\t\t\t} );\n\n\t\t\tconst baseIntersections = [];\n\t\t\tconst otherIntersections = [];\n\n\t\t\tscanlineIntersections.forEach( i => {\n\n\t\t\t\tif ( i.identifier === simplePath.identifier ) {\n\n\t\t\t\t\tbaseIntersections.push( i );\n\n\t\t\t\t} else {\n\n\t\t\t\t\totherIntersections.push( i );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t\tconst firstXOfPath = baseIntersections[ 0 ].point.x;\n\n\t\t\t// build up the path hierarchy\n\t\t\tconst stack = [];\n\t\t\tlet i = 0;\n\n\t\t\twhile ( i < otherIntersections.length && otherIntersections[ i ].point.x < firstXOfPath ) {\n\n\t\t\t\tif ( stack.length > 0 && stack[ stack.length - 1 ] === otherIntersections[ i ].identifier ) {\n\n\t\t\t\t\tstack.pop();\n\n\t\t\t\t} else {\n\n\t\t\t\t\tstack.push( otherIntersections[ i ].identifier );\n\n\t\t\t\t}\n\n\t\t\t\ti ++;\n\n\t\t\t}\n\n\t\t\tstack.push( simplePath.identifier );\n\n\t\t\tif ( _fillRule === 'evenodd' ) {\n\n\t\t\t\tconst isHole = stack.length % 2 === 0 ? true : false;\n\t\t\t\tconst isHoleFor = stack[ stack.length - 2 ];\n\n\t\t\t\treturn { identifier: simplePath.identifier, isHole: isHole, for: isHoleFor };\n\n\t\t\t} else if ( _fillRule === 'nonzero' ) {\n\n\t\t\t\t// check if path is a hole by counting the amount of paths with alternating rotations it has to cross.\n\t\t\t\tlet isHole = true;\n\t\t\t\tlet isHoleFor = null;\n\t\t\t\tlet lastCWValue = null;\n\n\t\t\t\tfor ( let i = 0; i < stack.length; i ++ ) {\n\n\t\t\t\t\tconst identifier = stack[ i ];\n\t\t\t\t\tif ( isHole ) {\n\n\t\t\t\t\t\tlastCWValue = allPaths[ identifier ].isCW;\n\t\t\t\t\t\tisHole = false;\n\t\t\t\t\t\tisHoleFor = identifier;\n\n\t\t\t\t\t} else if ( lastCWValue !== allPaths[ identifier ].isCW ) {\n\n\t\t\t\t\t\tlastCWValue = allPaths[ identifier ].isCW;\n\t\t\t\t\t\tisHole = true;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\treturn { identifier: simplePath.identifier, isHole: isHole, for: isHoleFor };\n\n\t\t\t} else {\n\n\t\t\t\tconsole.warn( 'fill-rule: \"' + _fillRule + '\" is currently not implemented.' );\n\n\t\t\t}\n\n\t\t}\n\n\t\t// check for self intersecting paths\n\t\t// TODO\n\n\t\t// check intersecting paths\n\t\t// TODO\n\n\t\t// prepare paths for hole detection\n\t\tlet identifier = 0;\n\n\t\tlet scanlineMinX = BIGNUMBER;\n\t\tlet scanlineMaxX = - BIGNUMBER;\n\n\t\tlet simplePaths = shapePath.subPaths.map( p => {\n\n\t\t\tconst points = p.getPoints();\n\t\t\tlet maxY = - BIGNUMBER;\n\t\t\tlet minY = BIGNUMBER;\n\t\t\tlet maxX = - BIGNUMBER;\n\t\t\tlet minX = BIGNUMBER;\n\n\t      \t//points.forEach(p => p.y *= -1);\n\n\t\t\tfor ( let i = 0; i < points.length; i ++ ) {\n\n\t\t\t\tconst p = points[ i ];\n\n\t\t\t\tif ( p.y > maxY ) {\n\n\t\t\t\t\tmaxY = p.y;\n\n\t\t\t\t}\n\n\t\t\t\tif ( p.y < minY ) {\n\n\t\t\t\t\tminY = p.y;\n\n\t\t\t\t}\n\n\t\t\t\tif ( p.x > maxX ) {\n\n\t\t\t\t\tmaxX = p.x;\n\n\t\t\t\t}\n\n\t\t\t\tif ( p.x < minX ) {\n\n\t\t\t\t\tminX = p.x;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t//\n\t\t\tif ( scanlineMaxX <= maxX ) {\n\n\t\t\t\tscanlineMaxX = maxX + 1;\n\n\t\t\t}\n\n\t\t\tif ( scanlineMinX >= minX ) {\n\n\t\t\t\tscanlineMinX = minX - 1;\n\n\t\t\t}\n\n\t\t\treturn { points: points, isCW: ShapeUtils.isClockWise( points ), identifier: identifier ++, boundingBox: new Box2( new Vector2( minX, minY ), new Vector2( maxX, maxY ) ) };\n\n\t\t} );\n\n\t\tsimplePaths = simplePaths.filter( sp => sp.points.length > 1 );\n\n\t\t// check if path is solid or a hole\n\t\tconst isAHole = simplePaths.map( p => isHoleTo( p, simplePaths, scanlineMinX, scanlineMaxX, shapePath.userData.style.fillRule ) );\n\n\n\t\tconst shapesToReturn = [];\n\t\tsimplePaths.forEach( p => {\n\n\t\t\tconst amIAHole = isAHole[ p.identifier ];\n\n\t\t\tif ( ! amIAHole.isHole ) {\n\n\t\t\t\tconst shape = new Shape( p.points );\n\t\t\t\tconst holes = isAHole.filter( h => h.isHole && h.for === p.identifier );\n\t\t\t\tholes.forEach( h => {\n\n\t\t\t\t\tconst path = simplePaths[ h.identifier ];\n\t\t\t\t\tshape.holes.push( new Path( path.points ) );\n\n\t\t\t\t} );\n\t\t\t\tshapesToReturn.push( shape );\n\n\t\t\t}\n\n\t\t} );\n\n\t\treturn shapesToReturn;\n\n\t}\n\n\tstatic getStrokeStyle( width, color, lineJoin, lineCap, miterLimit ) {\n\n\t\t// Param width: Stroke width\n\t\t// Param color: As returned by THREE.Color.getStyle()\n\t\t// Param lineJoin: One of \"round\", \"bevel\", \"miter\" or \"miter-limit\"\n\t\t// Param lineCap: One of \"round\", \"square\" or \"butt\"\n\t\t// Param miterLimit: Maximum join length, in multiples of the \"width\" parameter (join is truncated if it exceeds that distance)\n\t\t// Returns style object\n\n\t\twidth = width !== undefined ? width : 1;\n\t\tcolor = color !== undefined ? color : '#000';\n\t\tlineJoin = lineJoin !== undefined ? lineJoin : 'miter';\n\t\tlineCap = lineCap !== undefined ? lineCap : 'butt';\n\t\tmiterLimit = miterLimit !== undefined ? miterLimit : 4;\n\n\t\treturn {\n\t\t\tstrokeColor: color,\n\t\t\tstrokeWidth: width,\n\t\t\tstrokeLineJoin: lineJoin,\n\t\t\tstrokeLineCap: lineCap,\n\t\t\tstrokeMiterLimit: miterLimit\n\t\t};\n\n\t}\n\n\tstatic pointsToStroke( points, style, arcDivisions, minDistance ) {\n\n\t\t// Generates a stroke with some witdh around the given path.\n\t\t// The path can be open or closed (last point equals to first point)\n\t\t// Param points: Array of Vector2D (the path). Minimum 2 points.\n\t\t// Param style: Object with SVG properties as returned by SVGLoader.getStrokeStyle(), or SVGLoader.parse() in the path.userData.style object\n\t\t// Params arcDivisions: Arc divisions for round joins and endcaps. (Optional)\n\t\t// Param minDistance: Points closer to this distance will be merged. (Optional)\n\t\t// Returns BufferGeometry with stroke triangles (In plane z = 0). UV coordinates are generated ('u' along path. 'v' across it, from left to right)\n\n\t\tconst vertices = [];\n\t\tconst normals = [];\n\t\tconst uvs = [];\n\n\t\tif ( SVGLoader.pointsToStrokeWithBuffers( points, style, arcDivisions, minDistance, vertices, normals, uvs ) === 0 ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst geometry = new BufferGeometry();\n\t\tgeometry.setAttribute( 'position', new Float32BufferAttribute( vertices, 3 ) );\n\t\tgeometry.setAttribute( 'normal', new Float32BufferAttribute( normals, 3 ) );\n\t\tgeometry.setAttribute( 'uv', new Float32BufferAttribute( uvs, 2 ) );\n\n\t\treturn geometry;\n\n\t}\n\n\tstatic pointsToStrokeWithBuffers( points, style, arcDivisions, minDistance, vertices, normals, uvs, vertexOffset ) {\n\n\t\t// This function can be called to update existing arrays or buffers.\n\t\t// Accepts same parameters as pointsToStroke, plus the buffers and optional offset.\n\t\t// Param vertexOffset: Offset vertices to start writing in the buffers (3 elements/vertex for vertices and normals, and 2 elements/vertex for uvs)\n\t\t// Returns number of written vertices / normals / uvs pairs\n\t\t// if 'vertices' parameter is undefined no triangles will be generated, but the returned vertices count will still be valid (useful to preallocate the buffers)\n\t\t// 'normals' and 'uvs' buffers are optional\n\n\t\tconst tempV2_1 = new Vector2();\n\t\tconst tempV2_2 = new Vector2();\n\t\tconst tempV2_3 = new Vector2();\n\t\tconst tempV2_4 = new Vector2();\n\t\tconst tempV2_5 = new Vector2();\n\t\tconst tempV2_6 = new Vector2();\n\t\tconst tempV2_7 = new Vector2();\n\t\tconst lastPointL = new Vector2();\n\t\tconst lastPointR = new Vector2();\n\t\tconst point0L = new Vector2();\n\t\tconst point0R = new Vector2();\n\t\tconst currentPointL = new Vector2();\n\t\tconst currentPointR = new Vector2();\n\t\tconst nextPointL = new Vector2();\n\t\tconst nextPointR = new Vector2();\n\t\tconst innerPoint = new Vector2();\n\t\tconst outerPoint = new Vector2();\n\n\t\tarcDivisions = arcDivisions !== undefined ? arcDivisions : 12;\n\t\tminDistance = minDistance !== undefined ? minDistance : 0.001;\n\t\tvertexOffset = vertexOffset !== undefined ? vertexOffset : 0;\n\n\t\t// First ensure there are no duplicated points\n\t\tpoints = removeDuplicatedPoints( points );\n\n\t\tconst numPoints = points.length;\n\n\t\tif ( numPoints < 2 ) return 0;\n\n\t\tconst isClosed = points[ 0 ].equals( points[ numPoints - 1 ] );\n\n\t\tlet currentPoint;\n\t\tlet previousPoint = points[ 0 ];\n\t\tlet nextPoint;\n\n\t\tconst strokeWidth2 = style.strokeWidth / 2;\n\n\t\tconst deltaU = 1 / ( numPoints - 1 );\n\t\tlet u0 = 0, u1;\n\n\t\tlet innerSideModified;\n\t\tlet joinIsOnLeftSide;\n\t\tlet isMiter;\n\t\tlet initialJoinIsOnLeftSide = false;\n\n\t\tlet numVertices = 0;\n\t\tlet currentCoordinate = vertexOffset * 3;\n\t\tlet currentCoordinateUV = vertexOffset * 2;\n\n\t\t// Get initial left and right stroke points\n\t\tgetNormal( points[ 0 ], points[ 1 ], tempV2_1 ).multiplyScalar( strokeWidth2 );\n\t\tlastPointL.copy( points[ 0 ] ).sub( tempV2_1 );\n\t\tlastPointR.copy( points[ 0 ] ).add( tempV2_1 );\n\t\tpoint0L.copy( lastPointL );\n\t\tpoint0R.copy( lastPointR );\n\n\t\tfor ( let iPoint = 1; iPoint < numPoints; iPoint ++ ) {\n\n\t\t\tcurrentPoint = points[ iPoint ];\n\n\t\t\t// Get next point\n\t\t\tif ( iPoint === numPoints - 1 ) {\n\n\t\t\t\tif ( isClosed ) {\n\n\t\t\t\t\t// Skip duplicated initial point\n\t\t\t\t\tnextPoint = points[ 1 ];\n\n\t\t\t\t} else nextPoint = undefined;\n\n\t\t\t} else {\n\n\t\t\t\tnextPoint = points[ iPoint + 1 ];\n\n\t\t\t}\n\n\t\t\t// Normal of previous segment in tempV2_1\n\t\t\tconst normal1 = tempV2_1;\n\t\t\tgetNormal( previousPoint, currentPoint, normal1 );\n\n\t\t\ttempV2_3.copy( normal1 ).multiplyScalar( strokeWidth2 );\n\t\t\tcurrentPointL.copy( currentPoint ).sub( tempV2_3 );\n\t\t\tcurrentPointR.copy( currentPoint ).add( tempV2_3 );\n\n\t\t\tu1 = u0 + deltaU;\n\n\t\t\tinnerSideModified = false;\n\n\t\t\tif ( nextPoint !== undefined ) {\n\n\t\t\t\t// Normal of next segment in tempV2_2\n\t\t\t\tgetNormal( currentPoint, nextPoint, tempV2_2 );\n\n\t\t\t\ttempV2_3.copy( tempV2_2 ).multiplyScalar( strokeWidth2 );\n\t\t\t\tnextPointL.copy( currentPoint ).sub( tempV2_3 );\n\t\t\t\tnextPointR.copy( currentPoint ).add( tempV2_3 );\n\n\t\t\t\tjoinIsOnLeftSide = true;\n\t\t\t\ttempV2_3.subVectors( nextPoint, previousPoint );\n\t\t\t\tif ( normal1.dot( tempV2_3 ) < 0 ) {\n\n\t\t\t\t\tjoinIsOnLeftSide = false;\n\n\t\t\t\t}\n\n\t\t\t\tif ( iPoint === 1 ) initialJoinIsOnLeftSide = joinIsOnLeftSide;\n\n\t\t\t\ttempV2_3.subVectors( nextPoint, currentPoint );\n\t\t\t\ttempV2_3.normalize();\n\t\t\t\tconst dot = Math.abs( normal1.dot( tempV2_3 ) );\n\n\t\t\t\t// If path is straight, don't create join\n\t\t\t\tif ( dot !== 0 ) {\n\n\t\t\t\t\t// Compute inner and outer segment intersections\n\t\t\t\t\tconst miterSide = strokeWidth2 / dot;\n\t\t\t\t\ttempV2_3.multiplyScalar( - miterSide );\n\t\t\t\t\ttempV2_4.subVectors( currentPoint, previousPoint );\n\t\t\t\t\ttempV2_5.copy( tempV2_4 ).setLength( miterSide ).add( tempV2_3 );\n\t\t\t\t\tinnerPoint.copy( tempV2_5 ).negate();\n\t\t\t\t\tconst miterLength2 = tempV2_5.length();\n\t\t\t\t\tconst segmentLengthPrev = tempV2_4.length();\n\t\t\t\t\ttempV2_4.divideScalar( segmentLengthPrev );\n\t\t\t\t\ttempV2_6.subVectors( nextPoint, currentPoint );\n\t\t\t\t\tconst segmentLengthNext = tempV2_6.length();\n\t\t\t\t\ttempV2_6.divideScalar( segmentLengthNext );\n\t\t\t\t\t// Check that previous and next segments doesn't overlap with the innerPoint of intersection\n\t\t\t\t\tif ( tempV2_4.dot( innerPoint ) < segmentLengthPrev && tempV2_6.dot( innerPoint ) < segmentLengthNext ) {\n\n\t\t\t\t\t\tinnerSideModified = true;\n\n\t\t\t\t\t}\n\n\t\t\t\t\touterPoint.copy( tempV2_5 ).add( currentPoint );\n\t\t\t\t\tinnerPoint.add( currentPoint );\n\n\t\t\t\t\tisMiter = false;\n\n\t\t\t\t\tif ( innerSideModified ) {\n\n\t\t\t\t\t\tif ( joinIsOnLeftSide ) {\n\n\t\t\t\t\t\t\tnextPointR.copy( innerPoint );\n\t\t\t\t\t\t\tcurrentPointR.copy( innerPoint );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tnextPointL.copy( innerPoint );\n\t\t\t\t\t\t\tcurrentPointL.copy( innerPoint );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\t// The segment triangles are generated here if there was overlapping\n\n\t\t\t\t\t\tmakeSegmentTriangles();\n\n\t\t\t\t\t}\n\n\t\t\t\t\tswitch ( style.strokeLineJoin ) {\n\n\t\t\t\t\t\tcase 'bevel':\n\n\t\t\t\t\t\t\tmakeSegmentWithBevelJoin( joinIsOnLeftSide, innerSideModified, u1 );\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'round':\n\n\t\t\t\t\t\t\t// Segment triangles\n\n\t\t\t\t\t\t\tcreateSegmentTrianglesWithMiddleSection( joinIsOnLeftSide, innerSideModified );\n\n\t\t\t\t\t\t\t// Join triangles\n\n\t\t\t\t\t\t\tif ( joinIsOnLeftSide ) {\n\n\t\t\t\t\t\t\t\tmakeCircularSector( currentPoint, currentPointL, nextPointL, u1, 0 );\n\n\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\tmakeCircularSector( currentPoint, nextPointR, currentPointR, u1, 1 );\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'miter':\n\t\t\t\t\t\tcase 'miter-clip':\n\t\t\t\t\t\tdefault:\n\n\t\t\t\t\t\t\tconst miterFraction = ( strokeWidth2 * style.strokeMiterLimit ) / miterLength2;\n\n\t\t\t\t\t\t\tif ( miterFraction < 1 ) {\n\n\t\t\t\t\t\t\t\t// The join miter length exceeds the miter limit\n\n\t\t\t\t\t\t\t\tif ( style.strokeLineJoin !== 'miter-clip' ) {\n\n\t\t\t\t\t\t\t\t\tmakeSegmentWithBevelJoin( joinIsOnLeftSide, innerSideModified, u1 );\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\t\t// Segment triangles\n\n\t\t\t\t\t\t\t\t\tcreateSegmentTrianglesWithMiddleSection( joinIsOnLeftSide, innerSideModified );\n\n\t\t\t\t\t\t\t\t\t// Miter-clip join triangles\n\n\t\t\t\t\t\t\t\t\tif ( joinIsOnLeftSide ) {\n\n\t\t\t\t\t\t\t\t\t\ttempV2_6.subVectors( outerPoint, currentPointL ).multiplyScalar( miterFraction ).add( currentPointL );\n\t\t\t\t\t\t\t\t\t\ttempV2_7.subVectors( outerPoint, nextPointL ).multiplyScalar( miterFraction ).add( nextPointL );\n\n\t\t\t\t\t\t\t\t\t\taddVertex( currentPointL, u1, 0 );\n\t\t\t\t\t\t\t\t\t\taddVertex( tempV2_6, u1, 0 );\n\t\t\t\t\t\t\t\t\t\taddVertex( currentPoint, u1, 0.5 );\n\n\t\t\t\t\t\t\t\t\t\taddVertex( currentPoint, u1, 0.5 );\n\t\t\t\t\t\t\t\t\t\taddVertex( tempV2_6, u1, 0 );\n\t\t\t\t\t\t\t\t\t\taddVertex( tempV2_7, u1, 0 );\n\n\t\t\t\t\t\t\t\t\t\taddVertex( currentPoint, u1, 0.5 );\n\t\t\t\t\t\t\t\t\t\taddVertex( tempV2_7, u1, 0 );\n\t\t\t\t\t\t\t\t\t\taddVertex( nextPointL, u1, 0 );\n\n\t\t\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\t\t\ttempV2_6.subVectors( outerPoint, currentPointR ).multiplyScalar( miterFraction ).add( currentPointR );\n\t\t\t\t\t\t\t\t\t\ttempV2_7.subVectors( outerPoint, nextPointR ).multiplyScalar( miterFraction ).add( nextPointR );\n\n\t\t\t\t\t\t\t\t\t\taddVertex( currentPointR, u1, 1 );\n\t\t\t\t\t\t\t\t\t\taddVertex( tempV2_6, u1, 1 );\n\t\t\t\t\t\t\t\t\t\taddVertex( currentPoint, u1, 0.5 );\n\n\t\t\t\t\t\t\t\t\t\taddVertex( currentPoint, u1, 0.5 );\n\t\t\t\t\t\t\t\t\t\taddVertex( tempV2_6, u1, 1 );\n\t\t\t\t\t\t\t\t\t\taddVertex( tempV2_7, u1, 1 );\n\n\t\t\t\t\t\t\t\t\t\taddVertex( currentPoint, u1, 0.5 );\n\t\t\t\t\t\t\t\t\t\taddVertex( tempV2_7, u1, 1 );\n\t\t\t\t\t\t\t\t\t\taddVertex( nextPointR, u1, 1 );\n\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\t// Miter join segment triangles\n\n\t\t\t\t\t\t\t\tif ( innerSideModified ) {\n\n\t\t\t\t\t\t\t\t\t// Optimized segment + join triangles\n\n\t\t\t\t\t\t\t\t\tif ( joinIsOnLeftSide ) {\n\n\t\t\t\t\t\t\t\t\t\taddVertex( lastPointR, u0, 1 );\n\t\t\t\t\t\t\t\t\t\taddVertex( lastPointL, u0, 0 );\n\t\t\t\t\t\t\t\t\t\taddVertex( outerPoint, u1, 0 );\n\n\t\t\t\t\t\t\t\t\t\taddVertex( lastPointR, u0, 1 );\n\t\t\t\t\t\t\t\t\t\taddVertex( outerPoint, u1, 0 );\n\t\t\t\t\t\t\t\t\t\taddVertex( innerPoint, u1, 1 );\n\n\t\t\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\t\t\taddVertex( lastPointR, u0, 1 );\n\t\t\t\t\t\t\t\t\t\taddVertex( lastPointL, u0, 0 );\n\t\t\t\t\t\t\t\t\t\taddVertex( outerPoint, u1, 1 );\n\n\t\t\t\t\t\t\t\t\t\taddVertex( lastPointL, u0, 0 );\n\t\t\t\t\t\t\t\t\t\taddVertex( innerPoint, u1, 0 );\n\t\t\t\t\t\t\t\t\t\taddVertex( outerPoint, u1, 1 );\n\n\t\t\t\t\t\t\t\t\t}\n\n\n\t\t\t\t\t\t\t\t\tif ( joinIsOnLeftSide ) {\n\n\t\t\t\t\t\t\t\t\t\tnextPointL.copy( outerPoint );\n\n\t\t\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\t\t\tnextPointR.copy( outerPoint );\n\n\t\t\t\t\t\t\t\t\t}\n\n\n\t\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\t\t// Add extra miter join triangles\n\n\t\t\t\t\t\t\t\t\tif ( joinIsOnLeftSide ) {\n\n\t\t\t\t\t\t\t\t\t\taddVertex( currentPointL, u1, 0 );\n\t\t\t\t\t\t\t\t\t\taddVertex( outerPoint, u1, 0 );\n\t\t\t\t\t\t\t\t\t\taddVertex( currentPoint, u1, 0.5 );\n\n\t\t\t\t\t\t\t\t\t\taddVertex( currentPoint, u1, 0.5 );\n\t\t\t\t\t\t\t\t\t\taddVertex( outerPoint, u1, 0 );\n\t\t\t\t\t\t\t\t\t\taddVertex( nextPointL, u1, 0 );\n\n\t\t\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\t\t\taddVertex( currentPointR, u1, 1 );\n\t\t\t\t\t\t\t\t\t\taddVertex( outerPoint, u1, 1 );\n\t\t\t\t\t\t\t\t\t\taddVertex( currentPoint, u1, 0.5 );\n\n\t\t\t\t\t\t\t\t\t\taddVertex( currentPoint, u1, 0.5 );\n\t\t\t\t\t\t\t\t\t\taddVertex( outerPoint, u1, 1 );\n\t\t\t\t\t\t\t\t\t\taddVertex( nextPointR, u1, 1 );\n\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tisMiter = true;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// The segment triangles are generated here when two consecutive points are collinear\n\n\t\t\t\t\tmakeSegmentTriangles();\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\t// The segment triangles are generated here if it is the ending segment\n\n\t\t\t\tmakeSegmentTriangles();\n\n\t\t\t}\n\n\t\t\tif ( ! isClosed && iPoint === numPoints - 1 ) {\n\n\t\t\t\t// Start line endcap\n\t\t\t\taddCapGeometry( points[ 0 ], point0L, point0R, joinIsOnLeftSide, true, u0 );\n\n\t\t\t}\n\n\t\t\t// Increment loop variables\n\n\t\t\tu0 = u1;\n\n\t\t\tpreviousPoint = currentPoint;\n\n\t\t\tlastPointL.copy( nextPointL );\n\t\t\tlastPointR.copy( nextPointR );\n\n\t\t}\n\n\t\tif ( ! isClosed ) {\n\n\t\t\t// Ending line endcap\n\t\t\taddCapGeometry( currentPoint, currentPointL, currentPointR, joinIsOnLeftSide, false, u1 );\n\n\t\t} else if ( innerSideModified && vertices ) {\n\n\t\t\t// Modify path first segment vertices to adjust to the segments inner and outer intersections\n\n\t\t\tlet lastOuter = outerPoint;\n\t\t\tlet lastInner = innerPoint;\n\n\t\t\tif ( initialJoinIsOnLeftSide !== joinIsOnLeftSide ) {\n\n\t\t\t\tlastOuter = innerPoint;\n\t\t\t\tlastInner = outerPoint;\n\n\t\t\t}\n\n\t\t\tif ( joinIsOnLeftSide ) {\n\n\t\t\t\tif ( isMiter || initialJoinIsOnLeftSide ) {\n\n\t\t\t\t\tlastInner.toArray( vertices, 0 * 3 );\n\t\t\t\t\tlastInner.toArray( vertices, 3 * 3 );\n\n\t\t\t\t\tif ( isMiter ) {\n\n\t\t\t\t\t\tlastOuter.toArray( vertices, 1 * 3 );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tif ( isMiter || ! initialJoinIsOnLeftSide ) {\n\n\t\t\t\t\tlastInner.toArray( vertices, 1 * 3 );\n\t\t\t\t\tlastInner.toArray( vertices, 3 * 3 );\n\n\t\t\t\t\tif ( isMiter ) {\n\n\t\t\t\t\t\tlastOuter.toArray( vertices, 0 * 3 );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn numVertices;\n\n\t\t// -- End of algorithm\n\n\t\t// -- Functions\n\n\t\tfunction getNormal( p1, p2, result ) {\n\n\t\t\tresult.subVectors( p2, p1 );\n\t\t\treturn result.set( - result.y, result.x ).normalize();\n\n\t\t}\n\n\t\tfunction addVertex( position, u, v ) {\n\n\t\t\tif ( vertices ) {\n\n\t\t\t\tvertices[ currentCoordinate ] = position.x;\n\t\t\t\tvertices[ currentCoordinate + 1 ] = position.y;\n\t\t\t\tvertices[ currentCoordinate + 2 ] = 0;\n\n\t\t\t\tif ( normals ) {\n\n\t\t\t\t\tnormals[ currentCoordinate ] = 0;\n\t\t\t\t\tnormals[ currentCoordinate + 1 ] = 0;\n\t\t\t\t\tnormals[ currentCoordinate + 2 ] = 1;\n\n\t\t\t\t}\n\n\t\t\t\tcurrentCoordinate += 3;\n\n\t\t\t\tif ( uvs ) {\n\n\t\t\t\t\tuvs[ currentCoordinateUV ] = u;\n\t\t\t\t\tuvs[ currentCoordinateUV + 1 ] = v;\n\n\t\t\t\t\tcurrentCoordinateUV += 2;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tnumVertices += 3;\n\n\t\t}\n\n\t\tfunction makeCircularSector( center, p1, p2, u, v ) {\n\n\t\t\t// param p1, p2: Points in the circle arc.\n\t\t\t// p1 and p2 are in clockwise direction.\n\n\t\t\ttempV2_1.copy( p1 ).sub( center ).normalize();\n\t\t\ttempV2_2.copy( p2 ).sub( center ).normalize();\n\n\t\t\tlet angle = Math.PI;\n\t\t\tconst dot = tempV2_1.dot( tempV2_2 );\n\t\t\tif ( Math.abs( dot ) < 1 ) angle = Math.abs( Math.acos( dot ) );\n\n\t\t\tangle /= arcDivisions;\n\n\t\t\ttempV2_3.copy( p1 );\n\n\t\t\tfor ( let i = 0, il = arcDivisions - 1; i < il; i ++ ) {\n\n\t\t\t\ttempV2_4.copy( tempV2_3 ).rotateAround( center, angle );\n\n\t\t\t\taddVertex( tempV2_3, u, v );\n\t\t\t\taddVertex( tempV2_4, u, v );\n\t\t\t\taddVertex( center, u, 0.5 );\n\n\t\t\t\ttempV2_3.copy( tempV2_4 );\n\n\t\t\t}\n\n\t\t\taddVertex( tempV2_4, u, v );\n\t\t\taddVertex( p2, u, v );\n\t\t\taddVertex( center, u, 0.5 );\n\n\t\t}\n\n\t\tfunction makeSegmentTriangles() {\n\n\t\t\taddVertex( lastPointR, u0, 1 );\n\t\t\taddVertex( lastPointL, u0, 0 );\n\t\t\taddVertex( currentPointL, u1, 0 );\n\n\t\t\taddVertex( lastPointR, u0, 1 );\n\t\t\taddVertex( currentPointL, u1, 1 );\n\t\t\taddVertex( currentPointR, u1, 0 );\n\n\t\t}\n\n\t\tfunction makeSegmentWithBevelJoin( joinIsOnLeftSide, innerSideModified, u ) {\n\n\t\t\tif ( innerSideModified ) {\n\n\t\t\t\t// Optimized segment + bevel triangles\n\n\t\t\t\tif ( joinIsOnLeftSide ) {\n\n\t\t\t\t\t// Path segments triangles\n\n\t\t\t\t\taddVertex( lastPointR, u0, 1 );\n\t\t\t\t\taddVertex( lastPointL, u0, 0 );\n\t\t\t\t\taddVertex( currentPointL, u1, 0 );\n\n\t\t\t\t\taddVertex( lastPointR, u0, 1 );\n\t\t\t\t\taddVertex( currentPointL, u1, 0 );\n\t\t\t\t\taddVertex( innerPoint, u1, 1 );\n\n\t\t\t\t\t// Bevel join triangle\n\n\t\t\t\t\taddVertex( currentPointL, u, 0 );\n\t\t\t\t\taddVertex( nextPointL, u, 0 );\n\t\t\t\t\taddVertex( innerPoint, u, 0.5 );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// Path segments triangles\n\n\t\t\t\t\taddVertex( lastPointR, u0, 1 );\n\t\t\t\t\taddVertex( lastPointL, u0, 0 );\n\t\t\t\t\taddVertex( currentPointR, u1, 1 );\n\n\t\t\t\t\taddVertex( lastPointL, u0, 0 );\n\t\t\t\t\taddVertex( innerPoint, u1, 0 );\n\t\t\t\t\taddVertex( currentPointR, u1, 1 );\n\n\t\t\t\t\t// Bevel join triangle\n\n\t\t\t\t\taddVertex( currentPointR, u, 1 );\n\t\t\t\t\taddVertex( nextPointR, u, 0 );\n\t\t\t\t\taddVertex( innerPoint, u, 0.5 );\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\t// Bevel join triangle. The segment triangles are done in the main loop\n\n\t\t\t\tif ( joinIsOnLeftSide ) {\n\n\t\t\t\t\taddVertex( currentPointL, u, 0 );\n\t\t\t\t\taddVertex( nextPointL, u, 0 );\n\t\t\t\t\taddVertex( currentPoint, u, 0.5 );\n\n\t\t\t\t} else {\n\n\t\t\t\t\taddVertex( currentPointR, u, 1 );\n\t\t\t\t\taddVertex( nextPointR, u, 0 );\n\t\t\t\t\taddVertex( currentPoint, u, 0.5 );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction createSegmentTrianglesWithMiddleSection( joinIsOnLeftSide, innerSideModified ) {\n\n\t\t\tif ( innerSideModified ) {\n\n\t\t\t\tif ( joinIsOnLeftSide ) {\n\n\t\t\t\t\taddVertex( lastPointR, u0, 1 );\n\t\t\t\t\taddVertex( lastPointL, u0, 0 );\n\t\t\t\t\taddVertex( currentPointL, u1, 0 );\n\n\t\t\t\t\taddVertex( lastPointR, u0, 1 );\n\t\t\t\t\taddVertex( currentPointL, u1, 0 );\n\t\t\t\t\taddVertex( innerPoint, u1, 1 );\n\n\t\t\t\t\taddVertex( currentPointL, u0, 0 );\n\t\t\t\t\taddVertex( currentPoint, u1, 0.5 );\n\t\t\t\t\taddVertex( innerPoint, u1, 1 );\n\n\t\t\t\t\taddVertex( currentPoint, u1, 0.5 );\n\t\t\t\t\taddVertex( nextPointL, u0, 0 );\n\t\t\t\t\taddVertex( innerPoint, u1, 1 );\n\n\t\t\t\t} else {\n\n\t\t\t\t\taddVertex( lastPointR, u0, 1 );\n\t\t\t\t\taddVertex( lastPointL, u0, 0 );\n\t\t\t\t\taddVertex( currentPointR, u1, 1 );\n\n\t\t\t\t\taddVertex( lastPointL, u0, 0 );\n\t\t\t\t\taddVertex( innerPoint, u1, 0 );\n\t\t\t\t\taddVertex( currentPointR, u1, 1 );\n\n\t\t\t\t\taddVertex( currentPointR, u0, 1 );\n\t\t\t\t\taddVertex( innerPoint, u1, 0 );\n\t\t\t\t\taddVertex( currentPoint, u1, 0.5 );\n\n\t\t\t\t\taddVertex( currentPoint, u1, 0.5 );\n\t\t\t\t\taddVertex( innerPoint, u1, 0 );\n\t\t\t\t\taddVertex( nextPointR, u0, 1 );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction addCapGeometry( center, p1, p2, joinIsOnLeftSide, start, u ) {\n\n\t\t\t// param center: End point of the path\n\t\t\t// param p1, p2: Left and right cap points\n\n\t\t\tswitch ( style.strokeLineCap ) {\n\n\t\t\t\tcase 'round':\n\n\t\t\t\t\tif ( start ) {\n\n\t\t\t\t\t\tmakeCircularSector( center, p2, p1, u, 0.5 );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tmakeCircularSector( center, p1, p2, u, 0.5 );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'square':\n\n\t\t\t\t\tif ( start ) {\n\n\t\t\t\t\t\ttempV2_1.subVectors( p1, center );\n\t\t\t\t\t\ttempV2_2.set( tempV2_1.y, - tempV2_1.x );\n\n\t\t\t\t\t\ttempV2_3.addVectors( tempV2_1, tempV2_2 ).add( center );\n\t\t\t\t\t\ttempV2_4.subVectors( tempV2_2, tempV2_1 ).add( center );\n\n\t\t\t\t\t\t// Modify already existing vertices\n\t\t\t\t\t\tif ( joinIsOnLeftSide ) {\n\n\t\t\t\t\t\t\ttempV2_3.toArray( vertices, 1 * 3 );\n\t\t\t\t\t\t\ttempV2_4.toArray( vertices, 0 * 3 );\n\t\t\t\t\t\t\ttempV2_4.toArray( vertices, 3 * 3 );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\ttempV2_3.toArray( vertices, 1 * 3 );\n\t\t\t\t\t\t\ttempV2_3.toArray( vertices, 3 * 3 );\n\t\t\t\t\t\t\ttempV2_4.toArray( vertices, 0 * 3 );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\ttempV2_1.subVectors( p2, center );\n\t\t\t\t\t\ttempV2_2.set( tempV2_1.y, - tempV2_1.x );\n\n\t\t\t\t\t\ttempV2_3.addVectors( tempV2_1, tempV2_2 ).add( center );\n\t\t\t\t\t\ttempV2_4.subVectors( tempV2_2, tempV2_1 ).add( center );\n\n\t\t\t\t\t\tconst vl = vertices.length;\n\n\t\t\t\t\t\t// Modify already existing vertices\n\t\t\t\t\t\tif ( joinIsOnLeftSide ) {\n\n\t\t\t\t\t\t\ttempV2_3.toArray( vertices, vl - 1 * 3 );\n\t\t\t\t\t\t\ttempV2_4.toArray( vertices, vl - 2 * 3 );\n\t\t\t\t\t\t\ttempV2_4.toArray( vertices, vl - 4 * 3 );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\ttempV2_3.toArray( vertices, vl - 2 * 3 );\n\t\t\t\t\t\t\ttempV2_4.toArray( vertices, vl - 1 * 3 );\n\t\t\t\t\t\t\ttempV2_4.toArray( vertices, vl - 4 * 3 );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'butt':\n\t\t\t\tdefault:\n\n\t\t\t\t\t// Nothing to do here\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction removeDuplicatedPoints( points ) {\n\n\t\t\t// Creates a new array if necessary with duplicated points removed.\n\t\t\t// This does not remove duplicated initial and ending points of a closed path.\n\n\t\t\tlet dupPoints = false;\n\t\t\tfor ( let i = 1, n = points.length - 1; i < n; i ++ ) {\n\n\t\t\t\tif ( points[ i ].distanceTo( points[ i + 1 ] ) < minDistance ) {\n\n\t\t\t\t\tdupPoints = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( ! dupPoints ) return points;\n\n\t\t\tconst newPoints = [];\n\t\t\tnewPoints.push( points[ 0 ] );\n\n\t\t\tfor ( let i = 1, n = points.length - 1; i < n; i ++ ) {\n\n\t\t\t\tif ( points[ i ].distanceTo( points[ i + 1 ] ) >= minDistance ) {\n\n\t\t\t\t\tnewPoints.push( points[ i ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tnewPoints.push( points[ points.length - 1 ] );\n\n\t\t\treturn newPoints;\n\n\t\t}\n\n\t}\n\n\n}\n\nexport { SVGLoader };\n","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nimport { FileLoader, ImageLoader, ObjectLoader, TextureLoader } from 'three';\r\nimport { FBXLoader } from 'three/examples/jsm/loaders/FBXLoader';\r\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader';\r\nimport { SVGLoader } from 'three/examples/jsm/loaders/SVGLoader';\r\nexport default class Loaders {\r\n    constructor(cache, textureAnisotropy) {\r\n        this.cache = cache;\r\n        this.textureAnisotropy = textureAnisotropy;\r\n    }\r\n    get fileLoader() {\r\n        if (!this._fileLoader)\r\n            this._fileLoader = new FileLoader();\r\n        return this._fileLoader;\r\n    }\r\n    get imageLoader() {\r\n        if (!this._imgLoader)\r\n            this._imgLoader = new ImageLoader();\r\n        return this._imgLoader;\r\n    }\r\n    get svgLoader() {\r\n        if (!this._svgLoader)\r\n            this._svgLoader = new SVGLoader();\r\n        return this._svgLoader;\r\n    }\r\n    get textureLoader() {\r\n        if (!this._textureLoader)\r\n            this._textureLoader = new TextureLoader();\r\n        return this._textureLoader;\r\n    }\r\n    get objectLoader() {\r\n        if (!this._objectLoader)\r\n            this._objectLoader = new ObjectLoader();\r\n        return this._objectLoader;\r\n    }\r\n    get gltfLoader() {\r\n        if (!this._gltfLoader)\r\n            this._gltfLoader = new GLTFLoader();\r\n        return this._gltfLoader;\r\n    }\r\n    get fbxLoader() {\r\n        if (!this._fbxLoader)\r\n            this._fbxLoader = new FBXLoader();\r\n        return this._fbxLoader;\r\n    }\r\n    preload(key, url) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            this.cache.add(key, url);\r\n            return new Promise(resolve => {\r\n                const isModel = /\\.fbx$|\\.glb$|\\.gltf$/.test(url);\r\n                const isTexture = /\\.jpe?g$|\\.png$/.test(url);\r\n                if (isTexture) {\r\n                    this.textureLoader.load(url, texture => {\r\n                        return resolve(texture);\r\n                    });\r\n                }\r\n                else {\r\n                    if (isModel)\r\n                        this.fileLoader.setResponseType('arraybuffer');\r\n                    this.fileLoader.load(url, file => {\r\n                        return resolve(file);\r\n                    });\r\n                }\r\n            });\r\n        });\r\n    }\r\n    textureAtlas(texture, json, _type = 'JSONHash') {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            let parsed = JSON.parse((yield this.file(json)));\r\n            // convert JSONArray to JSONHash\r\n            const isJSONArray = parsed.textures;\r\n            if (isJSONArray) {\r\n                const frames = parsed.textures[0].frames;\r\n                let jsonHash = { frames: {} };\r\n                frames.forEach(frame => {\r\n                    jsonHash = Object.assign(Object.assign({}, jsonHash), { frames: Object.assign(Object.assign({}, jsonHash.frames), { [frame.filename]: {\r\n                                frame: frame.frame,\r\n                                rotated: frame.rotated,\r\n                                sourceSize: frame.sourceSize,\r\n                                spriteSourceSize: frame.spriteSourceSize,\r\n                                trimmed: frame.trimmed\r\n                            } }) });\r\n                });\r\n                parsed = jsonHash;\r\n            }\r\n            const atlas = {\r\n                texture: yield this.texture(texture),\r\n                json: parsed\r\n            };\r\n            return atlas;\r\n        });\r\n    }\r\n    file(url) {\r\n        const key = this.cache.get(url);\r\n        url = key ? key : url;\r\n        return new Promise(resolve => {\r\n            this.fileLoader.load(url, file => {\r\n                return resolve(file);\r\n            });\r\n        });\r\n    }\r\n    svg(url) {\r\n        const key = this.cache.get(url);\r\n        url = key ? key : url;\r\n        return new Promise(resolve => {\r\n            this.svgLoader.load(url, svg => {\r\n                return resolve(svg);\r\n            });\r\n        });\r\n    }\r\n    texture(url) {\r\n        const isBase64 = /^data:image\\/[\\S]+;base64,/gm.test(url);\r\n        // we do not want to cache base64 images\r\n        if (!isBase64) {\r\n            const key = this.cache.get(url);\r\n            url = key ? key : url;\r\n        }\r\n        return new Promise(resolve => {\r\n            this.textureLoader.load(url, (texture) => {\r\n                texture.anisotropy = this.textureAnisotropy;\r\n                texture.needsUpdate = true;\r\n                resolve(texture);\r\n            });\r\n        });\r\n    }\r\n    // examples: https://github.com/mrdoob/three.js/wiki/JSON-Object-Scene-format-4\r\n    object(url) {\r\n        const key = this.cache.get(url);\r\n        url = key ? key : url;\r\n        return new Promise(resolve => {\r\n            this.objectLoader.load(url, (json) => {\r\n                resolve(json);\r\n            });\r\n        });\r\n    }\r\n    gltf(url) {\r\n        const key = this.cache.get(url);\r\n        url = key ? key : url;\r\n        return new Promise(resolve => {\r\n            this.gltfLoader.load(url, (gltf) => {\r\n                resolve(gltf);\r\n            });\r\n        });\r\n    }\r\n    fbx(url) {\r\n        const key = this.cache.get(url);\r\n        url = key ? key : url;\r\n        return new Promise(resolve => {\r\n            this.fbxLoader.load(url, (fbx) => {\r\n                resolve(fbx);\r\n            });\r\n        });\r\n    }\r\n}\r\n//# sourceMappingURL=loaders.js.map","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\nimport { Mesh, MeshBasicMaterial, Object3D, SphereBufferGeometry } from 'three';\r\nimport { AmbientLight, DirectionalLight, HemisphereLight, PointLight, RectAreaLight, SpotLight } from 'three';\r\nimport { DirectionalLightHelper, SpotLightHelper } from 'three';\r\nclass PointLightHelper extends Object3D {\r\n    constructor(scene, light, size, color) {\r\n        super();\r\n        this.scene = scene;\r\n        this.light = light;\r\n        this.size = size;\r\n        this.color = color;\r\n        this.geo = new SphereBufferGeometry(size || 0.2, 16, 8);\r\n        this.mat = new MeshBasicMaterial({ color: color || light.color });\r\n        this.mesh = new Mesh(this.geo, this.mat);\r\n        this.add(this.mesh);\r\n        light.add(this);\r\n    }\r\n    dispose() {\r\n        this.mesh.geometry.dispose();\r\n        if (!Array.isArray(this.mesh.material))\r\n            this.mesh.material.dispose();\r\n        else\r\n            this.mesh.material.forEach(m => m.dispose());\r\n        this.remove(this.mesh);\r\n    }\r\n    update() { }\r\n}\r\nexport default class Lights {\r\n    constructor(scene) {\r\n        this.scene = scene;\r\n    }\r\n    get helper() {\r\n        return {\r\n            directionalLightHelper: (light, size, color) => {\r\n                const helper = new DirectionalLightHelper(light, size, color);\r\n                this.scene.add(helper);\r\n                return helper;\r\n            },\r\n            spotLightHelper: (light, color) => {\r\n                const helper = new SpotLightHelper(light, color);\r\n                this.scene.add(helper);\r\n                return helper;\r\n            },\r\n            pointLightHelper: (light, size, color) => new PointLightHelper(this.scene, light, size, color)\r\n        };\r\n    }\r\n    directionalLight(options = {}) {\r\n        const { color = 0xffffff, intensity = 1 } = options;\r\n        const light = new DirectionalLight(color, intensity);\r\n        light.castShadow = true;\r\n        this.scene.add(light);\r\n        return light;\r\n    }\r\n    hemisphereLight(options = {}) {\r\n        const { skyColor = 0xffffff, groundColor = 0xffffff, intensity = 1 } = options;\r\n        const light = new HemisphereLight(skyColor, groundColor, intensity);\r\n        this.scene.add(light);\r\n        return light;\r\n    }\r\n    ambientLight(options = {}) {\r\n        const { color = 0xffffff, intensity = 1 } = options;\r\n        const light = new AmbientLight(color, intensity);\r\n        this.scene.add(light);\r\n        return light;\r\n    }\r\n    pointLight(options = {}) {\r\n        const { color = 0xffffff, intensity = 1, distance = 0, decay = 1 } = options;\r\n        const light = new PointLight(color, intensity, distance, decay);\r\n        light.castShadow = true;\r\n        this.scene.add(light);\r\n        return light;\r\n    }\r\n    spotLight(options = {}) {\r\n        const { color = 0xffffff, intensity = 1, distance = 0, angle = Math.PI / 8, penumbra = 0, decay = 1 } = options;\r\n        const light = new SpotLight(color, intensity, distance, angle, penumbra, decay);\r\n        light.castShadow = true;\r\n        this.scene.add(light);\r\n        return light;\r\n    }\r\n    rectAreaLight(options = {}) {\r\n        const { color = 0xffffff, intensity = 1, width = 10, height = 10 } = options;\r\n        const light = new RectAreaLight(color, intensity, width, height);\r\n        this.scene.add(light);\r\n        return light;\r\n    }\r\n}\r\n//# sourceMappingURL=lights.js.map","import {\n\tBox3,\n\tBufferAttribute,\n\tBufferGeometry,\n\tColor,\n\tEventDispatcher,\n\tFloat32BufferAttribute,\n\tMatrix3,\n\tMatrix4,\n\tMathUtils,\n\tObject3D,\n\tSphere,\n\tVector2,\n\tVector3\n} from 'three';\n\nconst _m1 = new Matrix4();\nconst _obj = new Object3D();\nconst _offset = new Vector3();\n\nclass Geometry extends EventDispatcher {\n\n\tconstructor() {\n\n\t\tsuper();\n\n\t\tthis.uuid = MathUtils.generateUUID();\n\n\t\tthis.name = '';\n\t\tthis.type = 'Geometry';\n\n\t\tthis.vertices = [];\n\t\tthis.colors = [];\n\t\tthis.faces = [];\n\t\tthis.faceVertexUvs = [[]];\n\n\t\tthis.morphTargets = [];\n\t\tthis.morphNormals = [];\n\n\t\tthis.skinWeights = [];\n\t\tthis.skinIndices = [];\n\n\t\tthis.lineDistances = [];\n\n\t\tthis.boundingBox = null;\n\t\tthis.boundingSphere = null;\n\n\t\t// update flags\n\n\t\tthis.elementsNeedUpdate = false;\n\t\tthis.verticesNeedUpdate = false;\n\t\tthis.uvsNeedUpdate = false;\n\t\tthis.normalsNeedUpdate = false;\n\t\tthis.colorsNeedUpdate = false;\n\t\tthis.lineDistancesNeedUpdate = false;\n\t\tthis.groupsNeedUpdate = false;\n\n\t}\n\n\tapplyMatrix4( matrix ) {\n\n\t\tconst normalMatrix = new Matrix3().getNormalMatrix( matrix );\n\n\t\tfor ( let i = 0, il = this.vertices.length; i < il; i ++ ) {\n\n\t\t\tconst vertex = this.vertices[ i ];\n\t\t\tvertex.applyMatrix4( matrix );\n\n\t\t}\n\n\t\tfor ( let i = 0, il = this.faces.length; i < il; i ++ ) {\n\n\t\t\tconst face = this.faces[ i ];\n\t\t\tface.normal.applyMatrix3( normalMatrix ).normalize();\n\n\t\t\tfor ( let j = 0, jl = face.vertexNormals.length; j < jl; j ++ ) {\n\n\t\t\t\tface.vertexNormals[ j ].applyMatrix3( normalMatrix ).normalize();\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( this.boundingBox !== null ) {\n\n\t\t\tthis.computeBoundingBox();\n\n\t\t}\n\n\t\tif ( this.boundingSphere !== null ) {\n\n\t\t\tthis.computeBoundingSphere();\n\n\t\t}\n\n\t\tthis.verticesNeedUpdate = true;\n\t\tthis.normalsNeedUpdate = true;\n\n\t\treturn this;\n\n\t}\n\n\trotateX( angle ) {\n\n\t\t// rotate geometry around world x-axis\n\n\t\t_m1.makeRotationX( angle );\n\n\t\tthis.applyMatrix4( _m1 );\n\n\t\treturn this;\n\n\t}\n\n\trotateY( angle ) {\n\n\t\t// rotate geometry around world y-axis\n\n\t\t_m1.makeRotationY( angle );\n\n\t\tthis.applyMatrix4( _m1 );\n\n\t\treturn this;\n\n\t}\n\n\trotateZ( angle ) {\n\n\t\t// rotate geometry around world z-axis\n\n\t\t_m1.makeRotationZ( angle );\n\n\t\tthis.applyMatrix4( _m1 );\n\n\t\treturn this;\n\n\t}\n\n\ttranslate( x, y, z ) {\n\n\t\t// translate geometry\n\n\t\t_m1.makeTranslation( x, y, z );\n\n\t\tthis.applyMatrix4( _m1 );\n\n\t\treturn this;\n\n\t}\n\n\tscale( x, y, z ) {\n\n\t\t// scale geometry\n\n\t\t_m1.makeScale( x, y, z );\n\n\t\tthis.applyMatrix4( _m1 );\n\n\t\treturn this;\n\n\t}\n\n\tlookAt( vector ) {\n\n\t\t_obj.lookAt( vector );\n\n\t\t_obj.updateMatrix();\n\n\t\tthis.applyMatrix4( _obj.matrix );\n\n\t\treturn this;\n\n\t}\n\n\tfromBufferGeometry( geometry ) {\n\n\t\tconst scope = this;\n\n\t\tconst index = geometry.index !== null ? geometry.index : undefined;\n\t\tconst attributes = geometry.attributes;\n\n\t\tif ( attributes.position === undefined ) {\n\n\t\t\tconsole.error( 'THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion.' );\n\t\t\treturn this;\n\n\t\t}\n\n\t\tconst position = attributes.position;\n\t\tconst normal = attributes.normal;\n\t\tconst color = attributes.color;\n\t\tconst uv = attributes.uv;\n\t\tconst uv2 = attributes.uv2;\n\n\t\tif ( uv2 !== undefined ) this.faceVertexUvs[ 1 ] = [];\n\n\t\tfor ( let i = 0; i < position.count; i ++ ) {\n\n\t\t\tscope.vertices.push( new Vector3().fromBufferAttribute( position, i ) );\n\n\t\t\tif ( color !== undefined ) {\n\n\t\t\t\tscope.colors.push( new Color().fromBufferAttribute( color, i ) );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction addFace( a, b, c, materialIndex ) {\n\n\t\t\tconst vertexColors = ( color === undefined ) ? [] : [\n\t\t\t\tscope.colors[ a ].clone(),\n\t\t\t\tscope.colors[ b ].clone(),\n\t\t\t\tscope.colors[ c ].clone()\n\t\t\t];\n\n\t\t\tconst vertexNormals = ( normal === undefined ) ? [] : [\n\t\t\t\tnew Vector3().fromBufferAttribute( normal, a ),\n\t\t\t\tnew Vector3().fromBufferAttribute( normal, b ),\n\t\t\t\tnew Vector3().fromBufferAttribute( normal, c )\n\t\t\t];\n\n\t\t\tconst face = new Face3( a, b, c, vertexNormals, vertexColors, materialIndex );\n\n\t\t\tscope.faces.push( face );\n\n\t\t\tif ( uv !== undefined ) {\n\n\t\t\t\tscope.faceVertexUvs[ 0 ].push( [\n\t\t\t\t\tnew Vector2().fromBufferAttribute( uv, a ),\n\t\t\t\t\tnew Vector2().fromBufferAttribute( uv, b ),\n\t\t\t\t\tnew Vector2().fromBufferAttribute( uv, c )\n\t\t\t\t] );\n\n\t\t\t}\n\n\t\t\tif ( uv2 !== undefined ) {\n\n\t\t\t\tscope.faceVertexUvs[ 1 ].push( [\n\t\t\t\t\tnew Vector2().fromBufferAttribute( uv2, a ),\n\t\t\t\t\tnew Vector2().fromBufferAttribute( uv2, b ),\n\t\t\t\t\tnew Vector2().fromBufferAttribute( uv2, c )\n\t\t\t\t] );\n\n\t\t\t}\n\n\t\t}\n\n\t\tconst groups = geometry.groups;\n\n\t\tif ( groups.length > 0 ) {\n\n\t\t\tfor ( let i = 0; i < groups.length; i ++ ) {\n\n\t\t\t\tconst group = groups[ i ];\n\n\t\t\t\tconst start = group.start;\n\t\t\t\tconst count = group.count;\n\n\t\t\t\tfor ( let j = start, jl = start + count; j < jl; j += 3 ) {\n\n\t\t\t\t\tif ( index !== undefined ) {\n\n\t\t\t\t\t\taddFace( index.getX( j ), index.getX( j + 1 ), index.getX( j + 2 ), group.materialIndex );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\taddFace( j, j + 1, j + 2, group.materialIndex );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tif ( index !== undefined ) {\n\n\t\t\t\tfor ( let i = 0; i < index.count; i += 3 ) {\n\n\t\t\t\t\taddFace( index.getX( i ), index.getX( i + 1 ), index.getX( i + 2 ) );\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tfor ( let i = 0; i < position.count; i += 3 ) {\n\n\t\t\t\t\taddFace( i, i + 1, i + 2 );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.computeFaceNormals();\n\n\t\tif ( geometry.boundingBox !== null ) {\n\n\t\t\tthis.boundingBox = geometry.boundingBox.clone();\n\n\t\t}\n\n\t\tif ( geometry.boundingSphere !== null ) {\n\n\t\t\tthis.boundingSphere = geometry.boundingSphere.clone();\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\tcenter() {\n\n\t\tthis.computeBoundingBox();\n\n\t\tthis.boundingBox.getCenter( _offset ).negate();\n\n\t\tthis.translate( _offset.x, _offset.y, _offset.z );\n\n\t\treturn this;\n\n\t}\n\n\tnormalize() {\n\n\t\tthis.computeBoundingSphere();\n\n\t\tconst center = this.boundingSphere.center;\n\t\tconst radius = this.boundingSphere.radius;\n\n\t\tconst s = radius === 0 ? 1 : 1.0 / radius;\n\n\t\tconst matrix = new Matrix4();\n\t\tmatrix.set(\n\t\t\ts, 0, 0, - s * center.x,\n\t\t\t0, s, 0, - s * center.y,\n\t\t\t0, 0, s, - s * center.z,\n\t\t\t0, 0, 0, 1\n\t\t);\n\n\t\tthis.applyMatrix4( matrix );\n\n\t\treturn this;\n\n\t}\n\n\tcomputeFaceNormals() {\n\n\t\tconst cb = new Vector3(), ab = new Vector3();\n\n\t\tfor ( let f = 0, fl = this.faces.length; f < fl; f ++ ) {\n\n\t\t\tconst face = this.faces[ f ];\n\n\t\t\tconst vA = this.vertices[ face.a ];\n\t\t\tconst vB = this.vertices[ face.b ];\n\t\t\tconst vC = this.vertices[ face.c ];\n\n\t\t\tcb.subVectors( vC, vB );\n\t\t\tab.subVectors( vA, vB );\n\t\t\tcb.cross( ab );\n\n\t\t\tcb.normalize();\n\n\t\t\tface.normal.copy( cb );\n\n\t\t}\n\n\t}\n\n\tcomputeVertexNormals( areaWeighted = true ) {\n\n\t\tconst vertices = new Array( this.vertices.length );\n\n\t\tfor ( let v = 0, vl = this.vertices.length; v < vl; v ++ ) {\n\n\t\t\tvertices[ v ] = new Vector3();\n\n\t\t}\n\n\t\tif ( areaWeighted ) {\n\n\t\t\t// vertex normals weighted by triangle areas\n\t\t\t// http://www.iquilezles.org/www/articles/normals/normals.htm\n\n\t\t\tconst cb = new Vector3(), ab = new Vector3();\n\n\t\t\tfor ( let f = 0, fl = this.faces.length; f < fl; f ++ ) {\n\n\t\t\t\tconst face = this.faces[ f ];\n\n\t\t\t\tconst vA = this.vertices[ face.a ];\n\t\t\t\tconst vB = this.vertices[ face.b ];\n\t\t\t\tconst vC = this.vertices[ face.c ];\n\n\t\t\t\tcb.subVectors( vC, vB );\n\t\t\t\tab.subVectors( vA, vB );\n\t\t\t\tcb.cross( ab );\n\n\t\t\t\tvertices[ face.a ].add( cb );\n\t\t\t\tvertices[ face.b ].add( cb );\n\t\t\t\tvertices[ face.c ].add( cb );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tthis.computeFaceNormals();\n\n\t\t\tfor ( let f = 0, fl = this.faces.length; f < fl; f ++ ) {\n\n\t\t\t\tconst face = this.faces[ f ];\n\n\t\t\t\tvertices[ face.a ].add( face.normal );\n\t\t\t\tvertices[ face.b ].add( face.normal );\n\t\t\t\tvertices[ face.c ].add( face.normal );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfor ( let v = 0, vl = this.vertices.length; v < vl; v ++ ) {\n\n\t\t\tvertices[ v ].normalize();\n\n\t\t}\n\n\t\tfor ( let f = 0, fl = this.faces.length; f < fl; f ++ ) {\n\n\t\t\tconst face = this.faces[ f ];\n\n\t\t\tconst vertexNormals = face.vertexNormals;\n\n\t\t\tif ( vertexNormals.length === 3 ) {\n\n\t\t\t\tvertexNormals[ 0 ].copy( vertices[ face.a ] );\n\t\t\t\tvertexNormals[ 1 ].copy( vertices[ face.b ] );\n\t\t\t\tvertexNormals[ 2 ].copy( vertices[ face.c ] );\n\n\t\t\t} else {\n\n\t\t\t\tvertexNormals[ 0 ] = vertices[ face.a ].clone();\n\t\t\t\tvertexNormals[ 1 ] = vertices[ face.b ].clone();\n\t\t\t\tvertexNormals[ 2 ] = vertices[ face.c ].clone();\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( this.faces.length > 0 ) {\n\n\t\t\tthis.normalsNeedUpdate = true;\n\n\t\t}\n\n\t}\n\n\tcomputeFlatVertexNormals() {\n\n\t\tthis.computeFaceNormals();\n\n\t\tfor ( let f = 0, fl = this.faces.length; f < fl; f ++ ) {\n\n\t\t\tconst face = this.faces[ f ];\n\n\t\t\tconst vertexNormals = face.vertexNormals;\n\n\t\t\tif ( vertexNormals.length === 3 ) {\n\n\t\t\t\tvertexNormals[ 0 ].copy( face.normal );\n\t\t\t\tvertexNormals[ 1 ].copy( face.normal );\n\t\t\t\tvertexNormals[ 2 ].copy( face.normal );\n\n\t\t\t} else {\n\n\t\t\t\tvertexNormals[ 0 ] = face.normal.clone();\n\t\t\t\tvertexNormals[ 1 ] = face.normal.clone();\n\t\t\t\tvertexNormals[ 2 ] = face.normal.clone();\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( this.faces.length > 0 ) {\n\n\t\t\tthis.normalsNeedUpdate = true;\n\n\t\t}\n\n\t}\n\n\tcomputeMorphNormals() {\n\n\t\t// save original normals\n\t\t// - create temp variables on first access\n\t\t//   otherwise just copy (for faster repeated calls)\n\n\t\tfor ( let f = 0, fl = this.faces.length; f < fl; f ++ ) {\n\n\t\t\tconst face = this.faces[ f ];\n\n\t\t\tif ( ! face.__originalFaceNormal ) {\n\n\t\t\t\tface.__originalFaceNormal = face.normal.clone();\n\n\t\t\t} else {\n\n\t\t\t\tface.__originalFaceNormal.copy( face.normal );\n\n\t\t\t}\n\n\t\t\tif ( ! face.__originalVertexNormals ) face.__originalVertexNormals = [];\n\n\t\t\tfor ( let i = 0, il = face.vertexNormals.length; i < il; i ++ ) {\n\n\t\t\t\tif ( ! face.__originalVertexNormals[ i ] ) {\n\n\t\t\t\t\tface.__originalVertexNormals[ i ] = face.vertexNormals[ i ].clone();\n\n\t\t\t\t} else {\n\n\t\t\t\t\tface.__originalVertexNormals[ i ].copy( face.vertexNormals[ i ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\t// use temp geometry to compute face and vertex normals for each morph\n\n\t\tconst tmpGeo = new Geometry();\n\t\ttmpGeo.faces = this.faces;\n\n\t\tfor ( let i = 0, il = this.morphTargets.length; i < il; i ++ ) {\n\n\t\t\t// create on first access\n\n\t\t\tif ( ! this.morphNormals[ i ] ) {\n\n\t\t\t\tthis.morphNormals[ i ] = {};\n\t\t\t\tthis.morphNormals[ i ].faceNormals = [];\n\t\t\t\tthis.morphNormals[ i ].vertexNormals = [];\n\n\t\t\t\tconst dstNormalsFace = this.morphNormals[ i ].faceNormals;\n\t\t\t\tconst dstNormalsVertex = this.morphNormals[ i ].vertexNormals;\n\n\t\t\t\tfor ( let f = 0, fl = this.faces.length; f < fl; f ++ ) {\n\n\t\t\t\t\tconst faceNormal = new Vector3();\n\t\t\t\t\tconst vertexNormals = { a: new Vector3(), b: new Vector3(), c: new Vector3() };\n\n\t\t\t\t\tdstNormalsFace.push( faceNormal );\n\t\t\t\t\tdstNormalsVertex.push( vertexNormals );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tconst morphNormals = this.morphNormals[ i ];\n\n\t\t\t// set vertices to morph target\n\n\t\t\ttmpGeo.vertices = this.morphTargets[ i ].vertices;\n\n\t\t\t// compute morph normals\n\n\t\t\ttmpGeo.computeFaceNormals();\n\t\t\ttmpGeo.computeVertexNormals();\n\n\t\t\t// store morph normals\n\n\t\t\tfor ( let f = 0, fl = this.faces.length; f < fl; f ++ ) {\n\n\t\t\t\tconst face = this.faces[ f ];\n\n\t\t\t\tconst faceNormal = morphNormals.faceNormals[ f ];\n\t\t\t\tconst vertexNormals = morphNormals.vertexNormals[ f ];\n\n\t\t\t\tfaceNormal.copy( face.normal );\n\n\t\t\t\tvertexNormals.a.copy( face.vertexNormals[ 0 ] );\n\t\t\t\tvertexNormals.b.copy( face.vertexNormals[ 1 ] );\n\t\t\t\tvertexNormals.c.copy( face.vertexNormals[ 2 ] );\n\n\t\t\t}\n\n\t\t}\n\n\t\t// restore original normals\n\n\t\tfor ( let f = 0, fl = this.faces.length; f < fl; f ++ ) {\n\n\t\t\tconst face = this.faces[ f ];\n\n\t\t\tface.normal = face.__originalFaceNormal;\n\t\t\tface.vertexNormals = face.__originalVertexNormals;\n\n\t\t}\n\n\t}\n\n\tcomputeBoundingBox() {\n\n\t\tif ( this.boundingBox === null ) {\n\n\t\t\tthis.boundingBox = new Box3();\n\n\t\t}\n\n\t\tthis.boundingBox.setFromPoints( this.vertices );\n\n\t}\n\n\tcomputeBoundingSphere() {\n\n\t\tif ( this.boundingSphere === null ) {\n\n\t\t\tthis.boundingSphere = new Sphere();\n\n\t\t}\n\n\t\tthis.boundingSphere.setFromPoints( this.vertices );\n\n\t}\n\n\tmerge( geometry, matrix, materialIndexOffset = 0 ) {\n\n\t\tif ( ! ( geometry && geometry.isGeometry ) ) {\n\n\t\t\tconsole.error( 'THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.', geometry );\n\t\t\treturn;\n\n\t\t}\n\n\t\tlet normalMatrix;\n\t\tconst vertexOffset = this.vertices.length,\n\t\t\tvertices1 = this.vertices,\n\t\t\tvertices2 = geometry.vertices,\n\t\t\tfaces1 = this.faces,\n\t\t\tfaces2 = geometry.faces,\n\t\t\tcolors1 = this.colors,\n\t\t\tcolors2 = geometry.colors;\n\n\t\tif ( matrix !== undefined ) {\n\n\t\t\tnormalMatrix = new Matrix3().getNormalMatrix( matrix );\n\n\t\t}\n\n\t\t// vertices\n\n\t\tfor ( let i = 0, il = vertices2.length; i < il; i ++ ) {\n\n\t\t\tconst vertex = vertices2[ i ];\n\n\t\t\tconst vertexCopy = vertex.clone();\n\n\t\t\tif ( matrix !== undefined ) vertexCopy.applyMatrix4( matrix );\n\n\t\t\tvertices1.push( vertexCopy );\n\n\t\t}\n\n\t\t// colors\n\n\t\tfor ( let i = 0, il = colors2.length; i < il; i ++ ) {\n\n\t\t\tcolors1.push( colors2[ i ].clone() );\n\n\t\t}\n\n\t\t// faces\n\n\t\tfor ( let i = 0, il = faces2.length; i < il; i ++ ) {\n\n\t\t\tconst face = faces2[ i ];\n\t\t\tlet normal, color;\n\t\t\tconst faceVertexNormals = face.vertexNormals,\n\t\t\t\tfaceVertexColors = face.vertexColors;\n\n\t\t\tconst faceCopy = new Face3( face.a + vertexOffset, face.b + vertexOffset, face.c + vertexOffset );\n\t\t\tfaceCopy.normal.copy( face.normal );\n\n\t\t\tif ( normalMatrix !== undefined ) {\n\n\t\t\t\tfaceCopy.normal.applyMatrix3( normalMatrix ).normalize();\n\n\t\t\t}\n\n\t\t\tfor ( let j = 0, jl = faceVertexNormals.length; j < jl; j ++ ) {\n\n\t\t\t\tnormal = faceVertexNormals[ j ].clone();\n\n\t\t\t\tif ( normalMatrix !== undefined ) {\n\n\t\t\t\t\tnormal.applyMatrix3( normalMatrix ).normalize();\n\n\t\t\t\t}\n\n\t\t\t\tfaceCopy.vertexNormals.push( normal );\n\n\t\t\t}\n\n\t\t\tfaceCopy.color.copy( face.color );\n\n\t\t\tfor ( let j = 0, jl = faceVertexColors.length; j < jl; j ++ ) {\n\n\t\t\t\tcolor = faceVertexColors[ j ];\n\t\t\t\tfaceCopy.vertexColors.push( color.clone() );\n\n\t\t\t}\n\n\t\t\tfaceCopy.materialIndex = face.materialIndex + materialIndexOffset;\n\n\t\t\tfaces1.push( faceCopy );\n\n\t\t}\n\n\t\t// uvs\n\n\t\tfor ( let i = 0, il = geometry.faceVertexUvs.length; i < il; i ++ ) {\n\n\t\t\tconst faceVertexUvs2 = geometry.faceVertexUvs[ i ];\n\n\t\t\tif ( this.faceVertexUvs[ i ] === undefined ) this.faceVertexUvs[ i ] = [];\n\n\t\t\tfor ( let j = 0, jl = faceVertexUvs2.length; j < jl; j ++ ) {\n\n\t\t\t\tconst uvs2 = faceVertexUvs2[ j ], uvsCopy = [];\n\n\t\t\t\tfor ( let k = 0, kl = uvs2.length; k < kl; k ++ ) {\n\n\t\t\t\t\tuvsCopy.push( uvs2[ k ].clone() );\n\n\t\t\t\t}\n\n\t\t\t\tthis.faceVertexUvs[ i ].push( uvsCopy );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tmergeMesh( mesh ) {\n\n\t\tif ( ! ( mesh && mesh.isMesh ) ) {\n\n\t\t\tconsole.error( 'THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.', mesh );\n\t\t\treturn;\n\n\t\t}\n\n\t\tif ( mesh.matrixAutoUpdate ) mesh.updateMatrix();\n\n\t\tthis.merge( mesh.geometry, mesh.matrix );\n\n\t}\n\n\t/*\n\t * Checks for duplicate vertices with hashmap.\n\t * Duplicated vertices are removed\n\t * and faces' vertices are updated.\n\t */\n\n\tmergeVertices( precisionPoints = 4 ) {\n\n\t\tconst verticesMap = {}; // Hashmap for looking up vertices by position coordinates (and making sure they are unique)\n\t\tconst unique = [], changes = [];\n\n\t\tconst precision = Math.pow( 10, precisionPoints );\n\n\t\tfor ( let i = 0, il = this.vertices.length; i < il; i ++ ) {\n\n\t\t\tconst v = this.vertices[ i ];\n\t\t\tconst key = Math.round( v.x * precision ) + '_' + Math.round( v.y * precision ) + '_' + Math.round( v.z * precision );\n\n\t\t\tif ( verticesMap[ key ] === undefined ) {\n\n\t\t\t\tverticesMap[ key ] = i;\n\t\t\t\tunique.push( this.vertices[ i ] );\n\t\t\t\tchanges[ i ] = unique.length - 1;\n\n\t\t\t} else {\n\n\t\t\t\t//console.log('Duplicate vertex found. ', i, ' could be using ', verticesMap[key]);\n\t\t\t\tchanges[ i ] = changes[ verticesMap[ key ] ];\n\n\t\t\t}\n\n\t\t}\n\n\n\t\t// if faces are completely degenerate after merging vertices, we\n\t\t// have to remove them from the geometry.\n\t\tconst faceIndicesToRemove = [];\n\n\t\tfor ( let i = 0, il = this.faces.length; i < il; i ++ ) {\n\n\t\t\tconst face = this.faces[ i ];\n\n\t\t\tface.a = changes[ face.a ];\n\t\t\tface.b = changes[ face.b ];\n\t\t\tface.c = changes[ face.c ];\n\n\t\t\tconst indices = [ face.a, face.b, face.c ];\n\n\t\t\t// if any duplicate vertices are found in a Face3\n\t\t\t// we have to remove the face as nothing can be saved\n\t\t\tfor ( let n = 0; n < 3; n ++ ) {\n\n\t\t\t\tif ( indices[ n ] === indices[ ( n + 1 ) % 3 ] ) {\n\n\t\t\t\t\tfaceIndicesToRemove.push( i );\n\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfor ( let i = faceIndicesToRemove.length - 1; i >= 0; i -- ) {\n\n\t\t\tconst idx = faceIndicesToRemove[ i ];\n\n\t\t\tthis.faces.splice( idx, 1 );\n\n\t\t\tfor ( let j = 0, jl = this.faceVertexUvs.length; j < jl; j ++ ) {\n\n\t\t\t\tthis.faceVertexUvs[ j ].splice( idx, 1 );\n\n\t\t\t}\n\n\t\t}\n\n\t\t// Use unique set of vertices\n\n\t\tconst diff = this.vertices.length - unique.length;\n\t\tthis.vertices = unique;\n\t\treturn diff;\n\n\t}\n\n\tsetFromPoints( points ) {\n\n\t\tthis.vertices = [];\n\n\t\tfor ( let i = 0, l = points.length; i < l; i ++ ) {\n\n\t\t\tconst point = points[ i ];\n\t\t\tthis.vertices.push( new Vector3( point.x, point.y, point.z || 0 ) );\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\tsortFacesByMaterialIndex() {\n\n\t\tconst faces = this.faces;\n\t\tconst length = faces.length;\n\n\t\t// tag faces\n\n\t\tfor ( let i = 0; i < length; i ++ ) {\n\n\t\t\tfaces[ i ]._id = i;\n\n\t\t}\n\n\t\t// sort faces\n\n\t\tfunction materialIndexSort( a, b ) {\n\n\t\t\treturn a.materialIndex - b.materialIndex;\n\n\t\t}\n\n\t\tfaces.sort( materialIndexSort );\n\n\t\t// sort uvs\n\n\t\tconst uvs1 = this.faceVertexUvs[ 0 ];\n\t\tconst uvs2 = this.faceVertexUvs[ 1 ];\n\n\t\tlet newUvs1, newUvs2;\n\n\t\tif ( uvs1 && uvs1.length === length ) newUvs1 = [];\n\t\tif ( uvs2 && uvs2.length === length ) newUvs2 = [];\n\n\t\tfor ( let i = 0; i < length; i ++ ) {\n\n\t\t\tconst id = faces[ i ]._id;\n\n\t\t\tif ( newUvs1 ) newUvs1.push( uvs1[ id ] );\n\t\t\tif ( newUvs2 ) newUvs2.push( uvs2[ id ] );\n\n\t\t}\n\n\t\tif ( newUvs1 ) this.faceVertexUvs[ 0 ] = newUvs1;\n\t\tif ( newUvs2 ) this.faceVertexUvs[ 1 ] = newUvs2;\n\n\t}\n\n\ttoJSON() {\n\n\t\tconst data = {\n\t\t\tmetadata: {\n\t\t\t\tversion: 4.5,\n\t\t\t\ttype: 'Geometry',\n\t\t\t\tgenerator: 'Geometry.toJSON'\n\t\t\t}\n\t\t};\n\n\t\t// standard Geometry serialization\n\n\t\tdata.uuid = this.uuid;\n\t\tdata.type = this.type;\n\t\tif ( this.name !== '' ) data.name = this.name;\n\n\t\tif ( this.parameters !== undefined ) {\n\n\t\t\tconst parameters = this.parameters;\n\n\t\t\tfor ( const key in parameters ) {\n\n\t\t\t\tif ( parameters[ key ] !== undefined ) data[ key ] = parameters[ key ];\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tconst vertices = [];\n\n\t\tfor ( let i = 0; i < this.vertices.length; i ++ ) {\n\n\t\t\tconst vertex = this.vertices[ i ];\n\t\t\tvertices.push( vertex.x, vertex.y, vertex.z );\n\n\t\t}\n\n\t\tconst faces = [];\n\t\tconst normals = [];\n\t\tconst normalsHash = {};\n\t\tconst colors = [];\n\t\tconst colorsHash = {};\n\t\tconst uvs = [];\n\t\tconst uvsHash = {};\n\n\t\tfor ( let i = 0; i < this.faces.length; i ++ ) {\n\n\t\t\tconst face = this.faces[ i ];\n\n\t\t\tconst hasMaterial = true;\n\t\t\tconst hasFaceUv = false; // deprecated\n\t\t\tconst hasFaceVertexUv = this.faceVertexUvs[ 0 ][ i ] !== undefined;\n\t\t\tconst hasFaceNormal = face.normal.length() > 0;\n\t\t\tconst hasFaceVertexNormal = face.vertexNormals.length > 0;\n\t\t\tconst hasFaceColor = face.color.r !== 1 || face.color.g !== 1 || face.color.b !== 1;\n\t\t\tconst hasFaceVertexColor = face.vertexColors.length > 0;\n\n\t\t\tlet faceType = 0;\n\n\t\t\tfaceType = setBit( faceType, 0, 0 ); // isQuad\n\t\t\tfaceType = setBit( faceType, 1, hasMaterial );\n\t\t\tfaceType = setBit( faceType, 2, hasFaceUv );\n\t\t\tfaceType = setBit( faceType, 3, hasFaceVertexUv );\n\t\t\tfaceType = setBit( faceType, 4, hasFaceNormal );\n\t\t\tfaceType = setBit( faceType, 5, hasFaceVertexNormal );\n\t\t\tfaceType = setBit( faceType, 6, hasFaceColor );\n\t\t\tfaceType = setBit( faceType, 7, hasFaceVertexColor );\n\n\t\t\tfaces.push( faceType );\n\t\t\tfaces.push( face.a, face.b, face.c );\n\t\t\tfaces.push( face.materialIndex );\n\n\t\t\tif ( hasFaceVertexUv ) {\n\n\t\t\t\tconst faceVertexUvs = this.faceVertexUvs[ 0 ][ i ];\n\n\t\t\t\tfaces.push(\n\t\t\t\t\tgetUvIndex( faceVertexUvs[ 0 ] ),\n\t\t\t\t\tgetUvIndex( faceVertexUvs[ 1 ] ),\n\t\t\t\t\tgetUvIndex( faceVertexUvs[ 2 ] )\n\t\t\t\t);\n\n\t\t\t}\n\n\t\t\tif ( hasFaceNormal ) {\n\n\t\t\t\tfaces.push( getNormalIndex( face.normal ) );\n\n\t\t\t}\n\n\t\t\tif ( hasFaceVertexNormal ) {\n\n\t\t\t\tconst vertexNormals = face.vertexNormals;\n\n\t\t\t\tfaces.push(\n\t\t\t\t\tgetNormalIndex( vertexNormals[ 0 ] ),\n\t\t\t\t\tgetNormalIndex( vertexNormals[ 1 ] ),\n\t\t\t\t\tgetNormalIndex( vertexNormals[ 2 ] )\n\t\t\t\t);\n\n\t\t\t}\n\n\t\t\tif ( hasFaceColor ) {\n\n\t\t\t\tfaces.push( getColorIndex( face.color ) );\n\n\t\t\t}\n\n\t\t\tif ( hasFaceVertexColor ) {\n\n\t\t\t\tconst vertexColors = face.vertexColors;\n\n\t\t\t\tfaces.push(\n\t\t\t\t\tgetColorIndex( vertexColors[ 0 ] ),\n\t\t\t\t\tgetColorIndex( vertexColors[ 1 ] ),\n\t\t\t\t\tgetColorIndex( vertexColors[ 2 ] )\n\t\t\t\t);\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction setBit( value, position, enabled ) {\n\n\t\t\treturn enabled ? value | ( 1 << position ) : value & ( ~ ( 1 << position ) );\n\n\t\t}\n\n\t\tfunction getNormalIndex( normal ) {\n\n\t\t\tconst hash = normal.x.toString() + normal.y.toString() + normal.z.toString();\n\n\t\t\tif ( normalsHash[ hash ] !== undefined ) {\n\n\t\t\t\treturn normalsHash[ hash ];\n\n\t\t\t}\n\n\t\t\tnormalsHash[ hash ] = normals.length / 3;\n\t\t\tnormals.push( normal.x, normal.y, normal.z );\n\n\t\t\treturn normalsHash[ hash ];\n\n\t\t}\n\n\t\tfunction getColorIndex( color ) {\n\n\t\t\tconst hash = color.r.toString() + color.g.toString() + color.b.toString();\n\n\t\t\tif ( colorsHash[ hash ] !== undefined ) {\n\n\t\t\t\treturn colorsHash[ hash ];\n\n\t\t\t}\n\n\t\t\tcolorsHash[ hash ] = colors.length;\n\t\t\tcolors.push( color.getHex() );\n\n\t\t\treturn colorsHash[ hash ];\n\n\t\t}\n\n\t\tfunction getUvIndex( uv ) {\n\n\t\t\tconst hash = uv.x.toString() + uv.y.toString();\n\n\t\t\tif ( uvsHash[ hash ] !== undefined ) {\n\n\t\t\t\treturn uvsHash[ hash ];\n\n\t\t\t}\n\n\t\t\tuvsHash[ hash ] = uvs.length / 2;\n\t\t\tuvs.push( uv.x, uv.y );\n\n\t\t\treturn uvsHash[ hash ];\n\n\t\t}\n\n\t\tdata.data = {};\n\n\t\tdata.data.vertices = vertices;\n\t\tdata.data.normals = normals;\n\t\tif ( colors.length > 0 ) data.data.colors = colors;\n\t\tif ( uvs.length > 0 ) data.data.uvs = [ uvs ]; // temporal backward compatibility\n\t\tdata.data.faces = faces;\n\n\t\treturn data;\n\n\t}\n\n\tclone() {\n\n\t\t/*\n\t\t // Handle primitives\n\n\t\t const parameters = this.parameters;\n\n\t\t if ( parameters !== undefined ) {\n\n\t\t const values = [];\n\n\t\t for ( const key in parameters ) {\n\n\t\t values.push( parameters[ key ] );\n\n\t\t }\n\n\t\t const geometry = Object.create( this.constructor.prototype );\n\t\t this.constructor.apply( geometry, values );\n\t\t return geometry;\n\n\t\t }\n\n\t\t return new this.constructor().copy( this );\n\t\t */\n\n\t\treturn new Geometry().copy( this );\n\n\t}\n\n\tcopy( source ) {\n\n\t\t// reset\n\n\t\tthis.vertices = [];\n\t\tthis.colors = [];\n\t\tthis.faces = [];\n\t\tthis.faceVertexUvs = [[]];\n\t\tthis.morphTargets = [];\n\t\tthis.morphNormals = [];\n\t\tthis.skinWeights = [];\n\t\tthis.skinIndices = [];\n\t\tthis.lineDistances = [];\n\t\tthis.boundingBox = null;\n\t\tthis.boundingSphere = null;\n\n\t\t// name\n\n\t\tthis.name = source.name;\n\n\t\t// vertices\n\n\t\tconst vertices = source.vertices;\n\n\t\tfor ( let i = 0, il = vertices.length; i < il; i ++ ) {\n\n\t\t\tthis.vertices.push( vertices[ i ].clone() );\n\n\t\t}\n\n\t\t// colors\n\n\t\tconst colors = source.colors;\n\n\t\tfor ( let i = 0, il = colors.length; i < il; i ++ ) {\n\n\t\t\tthis.colors.push( colors[ i ].clone() );\n\n\t\t}\n\n\t\t// faces\n\n\t\tconst faces = source.faces;\n\n\t\tfor ( let i = 0, il = faces.length; i < il; i ++ ) {\n\n\t\t\tthis.faces.push( faces[ i ].clone() );\n\n\t\t}\n\n\t\t// face vertex uvs\n\n\t\tfor ( let i = 0, il = source.faceVertexUvs.length; i < il; i ++ ) {\n\n\t\t\tconst faceVertexUvs = source.faceVertexUvs[ i ];\n\n\t\t\tif ( this.faceVertexUvs[ i ] === undefined ) {\n\n\t\t\t\tthis.faceVertexUvs[ i ] = [];\n\n\t\t\t}\n\n\t\t\tfor ( let j = 0, jl = faceVertexUvs.length; j < jl; j ++ ) {\n\n\t\t\t\tconst uvs = faceVertexUvs[ j ], uvsCopy = [];\n\n\t\t\t\tfor ( let k = 0, kl = uvs.length; k < kl; k ++ ) {\n\n\t\t\t\t\tconst uv = uvs[ k ];\n\n\t\t\t\t\tuvsCopy.push( uv.clone() );\n\n\t\t\t\t}\n\n\t\t\t\tthis.faceVertexUvs[ i ].push( uvsCopy );\n\n\t\t\t}\n\n\t\t}\n\n\t\t// morph targets\n\n\t\tconst morphTargets = source.morphTargets;\n\n\t\tfor ( let i = 0, il = morphTargets.length; i < il; i ++ ) {\n\n\t\t\tconst morphTarget = {};\n\t\t\tmorphTarget.name = morphTargets[ i ].name;\n\n\t\t\t// vertices\n\n\t\t\tif ( morphTargets[ i ].vertices !== undefined ) {\n\n\t\t\t\tmorphTarget.vertices = [];\n\n\t\t\t\tfor ( let j = 0, jl = morphTargets[ i ].vertices.length; j < jl; j ++ ) {\n\n\t\t\t\t\tmorphTarget.vertices.push( morphTargets[ i ].vertices[ j ].clone() );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// normals\n\n\t\t\tif ( morphTargets[ i ].normals !== undefined ) {\n\n\t\t\t\tmorphTarget.normals = [];\n\n\t\t\t\tfor ( let j = 0, jl = morphTargets[ i ].normals.length; j < jl; j ++ ) {\n\n\t\t\t\t\tmorphTarget.normals.push( morphTargets[ i ].normals[ j ].clone() );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tthis.morphTargets.push( morphTarget );\n\n\t\t}\n\n\t\t// morph normals\n\n\t\tconst morphNormals = source.morphNormals;\n\n\t\tfor ( let i = 0, il = morphNormals.length; i < il; i ++ ) {\n\n\t\t\tconst morphNormal = {};\n\n\t\t\t// vertex normals\n\n\t\t\tif ( morphNormals[ i ].vertexNormals !== undefined ) {\n\n\t\t\t\tmorphNormal.vertexNormals = [];\n\n\t\t\t\tfor ( let j = 0, jl = morphNormals[ i ].vertexNormals.length; j < jl; j ++ ) {\n\n\t\t\t\t\tconst srcVertexNormal = morphNormals[ i ].vertexNormals[ j ];\n\t\t\t\t\tconst destVertexNormal = {};\n\n\t\t\t\t\tdestVertexNormal.a = srcVertexNormal.a.clone();\n\t\t\t\t\tdestVertexNormal.b = srcVertexNormal.b.clone();\n\t\t\t\t\tdestVertexNormal.c = srcVertexNormal.c.clone();\n\n\t\t\t\t\tmorphNormal.vertexNormals.push( destVertexNormal );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// face normals\n\n\t\t\tif ( morphNormals[ i ].faceNormals !== undefined ) {\n\n\t\t\t\tmorphNormal.faceNormals = [];\n\n\t\t\t\tfor ( let j = 0, jl = morphNormals[ i ].faceNormals.length; j < jl; j ++ ) {\n\n\t\t\t\t\tmorphNormal.faceNormals.push( morphNormals[ i ].faceNormals[ j ].clone() );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tthis.morphNormals.push( morphNormal );\n\n\t\t}\n\n\t\t// skin weights\n\n\t\tconst skinWeights = source.skinWeights;\n\n\t\tfor ( let i = 0, il = skinWeights.length; i < il; i ++ ) {\n\n\t\t\tthis.skinWeights.push( skinWeights[ i ].clone() );\n\n\t\t}\n\n\t\t// skin indices\n\n\t\tconst skinIndices = source.skinIndices;\n\n\t\tfor ( let i = 0, il = skinIndices.length; i < il; i ++ ) {\n\n\t\t\tthis.skinIndices.push( skinIndices[ i ].clone() );\n\n\t\t}\n\n\t\t// line distances\n\n\t\tconst lineDistances = source.lineDistances;\n\n\t\tfor ( let i = 0, il = lineDistances.length; i < il; i ++ ) {\n\n\t\t\tthis.lineDistances.push( lineDistances[ i ] );\n\n\t\t}\n\n\t\t// bounding box\n\n\t\tconst boundingBox = source.boundingBox;\n\n\t\tif ( boundingBox !== null ) {\n\n\t\t\tthis.boundingBox = boundingBox.clone();\n\n\t\t}\n\n\t\t// bounding sphere\n\n\t\tconst boundingSphere = source.boundingSphere;\n\n\t\tif ( boundingSphere !== null ) {\n\n\t\t\tthis.boundingSphere = boundingSphere.clone();\n\n\t\t}\n\n\t\t// update flags\n\n\t\tthis.elementsNeedUpdate = source.elementsNeedUpdate;\n\t\tthis.verticesNeedUpdate = source.verticesNeedUpdate;\n\t\tthis.uvsNeedUpdate = source.uvsNeedUpdate;\n\t\tthis.normalsNeedUpdate = source.normalsNeedUpdate;\n\t\tthis.colorsNeedUpdate = source.colorsNeedUpdate;\n\t\tthis.lineDistancesNeedUpdate = source.lineDistancesNeedUpdate;\n\t\tthis.groupsNeedUpdate = source.groupsNeedUpdate;\n\n\t\treturn this;\n\n\t}\n\n\ttoBufferGeometry() {\n\n\t\tconst geometry = new DirectGeometry().fromGeometry( this );\n\n\t\tconst buffergeometry = new BufferGeometry();\n\n\t\tconst positions = new Float32Array( geometry.vertices.length * 3 );\n\t\tbuffergeometry.setAttribute( 'position', new BufferAttribute( positions, 3 ).copyVector3sArray( geometry.vertices ) );\n\n\t\tif ( geometry.normals.length > 0 ) {\n\n\t\t\tconst normals = new Float32Array( geometry.normals.length * 3 );\n\t\t\tbuffergeometry.setAttribute( 'normal', new BufferAttribute( normals, 3 ).copyVector3sArray( geometry.normals ) );\n\n\t\t}\n\n\t\tif ( geometry.colors.length > 0 ) {\n\n\t\t\tconst colors = new Float32Array( geometry.colors.length * 3 );\n\t\t\tbuffergeometry.setAttribute( 'color', new BufferAttribute( colors, 3 ).copyColorsArray( geometry.colors ) );\n\n\t\t}\n\n\t\tif ( geometry.uvs.length > 0 ) {\n\n\t\t\tconst uvs = new Float32Array( geometry.uvs.length * 2 );\n\t\t\tbuffergeometry.setAttribute( 'uv', new BufferAttribute( uvs, 2 ).copyVector2sArray( geometry.uvs ) );\n\n\t\t}\n\n\t\tif ( geometry.uvs2.length > 0 ) {\n\n\t\t\tconst uvs2 = new Float32Array( geometry.uvs2.length * 2 );\n\t\t\tbuffergeometry.setAttribute( 'uv2', new BufferAttribute( uvs2, 2 ).copyVector2sArray( geometry.uvs2 ) );\n\n\t\t}\n\n\t\t// groups\n\n\t\tbuffergeometry.groups = geometry.groups;\n\n\t\t// morphs\n\n\t\tfor ( const name in geometry.morphTargets ) {\n\n\t\t\tconst array = [];\n\t\t\tconst morphTargets = geometry.morphTargets[ name ];\n\n\t\t\tfor ( let i = 0, l = morphTargets.length; i < l; i ++ ) {\n\n\t\t\t\tconst morphTarget = morphTargets[ i ];\n\n\t\t\t\tconst attribute = new Float32BufferAttribute( morphTarget.data.length * 3, 3 );\n\t\t\t\tattribute.name = morphTarget.name;\n\n\t\t\t\tarray.push( attribute.copyVector3sArray( morphTarget.data ) );\n\n\t\t\t}\n\n\t\t\tbuffergeometry.morphAttributes[ name ] = array;\n\n\t\t}\n\n\t\t// skinning\n\n\t\tif ( geometry.skinIndices.length > 0 ) {\n\n\t\t\tconst skinIndices = new Float32BufferAttribute( geometry.skinIndices.length * 4, 4 );\n\t\t\tbuffergeometry.setAttribute( 'skinIndex', skinIndices.copyVector4sArray( geometry.skinIndices ) );\n\n\t\t}\n\n\t\tif ( geometry.skinWeights.length > 0 ) {\n\n\t\t\tconst skinWeights = new Float32BufferAttribute( geometry.skinWeights.length * 4, 4 );\n\t\t\tbuffergeometry.setAttribute( 'skinWeight', skinWeights.copyVector4sArray( geometry.skinWeights ) );\n\n\t\t}\n\n\t\t//\n\n\t\tif ( geometry.boundingSphere !== null ) {\n\n\t\t\tbuffergeometry.boundingSphere = geometry.boundingSphere.clone();\n\n\t\t}\n\n\t\tif ( geometry.boundingBox !== null ) {\n\n\t\t\tbuffergeometry.boundingBox = geometry.boundingBox.clone();\n\n\t\t}\n\n\t\treturn buffergeometry;\n\n\t}\n\n\tcomputeTangents() {\n\n\t\tconsole.error( 'THREE.Geometry: .computeTangents() has been removed.' );\n\n\t}\n\n\tcomputeLineDistances() {\n\n\t\tconsole.error( 'THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.' );\n\n\t}\n\n\tapplyMatrix( matrix ) {\n\n\t\tconsole.warn( 'THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4().' );\n\t\treturn this.applyMatrix4( matrix );\n\n\t}\n\n\tdispose() {\n\n\t\tthis.dispatchEvent( { type: 'dispose' } );\n\n\t}\n\n\tstatic createBufferGeometryFromObject( object ) {\n\n\t\tlet buffergeometry = new BufferGeometry();\n\n\t\tconst geometry = object.geometry;\n\n\t\tif ( object.isPoints || object.isLine ) {\n\n\t\t\tconst positions = new Float32BufferAttribute( geometry.vertices.length * 3, 3 );\n\t\t\tconst colors = new Float32BufferAttribute( geometry.colors.length * 3, 3 );\n\n\t\t\tbuffergeometry.setAttribute( 'position', positions.copyVector3sArray( geometry.vertices ) );\n\t\t\tbuffergeometry.setAttribute( 'color', colors.copyColorsArray( geometry.colors ) );\n\n\t\t\tif ( geometry.lineDistances && geometry.lineDistances.length === geometry.vertices.length ) {\n\n\t\t\t\tconst lineDistances = new Float32BufferAttribute( geometry.lineDistances.length, 1 );\n\n\t\t\t\tbuffergeometry.setAttribute( 'lineDistance', lineDistances.copyArray( geometry.lineDistances ) );\n\n\t\t\t}\n\n\t\t\tif ( geometry.boundingSphere !== null ) {\n\n\t\t\t\tbuffergeometry.boundingSphere = geometry.boundingSphere.clone();\n\n\t\t\t}\n\n\t\t\tif ( geometry.boundingBox !== null ) {\n\n\t\t\t\tbuffergeometry.boundingBox = geometry.boundingBox.clone();\n\n\t\t\t}\n\n\t\t} else if ( object.isMesh ) {\n\n\t\t\tbuffergeometry = geometry.toBufferGeometry();\n\n\t\t}\n\n\t\treturn buffergeometry;\n\n\t}\n\n}\n\nGeometry.prototype.isGeometry = true;\n\nclass DirectGeometry {\n\n\tconstructor() {\n\n\t\tthis.vertices = [];\n\t\tthis.normals = [];\n\t\tthis.colors = [];\n\t\tthis.uvs = [];\n\t\tthis.uvs2 = [];\n\n\t\tthis.groups = [];\n\n\t\tthis.morphTargets = {};\n\n\t\tthis.skinWeights = [];\n\t\tthis.skinIndices = [];\n\n\t\t// this.lineDistances = [];\n\n\t\tthis.boundingBox = null;\n\t\tthis.boundingSphere = null;\n\n\t\t// update flags\n\n\t\tthis.verticesNeedUpdate = false;\n\t\tthis.normalsNeedUpdate = false;\n\t\tthis.colorsNeedUpdate = false;\n\t\tthis.uvsNeedUpdate = false;\n\t\tthis.groupsNeedUpdate = false;\n\n\t}\n\n\tcomputeGroups( geometry ) {\n\n\t\tconst groups = [];\n\n\t\tlet group, i;\n\t\tlet materialIndex = undefined;\n\n\t\tconst faces = geometry.faces;\n\n\t\tfor ( i = 0; i < faces.length; i ++ ) {\n\n\t\t\tconst face = faces[ i ];\n\n\t\t\t// materials\n\n\t\t\tif ( face.materialIndex !== materialIndex ) {\n\n\t\t\t\tmaterialIndex = face.materialIndex;\n\n\t\t\t\tif ( group !== undefined ) {\n\n\t\t\t\t\tgroup.count = ( i * 3 ) - group.start;\n\t\t\t\t\tgroups.push( group );\n\n\t\t\t\t}\n\n\t\t\t\tgroup = {\n\t\t\t\t\tstart: i * 3,\n\t\t\t\t\tmaterialIndex: materialIndex\n\t\t\t\t};\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( group !== undefined ) {\n\n\t\t\tgroup.count = ( i * 3 ) - group.start;\n\t\t\tgroups.push( group );\n\n\t\t}\n\n\t\tthis.groups = groups;\n\n\t}\n\n\tfromGeometry( geometry ) {\n\n\t\tconst faces = geometry.faces;\n\t\tconst vertices = geometry.vertices;\n\t\tconst faceVertexUvs = geometry.faceVertexUvs;\n\n\t\tconst hasFaceVertexUv = faceVertexUvs[ 0 ] && faceVertexUvs[ 0 ].length > 0;\n\t\tconst hasFaceVertexUv2 = faceVertexUvs[ 1 ] && faceVertexUvs[ 1 ].length > 0;\n\n\t\t// morphs\n\n\t\tconst morphTargets = geometry.morphTargets;\n\t\tconst morphTargetsLength = morphTargets.length;\n\n\t\tlet morphTargetsPosition;\n\n\t\tif ( morphTargetsLength > 0 ) {\n\n\t\t\tmorphTargetsPosition = [];\n\n\t\t\tfor ( let i = 0; i < morphTargetsLength; i ++ ) {\n\n\t\t\t\tmorphTargetsPosition[ i ] = {\n\t\t\t\t\tname: morphTargets[ i ].name,\n\t\t\t\t \tdata: []\n\t\t\t\t};\n\n\t\t\t}\n\n\t\t\tthis.morphTargets.position = morphTargetsPosition;\n\n\t\t}\n\n\t\tconst morphNormals = geometry.morphNormals;\n\t\tconst morphNormalsLength = morphNormals.length;\n\n\t\tlet morphTargetsNormal;\n\n\t\tif ( morphNormalsLength > 0 ) {\n\n\t\t\tmorphTargetsNormal = [];\n\n\t\t\tfor ( let i = 0; i < morphNormalsLength; i ++ ) {\n\n\t\t\t\tmorphTargetsNormal[ i ] = {\n\t\t\t\t\tname: morphNormals[ i ].name,\n\t\t\t\t \tdata: []\n\t\t\t\t};\n\n\t\t\t}\n\n\t\t\tthis.morphTargets.normal = morphTargetsNormal;\n\n\t\t}\n\n\t\t// skins\n\n\t\tconst skinIndices = geometry.skinIndices;\n\t\tconst skinWeights = geometry.skinWeights;\n\n\t\tconst hasSkinIndices = skinIndices.length === vertices.length;\n\t\tconst hasSkinWeights = skinWeights.length === vertices.length;\n\n\t\t//\n\n\t\tif ( vertices.length > 0 && faces.length === 0 ) {\n\n\t\t\tconsole.error( 'THREE.DirectGeometry: Faceless geometries are not supported.' );\n\n\t\t}\n\n\t\tfor ( let i = 0; i < faces.length; i ++ ) {\n\n\t\t\tconst face = faces[ i ];\n\n\t\t\tthis.vertices.push( vertices[ face.a ], vertices[ face.b ], vertices[ face.c ] );\n\n\t\t\tconst vertexNormals = face.vertexNormals;\n\n\t\t\tif ( vertexNormals.length === 3 ) {\n\n\t\t\t\tthis.normals.push( vertexNormals[ 0 ], vertexNormals[ 1 ], vertexNormals[ 2 ] );\n\n\t\t\t} else {\n\n\t\t\t\tconst normal = face.normal;\n\n\t\t\t\tthis.normals.push( normal, normal, normal );\n\n\t\t\t}\n\n\t\t\tconst vertexColors = face.vertexColors;\n\n\t\t\tif ( vertexColors.length === 3 ) {\n\n\t\t\t\tthis.colors.push( vertexColors[ 0 ], vertexColors[ 1 ], vertexColors[ 2 ] );\n\n\t\t\t} else {\n\n\t\t\t\tconst color = face.color;\n\n\t\t\t\tthis.colors.push( color, color, color );\n\n\t\t\t}\n\n\t\t\tif ( hasFaceVertexUv === true ) {\n\n\t\t\t\tconst vertexUvs = faceVertexUvs[ 0 ][ i ];\n\n\t\t\t\tif ( vertexUvs !== undefined ) {\n\n\t\t\t\t\tthis.uvs.push( vertexUvs[ 0 ], vertexUvs[ 1 ], vertexUvs[ 2 ] );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ', i );\n\n\t\t\t\t\tthis.uvs.push( new Vector2(), new Vector2(), new Vector2() );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( hasFaceVertexUv2 === true ) {\n\n\t\t\t\tconst vertexUvs = faceVertexUvs[ 1 ][ i ];\n\n\t\t\t\tif ( vertexUvs !== undefined ) {\n\n\t\t\t\t\tthis.uvs2.push( vertexUvs[ 0 ], vertexUvs[ 1 ], vertexUvs[ 2 ] );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ', i );\n\n\t\t\t\t\tthis.uvs2.push( new Vector2(), new Vector2(), new Vector2() );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// morphs\n\n\t\t\tfor ( let j = 0; j < morphTargetsLength; j ++ ) {\n\n\t\t\t\tconst morphTarget = morphTargets[ j ].vertices;\n\n\t\t\t\tmorphTargetsPosition[ j ].data.push( morphTarget[ face.a ], morphTarget[ face.b ], morphTarget[ face.c ] );\n\n\t\t\t}\n\n\t\t\tfor ( let j = 0; j < morphNormalsLength; j ++ ) {\n\n\t\t\t\tconst morphNormal = morphNormals[ j ].vertexNormals[ i ];\n\n\t\t\t\tmorphTargetsNormal[ j ].data.push( morphNormal.a, morphNormal.b, morphNormal.c );\n\n\t\t\t}\n\n\t\t\t// skins\n\n\t\t\tif ( hasSkinIndices ) {\n\n\t\t\t\tthis.skinIndices.push( skinIndices[ face.a ], skinIndices[ face.b ], skinIndices[ face.c ] );\n\n\t\t\t}\n\n\t\t\tif ( hasSkinWeights ) {\n\n\t\t\t\tthis.skinWeights.push( skinWeights[ face.a ], skinWeights[ face.b ], skinWeights[ face.c ] );\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.computeGroups( geometry );\n\n\t\tthis.verticesNeedUpdate = geometry.verticesNeedUpdate;\n\t\tthis.normalsNeedUpdate = geometry.normalsNeedUpdate;\n\t\tthis.colorsNeedUpdate = geometry.colorsNeedUpdate;\n\t\tthis.uvsNeedUpdate = geometry.uvsNeedUpdate;\n\t\tthis.groupsNeedUpdate = geometry.groupsNeedUpdate;\n\n\t\tif ( geometry.boundingSphere !== null ) {\n\n\t\t\tthis.boundingSphere = geometry.boundingSphere.clone();\n\n\t\t}\n\n\t\tif ( geometry.boundingBox !== null ) {\n\n\t\t\tthis.boundingBox = geometry.boundingBox.clone();\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n}\n\nclass Face3 {\n\n\tconstructor( a, b, c, normal, color, materialIndex = 0 ) {\n\n\t\tthis.a = a;\n\t\tthis.b = b;\n\t\tthis.c = c;\n\n\t\tthis.normal = ( normal && normal.isVector3 ) ? normal : new Vector3();\n\t\tthis.vertexNormals = Array.isArray( normal ) ? normal : [];\n\n\t\tthis.color = ( color && color.isColor ) ? color : new Color();\n\t\tthis.vertexColors = Array.isArray( color ) ? color : [];\n\n\t\tthis.materialIndex = materialIndex;\n\n\t}\n\n\tclone() {\n\n\t\treturn new this.constructor().copy( this );\n\n\t}\n\n\tcopy( source ) {\n\n\t\tthis.a = source.a;\n\t\tthis.b = source.b;\n\t\tthis.c = source.c;\n\n\t\tthis.normal.copy( source.normal );\n\t\tthis.color.copy( source.color );\n\n\t\tthis.materialIndex = source.materialIndex;\n\n\t\tfor ( let i = 0, il = source.vertexNormals.length; i < il; i ++ ) {\n\n\t\t\tthis.vertexNormals[ i ] = source.vertexNormals[ i ].clone();\n\n\t\t}\n\n\t\tfor ( let i = 0, il = source.vertexColors.length; i < il; i ++ ) {\n\n\t\t\tthis.vertexColors[ i ] = source.vertexColors[ i ].clone();\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n}\n\nexport { Face3, Geometry };\n","// copied from https://github.com/mrdoob/three.js/blob/670b1e9e85356d98efa4c702e93c85dd52f01e1e/src/core/DirectGeometry.js\r\nimport { Vector2 } from 'three';\r\nexport class DirectGeometry {\r\n    constructor() {\r\n        this.vertices = [];\r\n        this.normals = [];\r\n        this.colors = [];\r\n        this.uvs = [];\r\n        this.uvs2 = [];\r\n        this.groups = [];\r\n        this.morphTargets = {};\r\n        this.skinWeights = [];\r\n        this.skinIndices = [];\r\n        // lineDistances = [];\r\n        this.boundingBox = null;\r\n        this.boundingSphere = null;\r\n        // update flags\r\n        this.verticesNeedUpdate = false;\r\n        this.normalsNeedUpdate = false;\r\n        this.colorsNeedUpdate = false;\r\n        this.uvsNeedUpdate = false;\r\n        this.groupsNeedUpdate = false;\r\n    }\r\n    computeGroups(geometry) {\r\n        const groups = [];\r\n        let group, i;\r\n        let materialIndex = undefined;\r\n        const faces = geometry.faces;\r\n        for (i = 0; i < faces.length; i++) {\r\n            const face = faces[i];\r\n            // materials\r\n            if (face.materialIndex !== materialIndex) {\r\n                materialIndex = face.materialIndex;\r\n                if (group !== undefined) {\r\n                    group.count = i * 3 - group.start;\r\n                    groups.push(group);\r\n                }\r\n                group = {\r\n                    start: i * 3,\r\n                    materialIndex: materialIndex\r\n                };\r\n            }\r\n        }\r\n        if (group !== undefined) {\r\n            group.count = i * 3 - group.start;\r\n            groups.push(group);\r\n        }\r\n        this.groups = groups;\r\n    }\r\n    fromGeometry(geometry) {\r\n        const faces = geometry.faces;\r\n        const vertices = geometry.vertices;\r\n        const faceVertexUvs = geometry.faceVertexUvs;\r\n        const hasFaceVertexUv = faceVertexUvs[0] && faceVertexUvs[0].length > 0;\r\n        const hasFaceVertexUv2 = faceVertexUvs[1] && faceVertexUvs[1].length > 0;\r\n        // morphs\r\n        const morphTargets = geometry.morphTargets;\r\n        const morphTargetsLength = morphTargets.length;\r\n        let morphTargetsPosition;\r\n        if (morphTargetsLength > 0) {\r\n            morphTargetsPosition = [];\r\n            for (let i = 0; i < morphTargetsLength; i++) {\r\n                morphTargetsPosition[i] = {\r\n                    name: morphTargets[i].name,\r\n                    data: []\r\n                };\r\n            }\r\n            this.morphTargets.position = morphTargetsPosition;\r\n        }\r\n        const morphNormals = geometry.morphNormals;\r\n        const morphNormalsLength = morphNormals.length;\r\n        let morphTargetsNormal;\r\n        if (morphNormalsLength > 0) {\r\n            morphTargetsNormal = [];\r\n            for (let i = 0; i < morphNormalsLength; i++) {\r\n                morphTargetsNormal[i] = {\r\n                    name: morphNormals[i].name,\r\n                    data: []\r\n                };\r\n            }\r\n            this.morphTargets.normal = morphTargetsNormal;\r\n        }\r\n        // skins\r\n        const skinIndices = geometry.skinIndices;\r\n        const skinWeights = geometry.skinWeights;\r\n        const hasSkinIndices = skinIndices.length === vertices.length;\r\n        const hasSkinWeights = skinWeights.length === vertices.length;\r\n        //\r\n        if (vertices.length > 0 && faces.length === 0) {\r\n            console.error('THREE.DirectGeometry: Faceless geometries are not supported.');\r\n        }\r\n        for (let i = 0; i < faces.length; i++) {\r\n            const face = faces[i];\r\n            this.vertices.push(vertices[face.a], vertices[face.b], vertices[face.c]);\r\n            const vertexNormals = face.vertexNormals;\r\n            if (vertexNormals.length === 3) {\r\n                this.normals.push(vertexNormals[0], vertexNormals[1], vertexNormals[2]);\r\n            }\r\n            else {\r\n                const normal = face.normal;\r\n                this.normals.push(normal, normal, normal);\r\n            }\r\n            const vertexColors = face.vertexColors;\r\n            if (vertexColors.length === 3) {\r\n                this.colors.push(vertexColors[0], vertexColors[1], vertexColors[2]);\r\n            }\r\n            else {\r\n                const color = face.color;\r\n                this.colors.push(color, color, color);\r\n            }\r\n            if (hasFaceVertexUv === true) {\r\n                const vertexUvs = faceVertexUvs[0][i];\r\n                if (vertexUvs !== undefined) {\r\n                    this.uvs.push(vertexUvs[0], vertexUvs[1], vertexUvs[2]);\r\n                }\r\n                else {\r\n                    console.warn('THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ', i);\r\n                    this.uvs.push(new Vector2(), new Vector2(), new Vector2());\r\n                }\r\n            }\r\n            if (hasFaceVertexUv2 === true) {\r\n                const vertexUvs = faceVertexUvs[1][i];\r\n                if (vertexUvs !== undefined) {\r\n                    this.uvs2.push(vertexUvs[0], vertexUvs[1], vertexUvs[2]);\r\n                }\r\n                else {\r\n                    console.warn('THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ', i);\r\n                    this.uvs2.push(new Vector2(), new Vector2(), new Vector2());\r\n                }\r\n            }\r\n            // morphs\r\n            for (let j = 0; j < morphTargetsLength; j++) {\r\n                const morphTarget = morphTargets[j].vertices;\r\n                morphTargetsPosition[j].data.push(morphTarget[face.a], morphTarget[face.b], morphTarget[face.c]);\r\n            }\r\n            for (let j = 0; j < morphNormalsLength; j++) {\r\n                const morphNormal = morphNormals[j].vertexNormals[i];\r\n                morphTargetsNormal[j].data.push(morphNormal.a, morphNormal.b, morphNormal.c);\r\n            }\r\n            // skins\r\n            if (hasSkinIndices) {\r\n                // @ts-expect-error\r\n                this.skinIndices.push(skinIndices[face.a], skinIndices[face.b], skinIndices[face.c]);\r\n            }\r\n            if (hasSkinWeights) {\r\n                // @ts-expect-error\r\n                this.skinWeights.push(skinWeights[face.a], skinWeights[face.b], skinWeights[face.c]);\r\n            }\r\n        }\r\n        this.computeGroups(geometry);\r\n        this.verticesNeedUpdate = geometry.verticesNeedUpdate;\r\n        this.normalsNeedUpdate = geometry.normalsNeedUpdate;\r\n        this.colorsNeedUpdate = geometry.colorsNeedUpdate;\r\n        this.uvsNeedUpdate = geometry.uvsNeedUpdate;\r\n        this.groupsNeedUpdate = geometry.groupsNeedUpdate;\r\n        if (geometry.boundingSphere !== null) {\r\n            this.boundingSphere = geometry.boundingSphere.clone();\r\n        }\r\n        if (geometry.boundingBox !== null) {\r\n            this.boundingBox = geometry.boundingBox.clone();\r\n        }\r\n        return this;\r\n    }\r\n}\r\n//# sourceMappingURL=_directGeometry.js.map","// copied from https://github.com/mrdoob/three.js/blob/670b1e9e85356d98efa4c702e93c85dd52f01e1e/src/core/BufferGeometry.js\r\nimport { BufferAttribute, Float32BufferAttribute } from 'three';\r\nimport { DirectGeometry } from './_directGeometry';\r\nexport const fromGeometry = (buffer, geometry) => {\r\n    const directGeometry = new DirectGeometry().fromGeometry(geometry);\r\n    return fromDirectGeometry(buffer, directGeometry);\r\n};\r\nconst fromDirectGeometry = (buffer, geometry) => {\r\n    var _a, _b;\r\n    const positions = new Float32Array(geometry.vertices.length * 3);\r\n    buffer.setAttribute('position', new BufferAttribute(positions, 3).copyVector3sArray(geometry.vertices));\r\n    if (geometry.normals.length > 0) {\r\n        const normals = new Float32Array(geometry.normals.length * 3);\r\n        buffer.setAttribute('normal', new BufferAttribute(normals, 3).copyVector3sArray(geometry.normals));\r\n    }\r\n    if (geometry.colors.length > 0) {\r\n        const colors = new Float32Array(geometry.colors.length * 3);\r\n        buffer.setAttribute('color', new BufferAttribute(colors, 3).copyColorsArray(geometry.colors));\r\n    }\r\n    if (geometry.uvs.length > 0) {\r\n        const uvs = new Float32Array(geometry.uvs.length * 2);\r\n        buffer.setAttribute('uv', new BufferAttribute(uvs, 2).copyVector2sArray(geometry.uvs));\r\n    }\r\n    if (geometry.uvs2.length > 0) {\r\n        const uvs2 = new Float32Array(geometry.uvs2.length * 2);\r\n        buffer.setAttribute('uv2', new BufferAttribute(uvs2, 2).copyVector2sArray(geometry.uvs2));\r\n    }\r\n    // groups\r\n    buffer.groups = geometry.groups;\r\n    // morphs\r\n    for (const name in geometry.morphTargets) {\r\n        const array = [];\r\n        const morphTargets = geometry.morphTargets[name];\r\n        for (let i = 0, l = morphTargets.length; i < l; i++) {\r\n            const morphTarget = morphTargets[i];\r\n            const attribute = new Float32BufferAttribute(morphTarget.data.length * 3, 3);\r\n            attribute.name = morphTarget.name;\r\n            array.push(attribute.copyVector3sArray(morphTarget.data));\r\n        }\r\n        buffer.morphAttributes[name] = array;\r\n    }\r\n    // skinning\r\n    if (geometry.skinIndices.length > 0) {\r\n        const skinIndices = new Float32BufferAttribute(geometry.skinIndices.length * 4, 4);\r\n        buffer.setAttribute('skinIndex', skinIndices.copyVector4sArray(geometry.skinIndices));\r\n    }\r\n    if (geometry.skinWeights.length > 0) {\r\n        const skinWeights = new Float32BufferAttribute(geometry.skinWeights.length * 4, 4);\r\n        buffer.setAttribute('skinWeight', skinWeights.copyVector4sArray(geometry.skinWeights));\r\n    }\r\n    //\r\n    if (geometry.boundingSphere !== null) {\r\n        // @ts-expect-error\r\n        buffer.boundingSphere = (_a = geometry.boundingSphere) === null || _a === void 0 ? void 0 : _a.clone();\r\n    }\r\n    if (geometry.boundingBox !== null) {\r\n        // @ts-expect-error\r\n        buffer.boundingBox = (_b = geometry.boundingBox) === null || _b === void 0 ? void 0 : _b.clone();\r\n    }\r\n    return buffer;\r\n};\r\n//# sourceMappingURL=_fromGeometry.js.map","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\n// TODO(yandeu) Make heightmap work with Buffer Geometries.\r\nimport { BufferGeometry, Color, DoubleSide, MeshPhongMaterial, PlaneBufferGeometry } from 'three';\r\nimport { ExtendedMesh } from '@enable3d/common/dist/extendedMesh';\r\nimport { Geometry } from 'three/examples/jsm/deprecated/Geometry';\r\nimport { fromGeometry } from '../csg/_fromGeometry';\r\nexport default class HeightMap {\r\n    constructor(scene) {\r\n        this.scene = scene;\r\n    }\r\n    add(texture, config = {}) {\r\n        const heightMap = this.make(texture, config);\r\n        if (heightMap)\r\n            this.scene.add(heightMap);\r\n        else\r\n            console.warn('Could not make heightmap');\r\n        return heightMap;\r\n    }\r\n    make(texture, config = {}) {\r\n        const { image } = texture;\r\n        const { width, height } = image;\r\n        const { colorScale } = config;\r\n        const canvas = document.createElement('canvas');\r\n        canvas.width = width;\r\n        canvas.height = height;\r\n        const ctx = canvas.getContext('2d');\r\n        if (!ctx)\r\n            return;\r\n        ctx.drawImage(texture.image, 0, 0);\r\n        const pixel = ctx.getImageData(0, 0, width, height);\r\n        // geometry (convert buffer geometry to deprecated geometry)\r\n        const plane = new Geometry().fromBufferGeometry(new PlaneBufferGeometry(10, 10, width - 1, height - 1));\r\n        // material\r\n        let materialConfig = { color: 0xcccccc, side: DoubleSide };\r\n        if (colorScale)\r\n            materialConfig = Object.assign(Object.assign({}, materialConfig), { vertexColors: true });\r\n        const material = new MeshPhongMaterial(materialConfig);\r\n        // mesh\r\n        const mesh = new ExtendedMesh(plane, material);\r\n        mesh.receiveShadow = mesh.castShadow = true;\r\n        mesh.shape = 'concave';\r\n        // adjust all z values\r\n        const geo = mesh.geometry;\r\n        for (let i = 0; i < geo.vertices.length; i++) {\r\n            geo.vertices[i].z = pixel.data[i * 4] / 120;\r\n        }\r\n        // helper function to get the highest point\r\n        const getHighPoint = (geometry, face) => {\r\n            var v1 = geometry.vertices[face.a].z;\r\n            var v2 = geometry.vertices[face.b].z;\r\n            var v3 = geometry.vertices[face.c].z;\r\n            return Math.max(v1, v2, v3);\r\n        };\r\n        // apply color scale if available\r\n        if (colorScale)\r\n            geo.faces.forEach(face => (face.color = new Color(colorScale(getHighPoint(geo, face)).hex())));\r\n        mesh.rotateX(-Math.PI / 2);\r\n        mesh.updateMatrix();\r\n        plane.computeFaceNormals();\r\n        plane.computeVertexNormals();\r\n        mesh.name = 'heightmap';\r\n        // back to buffer geometry\r\n        mesh.geometry = fromGeometry(new BufferGeometry(), mesh.geometry);\r\n        return mesh;\r\n    }\r\n}\r\n//# sourceMappingURL=heightmap.js.map","import {\n\tEventDispatcher,\n\tMOUSE,\n\tQuaternion,\n\tSpherical,\n\tTOUCH,\n\tVector2,\n\tVector3\n} from 'three';\n\n// This set of controls performs orbiting, dollying (zooming), and panning.\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\n//\n//    Orbit - left mouse / touch: one-finger move\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\n//    Pan - right mouse, or left mouse + ctrl/meta/shiftKey, or arrow keys / touch: two-finger move\n\nconst _changeEvent = { type: 'change' };\nconst _startEvent = { type: 'start' };\nconst _endEvent = { type: 'end' };\n\nclass OrbitControls extends EventDispatcher {\n\n\tconstructor( object, domElement ) {\n\n\t\tsuper();\n\n\t\tif ( domElement === undefined ) console.warn( 'THREE.OrbitControls: The second parameter \"domElement\" is now mandatory.' );\n\t\tif ( domElement === document ) console.error( 'THREE.OrbitControls: \"document\" should not be used as the target \"domElement\". Please use \"renderer.domElement\" instead.' );\n\n\t\tthis.object = object;\n\t\tthis.domElement = domElement;\n\t\tthis.domElement.style.touchAction = 'none'; // disable touch scroll\n\n\t\t// Set to false to disable this control\n\t\tthis.enabled = true;\n\n\t\t// \"target\" sets the location of focus, where the object orbits around\n\t\tthis.target = new Vector3();\n\n\t\t// How far you can dolly in and out ( PerspectiveCamera only )\n\t\tthis.minDistance = 0;\n\t\tthis.maxDistance = Infinity;\n\n\t\t// How far you can zoom in and out ( OrthographicCamera only )\n\t\tthis.minZoom = 0;\n\t\tthis.maxZoom = Infinity;\n\n\t\t// How far you can orbit vertically, upper and lower limits.\n\t\t// Range is 0 to Math.PI radians.\n\t\tthis.minPolarAngle = 0; // radians\n\t\tthis.maxPolarAngle = Math.PI; // radians\n\n\t\t// How far you can orbit horizontally, upper and lower limits.\n\t\t// If set, the interval [ min, max ] must be a sub-interval of [ - 2 PI, 2 PI ], with ( max - min < 2 PI )\n\t\tthis.minAzimuthAngle = - Infinity; // radians\n\t\tthis.maxAzimuthAngle = Infinity; // radians\n\n\t\t// Set to true to enable damping (inertia)\n\t\t// If damping is enabled, you must call controls.update() in your animation loop\n\t\tthis.enableDamping = false;\n\t\tthis.dampingFactor = 0.05;\n\n\t\t// This option actually enables dollying in and out; left as \"zoom\" for backwards compatibility.\n\t\t// Set to false to disable zooming\n\t\tthis.enableZoom = true;\n\t\tthis.zoomSpeed = 1.0;\n\n\t\t// Set to false to disable rotating\n\t\tthis.enableRotate = true;\n\t\tthis.rotateSpeed = 1.0;\n\n\t\t// Set to false to disable panning\n\t\tthis.enablePan = true;\n\t\tthis.panSpeed = 1.0;\n\t\tthis.screenSpacePanning = true; // if false, pan orthogonal to world-space direction camera.up\n\t\tthis.keyPanSpeed = 7.0;\t// pixels moved per arrow key push\n\n\t\t// Set to true to automatically rotate around the target\n\t\t// If auto-rotate is enabled, you must call controls.update() in your animation loop\n\t\tthis.autoRotate = false;\n\t\tthis.autoRotateSpeed = 2.0; // 30 seconds per orbit when fps is 60\n\n\t\t// The four arrow keys\n\t\tthis.keys = { LEFT: 'ArrowLeft', UP: 'ArrowUp', RIGHT: 'ArrowRight', BOTTOM: 'ArrowDown' };\n\n\t\t// Mouse buttons\n\t\tthis.mouseButtons = { LEFT: MOUSE.ROTATE, MIDDLE: MOUSE.DOLLY, RIGHT: MOUSE.PAN };\n\n\t\t// Touch fingers\n\t\tthis.touches = { ONE: TOUCH.ROTATE, TWO: TOUCH.DOLLY_PAN };\n\n\t\t// for reset\n\t\tthis.target0 = this.target.clone();\n\t\tthis.position0 = this.object.position.clone();\n\t\tthis.zoom0 = this.object.zoom;\n\n\t\t// the target DOM element for key events\n\t\tthis._domElementKeyEvents = null;\n\n\t\t//\n\t\t// public methods\n\t\t//\n\n\t\tthis.getPolarAngle = function () {\n\n\t\t\treturn spherical.phi;\n\n\t\t};\n\n\t\tthis.getAzimuthalAngle = function () {\n\n\t\t\treturn spherical.theta;\n\n\t\t};\n\n\t\tthis.listenToKeyEvents = function ( domElement ) {\n\n\t\t\tdomElement.addEventListener( 'keydown', onKeyDown );\n\t\t\tthis._domElementKeyEvents = domElement;\n\n\t\t};\n\n\t\tthis.saveState = function () {\n\n\t\t\tscope.target0.copy( scope.target );\n\t\t\tscope.position0.copy( scope.object.position );\n\t\t\tscope.zoom0 = scope.object.zoom;\n\n\t\t};\n\n\t\tthis.reset = function () {\n\n\t\t\tscope.target.copy( scope.target0 );\n\t\t\tscope.object.position.copy( scope.position0 );\n\t\t\tscope.object.zoom = scope.zoom0;\n\n\t\t\tscope.object.updateProjectionMatrix();\n\t\t\tscope.dispatchEvent( _changeEvent );\n\n\t\t\tscope.update();\n\n\t\t\tstate = STATE.NONE;\n\n\t\t};\n\n\t\t// this method is exposed, but perhaps it would be better if we can make it private...\n\t\tthis.update = function () {\n\n\t\t\tconst offset = new Vector3();\n\n\t\t\t// so camera.up is the orbit axis\n\t\t\tconst quat = new Quaternion().setFromUnitVectors( object.up, new Vector3( 0, 1, 0 ) );\n\t\t\tconst quatInverse = quat.clone().invert();\n\n\t\t\tconst lastPosition = new Vector3();\n\t\t\tconst lastQuaternion = new Quaternion();\n\n\t\t\tconst twoPI = 2 * Math.PI;\n\n\t\t\treturn function update() {\n\n\t\t\t\tconst position = scope.object.position;\n\n\t\t\t\toffset.copy( position ).sub( scope.target );\n\n\t\t\t\t// rotate offset to \"y-axis-is-up\" space\n\t\t\t\toffset.applyQuaternion( quat );\n\n\t\t\t\t// angle from z-axis around y-axis\n\t\t\t\tspherical.setFromVector3( offset );\n\n\t\t\t\tif ( scope.autoRotate && state === STATE.NONE ) {\n\n\t\t\t\t\trotateLeft( getAutoRotationAngle() );\n\n\t\t\t\t}\n\n\t\t\t\tif ( scope.enableDamping ) {\n\n\t\t\t\t\tspherical.theta += sphericalDelta.theta * scope.dampingFactor;\n\t\t\t\t\tspherical.phi += sphericalDelta.phi * scope.dampingFactor;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tspherical.theta += sphericalDelta.theta;\n\t\t\t\t\tspherical.phi += sphericalDelta.phi;\n\n\t\t\t\t}\n\n\t\t\t\t// restrict theta to be between desired limits\n\n\t\t\t\tlet min = scope.minAzimuthAngle;\n\t\t\t\tlet max = scope.maxAzimuthAngle;\n\n\t\t\t\tif ( isFinite( min ) && isFinite( max ) ) {\n\n\t\t\t\t\tif ( min < - Math.PI ) min += twoPI; else if ( min > Math.PI ) min -= twoPI;\n\n\t\t\t\t\tif ( max < - Math.PI ) max += twoPI; else if ( max > Math.PI ) max -= twoPI;\n\n\t\t\t\t\tif ( min <= max ) {\n\n\t\t\t\t\t\tspherical.theta = Math.max( min, Math.min( max, spherical.theta ) );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tspherical.theta = ( spherical.theta > ( min + max ) / 2 ) ?\n\t\t\t\t\t\t\tMath.max( min, spherical.theta ) :\n\t\t\t\t\t\t\tMath.min( max, spherical.theta );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// restrict phi to be between desired limits\n\t\t\t\tspherical.phi = Math.max( scope.minPolarAngle, Math.min( scope.maxPolarAngle, spherical.phi ) );\n\n\t\t\t\tspherical.makeSafe();\n\n\n\t\t\t\tspherical.radius *= scale;\n\n\t\t\t\t// restrict radius to be between desired limits\n\t\t\t\tspherical.radius = Math.max( scope.minDistance, Math.min( scope.maxDistance, spherical.radius ) );\n\n\t\t\t\t// move target to panned location\n\n\t\t\t\tif ( scope.enableDamping === true ) {\n\n\t\t\t\t\tscope.target.addScaledVector( panOffset, scope.dampingFactor );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tscope.target.add( panOffset );\n\n\t\t\t\t}\n\n\t\t\t\toffset.setFromSpherical( spherical );\n\n\t\t\t\t// rotate offset back to \"camera-up-vector-is-up\" space\n\t\t\t\toffset.applyQuaternion( quatInverse );\n\n\t\t\t\tposition.copy( scope.target ).add( offset );\n\n\t\t\t\tscope.object.lookAt( scope.target );\n\n\t\t\t\tif ( scope.enableDamping === true ) {\n\n\t\t\t\t\tsphericalDelta.theta *= ( 1 - scope.dampingFactor );\n\t\t\t\t\tsphericalDelta.phi *= ( 1 - scope.dampingFactor );\n\n\t\t\t\t\tpanOffset.multiplyScalar( 1 - scope.dampingFactor );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tsphericalDelta.set( 0, 0, 0 );\n\n\t\t\t\t\tpanOffset.set( 0, 0, 0 );\n\n\t\t\t\t}\n\n\t\t\t\tscale = 1;\n\n\t\t\t\t// update condition is:\n\t\t\t\t// min(camera displacement, camera rotation in radians)^2 > EPS\n\t\t\t\t// using small-angle approximation cos(x/2) = 1 - x^2 / 8\n\n\t\t\t\tif ( zoomChanged ||\n\t\t\t\t\tlastPosition.distanceToSquared( scope.object.position ) > EPS ||\n\t\t\t\t\t8 * ( 1 - lastQuaternion.dot( scope.object.quaternion ) ) > EPS ) {\n\n\t\t\t\t\tscope.dispatchEvent( _changeEvent );\n\n\t\t\t\t\tlastPosition.copy( scope.object.position );\n\t\t\t\t\tlastQuaternion.copy( scope.object.quaternion );\n\t\t\t\t\tzoomChanged = false;\n\n\t\t\t\t\treturn true;\n\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\n\t\t\t};\n\n\t\t}();\n\n\t\tthis.dispose = function () {\n\n\t\t\tscope.domElement.removeEventListener( 'contextmenu', onContextMenu );\n\n\t\t\tscope.domElement.removeEventListener( 'pointerdown', onPointerDown );\n\t\t\tscope.domElement.removeEventListener( 'pointercancel', onPointerCancel );\n\t\t\tscope.domElement.removeEventListener( 'wheel', onMouseWheel );\n\n\t\t\tscope.domElement.ownerDocument.removeEventListener( 'pointermove', onPointerMove );\n\t\t\tscope.domElement.ownerDocument.removeEventListener( 'pointerup', onPointerUp );\n\n\n\t\t\tif ( scope._domElementKeyEvents !== null ) {\n\n\t\t\t\tscope._domElementKeyEvents.removeEventListener( 'keydown', onKeyDown );\n\n\t\t\t}\n\n\t\t\t//scope.dispatchEvent( { type: 'dispose' } ); // should this be added here?\n\n\t\t};\n\n\t\t//\n\t\t// internals\n\t\t//\n\n\t\tconst scope = this;\n\n\t\tconst STATE = {\n\t\t\tNONE: - 1,\n\t\t\tROTATE: 0,\n\t\t\tDOLLY: 1,\n\t\t\tPAN: 2,\n\t\t\tTOUCH_ROTATE: 3,\n\t\t\tTOUCH_PAN: 4,\n\t\t\tTOUCH_DOLLY_PAN: 5,\n\t\t\tTOUCH_DOLLY_ROTATE: 6\n\t\t};\n\n\t\tlet state = STATE.NONE;\n\n\t\tconst EPS = 0.000001;\n\n\t\t// current position in spherical coordinates\n\t\tconst spherical = new Spherical();\n\t\tconst sphericalDelta = new Spherical();\n\n\t\tlet scale = 1;\n\t\tconst panOffset = new Vector3();\n\t\tlet zoomChanged = false;\n\n\t\tconst rotateStart = new Vector2();\n\t\tconst rotateEnd = new Vector2();\n\t\tconst rotateDelta = new Vector2();\n\n\t\tconst panStart = new Vector2();\n\t\tconst panEnd = new Vector2();\n\t\tconst panDelta = new Vector2();\n\n\t\tconst dollyStart = new Vector2();\n\t\tconst dollyEnd = new Vector2();\n\t\tconst dollyDelta = new Vector2();\n\n\t\tconst pointers = [];\n\t\tconst pointerPositions = {};\n\n\t\tfunction getAutoRotationAngle() {\n\n\t\t\treturn 2 * Math.PI / 60 / 60 * scope.autoRotateSpeed;\n\n\t\t}\n\n\t\tfunction getZoomScale() {\n\n\t\t\treturn Math.pow( 0.95, scope.zoomSpeed );\n\n\t\t}\n\n\t\tfunction rotateLeft( angle ) {\n\n\t\t\tsphericalDelta.theta -= angle;\n\n\t\t}\n\n\t\tfunction rotateUp( angle ) {\n\n\t\t\tsphericalDelta.phi -= angle;\n\n\t\t}\n\n\t\tconst panLeft = function () {\n\n\t\t\tconst v = new Vector3();\n\n\t\t\treturn function panLeft( distance, objectMatrix ) {\n\n\t\t\t\tv.setFromMatrixColumn( objectMatrix, 0 ); // get X column of objectMatrix\n\t\t\t\tv.multiplyScalar( - distance );\n\n\t\t\t\tpanOffset.add( v );\n\n\t\t\t};\n\n\t\t}();\n\n\t\tconst panUp = function () {\n\n\t\t\tconst v = new Vector3();\n\n\t\t\treturn function panUp( distance, objectMatrix ) {\n\n\t\t\t\tif ( scope.screenSpacePanning === true ) {\n\n\t\t\t\t\tv.setFromMatrixColumn( objectMatrix, 1 );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tv.setFromMatrixColumn( objectMatrix, 0 );\n\t\t\t\t\tv.crossVectors( scope.object.up, v );\n\n\t\t\t\t}\n\n\t\t\t\tv.multiplyScalar( distance );\n\n\t\t\t\tpanOffset.add( v );\n\n\t\t\t};\n\n\t\t}();\n\n\t\t// deltaX and deltaY are in pixels; right and down are positive\n\t\tconst pan = function () {\n\n\t\t\tconst offset = new Vector3();\n\n\t\t\treturn function pan( deltaX, deltaY ) {\n\n\t\t\t\tconst element = scope.domElement;\n\n\t\t\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\t\t\t// perspective\n\t\t\t\t\tconst position = scope.object.position;\n\t\t\t\t\toffset.copy( position ).sub( scope.target );\n\t\t\t\t\tlet targetDistance = offset.length();\n\n\t\t\t\t\t// half of the fov is center to top of screen\n\t\t\t\t\ttargetDistance *= Math.tan( ( scope.object.fov / 2 ) * Math.PI / 180.0 );\n\n\t\t\t\t\t// we use only clientHeight here so aspect ratio does not distort speed\n\t\t\t\t\tpanLeft( 2 * deltaX * targetDistance / element.clientHeight, scope.object.matrix );\n\t\t\t\t\tpanUp( 2 * deltaY * targetDistance / element.clientHeight, scope.object.matrix );\n\n\t\t\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\t\t// orthographic\n\t\t\t\t\tpanLeft( deltaX * ( scope.object.right - scope.object.left ) / scope.object.zoom / element.clientWidth, scope.object.matrix );\n\t\t\t\t\tpanUp( deltaY * ( scope.object.top - scope.object.bottom ) / scope.object.zoom / element.clientHeight, scope.object.matrix );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// camera neither orthographic nor perspective\n\t\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.' );\n\t\t\t\t\tscope.enablePan = false;\n\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t}();\n\n\t\tfunction dollyOut( dollyScale ) {\n\n\t\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\t\tscale /= dollyScale;\n\n\t\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\tscope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom * dollyScale ) );\n\t\t\t\tscope.object.updateProjectionMatrix();\n\t\t\t\tzoomChanged = true;\n\n\t\t\t} else {\n\n\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n\t\t\t\tscope.enableZoom = false;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction dollyIn( dollyScale ) {\n\n\t\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\t\tscale *= dollyScale;\n\n\t\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\tscope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom / dollyScale ) );\n\t\t\t\tscope.object.updateProjectionMatrix();\n\t\t\t\tzoomChanged = true;\n\n\t\t\t} else {\n\n\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n\t\t\t\tscope.enableZoom = false;\n\n\t\t\t}\n\n\t\t}\n\n\t\t//\n\t\t// event callbacks - update the object state\n\t\t//\n\n\t\tfunction handleMouseDownRotate( event ) {\n\n\t\t\trotateStart.set( event.clientX, event.clientY );\n\n\t\t}\n\n\t\tfunction handleMouseDownDolly( event ) {\n\n\t\t\tdollyStart.set( event.clientX, event.clientY );\n\n\t\t}\n\n\t\tfunction handleMouseDownPan( event ) {\n\n\t\t\tpanStart.set( event.clientX, event.clientY );\n\n\t\t}\n\n\t\tfunction handleMouseMoveRotate( event ) {\n\n\t\t\trotateEnd.set( event.clientX, event.clientY );\n\n\t\t\trotateDelta.subVectors( rotateEnd, rotateStart ).multiplyScalar( scope.rotateSpeed );\n\n\t\t\tconst element = scope.domElement;\n\n\t\t\trotateLeft( 2 * Math.PI * rotateDelta.x / element.clientHeight ); // yes, height\n\n\t\t\trotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight );\n\n\t\t\trotateStart.copy( rotateEnd );\n\n\t\t\tscope.update();\n\n\t\t}\n\n\t\tfunction handleMouseMoveDolly( event ) {\n\n\t\t\tdollyEnd.set( event.clientX, event.clientY );\n\n\t\t\tdollyDelta.subVectors( dollyEnd, dollyStart );\n\n\t\t\tif ( dollyDelta.y > 0 ) {\n\n\t\t\t\tdollyOut( getZoomScale() );\n\n\t\t\t} else if ( dollyDelta.y < 0 ) {\n\n\t\t\t\tdollyIn( getZoomScale() );\n\n\t\t\t}\n\n\t\t\tdollyStart.copy( dollyEnd );\n\n\t\t\tscope.update();\n\n\t\t}\n\n\t\tfunction handleMouseMovePan( event ) {\n\n\t\t\tpanEnd.set( event.clientX, event.clientY );\n\n\t\t\tpanDelta.subVectors( panEnd, panStart ).multiplyScalar( scope.panSpeed );\n\n\t\t\tpan( panDelta.x, panDelta.y );\n\n\t\t\tpanStart.copy( panEnd );\n\n\t\t\tscope.update();\n\n\t\t}\n\n\t\tfunction handleMouseUp( /*event*/ ) {\n\n\t\t\t// no-op\n\n\t\t}\n\n\t\tfunction handleMouseWheel( event ) {\n\n\t\t\tif ( event.deltaY < 0 ) {\n\n\t\t\t\tdollyIn( getZoomScale() );\n\n\t\t\t} else if ( event.deltaY > 0 ) {\n\n\t\t\t\tdollyOut( getZoomScale() );\n\n\t\t\t}\n\n\t\t\tscope.update();\n\n\t\t}\n\n\t\tfunction handleKeyDown( event ) {\n\n\t\t\tlet needsUpdate = false;\n\n\t\t\tswitch ( event.code ) {\n\n\t\t\t\tcase scope.keys.UP:\n\t\t\t\t\tpan( 0, scope.keyPanSpeed );\n\t\t\t\t\tneedsUpdate = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase scope.keys.BOTTOM:\n\t\t\t\t\tpan( 0, - scope.keyPanSpeed );\n\t\t\t\t\tneedsUpdate = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase scope.keys.LEFT:\n\t\t\t\t\tpan( scope.keyPanSpeed, 0 );\n\t\t\t\t\tneedsUpdate = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase scope.keys.RIGHT:\n\t\t\t\t\tpan( - scope.keyPanSpeed, 0 );\n\t\t\t\t\tneedsUpdate = true;\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tif ( needsUpdate ) {\n\n\t\t\t\t// prevent the browser from scrolling on cursor keys\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\tscope.update();\n\n\t\t\t}\n\n\n\t\t}\n\n\t\tfunction handleTouchStartRotate() {\n\n\t\t\tif ( pointers.length === 1 ) {\n\n\t\t\t\trotateStart.set( pointers[ 0 ].pageX, pointers[ 0 ].pageY );\n\n\t\t\t} else {\n\n\t\t\t\tconst x = 0.5 * ( pointers[ 0 ].pageX + pointers[ 1 ].pageX );\n\t\t\t\tconst y = 0.5 * ( pointers[ 0 ].pageY + pointers[ 1 ].pageY );\n\n\t\t\t\trotateStart.set( x, y );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction handleTouchStartPan() {\n\n\t\t\tif ( pointers.length === 1 ) {\n\n\t\t\t\tpanStart.set( pointers[ 0 ].pageX, pointers[ 0 ].pageY );\n\n\t\t\t} else {\n\n\t\t\t\tconst x = 0.5 * ( pointers[ 0 ].pageX + pointers[ 1 ].pageX );\n\t\t\t\tconst y = 0.5 * ( pointers[ 0 ].pageY + pointers[ 1 ].pageY );\n\n\t\t\t\tpanStart.set( x, y );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction handleTouchStartDolly() {\n\n\t\t\tconst dx = pointers[ 0 ].pageX - pointers[ 1 ].pageX;\n\t\t\tconst dy = pointers[ 0 ].pageY - pointers[ 1 ].pageY;\n\n\t\t\tconst distance = Math.sqrt( dx * dx + dy * dy );\n\n\t\t\tdollyStart.set( 0, distance );\n\n\t\t}\n\n\t\tfunction handleTouchStartDollyPan() {\n\n\t\t\tif ( scope.enableZoom ) handleTouchStartDolly();\n\n\t\t\tif ( scope.enablePan ) handleTouchStartPan();\n\n\t\t}\n\n\t\tfunction handleTouchStartDollyRotate() {\n\n\t\t\tif ( scope.enableZoom ) handleTouchStartDolly();\n\n\t\t\tif ( scope.enableRotate ) handleTouchStartRotate();\n\n\t\t}\n\n\t\tfunction handleTouchMoveRotate( event ) {\n\n\t\t\tif ( pointers.length == 1 ) {\n\n\t\t\t\trotateEnd.set( event.pageX, event.pageY );\n\n\t\t\t} else {\n\n\t\t\t\tconst position = getSecondPointerPosition( event );\n\n\t\t\t\tconst x = 0.5 * ( event.pageX + position.x );\n\t\t\t\tconst y = 0.5 * ( event.pageY + position.y );\n\n\t\t\t\trotateEnd.set( x, y );\n\n\t\t\t}\n\n\t\t\trotateDelta.subVectors( rotateEnd, rotateStart ).multiplyScalar( scope.rotateSpeed );\n\n\t\t\tconst element = scope.domElement;\n\n\t\t\trotateLeft( 2 * Math.PI * rotateDelta.x / element.clientHeight ); // yes, height\n\n\t\t\trotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight );\n\n\t\t\trotateStart.copy( rotateEnd );\n\n\t\t}\n\n\t\tfunction handleTouchMovePan( event ) {\n\n\t\t\tif ( pointers.length === 1 ) {\n\n\t\t\t\tpanEnd.set( event.pageX, event.pageY );\n\n\t\t\t} else {\n\n\t\t\t\tconst position = getSecondPointerPosition( event );\n\n\t\t\t\tconst x = 0.5 * ( event.pageX + position.x );\n\t\t\t\tconst y = 0.5 * ( event.pageY + position.y );\n\n\t\t\t\tpanEnd.set( x, y );\n\n\t\t\t}\n\n\t\t\tpanDelta.subVectors( panEnd, panStart ).multiplyScalar( scope.panSpeed );\n\n\t\t\tpan( panDelta.x, panDelta.y );\n\n\t\t\tpanStart.copy( panEnd );\n\n\t\t}\n\n\t\tfunction handleTouchMoveDolly( event ) {\n\n\t\t\tconst position = getSecondPointerPosition( event );\n\n\t\t\tconst dx = event.pageX - position.x;\n\t\t\tconst dy = event.pageY - position.y;\n\n\t\t\tconst distance = Math.sqrt( dx * dx + dy * dy );\n\n\t\t\tdollyEnd.set( 0, distance );\n\n\t\t\tdollyDelta.set( 0, Math.pow( dollyEnd.y / dollyStart.y, scope.zoomSpeed ) );\n\n\t\t\tdollyOut( dollyDelta.y );\n\n\t\t\tdollyStart.copy( dollyEnd );\n\n\t\t}\n\n\t\tfunction handleTouchMoveDollyPan( event ) {\n\n\t\t\tif ( scope.enableZoom ) handleTouchMoveDolly( event );\n\n\t\t\tif ( scope.enablePan ) handleTouchMovePan( event );\n\n\t\t}\n\n\t\tfunction handleTouchMoveDollyRotate( event ) {\n\n\t\t\tif ( scope.enableZoom ) handleTouchMoveDolly( event );\n\n\t\t\tif ( scope.enableRotate ) handleTouchMoveRotate( event );\n\n\t\t}\n\n\t\tfunction handleTouchEnd( /*event*/ ) {\n\n\t\t\t// no-op\n\n\t\t}\n\n\t\t//\n\t\t// event handlers - FSM: listen for events and reset state\n\t\t//\n\n\t\tfunction onPointerDown( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tif ( pointers.length === 0 ) {\n\n\t\t\t\tscope.domElement.ownerDocument.addEventListener( 'pointermove', onPointerMove );\n\t\t\t\tscope.domElement.ownerDocument.addEventListener( 'pointerup', onPointerUp );\n\n\t\t\t}\n\n\t\t\t//\n\n\t\t\taddPointer( event );\n\n\t\t\tif ( event.pointerType === 'touch' ) {\n\n\t\t\t\tonTouchStart( event );\n\n\t\t\t} else {\n\n\t\t\t\tonMouseDown( event );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onPointerMove( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tif ( event.pointerType === 'touch' ) {\n\n\t\t\t\tonTouchMove( event );\n\n\t\t\t} else {\n\n\t\t\t\tonMouseMove( event );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onPointerUp( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tif ( event.pointerType === 'touch' ) {\n\n\t\t\t\tonTouchEnd();\n\n\t\t\t} else {\n\n\t\t\t\tonMouseUp( event );\n\n\t\t\t}\n\n\t\t\tremovePointer( event );\n\n\t\t\t//\n\n\t\t\tif ( pointers.length === 0 ) {\n\n\t\t\t\tscope.domElement.ownerDocument.removeEventListener( 'pointermove', onPointerMove );\n\t\t\t\tscope.domElement.ownerDocument.removeEventListener( 'pointerup', onPointerUp );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onPointerCancel( event ) {\n\n\t\t\tremovePointer( event );\n\n\t\t}\n\n\t\tfunction onMouseDown( event ) {\n\n\t\t\tlet mouseAction;\n\n\t\t\tswitch ( event.button ) {\n\n\t\t\t\tcase 0:\n\n\t\t\t\t\tmouseAction = scope.mouseButtons.LEFT;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 1:\n\n\t\t\t\t\tmouseAction = scope.mouseButtons.MIDDLE;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2:\n\n\t\t\t\t\tmouseAction = scope.mouseButtons.RIGHT;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tmouseAction = - 1;\n\n\t\t\t}\n\n\t\t\tswitch ( mouseAction ) {\n\n\t\t\t\tcase MOUSE.DOLLY:\n\n\t\t\t\t\tif ( scope.enableZoom === false ) return;\n\n\t\t\t\t\thandleMouseDownDolly( event );\n\n\t\t\t\t\tstate = STATE.DOLLY;\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase MOUSE.ROTATE:\n\n\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\t\thandleMouseDownPan( event );\n\n\t\t\t\t\t\tstate = STATE.PAN;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\t\thandleMouseDownRotate( event );\n\n\t\t\t\t\t\tstate = STATE.ROTATE;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase MOUSE.PAN:\n\n\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\t\thandleMouseDownRotate( event );\n\n\t\t\t\t\t\tstate = STATE.ROTATE;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\t\thandleMouseDownPan( event );\n\n\t\t\t\t\t\tstate = STATE.PAN;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t}\n\n\t\t\tif ( state !== STATE.NONE ) {\n\n\t\t\t\tscope.dispatchEvent( _startEvent );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onMouseMove( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tswitch ( state ) {\n\n\t\t\t\tcase STATE.ROTATE:\n\n\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\thandleMouseMoveRotate( event );\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.DOLLY:\n\n\t\t\t\t\tif ( scope.enableZoom === false ) return;\n\n\t\t\t\t\thandleMouseMoveDolly( event );\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.PAN:\n\n\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\thandleMouseMovePan( event );\n\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onMouseUp( event ) {\n\n\t\t\thandleMouseUp( event );\n\n\t\t\tscope.dispatchEvent( _endEvent );\n\n\t\t\tstate = STATE.NONE;\n\n\t\t}\n\n\t\tfunction onMouseWheel( event ) {\n\n\t\t\tif ( scope.enabled === false || scope.enableZoom === false || ( state !== STATE.NONE && state !== STATE.ROTATE ) ) return;\n\n\t\t\tevent.preventDefault();\n\n\t\t\tscope.dispatchEvent( _startEvent );\n\n\t\t\thandleMouseWheel( event );\n\n\t\t\tscope.dispatchEvent( _endEvent );\n\n\t\t}\n\n\t\tfunction onKeyDown( event ) {\n\n\t\t\tif ( scope.enabled === false || scope.enablePan === false ) return;\n\n\t\t\thandleKeyDown( event );\n\n\t\t}\n\n\t\tfunction onTouchStart( event ) {\n\n\t\t\ttrackPointer( event );\n\n\t\t\tswitch ( pointers.length ) {\n\n\t\t\t\tcase 1:\n\n\t\t\t\t\tswitch ( scope.touches.ONE ) {\n\n\t\t\t\t\t\tcase TOUCH.ROTATE:\n\n\t\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\t\t\thandleTouchStartRotate();\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_ROTATE;\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase TOUCH.PAN:\n\n\t\t\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\t\t\thandleTouchStartPan();\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_PAN;\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\n\t\t\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2:\n\n\t\t\t\t\tswitch ( scope.touches.TWO ) {\n\n\t\t\t\t\t\tcase TOUCH.DOLLY_PAN:\n\n\t\t\t\t\t\t\tif ( scope.enableZoom === false && scope.enablePan === false ) return;\n\n\t\t\t\t\t\t\thandleTouchStartDollyPan();\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_PAN;\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase TOUCH.DOLLY_ROTATE:\n\n\t\t\t\t\t\t\tif ( scope.enableZoom === false && scope.enableRotate === false ) return;\n\n\t\t\t\t\t\t\thandleTouchStartDollyRotate();\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_ROTATE;\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\n\t\t\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t}\n\n\t\t\tif ( state !== STATE.NONE ) {\n\n\t\t\t\tscope.dispatchEvent( _startEvent );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onTouchMove( event ) {\n\n\t\t\ttrackPointer( event );\n\n\t\t\tswitch ( state ) {\n\n\t\t\t\tcase STATE.TOUCH_ROTATE:\n\n\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\thandleTouchMoveRotate( event );\n\n\t\t\t\t\tscope.update();\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.TOUCH_PAN:\n\n\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\thandleTouchMovePan( event );\n\n\t\t\t\t\tscope.update();\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.TOUCH_DOLLY_PAN:\n\n\t\t\t\t\tif ( scope.enableZoom === false && scope.enablePan === false ) return;\n\n\t\t\t\t\thandleTouchMoveDollyPan( event );\n\n\t\t\t\t\tscope.update();\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.TOUCH_DOLLY_ROTATE:\n\n\t\t\t\t\tif ( scope.enableZoom === false && scope.enableRotate === false ) return;\n\n\t\t\t\t\thandleTouchMoveDollyRotate( event );\n\n\t\t\t\t\tscope.update();\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onTouchEnd( event ) {\n\n\t\t\thandleTouchEnd( event );\n\n\t\t\tscope.dispatchEvent( _endEvent );\n\n\t\t\tstate = STATE.NONE;\n\n\t\t}\n\n\t\tfunction onContextMenu( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tevent.preventDefault();\n\n\t\t}\n\n\t\tfunction addPointer( event ) {\n\n\t\t\tpointers.push( event );\n\n\t\t}\n\n\t\tfunction removePointer( event ) {\n\n\t\t\tdelete pointerPositions[ event.pointerId ];\n\n\t\t\tfor ( let i = 0; i < pointers.length; i ++ ) {\n\n\t\t\t\tif ( pointers[ i ].pointerId == event.pointerId ) {\n\n\t\t\t\t\tpointers.splice( i, 1 );\n\t\t\t\t\treturn;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction trackPointer( event ) {\n\n\t\t\tlet position = pointerPositions[ event.pointerId ];\n\n\t\t\tif ( position === undefined ) {\n\n\t\t\t\tposition = new Vector2();\n\t\t\t\tpointerPositions[ event.pointerId ] = position;\n\n\t\t\t}\n\n\t\t\tposition.set( event.pageX, event.pageY );\n\n\t\t}\n\n\t\tfunction getSecondPointerPosition( event ) {\n\n\t\t\tconst pointer = ( event.pointerId === pointers[ 0 ].pointerId ) ? pointers[ 1 ] : pointers[ 0 ];\n\n\t\t\treturn pointerPositions[ pointer.pointerId ];\n\n\t\t}\n\n\t\t//\n\n\t\tscope.domElement.addEventListener( 'contextmenu', onContextMenu );\n\n\t\tscope.domElement.addEventListener( 'pointerdown', onPointerDown );\n\t\tscope.domElement.addEventListener( 'pointercancel', onPointerCancel );\n\t\tscope.domElement.addEventListener( 'wheel', onMouseWheel, { passive: false } );\n\n\t\t// force an update at start\n\n\t\tthis.update();\n\n\t}\n\n}\n\n\n// This set of controls performs orbiting, dollying (zooming), and panning.\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\n// This is very similar to OrbitControls, another set of touch behavior\n//\n//    Orbit - right mouse, or left mouse + ctrl/meta/shiftKey / touch: two-finger rotate\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\n//    Pan - left mouse, or arrow keys / touch: one-finger move\n\nclass MapControls extends OrbitControls {\n\n\tconstructor( object, domElement ) {\n\n\t\tsuper( object, domElement );\n\n\t\tthis.screenSpacePanning = false; // pan orthogonal to world-space direction camera.up\n\n\t\tthis.mouseButtons.LEFT = MOUSE.PAN;\n\t\tthis.mouseButtons.RIGHT = MOUSE.ROTATE;\n\n\t\tthis.touches.ONE = TOUCH.PAN;\n\t\tthis.touches.TWO = TOUCH.DOLLY_ROTATE;\n\n\t}\n\n}\n\nexport { OrbitControls, MapControls };\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nimport { BackSide, Color, Mesh, RepeatWrapping, ShaderMaterial, SphereBufferGeometry } from 'three';\r\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';\r\nexport default class WarpSpeed {\r\n    constructor(scene, renderer, camera, lights, physics, load, factories) {\r\n        this.scene = scene;\r\n        this.renderer = renderer;\r\n        this.camera = camera;\r\n        this.lights = lights;\r\n        this.physics = physics;\r\n        this.load = load;\r\n        this.factories = factories;\r\n    }\r\n    /**\r\n     * It takes took long to setup the third dimension your self? Get started with warp speed by using this function.\r\n     * @param features Pass the features you want to setup.\r\n     */\r\n    warpSpeed(...features) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            let Features = {};\r\n            // test for negative features\r\n            const negativeFeatures = features.filter(feature => /^-\\w+/.test(feature));\r\n            const hasNegativeFeatures = negativeFeatures.length > 0 ? true : false;\r\n            // add all features\r\n            if (features.length === 0 || hasNegativeFeatures)\r\n                features = ['light', 'camera', 'lookAtCenter', 'ground', 'grid', 'orbitControls', 'fog', 'sky'];\r\n            // remove the negative features\r\n            if (hasNegativeFeatures) {\r\n                const featuresToRemove = negativeFeatures.map(feature => feature.substr(1));\r\n                featuresToRemove.forEach(feature => {\r\n                    // @ts-ignore\r\n                    const index = features.indexOf(feature);\r\n                    features.splice(index, 1);\r\n                });\r\n            }\r\n            // TODO(yandeu): add fog\r\n            // if (features.includes('fog')) {\r\n            // }\r\n            if (features.includes('sky')) {\r\n                // https://github.com/mrdoob/three.js/blob/master/examples/webgl_lights_hemisphere.html\r\n                // SKYDOME\r\n                const vertexShader = [\r\n                    'varying vec3 vWorldPosition;',\r\n                    '',\r\n                    'void main() {',\r\n                    '',\r\n                    'vec4 worldPosition = modelMatrix * vec4( position, 1.0 );',\r\n                    'vWorldPosition = worldPosition.xyz;',\r\n                    '',\r\n                    'gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );',\r\n                    '',\r\n                    '}'\r\n                ].join('\\n');\r\n                const fragmentShader = [\r\n                    'uniform vec3 topColor;',\r\n                    'uniform vec3 bottomColor;',\r\n                    'uniform float offset;',\r\n                    'uniform float exponent;',\r\n                    '',\r\n                    'varying vec3 vWorldPosition;',\r\n                    '',\r\n                    'void main() {',\r\n                    '',\r\n                    'float h = normalize( vWorldPosition + offset ).y;',\r\n                    'gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h , 0.0), exponent ), 0.0 ) ), 1.0 );',\r\n                    '',\r\n                    '}'\r\n                ].join('\\n');\r\n                const uniforms = {\r\n                    topColor: { value: new Color(0x0077ff) },\r\n                    bottomColor: { value: new Color(0xedf5ff) },\r\n                    offset: { value: 33 },\r\n                    exponent: { value: 0.6 }\r\n                };\r\n                var skyGeo = new SphereBufferGeometry(500, 32, 15);\r\n                var skyMat = new ShaderMaterial({\r\n                    uniforms: uniforms,\r\n                    vertexShader: vertexShader,\r\n                    fragmentShader: fragmentShader,\r\n                    side: BackSide\r\n                });\r\n                var sky = new Mesh(skyGeo, skyMat);\r\n                this.scene.add(sky);\r\n            }\r\n            if (features.includes('camera')) {\r\n                this.camera.position.set(0, 6, 12);\r\n                Features = Object.assign({ camera: this.camera }, Features);\r\n            }\r\n            if (features.includes('light')) {\r\n                const intensity = 0.4;\r\n                const hemisphereLight = this.lights.hemisphereLight({ skyColor: 0xffffff, groundColor: 0x000000, intensity });\r\n                const ambientLight = this.lights.ambientLight({ color: 0xffffff, intensity });\r\n                const directionalLight = this.lights.directionalLight({ color: 0xffffff, intensity });\r\n                directionalLight.position.set(100, 200, 50);\r\n                const d = 20;\r\n                directionalLight.shadow.camera.top = d;\r\n                directionalLight.shadow.camera.bottom = -d;\r\n                directionalLight.shadow.camera.left = -d;\r\n                directionalLight.shadow.camera.right = d;\r\n                directionalLight.shadow.mapSize.set(1024, 1024);\r\n                // this.directionalLight = light\r\n                const lights = {\r\n                    ambientLight,\r\n                    directionalLight,\r\n                    hemisphereLight\r\n                };\r\n                Features = Object.assign({ lights }, Features);\r\n            }\r\n            if (features.includes('lookAtCenter')) {\r\n                this.camera.lookAt(this.scene.position);\r\n            }\r\n            if (features.includes('ground')) {\r\n                // grid (texture)\r\n                const addGrid = features.includes('grid');\r\n                const gridData = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOnAAADusBZ+q87AAAAJtJREFUeJzt0EENwDAAxLDbNP6UOxh+NEYQ5dl2drFv286598GrA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAu37AD8eaBH5JQdVbAAAAAElFTkSuQmCC';\r\n                const texture = yield this.load.texture(gridData);\r\n                texture.wrapS = texture.wrapT = RepeatWrapping;\r\n                texture.repeat.set(21, 21);\r\n                // ground\r\n                const geometry = { name: 'ground', width: 21, height: 21, depth: 1, y: -0.5 };\r\n                const material = {\r\n                    phong: { map: addGrid ? texture : null, color: 0xffffff }\r\n                };\r\n                let ground;\r\n                if (window.__loadPhysics) {\r\n                    ground = this.physics.add.ground(geometry, material);\r\n                    ground.body.setRestitution(1);\r\n                }\r\n                else {\r\n                    ground = this.factories.add.ground(geometry, material);\r\n                }\r\n                ground.receiveShadow = true;\r\n                Features = Object.assign({ ground }, Features);\r\n            }\r\n            if (features.includes('orbitControls')) {\r\n                // for phaser\r\n                // this.root is the phaser scene (scene3D)\r\n                // this.root.scale.parent instead of this.renderer.domElement\r\n                const orbitControls = new OrbitControls(this.camera, document.getElementById('enable3d-phaser-canvas') || this.renderer.domElement);\r\n                Features = Object.assign({ orbitControls }, Features);\r\n            }\r\n            return Features;\r\n        });\r\n    }\r\n}\r\n//# sourceMappingURL=warpSpeed.js.map","import {\n\tColor,\n\tLinearFilter,\n\tMathUtils,\n\tMatrix4,\n\tMesh,\n\tPerspectiveCamera,\n\tPlane,\n\tRGBFormat,\n\tShaderMaterial,\n\tUniformsUtils,\n\tVector3,\n\tVector4,\n\tWebGLRenderTarget\n} from 'three';\n\nclass Reflector extends Mesh {\n\n\tconstructor( geometry, options = {} ) {\n\n\t\tsuper( geometry );\n\n\t\tthis.type = 'Reflector';\n\n\t\tconst scope = this;\n\n\t\tconst color = ( options.color !== undefined ) ? new Color( options.color ) : new Color( 0x7F7F7F );\n\t\tconst textureWidth = options.textureWidth || 512;\n\t\tconst textureHeight = options.textureHeight || 512;\n\t\tconst clipBias = options.clipBias || 0;\n\t\tconst shader = options.shader || Reflector.ReflectorShader;\n\n\t\t//\n\n\t\tconst reflectorPlane = new Plane();\n\t\tconst normal = new Vector3();\n\t\tconst reflectorWorldPosition = new Vector3();\n\t\tconst cameraWorldPosition = new Vector3();\n\t\tconst rotationMatrix = new Matrix4();\n\t\tconst lookAtPosition = new Vector3( 0, 0, - 1 );\n\t\tconst clipPlane = new Vector4();\n\n\t\tconst view = new Vector3();\n\t\tconst target = new Vector3();\n\t\tconst q = new Vector4();\n\n\t\tconst textureMatrix = new Matrix4();\n\t\tconst virtualCamera = new PerspectiveCamera();\n\n\t\tconst parameters = {\n\t\t\tminFilter: LinearFilter,\n\t\t\tmagFilter: LinearFilter,\n\t\t\tformat: RGBFormat\n\t\t};\n\n\t\tconst renderTarget = new WebGLRenderTarget( textureWidth, textureHeight, parameters );\n\n\t\tif ( ! MathUtils.isPowerOfTwo( textureWidth ) || ! MathUtils.isPowerOfTwo( textureHeight ) ) {\n\n\t\t\trenderTarget.texture.generateMipmaps = false;\n\n\t\t}\n\n\t\tconst material = new ShaderMaterial( {\n\t\t\tuniforms: UniformsUtils.clone( shader.uniforms ),\n\t\t\tfragmentShader: shader.fragmentShader,\n\t\t\tvertexShader: shader.vertexShader\n\t\t} );\n\n\t\tmaterial.uniforms[ 'tDiffuse' ].value = renderTarget.texture;\n\t\tmaterial.uniforms[ 'color' ].value = color;\n\t\tmaterial.uniforms[ 'textureMatrix' ].value = textureMatrix;\n\n\t\tthis.material = material;\n\n\t\tthis.onBeforeRender = function ( renderer, scene, camera ) {\n\n\t\t\treflectorWorldPosition.setFromMatrixPosition( scope.matrixWorld );\n\t\t\tcameraWorldPosition.setFromMatrixPosition( camera.matrixWorld );\n\n\t\t\trotationMatrix.extractRotation( scope.matrixWorld );\n\n\t\t\tnormal.set( 0, 0, 1 );\n\t\t\tnormal.applyMatrix4( rotationMatrix );\n\n\t\t\tview.subVectors( reflectorWorldPosition, cameraWorldPosition );\n\n\t\t\t// Avoid rendering when reflector is facing away\n\n\t\t\tif ( view.dot( normal ) > 0 ) return;\n\n\t\t\tview.reflect( normal ).negate();\n\t\t\tview.add( reflectorWorldPosition );\n\n\t\t\trotationMatrix.extractRotation( camera.matrixWorld );\n\n\t\t\tlookAtPosition.set( 0, 0, - 1 );\n\t\t\tlookAtPosition.applyMatrix4( rotationMatrix );\n\t\t\tlookAtPosition.add( cameraWorldPosition );\n\n\t\t\ttarget.subVectors( reflectorWorldPosition, lookAtPosition );\n\t\t\ttarget.reflect( normal ).negate();\n\t\t\ttarget.add( reflectorWorldPosition );\n\n\t\t\tvirtualCamera.position.copy( view );\n\t\t\tvirtualCamera.up.set( 0, 1, 0 );\n\t\t\tvirtualCamera.up.applyMatrix4( rotationMatrix );\n\t\t\tvirtualCamera.up.reflect( normal );\n\t\t\tvirtualCamera.lookAt( target );\n\n\t\t\tvirtualCamera.far = camera.far; // Used in WebGLBackground\n\n\t\t\tvirtualCamera.updateMatrixWorld();\n\t\t\tvirtualCamera.projectionMatrix.copy( camera.projectionMatrix );\n\n\t\t\t// Update the texture matrix\n\t\t\ttextureMatrix.set(\n\t\t\t\t0.5, 0.0, 0.0, 0.5,\n\t\t\t\t0.0, 0.5, 0.0, 0.5,\n\t\t\t\t0.0, 0.0, 0.5, 0.5,\n\t\t\t\t0.0, 0.0, 0.0, 1.0\n\t\t\t);\n\t\t\ttextureMatrix.multiply( virtualCamera.projectionMatrix );\n\t\t\ttextureMatrix.multiply( virtualCamera.matrixWorldInverse );\n\t\t\ttextureMatrix.multiply( scope.matrixWorld );\n\n\t\t\t// Now update projection matrix with new clip plane, implementing code from: http://www.terathon.com/code/oblique.html\n\t\t\t// Paper explaining this technique: http://www.terathon.com/lengyel/Lengyel-Oblique.pdf\n\t\t\treflectorPlane.setFromNormalAndCoplanarPoint( normal, reflectorWorldPosition );\n\t\t\treflectorPlane.applyMatrix4( virtualCamera.matrixWorldInverse );\n\n\t\t\tclipPlane.set( reflectorPlane.normal.x, reflectorPlane.normal.y, reflectorPlane.normal.z, reflectorPlane.constant );\n\n\t\t\tconst projectionMatrix = virtualCamera.projectionMatrix;\n\n\t\t\tq.x = ( Math.sign( clipPlane.x ) + projectionMatrix.elements[ 8 ] ) / projectionMatrix.elements[ 0 ];\n\t\t\tq.y = ( Math.sign( clipPlane.y ) + projectionMatrix.elements[ 9 ] ) / projectionMatrix.elements[ 5 ];\n\t\t\tq.z = - 1.0;\n\t\t\tq.w = ( 1.0 + projectionMatrix.elements[ 10 ] ) / projectionMatrix.elements[ 14 ];\n\n\t\t\t// Calculate the scaled plane vector\n\t\t\tclipPlane.multiplyScalar( 2.0 / clipPlane.dot( q ) );\n\n\t\t\t// Replacing the third row of the projection matrix\n\t\t\tprojectionMatrix.elements[ 2 ] = clipPlane.x;\n\t\t\tprojectionMatrix.elements[ 6 ] = clipPlane.y;\n\t\t\tprojectionMatrix.elements[ 10 ] = clipPlane.z + 1.0 - clipBias;\n\t\t\tprojectionMatrix.elements[ 14 ] = clipPlane.w;\n\n\t\t\t// Render\n\n\t\t\trenderTarget.texture.encoding = renderer.outputEncoding;\n\n\t\t\tscope.visible = false;\n\n\t\t\tconst currentRenderTarget = renderer.getRenderTarget();\n\n\t\t\tconst currentXrEnabled = renderer.xr.enabled;\n\t\t\tconst currentShadowAutoUpdate = renderer.shadowMap.autoUpdate;\n\n\t\t\trenderer.xr.enabled = false; // Avoid camera modification\n\t\t\trenderer.shadowMap.autoUpdate = false; // Avoid re-computing shadows\n\n\t\t\trenderer.setRenderTarget( renderTarget );\n\n\t\t\trenderer.state.buffers.depth.setMask( true ); // make sure the depth buffer is writable so it can be properly cleared, see #18897\n\n\t\t\tif ( renderer.autoClear === false ) renderer.clear();\n\t\t\trenderer.render( scene, virtualCamera );\n\n\t\t\trenderer.xr.enabled = currentXrEnabled;\n\t\t\trenderer.shadowMap.autoUpdate = currentShadowAutoUpdate;\n\n\t\t\trenderer.setRenderTarget( currentRenderTarget );\n\n\t\t\t// Restore viewport\n\n\t\t\tconst viewport = camera.viewport;\n\n\t\t\tif ( viewport !== undefined ) {\n\n\t\t\t\trenderer.state.viewport( viewport );\n\n\t\t\t}\n\n\t\t\tscope.visible = true;\n\n\t\t};\n\n\t\tthis.getRenderTarget = function () {\n\n\t\t\treturn renderTarget;\n\n\t\t};\n\n\t}\n\n}\n\nReflector.prototype.isReflector = true;\n\nReflector.ReflectorShader = {\n\n\tuniforms: {\n\n\t\t'color': {\n\t\t\tvalue: null\n\t\t},\n\n\t\t'tDiffuse': {\n\t\t\tvalue: null\n\t\t},\n\n\t\t'textureMatrix': {\n\t\t\tvalue: null\n\t\t}\n\n\t},\n\n\tvertexShader: /* glsl */`\n\t\tuniform mat4 textureMatrix;\n\t\tvarying vec4 vUv;\n\n\t\t#include <common>\n\t\t#include <logdepthbuf_pars_vertex>\n\n\t\tvoid main() {\n\n\t\t\tvUv = textureMatrix * vec4( position, 1.0 );\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t\t#include <logdepthbuf_vertex>\n\n\t\t}`,\n\n\tfragmentShader: /* glsl */`\n\t\tuniform vec3 color;\n\t\tuniform sampler2D tDiffuse;\n\t\tvarying vec4 vUv;\n\n\t\t#include <logdepthbuf_pars_fragment>\n\n\t\tfloat blendOverlay( float base, float blend ) {\n\n\t\t\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );\n\n\t\t}\n\n\t\tvec3 blendOverlay( vec3 base, vec3 blend ) {\n\n\t\t\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#include <logdepthbuf_fragment>\n\n\t\t\tvec4 base = texture2DProj( tDiffuse, vUv );\n\t\t\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );\n\n\t\t}`\n};\n\nexport { Reflector };\n","import {\n\tColor,\n\tLinearFilter,\n\tMathUtils,\n\tMatrix4,\n\tMesh,\n\tPerspectiveCamera,\n\tPlane,\n\tQuaternion,\n\tRGBFormat,\n\tShaderMaterial,\n\tUniformsUtils,\n\tVector3,\n\tVector4,\n\tWebGLRenderTarget\n} from 'three';\n\nclass Refractor extends Mesh {\n\n\tconstructor( geometry, options = {} ) {\n\n\t\tsuper( geometry );\n\n\t\tthis.type = 'Refractor';\n\n\t\tconst scope = this;\n\n\t\tconst color = ( options.color !== undefined ) ? new Color( options.color ) : new Color( 0x7F7F7F );\n\t\tconst textureWidth = options.textureWidth || 512;\n\t\tconst textureHeight = options.textureHeight || 512;\n\t\tconst clipBias = options.clipBias || 0;\n\t\tconst shader = options.shader || Refractor.RefractorShader;\n\n\t\t//\n\n\t\tconst virtualCamera = new PerspectiveCamera();\n\t\tvirtualCamera.matrixAutoUpdate = false;\n\t\tvirtualCamera.userData.refractor = true;\n\n\t\t//\n\n\t\tconst refractorPlane = new Plane();\n\t\tconst textureMatrix = new Matrix4();\n\n\t\t// render target\n\n\t\tconst parameters = {\n\t\t\tminFilter: LinearFilter,\n\t\t\tmagFilter: LinearFilter,\n\t\t\tformat: RGBFormat\n\t\t};\n\n\t\tconst renderTarget = new WebGLRenderTarget( textureWidth, textureHeight, parameters );\n\n\t\tif ( ! MathUtils.isPowerOfTwo( textureWidth ) || ! MathUtils.isPowerOfTwo( textureHeight ) ) {\n\n\t\t\trenderTarget.texture.generateMipmaps = false;\n\n\t\t}\n\n\t\t// material\n\n\t\tthis.material = new ShaderMaterial( {\n\t\t\tuniforms: UniformsUtils.clone( shader.uniforms ),\n\t\t\tvertexShader: shader.vertexShader,\n\t\t\tfragmentShader: shader.fragmentShader,\n\t\t\ttransparent: true // ensures, refractors are drawn from farthest to closest\n\t\t} );\n\n\t\tthis.material.uniforms[ 'color' ].value = color;\n\t\tthis.material.uniforms[ 'tDiffuse' ].value = renderTarget.texture;\n\t\tthis.material.uniforms[ 'textureMatrix' ].value = textureMatrix;\n\n\t\t// functions\n\n\t\tconst visible = ( function () {\n\n\t\t\tconst refractorWorldPosition = new Vector3();\n\t\t\tconst cameraWorldPosition = new Vector3();\n\t\t\tconst rotationMatrix = new Matrix4();\n\n\t\t\tconst view = new Vector3();\n\t\t\tconst normal = new Vector3();\n\n\t\t\treturn function visible( camera ) {\n\n\t\t\t\trefractorWorldPosition.setFromMatrixPosition( scope.matrixWorld );\n\t\t\t\tcameraWorldPosition.setFromMatrixPosition( camera.matrixWorld );\n\n\t\t\t\tview.subVectors( refractorWorldPosition, cameraWorldPosition );\n\n\t\t\t\trotationMatrix.extractRotation( scope.matrixWorld );\n\n\t\t\t\tnormal.set( 0, 0, 1 );\n\t\t\t\tnormal.applyMatrix4( rotationMatrix );\n\n\t\t\t\treturn view.dot( normal ) < 0;\n\n\t\t\t};\n\n\t\t} )();\n\n\t\tconst updateRefractorPlane = ( function () {\n\n\t\t\tconst normal = new Vector3();\n\t\t\tconst position = new Vector3();\n\t\t\tconst quaternion = new Quaternion();\n\t\t\tconst scale = new Vector3();\n\n\t\t\treturn function updateRefractorPlane() {\n\n\t\t\t\tscope.matrixWorld.decompose( position, quaternion, scale );\n\t\t\t\tnormal.set( 0, 0, 1 ).applyQuaternion( quaternion ).normalize();\n\n\t\t\t\t// flip the normal because we want to cull everything above the plane\n\n\t\t\t\tnormal.negate();\n\n\t\t\t\trefractorPlane.setFromNormalAndCoplanarPoint( normal, position );\n\n\t\t\t};\n\n\t\t} )();\n\n\t\tconst updateVirtualCamera = ( function () {\n\n\t\t\tconst clipPlane = new Plane();\n\t\t\tconst clipVector = new Vector4();\n\t\t\tconst q = new Vector4();\n\n\t\t\treturn function updateVirtualCamera( camera ) {\n\n\t\t\t\tvirtualCamera.matrixWorld.copy( camera.matrixWorld );\n\t\t\t\tvirtualCamera.matrixWorldInverse.copy( virtualCamera.matrixWorld ).invert();\n\t\t\t\tvirtualCamera.projectionMatrix.copy( camera.projectionMatrix );\n\t\t\t\tvirtualCamera.far = camera.far; // used in WebGLBackground\n\n\t\t\t\t// The following code creates an oblique view frustum for clipping.\n\t\t\t\t// see: Lengyel, Eric. Oblique View Frustum Depth Projection and Clipping.\n\t\t\t\t// Journal of Game Development, Vol. 1, No. 2 (2005), Charles River Media, pp. 516\n\n\t\t\t\tclipPlane.copy( refractorPlane );\n\t\t\t\tclipPlane.applyMatrix4( virtualCamera.matrixWorldInverse );\n\n\t\t\t\tclipVector.set( clipPlane.normal.x, clipPlane.normal.y, clipPlane.normal.z, clipPlane.constant );\n\n\t\t\t\t// calculate the clip-space corner point opposite the clipping plane and\n\t\t\t\t// transform it into camera space by multiplying it by the inverse of the projection matrix\n\n\t\t\t\tconst projectionMatrix = virtualCamera.projectionMatrix;\n\n\t\t\t\tq.x = ( Math.sign( clipVector.x ) + projectionMatrix.elements[ 8 ] ) / projectionMatrix.elements[ 0 ];\n\t\t\t\tq.y = ( Math.sign( clipVector.y ) + projectionMatrix.elements[ 9 ] ) / projectionMatrix.elements[ 5 ];\n\t\t\t\tq.z = - 1.0;\n\t\t\t\tq.w = ( 1.0 + projectionMatrix.elements[ 10 ] ) / projectionMatrix.elements[ 14 ];\n\n\t\t\t\t// calculate the scaled plane vector\n\n\t\t\t\tclipVector.multiplyScalar( 2.0 / clipVector.dot( q ) );\n\n\t\t\t\t// replacing the third row of the projection matrix\n\n\t\t\t\tprojectionMatrix.elements[ 2 ] = clipVector.x;\n\t\t\t\tprojectionMatrix.elements[ 6 ] = clipVector.y;\n\t\t\t\tprojectionMatrix.elements[ 10 ] = clipVector.z + 1.0 - clipBias;\n\t\t\t\tprojectionMatrix.elements[ 14 ] = clipVector.w;\n\n\t\t\t};\n\n\t\t} )();\n\n\t\t// This will update the texture matrix that is used for projective texture mapping in the shader.\n\t\t// see: http://developer.download.nvidia.com/assets/gamedev/docs/projective_texture_mapping.pdf\n\n\t\tfunction updateTextureMatrix( camera ) {\n\n\t\t\t// this matrix does range mapping to [ 0, 1 ]\n\n\t\t\ttextureMatrix.set(\n\t\t\t\t0.5, 0.0, 0.0, 0.5,\n\t\t\t\t0.0, 0.5, 0.0, 0.5,\n\t\t\t\t0.0, 0.0, 0.5, 0.5,\n\t\t\t\t0.0, 0.0, 0.0, 1.0\n\t\t\t);\n\n\t\t\t// we use \"Object Linear Texgen\", so we need to multiply the texture matrix T\n\t\t\t// (matrix above) with the projection and view matrix of the virtual camera\n\t\t\t// and the model matrix of the refractor\n\n\t\t\ttextureMatrix.multiply( camera.projectionMatrix );\n\t\t\ttextureMatrix.multiply( camera.matrixWorldInverse );\n\t\t\ttextureMatrix.multiply( scope.matrixWorld );\n\n\t\t}\n\n\t\t//\n\n\t\tfunction render( renderer, scene, camera ) {\n\n\t\t\tscope.visible = false;\n\n\t\t\tconst currentRenderTarget = renderer.getRenderTarget();\n\t\t\tconst currentXrEnabled = renderer.xr.enabled;\n\t\t\tconst currentShadowAutoUpdate = renderer.shadowMap.autoUpdate;\n\n\t\t\trenderer.xr.enabled = false; // avoid camera modification\n\t\t\trenderer.shadowMap.autoUpdate = false; // avoid re-computing shadows\n\n\t\t\trenderer.setRenderTarget( renderTarget );\n\t\t\tif ( renderer.autoClear === false ) renderer.clear();\n\t\t\trenderer.render( scene, virtualCamera );\n\n\t\t\trenderer.xr.enabled = currentXrEnabled;\n\t\t\trenderer.shadowMap.autoUpdate = currentShadowAutoUpdate;\n\t\t\trenderer.setRenderTarget( currentRenderTarget );\n\n\t\t\t// restore viewport\n\n\t\t\tconst viewport = camera.viewport;\n\n\t\t\tif ( viewport !== undefined ) {\n\n\t\t\t\trenderer.state.viewport( viewport );\n\n\t\t\t}\n\n\t\t\tscope.visible = true;\n\n\t\t}\n\n\t\t//\n\n\t\tthis.onBeforeRender = function ( renderer, scene, camera ) {\n\n\t\t\t// Render\n\n\t\t\trenderTarget.texture.encoding = renderer.outputEncoding;\n\n\t\t\t// ensure refractors are rendered only once per frame\n\n\t\t\tif ( camera.userData.refractor === true ) return;\n\n\t\t\t// avoid rendering when the refractor is viewed from behind\n\n\t\t\tif ( ! visible( camera ) === true ) return;\n\n\t\t\t// update\n\n\t\t\tupdateRefractorPlane();\n\n\t\t\tupdateTextureMatrix( camera );\n\n\t\t\tupdateVirtualCamera( camera );\n\n\t\t\trender( renderer, scene, camera );\n\n\t\t};\n\n\t\tthis.getRenderTarget = function () {\n\n\t\t\treturn renderTarget;\n\n\t\t};\n\n\t}\n\n}\n\nRefractor.prototype.isRefractor = true;\n\nRefractor.RefractorShader = {\n\n\tuniforms: {\n\n\t\t'color': {\n\t\t\tvalue: null\n\t\t},\n\n\t\t'tDiffuse': {\n\t\t\tvalue: null\n\t\t},\n\n\t\t'textureMatrix': {\n\t\t\tvalue: null\n\t\t}\n\n\t},\n\n\tvertexShader: /* glsl */`\n\n\t\tuniform mat4 textureMatrix;\n\n\t\tvarying vec4 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = textureMatrix * vec4( position, 1.0 );\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}`,\n\n\tfragmentShader: /* glsl */`\n\n\t\tuniform vec3 color;\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec4 vUv;\n\n\t\tfloat blendOverlay( float base, float blend ) {\n\n\t\t\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );\n\n\t\t}\n\n\t\tvec3 blendOverlay( vec3 base, vec3 blend ) {\n\n\t\t\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvec4 base = texture2DProj( tDiffuse, vUv );\n\t\t\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );\n\n\t\t}`\n\n};\n\nexport { Refractor };\n","import {\n\tClock,\n\tColor,\n\tLinearEncoding,\n\tMatrix4,\n\tMesh,\n\tRepeatWrapping,\n\tShaderMaterial,\n\tTextureLoader,\n\tUniformsLib,\n\tUniformsUtils,\n\tVector2,\n\tVector4\n} from 'three';\nimport { Reflector } from '../objects/Reflector.js';\nimport { Refractor } from '../objects/Refractor.js';\n\n/**\n * References:\n *\thttp://www.valvesoftware.com/publications/2010/siggraph2010_vlachos_waterflow.pdf\n * \thttp://graphicsrunner.blogspot.de/2010/08/water-using-flow-maps.html\n *\n */\n\nclass Water extends Mesh {\n\n\tconstructor( geometry, options = {} ) {\n\n\t\tsuper( geometry );\n\n\t\tthis.type = 'Water';\n\n\t\tconst scope = this;\n\n\t\tconst color = ( options.color !== undefined ) ? new Color( options.color ) : new Color( 0xFFFFFF );\n\t\tconst textureWidth = options.textureWidth || 512;\n\t\tconst textureHeight = options.textureHeight || 512;\n\t\tconst clipBias = options.clipBias || 0;\n\t\tconst flowDirection = options.flowDirection || new Vector2( 1, 0 );\n\t\tconst flowSpeed = options.flowSpeed || 0.03;\n\t\tconst reflectivity = options.reflectivity || 0.02;\n\t\tconst scale = options.scale || 1;\n\t\tconst shader = options.shader || Water.WaterShader;\n\t\tconst encoding = options.encoding !== undefined ? options.encoding : LinearEncoding;\n\n\t\tconst textureLoader = new TextureLoader();\n\n\t\tconst flowMap = options.flowMap || undefined;\n\t\tconst normalMap0 = options.normalMap0 || textureLoader.load( 'textures/water/Water_1_M_Normal.jpg' );\n\t\tconst normalMap1 = options.normalMap1 || textureLoader.load( 'textures/water/Water_2_M_Normal.jpg' );\n\n\t\tconst cycle = 0.15; // a cycle of a flow map phase\n\t\tconst halfCycle = cycle * 0.5;\n\t\tconst textureMatrix = new Matrix4();\n\t\tconst clock = new Clock();\n\n\t\t// internal components\n\n\t\tif ( Reflector === undefined ) {\n\n\t\t\tconsole.error( 'THREE.Water: Required component Reflector not found.' );\n\t\t\treturn;\n\n\t\t}\n\n\t\tif ( Refractor === undefined ) {\n\n\t\t\tconsole.error( 'THREE.Water: Required component Refractor not found.' );\n\t\t\treturn;\n\n\t\t}\n\n\t\tconst reflector = new Reflector( geometry, {\n\t\t\ttextureWidth: textureWidth,\n\t\t\ttextureHeight: textureHeight,\n\t\t\tclipBias: clipBias,\n\t\t\tencoding: encoding\n\t\t} );\n\n\t\tconst refractor = new Refractor( geometry, {\n\t\t\ttextureWidth: textureWidth,\n\t\t\ttextureHeight: textureHeight,\n\t\t\tclipBias: clipBias,\n\t\t\tencoding: encoding\n\t\t} );\n\n\t\treflector.matrixAutoUpdate = false;\n\t\trefractor.matrixAutoUpdate = false;\n\n\t\t// material\n\n\t\tthis.material = new ShaderMaterial( {\n\t\t\tuniforms: UniformsUtils.merge( [\n\t\t\t\tUniformsLib[ 'fog' ],\n\t\t\t\tshader.uniforms\n\t\t\t] ),\n\t\t\tvertexShader: shader.vertexShader,\n\t\t\tfragmentShader: shader.fragmentShader,\n\t\t\ttransparent: true,\n\t\t\tfog: true\n\t\t} );\n\n\t\tif ( flowMap !== undefined ) {\n\n\t\t\tthis.material.defines.USE_FLOWMAP = '';\n\t\t\tthis.material.uniforms[ 'tFlowMap' ] = {\n\t\t\t\ttype: 't',\n\t\t\t\tvalue: flowMap\n\t\t\t};\n\n\t\t} else {\n\n\t\t\tthis.material.uniforms[ 'flowDirection' ] = {\n\t\t\t\ttype: 'v2',\n\t\t\t\tvalue: flowDirection\n\t\t\t};\n\n\t\t}\n\n\t\t// maps\n\n\t\tnormalMap0.wrapS = normalMap0.wrapT = RepeatWrapping;\n\t\tnormalMap1.wrapS = normalMap1.wrapT = RepeatWrapping;\n\n\t\tthis.material.uniforms[ 'tReflectionMap' ].value = reflector.getRenderTarget().texture;\n\t\tthis.material.uniforms[ 'tRefractionMap' ].value = refractor.getRenderTarget().texture;\n\t\tthis.material.uniforms[ 'tNormalMap0' ].value = normalMap0;\n\t\tthis.material.uniforms[ 'tNormalMap1' ].value = normalMap1;\n\n\t\t// water\n\n\t\tthis.material.uniforms[ 'color' ].value = color;\n\t\tthis.material.uniforms[ 'reflectivity' ].value = reflectivity;\n\t\tthis.material.uniforms[ 'textureMatrix' ].value = textureMatrix;\n\n\t\t// inital values\n\n\t\tthis.material.uniforms[ 'config' ].value.x = 0; // flowMapOffset0\n\t\tthis.material.uniforms[ 'config' ].value.y = halfCycle; // flowMapOffset1\n\t\tthis.material.uniforms[ 'config' ].value.z = halfCycle; // halfCycle\n\t\tthis.material.uniforms[ 'config' ].value.w = scale; // scale\n\n\t\t// functions\n\n\t\tfunction updateTextureMatrix( camera ) {\n\n\t\t\ttextureMatrix.set(\n\t\t\t\t0.5, 0.0, 0.0, 0.5,\n\t\t\t\t0.0, 0.5, 0.0, 0.5,\n\t\t\t\t0.0, 0.0, 0.5, 0.5,\n\t\t\t\t0.0, 0.0, 0.0, 1.0\n\t\t\t);\n\n\t\t\ttextureMatrix.multiply( camera.projectionMatrix );\n\t\t\ttextureMatrix.multiply( camera.matrixWorldInverse );\n\t\t\ttextureMatrix.multiply( scope.matrixWorld );\n\n\t\t}\n\n\t\tfunction updateFlow() {\n\n\t\t\tconst delta = clock.getDelta();\n\t\t\tconst config = scope.material.uniforms[ 'config' ];\n\n\t\t\tconfig.value.x += flowSpeed * delta; // flowMapOffset0\n\t\t\tconfig.value.y = config.value.x + halfCycle; // flowMapOffset1\n\n\t\t\t// Important: The distance between offsets should be always the value of \"halfCycle\".\n\t\t\t// Moreover, both offsets should be in the range of [ 0, cycle ].\n\t\t\t// This approach ensures a smooth water flow and avoids \"reset\" effects.\n\n\t\t\tif ( config.value.x >= cycle ) {\n\n\t\t\t\tconfig.value.x = 0;\n\t\t\t\tconfig.value.y = halfCycle;\n\n\t\t\t} else if ( config.value.y >= cycle ) {\n\n\t\t\t\tconfig.value.y = config.value.y - cycle;\n\n\t\t\t}\n\n\t\t}\n\n\t\t//\n\n\t\tthis.onBeforeRender = function ( renderer, scene, camera ) {\n\n\t\t\tupdateTextureMatrix( camera );\n\t\t\tupdateFlow();\n\n\t\t\tscope.visible = false;\n\n\t\t\treflector.matrixWorld.copy( scope.matrixWorld );\n\t\t\trefractor.matrixWorld.copy( scope.matrixWorld );\n\n\t\t\treflector.onBeforeRender( renderer, scene, camera );\n\t\t\trefractor.onBeforeRender( renderer, scene, camera );\n\n\t\t\tscope.visible = true;\n\n\t\t};\n\n\t}\n\n}\n\nWater.prototype.isWater = true;\n\nWater.WaterShader = {\n\n\tuniforms: {\n\n\t\t'color': {\n\t\t\ttype: 'c',\n\t\t\tvalue: null\n\t\t},\n\n\t\t'reflectivity': {\n\t\t\ttype: 'f',\n\t\t\tvalue: 0\n\t\t},\n\n\t\t'tReflectionMap': {\n\t\t\ttype: 't',\n\t\t\tvalue: null\n\t\t},\n\n\t\t'tRefractionMap': {\n\t\t\ttype: 't',\n\t\t\tvalue: null\n\t\t},\n\n\t\t'tNormalMap0': {\n\t\t\ttype: 't',\n\t\t\tvalue: null\n\t\t},\n\n\t\t'tNormalMap1': {\n\t\t\ttype: 't',\n\t\t\tvalue: null\n\t\t},\n\n\t\t'textureMatrix': {\n\t\t\ttype: 'm4',\n\t\t\tvalue: null\n\t\t},\n\n\t\t'config': {\n\t\t\ttype: 'v4',\n\t\t\tvalue: new Vector4()\n\t\t}\n\n\t},\n\n\tvertexShader: /* glsl */`\n\n\t\t#include <common>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\n\t\tuniform mat4 textureMatrix;\n\n\t\tvarying vec4 vCoord;\n\t\tvarying vec2 vUv;\n\t\tvarying vec3 vToEye;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tvCoord = textureMatrix * vec4( position, 1.0 );\n\n\t\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\t\t\tvToEye = cameraPosition - worldPosition.xyz;\n\n\t\t\tvec4 mvPosition =  viewMatrix * worldPosition; // used in fog_vertex\n\t\t\tgl_Position = projectionMatrix * mvPosition;\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}`,\n\n\tfragmentShader: /* glsl */`\n\n\t\t#include <common>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\n\t\tuniform sampler2D tReflectionMap;\n\t\tuniform sampler2D tRefractionMap;\n\t\tuniform sampler2D tNormalMap0;\n\t\tuniform sampler2D tNormalMap1;\n\n\t\t#ifdef USE_FLOWMAP\n\t\t\tuniform sampler2D tFlowMap;\n\t\t#else\n\t\t\tuniform vec2 flowDirection;\n\t\t#endif\n\n\t\tuniform vec3 color;\n\t\tuniform float reflectivity;\n\t\tuniform vec4 config;\n\n\t\tvarying vec4 vCoord;\n\t\tvarying vec2 vUv;\n\t\tvarying vec3 vToEye;\n\n\t\tvoid main() {\n\n\t\t\t#include <logdepthbuf_fragment>\n\n\t\t\tfloat flowMapOffset0 = config.x;\n\t\t\tfloat flowMapOffset1 = config.y;\n\t\t\tfloat halfCycle = config.z;\n\t\t\tfloat scale = config.w;\n\n\t\t\tvec3 toEye = normalize( vToEye );\n\n\t\t\t// determine flow direction\n\t\t\tvec2 flow;\n\t\t\t#ifdef USE_FLOWMAP\n\t\t\t\tflow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;\n\t\t\t#else\n\t\t\t\tflow = flowDirection;\n\t\t\t#endif\n\t\t\tflow.x *= - 1.0;\n\n\t\t\t// sample normal maps (distort uvs with flowdata)\n\t\t\tvec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );\n\t\t\tvec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );\n\n\t\t\t// linear interpolate to get the final normal color\n\t\t\tfloat flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;\n\t\t\tvec4 normalColor = mix( normalColor0, normalColor1, flowLerp );\n\n\t\t\t// calculate normal vector\n\t\t\tvec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );\n\n\t\t\t// calculate the fresnel term to blend reflection and refraction maps\n\t\t\tfloat theta = max( dot( toEye, normal ), 0.0 );\n\t\t\tfloat reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );\n\n\t\t\t// calculate final uv coords\n\t\t\tvec3 coord = vCoord.xyz / vCoord.w;\n\t\t\tvec2 uv = coord.xy + coord.z * normal.xz * 0.05;\n\n\t\t\tvec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );\n\t\t\tvec4 refractColor = texture2D( tRefractionMap, uv );\n\n\t\t\t// multiply water color with the mix of both textures\n\t\t\tgl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\n\t\t}`\n\n};\n\nexport { Water };\n","// misc\r\nimport { addWater } from './water';\r\nimport { RepeatWrapping } from 'three';\r\nimport { logger } from '@enable3d/common/dist/logger';\r\nexport default class Misc {\r\n    constructor(scene, renderer, factories) {\r\n        this.scene = scene;\r\n        this.renderer = renderer;\r\n        this.factories = factories;\r\n    }\r\n    water(config = {}) {\r\n        addWater(this.scene, this.renderer, config);\r\n    }\r\n    textureCube(textures) {\r\n        if (textures.length !== 6) {\r\n            logger('You need to pass 6 urls to textureCube()');\r\n        }\r\n        const textureCube = new TextureCube();\r\n        textures.forEach((texture, i) => {\r\n            texture.wrapS = texture.wrapT = RepeatWrapping;\r\n            const material = this.factories.add.material({ phong: { map: texture } });\r\n            textureCube.materials[i] = material;\r\n        });\r\n        return textureCube;\r\n    }\r\n}\r\nexport class TextureCube {\r\n    constructor() {\r\n        this.materials = new Array(6);\r\n    }\r\n    get texture() {\r\n        return {\r\n            left: this.getTexture(0),\r\n            right: this.getTexture(1),\r\n            up: this.getTexture(2),\r\n            down: this.getTexture(3),\r\n            front: this.getTexture(4),\r\n            back: this.getTexture(5)\r\n        };\r\n    }\r\n    getTexture(i) {\r\n        // @ts-ignore\r\n        return this.materials[i].map;\r\n    }\r\n}\r\n//# sourceMappingURL=misc.js.map","import { Mesh, MeshStandardMaterial, PlaneBufferGeometry, Vector2 } from 'three';\r\n// @ts-ignore\r\nimport { Water } from 'three/examples/jsm/objects/Water2';\r\nconst addWater = (scene, renderer, config = {}) => {\r\n    const { width = 20, height = 20, x = 0, y = 0, z = 0, color = '#ffffff', scale = 4, flowX = 1, flowY = 1, normalMap0 = undefined, normalMap1 = undefined } = config;\r\n    //ground\r\n    const groundGeometry = new PlaneBufferGeometry(width, height);\r\n    // #0077be (also known as Ocean Boat Blue)\r\n    const groundMaterial = new MeshStandardMaterial({ color: 0x0077be, transparent: true, opacity: 0.8 });\r\n    const ground = new Mesh(groundGeometry, groundMaterial);\r\n    ground.position.set(x, y, z);\r\n    ground.rotation.x = Math.PI * -0.5;\r\n    scene.add(ground);\r\n    // water\r\n    const waterGeometry = new PlaneBufferGeometry(width, height);\r\n    const water = new Water(waterGeometry, {\r\n        color: color,\r\n        scale: scale,\r\n        flowDirection: new Vector2(flowX, flowY),\r\n        textureWidth: 1024,\r\n        textureHeight: 1024,\r\n        normalMap0: normalMap0,\r\n        normalMap1: normalMap1,\r\n        encoding: renderer.outputEncoding\r\n    });\r\n    water.position.set(x, y + 0.1, z);\r\n    water.rotation.x = Math.PI * -0.5;\r\n    scene.add(water);\r\n    return { ground, water };\r\n};\r\nexport { addWater };\r\n//# sourceMappingURL=water.js.map","import { Geometry } from 'three/examples/jsm/deprecated/Geometry';\r\nimport { BufferGeometry, Mesh, MeshBasicMaterial, PlaneBufferGeometry, Raycaster, Vector2, Vector3 } from 'three';\r\nimport { SVGLoader } from 'three/examples/jsm/loaders/SVGLoader';\r\nimport { fromGeometry } from '../csg/_fromGeometry';\r\n/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\nexport default class Transform {\r\n    constructor(camera, renderer) {\r\n        this.camera = camera;\r\n        this.renderer = renderer;\r\n    }\r\n    static geometryToBufferGeometry(geometry) {\r\n        if (geometry.isGeometry)\r\n            return fromGeometry(new BufferGeometry(), geometry);\r\n        else\r\n            return geometry;\r\n    }\r\n    static bufferGeometryToGeometry(bufferGeometry) {\r\n        if (bufferGeometry.isBufferGeometry)\r\n            return new Geometry().fromBufferGeometry(bufferGeometry);\r\n        else\r\n            return bufferGeometry;\r\n    }\r\n    /**\r\n     * Transforms your svg files to paths.\r\n     */\r\n    fromSVGtoShape(svg, isCCW = false, noHoles) {\r\n        if (svg) {\r\n            const svgLoader = new SVGLoader();\r\n            const shapes = [];\r\n            svgLoader.parse(svg).paths.forEach(path => {\r\n                path.toShapes(isCCW, noHoles).forEach(shape => {\r\n                    shapes.push(shape);\r\n                });\r\n            });\r\n            return shapes;\r\n        }\r\n        return [];\r\n    }\r\n    from3dto2d(position) {\r\n        const vector3 = new Vector3(position.x, position.y, position.z);\r\n        const canvas = this.renderer.domElement;\r\n        // map to normalized device coordinate (NDC) space\r\n        this.camera.updateMatrixWorld();\r\n        vector3.project(this.camera);\r\n        // map to 2D screen space\r\n        const x = Math.round((vector3.x + 1) * (canvas.width / 2));\r\n        const y = Math.round((-vector3.y + 1) * (canvas.height / 2));\r\n        return new Vector2(x, y);\r\n    }\r\n    /**\r\n     *\r\n     * @param x X coordinate in normalized device coordinate (NDC) (-1 to +1).\r\n     * @param y Y coordinate in normalized device coordinate (NDC) (-1 to +1).\r\n     * @param distanceFromCamera The distance from the camera.\r\n     */\r\n    from2dto3d(x, y, distanceFromCamera) {\r\n        var _a;\r\n        // initialize temporary variables\r\n        if (!this.tmpPlane) {\r\n            const geo = new PlaneBufferGeometry(10000, 10000);\r\n            const mat = new MeshBasicMaterial({ transparent: true, opacity: 0.25 });\r\n            this.tmpPlane = new Mesh(geo, mat);\r\n            this.tmpPlane.name = '_tmp_raycast_plane';\r\n        }\r\n        if (!this.tmpRaycaster)\r\n            this.tmpRaycaster = new Raycaster();\r\n        if (!this.tmpVector3)\r\n            this.tmpVector3 = new Vector3();\r\n        // holds the position we want to return later\r\n        let position;\r\n        // add plane parallel to camera\r\n        this.tmpPlane.setRotationFromEuler(this.camera.rotation);\r\n        const p = this.camera.position;\r\n        this.tmpPlane.position.set(p.x, p.y, p.z);\r\n        // adjust the distance of the plane\r\n        this.camera.getWorldDirection(this.tmpVector3);\r\n        this.tmpPlane.position.add(this.tmpVector3.clone().multiplyScalar(distanceFromCamera));\r\n        this.tmpPlane.updateMatrix();\r\n        this.tmpPlane.updateMatrixWorld(true);\r\n        // raycast\r\n        this.tmpRaycaster.setFromCamera({ x, y }, this.camera);\r\n        // check intersection with plane\r\n        const intersects = this.tmpRaycaster.intersectObjects([this.tmpPlane]);\r\n        if (((_a = intersects[0]) === null || _a === void 0 ? void 0 : _a.object.name) === '_tmp_raycast_plane')\r\n            position = intersects[0].point;\r\n        return position;\r\n    }\r\n}\r\n//# sourceMappingURL=transform.js.map","/**\n * @webxr-input-profiles/motion-controllers 1.0.0 https://github.com/immersive-web/webxr-input-profiles\n */\n\nconst Constants = {\n  Handedness: Object.freeze({\n    NONE: 'none',\n    LEFT: 'left',\n    RIGHT: 'right'\n  }),\n\n  ComponentState: Object.freeze({\n    DEFAULT: 'default',\n    TOUCHED: 'touched',\n    PRESSED: 'pressed'\n  }),\n\n  ComponentProperty: Object.freeze({\n    BUTTON: 'button',\n    X_AXIS: 'xAxis',\n    Y_AXIS: 'yAxis',\n    STATE: 'state'\n  }),\n\n  ComponentType: Object.freeze({\n    TRIGGER: 'trigger',\n    SQUEEZE: 'squeeze',\n    TOUCHPAD: 'touchpad',\n    THUMBSTICK: 'thumbstick',\n    BUTTON: 'button'\n  }),\n\n  ButtonTouchThreshold: 0.05,\n\n  AxisTouchThreshold: 0.1,\n\n  VisualResponseProperty: Object.freeze({\n    TRANSFORM: 'transform',\n    VISIBILITY: 'visibility'\n  })\n};\n\n/**\n * @description Static helper function to fetch a JSON file and turn it into a JS object\n * @param {string} path - Path to JSON file to be fetched\n */\nasync function fetchJsonFile(path) {\n  const response = await fetch(path);\n  if (!response.ok) {\n    throw new Error(response.statusText);\n  } else {\n    return response.json();\n  }\n}\n\nasync function fetchProfilesList(basePath) {\n  if (!basePath) {\n    throw new Error('No basePath supplied');\n  }\n\n  const profileListFileName = 'profilesList.json';\n  const profilesList = await fetchJsonFile(`${basePath}/${profileListFileName}`);\n  return profilesList;\n}\n\nasync function fetchProfile(xrInputSource, basePath, defaultProfile = null, getAssetPath = true) {\n  if (!xrInputSource) {\n    throw new Error('No xrInputSource supplied');\n  }\n\n  if (!basePath) {\n    throw new Error('No basePath supplied');\n  }\n\n  // Get the list of profiles\n  const supportedProfilesList = await fetchProfilesList(basePath);\n\n  // Find the relative path to the first requested profile that is recognized\n  let match;\n  xrInputSource.profiles.some((profileId) => {\n    const supportedProfile = supportedProfilesList[profileId];\n    if (supportedProfile) {\n      match = {\n        profileId,\n        profilePath: `${basePath}/${supportedProfile.path}`,\n        deprecated: !!supportedProfile.deprecated\n      };\n    }\n    return !!match;\n  });\n\n  if (!match) {\n    if (!defaultProfile) {\n      throw new Error('No matching profile name found');\n    }\n\n    const supportedProfile = supportedProfilesList[defaultProfile];\n    if (!supportedProfile) {\n      throw new Error(`No matching profile name found and default profile \"${defaultProfile}\" missing.`);\n    }\n\n    match = {\n      profileId: defaultProfile,\n      profilePath: `${basePath}/${supportedProfile.path}`,\n      deprecated: !!supportedProfile.deprecated\n    };\n  }\n\n  const profile = await fetchJsonFile(match.profilePath);\n\n  let assetPath;\n  if (getAssetPath) {\n    let layout;\n    if (xrInputSource.handedness === 'any') {\n      layout = profile.layouts[Object.keys(profile.layouts)[0]];\n    } else {\n      layout = profile.layouts[xrInputSource.handedness];\n    }\n    if (!layout) {\n      throw new Error(\n        `No matching handedness, ${xrInputSource.handedness}, in profile ${match.profileId}`\n      );\n    }\n\n    if (layout.assetPath) {\n      assetPath = match.profilePath.replace('profile.json', layout.assetPath);\n    }\n  }\n\n  return { profile, assetPath };\n}\n\n/** @constant {Object} */\nconst defaultComponentValues = {\n  xAxis: 0,\n  yAxis: 0,\n  button: 0,\n  state: Constants.ComponentState.DEFAULT\n};\n\n/**\n * @description Converts an X, Y coordinate from the range -1 to 1 (as reported by the Gamepad\n * API) to the range 0 to 1 (for interpolation). Also caps the X, Y values to be bounded within\n * a circle. This ensures that thumbsticks are not animated outside the bounds of their physical\n * range of motion and touchpads do not report touch locations off their physical bounds.\n * @param {number} x The original x coordinate in the range -1 to 1\n * @param {number} y The original y coordinate in the range -1 to 1\n */\nfunction normalizeAxes(x = 0, y = 0) {\n  let xAxis = x;\n  let yAxis = y;\n\n  // Determine if the point is outside the bounds of the circle\n  // and, if so, place it on the edge of the circle\n  const hypotenuse = Math.sqrt((x * x) + (y * y));\n  if (hypotenuse > 1) {\n    const theta = Math.atan2(y, x);\n    xAxis = Math.cos(theta);\n    yAxis = Math.sin(theta);\n  }\n\n  // Scale and move the circle so values are in the interpolation range.  The circle's origin moves\n  // from (0, 0) to (0.5, 0.5). The circle's radius scales from 1 to be 0.5.\n  const result = {\n    normalizedXAxis: (xAxis * 0.5) + 0.5,\n    normalizedYAxis: (yAxis * 0.5) + 0.5\n  };\n  return result;\n}\n\n/**\n * Contains the description of how the 3D model should visually respond to a specific user input.\n * This is accomplished by initializing the object with the name of a node in the 3D model and\n * property that need to be modified in response to user input, the name of the nodes representing\n * the allowable range of motion, and the name of the input which triggers the change. In response\n * to the named input changing, this object computes the appropriate weighting to use for\n * interpolating between the range of motion nodes.\n */\nclass VisualResponse {\n  constructor(visualResponseDescription) {\n    this.componentProperty = visualResponseDescription.componentProperty;\n    this.states = visualResponseDescription.states;\n    this.valueNodeName = visualResponseDescription.valueNodeName;\n    this.valueNodeProperty = visualResponseDescription.valueNodeProperty;\n\n    if (this.valueNodeProperty === Constants.VisualResponseProperty.TRANSFORM) {\n      this.minNodeName = visualResponseDescription.minNodeName;\n      this.maxNodeName = visualResponseDescription.maxNodeName;\n    }\n\n    // Initializes the response's current value based on default data\n    this.value = 0;\n    this.updateFromComponent(defaultComponentValues);\n  }\n\n  /**\n   * Computes the visual response's interpolation weight based on component state\n   * @param {Object} componentValues - The component from which to update\n   * @param {number} xAxis - The reported X axis value of the component\n   * @param {number} yAxis - The reported Y axis value of the component\n   * @param {number} button - The reported value of the component's button\n   * @param {string} state - The component's active state\n   */\n  updateFromComponent({\n    xAxis, yAxis, button, state\n  }) {\n    const { normalizedXAxis, normalizedYAxis } = normalizeAxes(xAxis, yAxis);\n    switch (this.componentProperty) {\n      case Constants.ComponentProperty.X_AXIS:\n        this.value = (this.states.includes(state)) ? normalizedXAxis : 0.5;\n        break;\n      case Constants.ComponentProperty.Y_AXIS:\n        this.value = (this.states.includes(state)) ? normalizedYAxis : 0.5;\n        break;\n      case Constants.ComponentProperty.BUTTON:\n        this.value = (this.states.includes(state)) ? button : 0;\n        break;\n      case Constants.ComponentProperty.STATE:\n        if (this.valueNodeProperty === Constants.VisualResponseProperty.VISIBILITY) {\n          this.value = (this.states.includes(state));\n        } else {\n          this.value = this.states.includes(state) ? 1.0 : 0.0;\n        }\n        break;\n      default:\n        throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`);\n    }\n  }\n}\n\nclass Component {\n  /**\n   * @param {Object} componentId - Id of the component\n   * @param {Object} componentDescription - Description of the component to be created\n   */\n  constructor(componentId, componentDescription) {\n    if (!componentId\n     || !componentDescription\n     || !componentDescription.visualResponses\n     || !componentDescription.gamepadIndices\n     || Object.keys(componentDescription.gamepadIndices).length === 0) {\n      throw new Error('Invalid arguments supplied');\n    }\n\n    this.id = componentId;\n    this.type = componentDescription.type;\n    this.rootNodeName = componentDescription.rootNodeName;\n    this.touchPointNodeName = componentDescription.touchPointNodeName;\n\n    // Build all the visual responses for this component\n    this.visualResponses = {};\n    Object.keys(componentDescription.visualResponses).forEach((responseName) => {\n      const visualResponse = new VisualResponse(componentDescription.visualResponses[responseName]);\n      this.visualResponses[responseName] = visualResponse;\n    });\n\n    // Set default values\n    this.gamepadIndices = Object.assign({}, componentDescription.gamepadIndices);\n\n    this.values = {\n      state: Constants.ComponentState.DEFAULT,\n      button: (this.gamepadIndices.button !== undefined) ? 0 : undefined,\n      xAxis: (this.gamepadIndices.xAxis !== undefined) ? 0 : undefined,\n      yAxis: (this.gamepadIndices.yAxis !== undefined) ? 0 : undefined\n    };\n  }\n\n  get data() {\n    const data = { id: this.id, ...this.values };\n    return data;\n  }\n\n  /**\n   * @description Poll for updated data based on current gamepad state\n   * @param {Object} gamepad - The gamepad object from which the component data should be polled\n   */\n  updateFromGamepad(gamepad) {\n    // Set the state to default before processing other data sources\n    this.values.state = Constants.ComponentState.DEFAULT;\n\n    // Get and normalize button\n    if (this.gamepadIndices.button !== undefined\n        && gamepad.buttons.length > this.gamepadIndices.button) {\n      const gamepadButton = gamepad.buttons[this.gamepadIndices.button];\n      this.values.button = gamepadButton.value;\n      this.values.button = (this.values.button < 0) ? 0 : this.values.button;\n      this.values.button = (this.values.button > 1) ? 1 : this.values.button;\n\n      // Set the state based on the button\n      if (gamepadButton.pressed || this.values.button === 1) {\n        this.values.state = Constants.ComponentState.PRESSED;\n      } else if (gamepadButton.touched || this.values.button > Constants.ButtonTouchThreshold) {\n        this.values.state = Constants.ComponentState.TOUCHED;\n      }\n    }\n\n    // Get and normalize x axis value\n    if (this.gamepadIndices.xAxis !== undefined\n        && gamepad.axes.length > this.gamepadIndices.xAxis) {\n      this.values.xAxis = gamepad.axes[this.gamepadIndices.xAxis];\n      this.values.xAxis = (this.values.xAxis < -1) ? -1 : this.values.xAxis;\n      this.values.xAxis = (this.values.xAxis > 1) ? 1 : this.values.xAxis;\n\n      // If the state is still default, check if the xAxis makes it touched\n      if (this.values.state === Constants.ComponentState.DEFAULT\n        && Math.abs(this.values.xAxis) > Constants.AxisTouchThreshold) {\n        this.values.state = Constants.ComponentState.TOUCHED;\n      }\n    }\n\n    // Get and normalize Y axis value\n    if (this.gamepadIndices.yAxis !== undefined\n        && gamepad.axes.length > this.gamepadIndices.yAxis) {\n      this.values.yAxis = gamepad.axes[this.gamepadIndices.yAxis];\n      this.values.yAxis = (this.values.yAxis < -1) ? -1 : this.values.yAxis;\n      this.values.yAxis = (this.values.yAxis > 1) ? 1 : this.values.yAxis;\n\n      // If the state is still default, check if the yAxis makes it touched\n      if (this.values.state === Constants.ComponentState.DEFAULT\n        && Math.abs(this.values.yAxis) > Constants.AxisTouchThreshold) {\n        this.values.state = Constants.ComponentState.TOUCHED;\n      }\n    }\n\n    // Update the visual response weights based on the current component data\n    Object.values(this.visualResponses).forEach((visualResponse) => {\n      visualResponse.updateFromComponent(this.values);\n    });\n  }\n}\n\n/**\n  * @description Builds a motion controller with components and visual responses based on the\n  * supplied profile description. Data is polled from the xrInputSource's gamepad.\n  * @author Nell Waliczek / https://github.com/NellWaliczek\n*/\nclass MotionController {\n  /**\n   * @param {Object} xrInputSource - The XRInputSource to build the MotionController around\n   * @param {Object} profile - The best matched profile description for the supplied xrInputSource\n   * @param {Object} assetUrl\n   */\n  constructor(xrInputSource, profile, assetUrl) {\n    if (!xrInputSource) {\n      throw new Error('No xrInputSource supplied');\n    }\n\n    if (!profile) {\n      throw new Error('No profile supplied');\n    }\n\n    this.xrInputSource = xrInputSource;\n    this.assetUrl = assetUrl;\n    this.id = profile.profileId;\n\n    // Build child components as described in the profile description\n    this.layoutDescription = profile.layouts[xrInputSource.handedness];\n    this.components = {};\n    Object.keys(this.layoutDescription.components).forEach((componentId) => {\n      const componentDescription = this.layoutDescription.components[componentId];\n      this.components[componentId] = new Component(componentId, componentDescription);\n    });\n\n    // Initialize components based on current gamepad state\n    this.updateFromGamepad();\n  }\n\n  get gripSpace() {\n    return this.xrInputSource.gripSpace;\n  }\n\n  get targetRaySpace() {\n    return this.xrInputSource.targetRaySpace;\n  }\n\n  /**\n   * @description Returns a subset of component data for simplified debugging\n   */\n  get data() {\n    const data = [];\n    Object.values(this.components).forEach((component) => {\n      data.push(component.data);\n    });\n    return data;\n  }\n\n  /**\n   * @description Poll for updated data based on current gamepad state\n   */\n  updateFromGamepad() {\n    Object.values(this.components).forEach((component) => {\n      component.updateFromGamepad(this.xrInputSource.gamepad);\n    });\n  }\n}\n\nexport { Constants, MotionController, fetchProfile, fetchProfilesList };\n","import {\n\tMesh,\n\tMeshBasicMaterial,\n\tObject3D,\n\tSphereGeometry,\n} from 'three';\n\nimport { GLTFLoader } from '../loaders/GLTFLoader.js';\n\nimport {\n\tConstants as MotionControllerConstants,\n\tfetchProfile,\n\tMotionController\n} from '../libs/motion-controllers.module.js';\n\nconst DEFAULT_PROFILES_PATH = 'https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles';\nconst DEFAULT_PROFILE = 'generic-trigger';\n\nclass XRControllerModel extends Object3D {\n\n\tconstructor() {\n\n\t\tsuper();\n\n\t\tthis.motionController = null;\n\t\tthis.envMap = null;\n\n\t}\n\n\tsetEnvironmentMap( envMap ) {\n\n\t\tif ( this.envMap == envMap ) {\n\n\t\t\treturn this;\n\n\t\t}\n\n\t\tthis.envMap = envMap;\n\t\tthis.traverse( ( child ) => {\n\n\t\t\tif ( child.isMesh ) {\n\n\t\t\t\tchild.material.envMap = this.envMap;\n\t\t\t\tchild.material.needsUpdate = true;\n\n\t\t\t}\n\n\t\t} );\n\n\t\treturn this;\n\n\t}\n\n\t/**\n\t * Polls data from the XRInputSource and updates the model's components to match\n\t * the real world data\n\t */\n\tupdateMatrixWorld( force ) {\n\n\t\tsuper.updateMatrixWorld( force );\n\n\t\tif ( ! this.motionController ) return;\n\n\t\t// Cause the MotionController to poll the Gamepad for data\n\t\tthis.motionController.updateFromGamepad();\n\n\t\t// Update the 3D model to reflect the button, thumbstick, and touchpad state\n\t\tObject.values( this.motionController.components ).forEach( ( component ) => {\n\n\t\t\t// Update node data based on the visual responses' current states\n\t\t\tObject.values( component.visualResponses ).forEach( ( visualResponse ) => {\n\n\t\t\t\tconst { valueNode, minNode, maxNode, value, valueNodeProperty } = visualResponse;\n\n\t\t\t\t// Skip if the visual response node is not found. No error is needed,\n\t\t\t\t// because it will have been reported at load time.\n\t\t\t\tif ( ! valueNode ) return;\n\n\t\t\t\t// Calculate the new properties based on the weight supplied\n\t\t\t\tif ( valueNodeProperty === MotionControllerConstants.VisualResponseProperty.VISIBILITY ) {\n\n\t\t\t\t\tvalueNode.visible = value;\n\n\t\t\t\t} else if ( valueNodeProperty === MotionControllerConstants.VisualResponseProperty.TRANSFORM ) {\n\n\t\t\t\t\tvalueNode.quaternion.slerpQuaternions(\n\t\t\t\t\t\tminNode.quaternion,\n\t\t\t\t\t\tmaxNode.quaternion,\n\t\t\t\t\t\tvalue\n\t\t\t\t\t);\n\n\t\t\t\t\tvalueNode.position.lerpVectors(\n\t\t\t\t\t\tminNode.position,\n\t\t\t\t\t\tmaxNode.position,\n\t\t\t\t\t\tvalue\n\t\t\t\t\t);\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t} );\n\n\t}\n\n}\n\n/**\n * Walks the model's tree to find the nodes needed to animate the components and\n * saves them to the motionContoller components for use in the frame loop. When\n * touchpads are found, attaches a touch dot to them.\n */\nfunction findNodes( motionController, scene ) {\n\n\t// Loop through the components and find the nodes needed for each components' visual responses\n\tObject.values( motionController.components ).forEach( ( component ) => {\n\n\t\tconst { type, touchPointNodeName, visualResponses } = component;\n\n\t\tif ( type === MotionControllerConstants.ComponentType.TOUCHPAD ) {\n\n\t\t\tcomponent.touchPointNode = scene.getObjectByName( touchPointNodeName );\n\t\t\tif ( component.touchPointNode ) {\n\n\t\t\t\t// Attach a touch dot to the touchpad.\n\t\t\t\tconst sphereGeometry = new SphereGeometry( 0.001 );\n\t\t\t\tconst material = new MeshBasicMaterial( { color: 0x0000FF } );\n\t\t\t\tconst sphere = new Mesh( sphereGeometry, material );\n\t\t\t\tcomponent.touchPointNode.add( sphere );\n\n\t\t\t} else {\n\n\t\t\t\tconsole.warn( `Could not find touch dot, ${component.touchPointNodeName}, in touchpad component ${component.id}` );\n\n\t\t\t}\n\n\t\t}\n\n\t\t// Loop through all the visual responses to be applied to this component\n\t\tObject.values( visualResponses ).forEach( ( visualResponse ) => {\n\n\t\t\tconst { valueNodeName, minNodeName, maxNodeName, valueNodeProperty } = visualResponse;\n\n\t\t\t// If animating a transform, find the two nodes to be interpolated between.\n\t\t\tif ( valueNodeProperty === MotionControllerConstants.VisualResponseProperty.TRANSFORM ) {\n\n\t\t\t\tvisualResponse.minNode = scene.getObjectByName( minNodeName );\n\t\t\t\tvisualResponse.maxNode = scene.getObjectByName( maxNodeName );\n\n\t\t\t\t// If the extents cannot be found, skip this animation\n\t\t\t\tif ( ! visualResponse.minNode ) {\n\n\t\t\t\t\tconsole.warn( `Could not find ${minNodeName} in the model` );\n\t\t\t\t\treturn;\n\n\t\t\t\t}\n\n\t\t\t\tif ( ! visualResponse.maxNode ) {\n\n\t\t\t\t\tconsole.warn( `Could not find ${maxNodeName} in the model` );\n\t\t\t\t\treturn;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// If the target node cannot be found, skip this animation\n\t\t\tvisualResponse.valueNode = scene.getObjectByName( valueNodeName );\n\t\t\tif ( ! visualResponse.valueNode ) {\n\n\t\t\t\tconsole.warn( `Could not find ${valueNodeName} in the model` );\n\n\t\t\t}\n\n\t\t} );\n\n\t} );\n\n}\n\nfunction addAssetSceneToControllerModel( controllerModel, scene ) {\n\n\t// Find the nodes needed for animation and cache them on the motionController.\n\tfindNodes( controllerModel.motionController, scene );\n\n\t// Apply any environment map that the mesh already has set.\n\tif ( controllerModel.envMap ) {\n\n\t\tscene.traverse( ( child ) => {\n\n\t\t\tif ( child.isMesh ) {\n\n\t\t\t\tchild.material.envMap = controllerModel.envMap;\n\t\t\t\tchild.material.needsUpdate = true;\n\n\t\t\t}\n\n\t\t} );\n\n\t}\n\n\t// Add the glTF scene to the controllerModel.\n\tcontrollerModel.add( scene );\n\n}\n\nclass XRControllerModelFactory {\n\n\tconstructor( gltfLoader = null ) {\n\n\t\tthis.gltfLoader = gltfLoader;\n\t\tthis.path = DEFAULT_PROFILES_PATH;\n\t\tthis._assetCache = {};\n\n\t\t// If a GLTFLoader wasn't supplied to the constructor create a new one.\n\t\tif ( ! this.gltfLoader ) {\n\n\t\t\tthis.gltfLoader = new GLTFLoader();\n\n\t\t}\n\n\t}\n\n\tcreateControllerModel( controller ) {\n\n\t\tconst controllerModel = new XRControllerModel();\n\t\tlet scene = null;\n\n\t\tcontroller.addEventListener( 'connected', ( event ) => {\n\n\t\t\tconst xrInputSource = event.data;\n\n\t\t\tif ( xrInputSource.targetRayMode !== 'tracked-pointer' || ! xrInputSource.gamepad ) return;\n\n\t\t\tfetchProfile( xrInputSource, this.path, DEFAULT_PROFILE ).then( ( { profile, assetPath } ) => {\n\n\t\t\t\tcontrollerModel.motionController = new MotionController(\n\t\t\t\t\txrInputSource,\n\t\t\t\t\tprofile,\n\t\t\t\t\tassetPath\n\t\t\t\t);\n\n\t\t\t\tconst cachedAsset = this._assetCache[ controllerModel.motionController.assetUrl ];\n\t\t\t\tif ( cachedAsset ) {\n\n\t\t\t\t\tscene = cachedAsset.scene.clone();\n\n\t\t\t\t\taddAssetSceneToControllerModel( controllerModel, scene );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tif ( ! this.gltfLoader ) {\n\n\t\t\t\t\t\tthrow new Error( 'GLTFLoader not set.' );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.gltfLoader.setPath( '' );\n\t\t\t\t\tthis.gltfLoader.load( controllerModel.motionController.assetUrl, ( asset ) => {\n\n\t\t\t\t\t\tthis._assetCache[ controllerModel.motionController.assetUrl ] = asset;\n\n\t\t\t\t\t\tscene = asset.scene.clone();\n\n\t\t\t\t\t\taddAssetSceneToControllerModel( controllerModel, scene );\n\n\t\t\t\t\t},\n\t\t\t\t\tnull,\n\t\t\t\t\t() => {\n\n\t\t\t\t\t\tthrow new Error( `Asset ${controllerModel.motionController.assetUrl} missing or malformed.` );\n\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\n\t\t\t} ).catch( ( err ) => {\n\n\t\t\t\tconsole.warn( err );\n\n\t\t\t} );\n\n\t\t} );\n\n\t\tcontroller.addEventListener( 'disconnected', () => {\n\n\t\t\tcontrollerModel.motionController = null;\n\t\t\tcontrollerModel.remove( scene );\n\t\t\tscene = null;\n\n\t\t} );\n\n\t\treturn controllerModel;\n\n\t}\n\n}\n\nexport { XRControllerModelFactory };\n","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\nimport * as THREE from 'three';\r\nimport { VRButton } from 'three/examples/jsm/webxr/VRButton';\r\nimport { XRControllerModelFactory } from 'three/examples/jsm/webxr/XRControllerModelFactory';\r\nexport default class WebXR {\r\n    constructor(_renderer, _scene, _camera) {\r\n        // https://medium.com/samsung-internet-dev/vr-locomotion-740dafa85914\r\n        this._renderer = _renderer;\r\n        this._scene = _scene;\r\n        this._camera = _camera;\r\n        this.controllerModelFactory = new XRControllerModelFactory();\r\n        // const geo = new THREE.SphereGeometry(0.5)\r\n        // const mat = new THREE.MeshLambertMaterial({ color: 0xff0000 })\r\n        // this.dot = new THREE.Mesh(geo, mat)\r\n        // this.dot.position.set(0, 1, 0)\r\n        this.cameraGroup = new THREE.Group();\r\n        this.cameraGroup.add(_camera);\r\n        _scene.add(this.cameraGroup);\r\n        _renderer.xr.enabled = true;\r\n        // add vr button\r\n        const vrButton = VRButton.createButton(_renderer);\r\n        vrButton.style.cssText += 'background: rgba(0, 0, 0, 0.8); ';\r\n        document.body.appendChild(vrButton);\r\n    }\r\n    get isPresenting() {\r\n        var _a, _b;\r\n        return !!((_b = (_a = this._renderer) === null || _a === void 0 ? void 0 : _a.xr) === null || _b === void 0 ? void 0 : _b.isPresenting);\r\n    }\r\n    getController(id) {\r\n        const controller = this._renderer.xr.getController(id);\r\n        this.cameraGroup.add(controller);\r\n        return controller;\r\n    }\r\n    getControllerGrip(id) {\r\n        const controllerGrip = this._renderer.xr.getControllerGrip(id);\r\n        const model = this.controllerModelFactory.createControllerModel(controllerGrip);\r\n        controllerGrip.add(model);\r\n        this.cameraGroup.add(controllerGrip);\r\n        return controllerGrip;\r\n    }\r\n    getControllerRay(data) {\r\n        // https://github.com/mrdoob/three.js/blob/master/examples/webxr_vr_ballshooter.html\r\n        const { targetRayMode } = data;\r\n        if (targetRayMode === 'tracked-pointer') {\r\n            const geometry = new THREE.BufferGeometry();\r\n            geometry.setAttribute('position', new THREE.Float32BufferAttribute([0, 0, 0, 0, 0, -1], 3));\r\n            geometry.setAttribute('color', new THREE.Float32BufferAttribute([1, 0, 0, 1, 1, 1], 3));\r\n            const material = new THREE.LineBasicMaterial({\r\n                vertexColors: true\r\n            });\r\n            return new THREE.Line(geometry, material);\r\n        }\r\n        if (targetRayMode === 'gaze') {\r\n            const geometry = new THREE.RingBufferGeometry(0.02, 0.04, 32).translate(0, 0, -1);\r\n            const material = new THREE.MeshBasicMaterial({ color: 'red', opacity: 0.5, transparent: true });\r\n            return new THREE.Mesh(geometry, material);\r\n        }\r\n        return;\r\n    }\r\n    get camera() {\r\n        return this.WebXRCamera;\r\n    }\r\n    get WebXRCamera() {\r\n        var _a;\r\n        return {\r\n            group: this.cameraGroup,\r\n            position: (_a = this.cameraGroup) === null || _a === void 0 ? void 0 : _a.position,\r\n            rotation: this.isPresenting ? this._renderer.xr.getCamera(this._camera).rotation : undefined,\r\n            getWorldDirection: (target) => this.isPresenting ? this._renderer.xr.getCamera(this._camera).getWorldDirection(target) : undefined\r\n        };\r\n    }\r\n}\r\n//# sourceMappingURL=webxr.js.map","class VRButton {\n\n\tstatic createButton( renderer, options ) {\n\n\t\tif ( options ) {\n\n\t\t\tconsole.error( 'THREE.VRButton: The \"options\" parameter has been removed. Please set the reference space type via renderer.xr.setReferenceSpaceType() instead.' );\n\n\t\t}\n\n\t\tconst button = document.createElement( 'button' );\n\n\t\tfunction showEnterVR( /*device*/ ) {\n\n\t\t\tlet currentSession = null;\n\n\t\t\tasync function onSessionStarted( session ) {\n\n\t\t\t\tsession.addEventListener( 'end', onSessionEnded );\n\n\t\t\t\tawait renderer.xr.setSession( session );\n\t\t\t\tbutton.textContent = 'EXIT VR';\n\n\t\t\t\tcurrentSession = session;\n\n\t\t\t}\n\n\t\t\tfunction onSessionEnded( /*event*/ ) {\n\n\t\t\t\tcurrentSession.removeEventListener( 'end', onSessionEnded );\n\n\t\t\t\tbutton.textContent = 'ENTER VR';\n\n\t\t\t\tcurrentSession = null;\n\n\t\t\t}\n\n\t\t\t//\n\n\t\t\tbutton.style.display = '';\n\n\t\t\tbutton.style.cursor = 'pointer';\n\t\t\tbutton.style.left = 'calc(50% - 50px)';\n\t\t\tbutton.style.width = '100px';\n\n\t\t\tbutton.textContent = 'ENTER VR';\n\n\t\t\tbutton.onmouseenter = function () {\n\n\t\t\t\tbutton.style.opacity = '1.0';\n\n\t\t\t};\n\n\t\t\tbutton.onmouseleave = function () {\n\n\t\t\t\tbutton.style.opacity = '0.5';\n\n\t\t\t};\n\n\t\t\tbutton.onclick = function () {\n\n\t\t\t\tif ( currentSession === null ) {\n\n\t\t\t\t\t// WebXR's requestReferenceSpace only works if the corresponding feature\n\t\t\t\t\t// was requested at session creation time. For simplicity, just ask for\n\t\t\t\t\t// the interesting ones as optional features, but be aware that the\n\t\t\t\t\t// requestReferenceSpace call will fail if it turns out to be unavailable.\n\t\t\t\t\t// ('local' is always available for immersive sessions and doesn't need to\n\t\t\t\t\t// be requested separately.)\n\n\t\t\t\t\tconst sessionInit = { optionalFeatures: [ 'local-floor', 'bounded-floor', 'hand-tracking', 'layers' ] };\n\t\t\t\t\tnavigator.xr.requestSession( 'immersive-vr', sessionInit ).then( onSessionStarted );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tcurrentSession.end();\n\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t}\n\n\t\tfunction disableButton() {\n\n\t\t\tbutton.style.display = '';\n\n\t\t\tbutton.style.cursor = 'auto';\n\t\t\tbutton.style.left = 'calc(50% - 75px)';\n\t\t\tbutton.style.width = '150px';\n\n\t\t\tbutton.onmouseenter = null;\n\t\t\tbutton.onmouseleave = null;\n\n\t\t\tbutton.onclick = null;\n\n\t\t}\n\n\t\tfunction showWebXRNotFound() {\n\n\t\t\tdisableButton();\n\n\t\t\tbutton.textContent = 'VR NOT SUPPORTED';\n\n\t\t}\n\n\t\tfunction stylizeElement( element ) {\n\n\t\t\telement.style.position = 'absolute';\n\t\t\telement.style.bottom = '20px';\n\t\t\telement.style.padding = '12px 6px';\n\t\t\telement.style.border = '1px solid #fff';\n\t\t\telement.style.borderRadius = '4px';\n\t\t\telement.style.background = 'rgba(0,0,0,0.1)';\n\t\t\telement.style.color = '#fff';\n\t\t\telement.style.font = 'normal 13px sans-serif';\n\t\t\telement.style.textAlign = 'center';\n\t\t\telement.style.opacity = '0.5';\n\t\t\telement.style.outline = 'none';\n\t\t\telement.style.zIndex = '999';\n\n\t\t}\n\n\t\tif ( 'xr' in navigator ) {\n\n\t\t\tbutton.id = 'VRButton';\n\t\t\tbutton.style.display = 'none';\n\n\t\t\tstylizeElement( button );\n\n\t\t\tnavigator.xr.isSessionSupported( 'immersive-vr' ).then( function ( supported ) {\n\n\t\t\t\tsupported ? showEnterVR() : showWebXRNotFound();\n\n\t\t\t} );\n\n\t\t\treturn button;\n\n\t\t} else {\n\n\t\t\tconst message = document.createElement( 'a' );\n\n\t\t\tif ( window.isSecureContext === false ) {\n\n\t\t\t\tmessage.href = document.location.href.replace( /^http:/, 'https:' );\n\t\t\t\tmessage.innerHTML = 'WEBXR NEEDS HTTPS'; // TODO Improve message\n\n\t\t\t} else {\n\n\t\t\t\tmessage.href = 'https://immersiveweb.dev/';\n\t\t\t\tmessage.innerHTML = 'WEBXR NOT AVAILABLE';\n\n\t\t\t}\n\n\t\t\tmessage.style.left = 'calc(50% - 90px)';\n\t\t\tmessage.style.width = '180px';\n\t\t\tmessage.style.textDecoration = 'none';\n\n\t\t\tstylizeElement( message );\n\n\t\t\treturn message;\n\n\t\t}\n\n\t}\n\n}\n\nexport { VRButton };\n","import { Color, Vector3 } from 'three';\r\nclass Face3 {\r\n    constructor(a, b, c, normal, color, materialIndex = 0) {\r\n        this.a = a;\r\n        this.b = b;\r\n        this.c = c;\r\n        this.normal = normal && normal.isVector3 ? normal : new Vector3();\r\n        this.vertexNormals = Array.isArray(normal) ? normal : [];\r\n        this.color = color && color.isColor ? color : new Color();\r\n        this.vertexColors = Array.isArray(color) ? color : [];\r\n        this.materialIndex = materialIndex;\r\n    }\r\n    clone() {\r\n        // @ts-ignore\r\n        return new this.constructor().copy(this);\r\n    }\r\n    copy(source) {\r\n        this.a = source.a;\r\n        this.b = source.b;\r\n        this.c = source.c;\r\n        this.normal.copy(source.normal);\r\n        this.color.copy(source.color);\r\n        this.materialIndex = source.materialIndex;\r\n        for (let i = 0, il = source.vertexNormals.length; i < il; i++) {\r\n            this.vertexNormals[i] = source.vertexNormals[i].clone();\r\n        }\r\n        for (let i = 0, il = source.vertexColors.length; i < il; i++) {\r\n            this.vertexColors[i] = source.vertexColors[i].clone();\r\n        }\r\n        return this;\r\n    }\r\n}\r\nexport { Face3 };\r\n//# sourceMappingURL=face3.js.map","/* eslint-disable no-case-declarations */\r\n/* eslint-disable constructor-super */\r\n/* eslint-disable no-this-before-super */\r\n/**\r\n * @author       Evan Wallace (http://madebyevan.com/))\r\n * @copyright    Copyright (c) 2011 Evan Wallace\r\n * @license      MIT license\r\n *\r\n * @author       manthrax (https://github.com/manthrax)\r\n *\r\n * @author       Jiro-Digital (https://github.com/Jiro-Digital)\r\n * @copyright    Copyright (c) 2020 Jiro Digital Ltd\r\n * @license      {@link https://github.com/Jiro-Digital/three-csg-ts/blob/master/LICENSE|MIT}\r\n *\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\n// TODO(yandeu) Replace this CSG lib with one that works natively with Buffer Geometries.\r\n// Originally copied from https://github.com/Hi-Level/three-csg (now https://github.com/Jiro-Digital/three-csg-ts)\r\n// which is a typescript rewrite of https://github.com/manthrax/THREE-CSGMesh\r\n// which as originally written by Copyright (c) 2011 Evan Wallace (http://madebyevan.com/), under the MIT license.\r\nimport { Geometry } from 'three/examples/jsm/deprecated/Geometry';\r\nimport { Face3 } from '@enable3d/three-wrapper/dist/deprecated/face3';\r\nimport { Matrix3, Matrix4, Mesh, REVISION, Vector3 } from 'three';\r\nimport Transform from '../plugins/transform';\r\n/**\r\n * CSG wrapper for enable3d\r\n *\r\n * The CSG library does not support buffer geometries.\r\n * Means we first make sure we are dealing with geometries\r\n * and then transform them back to buffer geometries.\r\n */\r\nclass CSGWrapper {\r\n    static toGeometry(meshA, meshB) {\r\n        meshA.geometry = Transform.bufferGeometryToGeometry(meshA.geometry);\r\n        meshB.geometry = Transform.bufferGeometryToGeometry(meshB.geometry);\r\n    }\r\n    static toBufferGeometry(meshC) {\r\n        meshC.geometry = Transform.geometryToBufferGeometry(meshC.geometry);\r\n    }\r\n    static union(meshA, meshB) {\r\n        this.toGeometry(meshA, meshB);\r\n        const meshC = this.doCSG(meshA, meshB, 'union');\r\n        this.toBufferGeometry(meshC);\r\n        return meshC;\r\n    }\r\n    static subtract(meshA, meshB) {\r\n        this.toGeometry(meshA, meshB);\r\n        const meshC = this.doCSG(meshA, meshB, 'subtract');\r\n        this.toBufferGeometry(meshC);\r\n        return meshC;\r\n    }\r\n    static intersect(meshA, meshB) {\r\n        this.toGeometry(meshA, meshB);\r\n        const meshC = this.doCSG(meshA, meshB, 'intersect');\r\n        this.toBufferGeometry(meshC);\r\n        return meshC;\r\n    }\r\n    static doCSG(meshA, meshB, operation) {\r\n        meshA.updateMatrix();\r\n        meshB.updateMatrix();\r\n        const bspA = CSG.fromMesh(meshA);\r\n        const bspB = CSG.fromMesh(meshB);\r\n        const bspC = bspA[operation](bspB);\r\n        const result = CSG.toMesh(bspC, meshA.matrix);\r\n        return result;\r\n    }\r\n}\r\nexport { CSGWrapper as CSG };\r\n/**\r\n * CSG (Constructive Solid Geometry) library for three.js with Typescript support.\r\n * Holds a binary space partition tree representing a 3D solid. Two solids can\r\n * be combined using the `union()`, `subtract()`, and `intersect()` methods.\r\n */\r\nclass CSG {\r\n    constructor() {\r\n        this.polygons = [];\r\n    }\r\n    static fromPolygons(polygons) {\r\n        const csg = new CSG();\r\n        csg.polygons = polygons;\r\n        return csg;\r\n    }\r\n    static fromGeometry(geom) {\r\n        if (geom.isBufferGeometry) {\r\n            geom = new Geometry().fromBufferGeometry(geom);\r\n        }\r\n        const fs = geom.faces;\r\n        const vs = geom.vertices;\r\n        const polys = [];\r\n        const fm = ['a', 'b', 'c'];\r\n        for (let i = 0; i < fs.length; i++) {\r\n            const f = fs[i];\r\n            const vertices = [];\r\n            for (let j = 0; j < 3; j++) {\r\n                const uvs = geom.faceVertexUvs[0][i] !== undefined && geom.faceVertexUvs[0][i][j] !== undefined\r\n                    ? geom.faceVertexUvs[0][i][j]\r\n                    : undefined;\r\n                vertices.push(new Vertex(vs[f[fm[j]]], f.vertexNormals[j], uvs));\r\n            }\r\n            polys.push(new Polygon(vertices));\r\n        }\r\n        return CSG.fromPolygons(polys);\r\n    }\r\n    static fromMesh(mesh) {\r\n        const csg = CSG.fromGeometry(mesh.geometry);\r\n        CSG._tmpm3.getNormalMatrix(mesh.matrix);\r\n        for (const p of csg.polygons) {\r\n            for (const v of p.vertices) {\r\n                v.pos.applyMatrix4(mesh.matrix);\r\n                v.normal.applyMatrix3(CSG._tmpm3);\r\n            }\r\n        }\r\n        return csg;\r\n    }\r\n    static toMesh(csg, toMatrix) {\r\n        const geom = new Geometry();\r\n        const ps = csg.polygons;\r\n        const vs = geom.vertices;\r\n        const fvuv = geom.faceVertexUvs[0];\r\n        for (const p of ps) {\r\n            const pvs = p.vertices;\r\n            const v0 = vs.length;\r\n            const pvlen = pvs.length;\r\n            for (const pv of pvs) {\r\n                vs.push(new Vector3().copy(pv.pos));\r\n            }\r\n            for (let j = 3; j <= pvlen; j++) {\r\n                const fc = new Face3(v0, v0 + j - 2, v0 + j - 1);\r\n                const fuv = [];\r\n                fvuv.push(fuv);\r\n                const fnml = fc.vertexNormals;\r\n                fnml.push(new Vector3().copy(pvs[0].normal));\r\n                fnml.push(new Vector3().copy(pvs[j - 2].normal));\r\n                fnml.push(new Vector3().copy(pvs[j - 1].normal));\r\n                // check for uv property\r\n                if (pvs[0].uv && pvs[j - 2].uv && pvs[j - 1].uv) {\r\n                    fuv.push(new Vector3().copy(pvs[0].uv));\r\n                    fuv.push(new Vector3().copy(pvs[j - 2].uv));\r\n                    fuv.push(new Vector3().copy(pvs[j - 1].uv));\r\n                }\r\n                fc.normal = new Vector3().copy(p.plane.normal);\r\n                geom.faces.push(fc);\r\n            }\r\n        }\r\n        // compatibility fix for three.js >= r123 (Dezember 2020)\r\n        const inv = \r\n        // @ts-ignore\r\n        parseInt(REVISION) >= 123\r\n            ? new Matrix4().copy(toMatrix).invert()\r\n            : new Matrix4().getInverse(toMatrix);\r\n        geom.applyMatrix4(inv);\r\n        geom.verticesNeedUpdate = geom.elementsNeedUpdate = geom.normalsNeedUpdate = true;\r\n        geom.computeBoundingSphere();\r\n        geom.computeBoundingBox();\r\n        // @ts-expect-error\r\n        const m = new Mesh(geom);\r\n        m.matrix.copy(toMatrix);\r\n        m.matrix.decompose(m.position, m.rotation, m.scale);\r\n        m.updateMatrixWorld();\r\n        return m;\r\n    }\r\n    static iEval(tokens, _index = 0) {\r\n        var _a;\r\n        if (typeof tokens === 'string') {\r\n            CSG.currentOp = tokens;\r\n        }\r\n        else if (tokens instanceof Array) {\r\n            for (const token of tokens) {\r\n                CSG.iEval(token, 0);\r\n            }\r\n        }\r\n        else if (typeof tokens === 'object') {\r\n            const op = CSG.currentOp;\r\n            tokens.updateMatrix();\r\n            tokens.updateMatrixWorld();\r\n            if (!CSG.sourceMesh) {\r\n                CSG.currentPrim = CSG.fromMesh((CSG.sourceMesh = tokens));\r\n            }\r\n            else {\r\n                CSG.nextPrim = CSG.fromMesh(tokens);\r\n                CSG.currentPrim = CSG.currentPrim[op](CSG.nextPrim);\r\n            }\r\n            if (CSG.doRemove)\r\n                (_a = tokens === null || tokens === void 0 ? void 0 : tokens.parent) === null || _a === void 0 ? void 0 : _a.remove(tokens);\r\n        } // union,subtract,intersect,inverse\r\n    }\r\n    static eval(tokens, doRemove) {\r\n        // [['add',mesh,mesh,mesh,mesh],['sub',mesh,mesh,mesh,mesh]]\r\n        // @ts-ignore\r\n        delete CSG.currentOp;\r\n        // @ts-ignore\r\n        delete CSG.sourceMesh;\r\n        CSG.doRemove = doRemove;\r\n        CSG.iEval(tokens);\r\n        const result = CSG.toMesh(CSG.currentPrim, CSG.sourceMesh.matrix);\r\n        result.material = CSG.sourceMesh.material;\r\n        result.castShadow = result.receiveShadow = true;\r\n        return result;\r\n    }\r\n    clone() {\r\n        const csg = new CSG();\r\n        csg.polygons = this.polygons.map(p => {\r\n            return p.clone();\r\n        });\r\n        return csg;\r\n    }\r\n    toPolygons() {\r\n        return this.polygons;\r\n    }\r\n    union(csg) {\r\n        const a = new Node(this.clone().polygons);\r\n        const b = new Node(csg.clone().polygons);\r\n        a.clipTo(b);\r\n        b.clipTo(a);\r\n        b.invert();\r\n        b.clipTo(a);\r\n        b.invert();\r\n        a.build(b.allPolygons());\r\n        return CSG.fromPolygons(a.allPolygons());\r\n    }\r\n    subtract(csg) {\r\n        const a = new Node(this.clone().polygons);\r\n        const b = new Node(csg.clone().polygons);\r\n        a.invert();\r\n        a.clipTo(b);\r\n        b.clipTo(a);\r\n        b.invert();\r\n        b.clipTo(a);\r\n        b.invert();\r\n        a.build(b.allPolygons());\r\n        a.invert();\r\n        return CSG.fromPolygons(a.allPolygons());\r\n    }\r\n    intersect(csg) {\r\n        const a = new Node(this.clone().polygons);\r\n        const b = new Node(csg.clone().polygons);\r\n        a.invert();\r\n        b.clipTo(a);\r\n        b.invert();\r\n        a.clipTo(b);\r\n        b.clipTo(a);\r\n        a.build(b.allPolygons());\r\n        a.invert();\r\n        return CSG.fromPolygons(a.allPolygons());\r\n    }\r\n    inverse() {\r\n        const csg = this.clone();\r\n        csg.polygons.map(p => {\r\n            p.flip();\r\n        });\r\n        return csg;\r\n    }\r\n}\r\nCSG._tmpm3 = new Matrix3();\r\n/**\r\n * Represents a 3D vector.\r\n */\r\nclass Vector extends Vector3 {\r\n    constructor(x, y, z) {\r\n        if (arguments.length === 3) {\r\n            super(x, y, z);\r\n        }\r\n        else if (Array.isArray(x)) {\r\n            super(x[0], x[1], x[2]);\r\n        }\r\n        else if (typeof x === 'object') {\r\n            // @ts-ignore\r\n            this.copy(x);\r\n        }\r\n        else {\r\n            throw new Error('Invalid constructor to vector');\r\n        }\r\n    }\r\n    clone() {\r\n        return new Vector(this.x, this.y, this.z);\r\n    }\r\n    negated() {\r\n        return this.clone().multiplyScalar(-1);\r\n    }\r\n    plus(a) {\r\n        return this.clone().add(a);\r\n    }\r\n    minus(a) {\r\n        return this.clone().sub(a);\r\n    }\r\n    times(a) {\r\n        return this.clone().multiplyScalar(a);\r\n    }\r\n    dividedBy(a) {\r\n        return this.clone().divideScalar(a);\r\n    }\r\n    lerp(a, t) {\r\n        return this.plus(a.minus(this).times(t));\r\n    }\r\n    unit() {\r\n        return this.dividedBy(this.length());\r\n    }\r\n    // @ts-ignore\r\n    cross(a, w) {\r\n        return Vector3.prototype.cross.call(this.clone(), a);\r\n    }\r\n}\r\n/**\r\n * Represents a vertex of a polygon. Use your own vertex class instead of this\r\n * one to provide additional features like texture coordinates and vertex\r\n * colors. Custom vertex classes need to provide a `pos` property and `clone()`,\r\n * `flip()`, and `interpolate()` methods that behave analogous to the ones\r\n * defined by `CSG.Vertex`. This class provides `normal` so convenience\r\n * functions like `CSG.sphere()` can return a smooth vertex normal, but `normal`\r\n * is not used anywhere else.\r\n */\r\nclass Vertex {\r\n    constructor(pos, normal, uv) {\r\n        this.pos = new Vector(pos.x, pos.y, pos.z);\r\n        this.normal = new Vector(normal.x, normal.y, normal.z);\r\n        if (uv)\r\n            this.uv = new Vector(uv.x, uv.y, uv.z);\r\n    }\r\n    clone() {\r\n        return new Vertex(this.pos.clone(), this.normal.clone(), this.uv ? this.uv.clone() : undefined);\r\n    }\r\n    // Invert all orientation-specific data (e.g. vertex normal). Called when the\r\n    // orientation of a polygon is flipped.\r\n    flip() {\r\n        this.normal = this.normal.negated();\r\n    }\r\n    // Create a new vertex between this vertex and `other` by linearly\r\n    // interpolating all properties using a parameter of `t`. Subclasses should\r\n    // override this to interpolate additional properties.\r\n    interpolate(other, t) {\r\n        return new Vertex(this.pos.lerp(other.pos, t), this.normal.lerp(other.normal, t), this.uv ? this.uv.lerp(other.uv, t) : undefined);\r\n    }\r\n}\r\n/**\r\n * Represents a plane in 3D space.\r\n */\r\nclass Plane {\r\n    constructor(normal, w) {\r\n        this.normal = normal;\r\n        this.w = w;\r\n    }\r\n    static fromPoints(a, b, c) {\r\n        const n = b\r\n            .minus(a)\r\n            .cross(c.minus(a))\r\n            // @ts-ignore\r\n            .unit();\r\n        return new Plane(n, n.dot(a));\r\n    }\r\n    clone() {\r\n        return new Plane(this.normal.clone(), this.w);\r\n    }\r\n    flip() {\r\n        this.normal = this.normal.negated();\r\n        this.w = -this.w;\r\n    }\r\n    // Split `polygon` by this plane if needed, then put the polygon or polygon\r\n    // fragments in the appropriate lists. Coplanar polygons go into either\r\n    // `coplanarFront` or `coplanarBack` depending on their orientation with\r\n    // respect to this plane. Polygons in front or in back of this plane go into\r\n    // either `front` or `back`.\r\n    splitPolygon(polygon, coplanarFront, coplanarBack, front, back) {\r\n        const COPLANAR = 0;\r\n        const FRONT = 1;\r\n        const BACK = 2;\r\n        const SPANNING = 3;\r\n        // Classify each point as well as the entire polygon into one of the above\r\n        // four classes.\r\n        let polygonType = 0;\r\n        const types = [];\r\n        for (const vertex of polygon.vertices) {\r\n            const t = this.normal.dot(vertex.pos) - this.w;\r\n            const type = t < -Plane.EPSILON ? BACK : t > Plane.EPSILON ? FRONT : COPLANAR;\r\n            polygonType |= type;\r\n            types.push(type);\r\n        }\r\n        // Put the polygon in the correct list, splitting it when necessary.\r\n        switch (polygonType) {\r\n            case COPLANAR:\r\n                if (this.normal.dot(polygon.plane.normal) > 0)\r\n                    coplanarFront.push(polygon);\r\n                else\r\n                    coplanarBack.push(polygon);\r\n                break;\r\n            case FRONT:\r\n                front.push(polygon);\r\n                break;\r\n            case BACK:\r\n                back.push(polygon);\r\n                break;\r\n            case SPANNING:\r\n                const f = [];\r\n                const b = [];\r\n                for (let i = 0; i < polygon.vertices.length; i++) {\r\n                    const j = (i + 1) % polygon.vertices.length;\r\n                    const ti = types[i];\r\n                    const tj = types[j];\r\n                    const vi = polygon.vertices[i];\r\n                    const vj = polygon.vertices[j];\r\n                    if (ti !== BACK) {\r\n                        f.push(vi);\r\n                    }\r\n                    if (ti !== FRONT) {\r\n                        b.push(ti !== BACK ? vi.clone() : vi);\r\n                    }\r\n                    if ((ti | tj) === SPANNING) {\r\n                        const t = (this.w - this.normal.dot(vi.pos)) / this.normal.dot(vj.pos.minus(vi.pos));\r\n                        const v = vi.interpolate(vj, t);\r\n                        f.push(v);\r\n                        b.push(v.clone());\r\n                    }\r\n                }\r\n                if (f.length >= 3) {\r\n                    front.push(new Polygon(f, polygon.shared));\r\n                }\r\n                if (b.length >= 3) {\r\n                    back.push(new Polygon(b, polygon.shared));\r\n                }\r\n                break;\r\n        }\r\n    }\r\n}\r\n// the tolerance used by `splitPolygon()` to decide if a\r\n// point is on the plane.\r\nPlane.EPSILON = 1e-5;\r\n/**\r\n * Represents a convex polygon. The vertices used to initialize a polygon must\r\n * be coplanar and form a convex loop. They do not have to be `Vertex`\r\n * instances but they must behave similarly (duck typing can be used for\r\n * customization).\r\n *\r\n * Each convex polygon has a `shared` property, which is shared between all\r\n * polygons that are clones of each other or were split from the same polygon.\r\n * This can be used to define per-polygon properties (such as surface color).\r\n */\r\nclass Polygon {\r\n    constructor(vertices, shared = null) {\r\n        this.vertices = vertices;\r\n        this.shared = shared;\r\n        this.plane = Plane.fromPoints(vertices[0].pos, vertices[1].pos, vertices[2].pos);\r\n    }\r\n    clone() {\r\n        const vertices = this.vertices.map(v => {\r\n            return v.clone();\r\n        });\r\n        return new Polygon(vertices, this.shared);\r\n    }\r\n    flip() {\r\n        this.vertices.reverse().map(v => {\r\n            v.flip();\r\n        });\r\n        this.plane.flip();\r\n    }\r\n}\r\n/**\r\n * Holds a node in a BSP tree. A BSP tree is built from a collection of polygons\r\n * by picking a polygon to split along. That polygon (and all other coplanar\r\n * polygons) are added directly to that node and the other polygons are added to\r\n * the front and/or back subtrees. This is not a leafy BSP tree since there is\r\n * no distinction between internal and leaf nodes.\r\n */\r\nclass Node {\r\n    constructor(polygons) {\r\n        // @ts-ignore\r\n        delete this.plane;\r\n        // @ts-ignore\r\n        delete this.front;\r\n        // @ts-ignore\r\n        delete this.back;\r\n        this.polygons = [];\r\n        if (polygons) {\r\n            this.build(polygons);\r\n        }\r\n    }\r\n    clone() {\r\n        const node = new Node();\r\n        node.plane = this.plane && this.plane.clone();\r\n        node.front = this.front && this.front.clone();\r\n        node.back = this.back && this.back.clone();\r\n        node.polygons = this.polygons.map(p => {\r\n            return p.clone();\r\n        });\r\n        return node;\r\n    }\r\n    // Convert solid space to empty space and empty space to solid space.\r\n    invert() {\r\n        for (const polygon of this.polygons) {\r\n            polygon.flip();\r\n        }\r\n        this.plane.flip();\r\n        if (this.front) {\r\n            this.front.invert();\r\n        }\r\n        if (this.back) {\r\n            this.back.invert();\r\n        }\r\n        const temp = this.front;\r\n        this.front = this.back;\r\n        this.back = temp;\r\n    }\r\n    // Recursively remove all polygons in `polygons` that are inside this BSP\r\n    // tree.\r\n    clipPolygons(polygons) {\r\n        if (!this.plane) {\r\n            return polygons.slice();\r\n        }\r\n        let front = [];\r\n        let back = [];\r\n        for (const polygon of polygons) {\r\n            this.plane.splitPolygon(polygon, front, back, front, back);\r\n        }\r\n        if (this.front) {\r\n            front = this.front.clipPolygons(front);\r\n        }\r\n        back = this.back ? this.back.clipPolygons(back) : [];\r\n        return front.concat(back);\r\n    }\r\n    // Remove all polygons in this BSP tree that are inside the other BSP tree\r\n    // `bsp`.\r\n    clipTo(bsp) {\r\n        this.polygons = bsp.clipPolygons(this.polygons);\r\n        if (this.front) {\r\n            this.front.clipTo(bsp);\r\n        }\r\n        if (this.back) {\r\n            this.back.clipTo(bsp);\r\n        }\r\n    }\r\n    // Return a list of all polygons in this BSP tree.\r\n    allPolygons() {\r\n        let polygons = this.polygons.slice();\r\n        if (this.front) {\r\n            polygons = polygons.concat(this.front.allPolygons());\r\n        }\r\n        if (this.back) {\r\n            polygons = polygons.concat(this.back.allPolygons());\r\n        }\r\n        return polygons;\r\n    }\r\n    // Build a BSP tree out of `polygons`. When called on an existing tree, the\r\n    // new polygons are filtered down to the bottom of the tree and become new\r\n    // nodes there. Each set of polygons is partitioned using the first polygon\r\n    // (no heuristic is used to pick a good split).\r\n    build(polygons) {\r\n        if (!polygons.length) {\r\n            return;\r\n        }\r\n        if (!this.plane) {\r\n            this.plane = polygons[0].plane.clone();\r\n        }\r\n        const front = [];\r\n        const back = [];\r\n        for (const polygon of polygons) {\r\n            this.plane.splitPolygon(polygon, this.polygons, this.polygons, front, back);\r\n        }\r\n        if (front.length) {\r\n            if (!this.front) {\r\n                this.front = new Node();\r\n            }\r\n            this.front.build(front);\r\n        }\r\n        if (back.length) {\r\n            if (!this.back) {\r\n                this.back = new Node();\r\n            }\r\n            this.back.build(back);\r\n        }\r\n    }\r\n}\r\n//# sourceMappingURL=index.js.map","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\n\r\nimport Third from './third'\r\nimport * as Phaser from 'phaser'\r\nimport { ThreeGraphicsConfig } from '@enable3d/common/dist/types'\r\nimport { WarpedStartFeatures } from '@enable3d/three-graphics/jsm/plugins'\r\nimport { Color } from 'three'\r\nimport { logger } from '@enable3d/common/dist/logger'\r\n\r\nexport class Scene3D extends Phaser.Scene {\r\n  constructor(config: string | Phaser.Types.Scenes.SettingsConfig) {\r\n    super(config)\r\n  }\r\n\r\n  /** Access the Third Dimension */\r\n  public third: Third\r\n\r\n  /**\r\n   * It takes took long to setup the third dimension your self? Get started with warp speed by using this function.\r\n   * @param features Pass the features you want to setup.\r\n   */\r\n  public async warpSpeesd(...features: WarpedStartFeatures[]) {\r\n    return await this.third.warpSpeed(...features)\r\n  }\r\n\r\n  public haveSomeFun(numberOfElements: number = 20) {\r\n    this.third.haveSomeFun(numberOfElements)\r\n  }\r\n\r\n  /** Place this in the init() function */\r\n  public requestThirdDimension() {\r\n    logger('You do not need requestThirdDimension() anymore. Place accessThirdDimension() inside init() instead!')\r\n  }\r\n\r\n  public clearThirdDimension() {\r\n    // @ts-ignore\r\n    for (const key in this.third) delete this.third[key]\r\n    // @ts-ignore\r\n    delete this.third\r\n  }\r\n\r\n  /** Place this in the init() function */\r\n  public accessThirdDimension(config: ThreeGraphicsConfig = {}) {\r\n    this.clearThirdDimension()\r\n\r\n    // create new third\r\n    this.third = new Third(this, config)\r\n\r\n    // set phaser background color to white\r\n    // this.cameras.main.setBackgroundColor(0xffffff)\r\n\r\n    // set phaser background color to transparent\r\n    this.cameras.main.transparent = true\r\n    this.cameras.main.setBackgroundColor('rgba(0,0,0,0)')\r\n\r\n    // set three.js background color to white\r\n    this.third.scene.background = new Color('white')\r\n  }\r\n\r\n  /** Combines the 3 XR update methods */\r\n  public updateLoopXR(time: number, delta: number) {\r\n    this.preUpdateXR(time, delta)\r\n    this.updateXR(time, delta)\r\n    this.postUpdateXR(time, delta)\r\n  }\r\n\r\n  /** Pre-Update the WebXR */\r\n  private preUpdateXR(_time: number, _delta: number) {}\r\n\r\n  /** Update the WebXR. Use this to update your game loop in XR mode instead the normal update method provided by phaser.\r\n   * It will overwrite the default Phaser clock and do some other things behind the scene for you. (The Phaser update loop will not run in WebXR mode!)\r\n   */\r\n  public updateXR(_time: number, _delta: number) {}\r\n\r\n  /** Post-Update the WebXR */\r\n  private postUpdateXR(_time: number, _delta: number) {\r\n    if (this.third.isXrEnabled) {\r\n      // overwrite the default phaser clock\r\n      this.time.update(_time, _delta)\r\n      // manually update the physics\r\n      this.third.physics.update(_delta)\r\n      // manually update physics debugger\r\n      this.third.physics.updateDebugger()\r\n      // manually update the mixers\r\n      this.third.animationMixers.update(_delta)\r\n    }\r\n  }\r\n}\r\n","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\n\r\nimport { ThreeGraphics } from '@enable3d/three-graphics/jsm'\r\nimport { ExtendedMesh, ExtendedObject3D, ThreeGraphicsConfig } from '@enable3d/common/dist/types'\r\nimport { Scene3D } from './scene3d'\r\n\r\nimport * as Plugins from '@enable3d/three-graphics/jsm/plugins'\r\nimport { EffectComposer } from 'three/examples/jsm/postprocessing/EffectComposer.js'\r\nimport { WebGLRenderer } from 'three'\r\nimport { CSG } from '@enable3d/three-graphics/jsm/csg'\r\n\r\n/**\r\n * The phaser wrapper for ThreeGraphics, which is a separate module\r\n */\r\nclass Third extends ThreeGraphics {\r\n  public scene3D: Scene3D\r\n  public isXrEnabled: boolean\r\n  public composer: EffectComposer\r\n  // public camera: THREE.PerspectiveCamera | THREE.OrthographicCamera,\r\n\r\n  // plugins\r\n  public load: Plugins.Loaders\r\n  public lights: Plugins.Lights\r\n  public transform: Plugins.Transform\r\n  public heightMap: Plugins.HeightMap\r\n  public webXR: Plugins.WebXR\r\n  public misc: Plugins.Misc\r\n  public cameras: Plugins.Cameras\r\n\r\n  public csg: typeof CSG\r\n\r\n  private factories: Plugins.Factories\r\n  private ws: Plugins.WarpSpeed\r\n  private mixers: Plugins.Mixers\r\n\r\n  /**\r\n   * Start Phaser3D\r\n   * @param scene Add the current Phaser Scene\r\n   * @param config Phaser3D Config\r\n   */\r\n  constructor(scene3D: Scene3D, config: ThreeGraphicsConfig = {}) {\r\n    const canvas = document.getElementById('enable3d-three-canvas')\r\n    let options = {}\r\n    if (canvas)\r\n      options = {\r\n        canvas: canvas\r\n      }\r\n\r\n    // add a custom renderer to ThreeGraphics\r\n    config.renderer = new WebGLRenderer({ ...options, antialias: config.antialias || false })\r\n\r\n    super(config)\r\n\r\n    scene3D.sys.game.canvas.parentElement?.insertBefore(config.renderer.domElement, scene3D.sys.game.canvas)\r\n    scene3D.sys.game.canvas.style.position = 'relative'\r\n\r\n    const resize = () => {\r\n      if (!config.renderer) return\r\n\r\n      const { width, height, marginLeft, marginTop } = scene3D.sys.game.canvas.style\r\n\r\n      config.renderer.domElement.id = 'enable3d-three-canvas'\r\n\r\n      // @ts-ignore\r\n      this.camera?.aspect = scene3D.sys.game.scale.baseSize.width / scene3D.sys.game.scale.baseSize.height\r\n      this.camera?.updateProjectionMatrix()\r\n\r\n      config.renderer.setSize(scene3D.sys.game.scale.baseSize.width, scene3D.sys.game.scale.baseSize.height)\r\n\r\n      config.renderer.domElement.style.width = width\r\n      config.renderer.domElement.style.height = height\r\n      config.renderer.domElement.style.marginLeft = marginLeft\r\n      config.renderer.domElement.style.marginTop = marginTop\r\n    }\r\n\r\n    resize()\r\n\r\n    scene3D.scale.on('resize', () => {\r\n      resize()\r\n    })\r\n\r\n    const style = document.createElement('style')\r\n    style.innerText = `\r\n      #enable3d-phaser-canvas:focus,\r\n      #enable3d-three-canvas:focus {\r\n        outline: none;\r\n      }\r\n\r\n      #enable3d-three-canvas {\r\n        position: absolute;\r\n      }\r\n    `\r\n    document.head.appendChild(style)\r\n\r\n    const { enableXR = false } = config\r\n    this.isXrEnabled = enableXR\r\n\r\n    //  We don't want three.js to wipe our gl context!\r\n    // this.renderer.autoClear = false\r\n\r\n    this.scene3D = scene3D\r\n\r\n    // load xr plugin\r\n    if (enableXR) {\r\n      this.webXR = new Plugins.WebXR(this.renderer, this.scene, this.camera)\r\n    }\r\n\r\n    // xr renderer\r\n    if (this.isXrEnabled) {\r\n      let lastTime = 0\r\n      this.renderer.setAnimationLoop((time: number) => {\r\n        if (this.renderer.xr.isPresenting) {\r\n          const delta = time - lastTime\r\n          lastTime = time\r\n\r\n          scene3D.updateLoopXR(time, delta)\r\n          this.renderer.state.reset()\r\n\r\n          this.preRender()\r\n          if (this.composer) this.composer.render()\r\n          else this.renderer.render(this.scene, this.camera)\r\n          this.postRender()\r\n        }\r\n      })\r\n    }\r\n\r\n    const view = scene3D.add.extern()\r\n    // @ts-ignore\r\n    view.render = (_renderer: WebGLRenderer) => {\r\n      if (!this.renderer.xr.isPresenting) {\r\n        // scene3D.updateLoopXR(scene3D.sys.game.loop.time, scene3D.sys.game.loop.delta)\r\n        // this.renderer.state.reset()\r\n        this.preRender()\r\n        if (this.composer) this.composer.render()\r\n        else this.renderer.render(this.scene, this.camera)\r\n        this.postRender()\r\n      }\r\n    }\r\n\r\n    // if (!this.isXrEnabled) {\r\n    scene3D.events.on('postupdate', (_time: number, delta: number) => {\r\n      this.animationMixers?.update(delta)\r\n      this.physics?.update(delta)\r\n      this.physics?.updateDebugger()\r\n    })\r\n    // }\r\n\r\n    // plugins\r\n    this.load = new Plugins.Loaders(this.cache, this.textureAnisotropy)\r\n    this.lights = new Plugins.Lights(this.scene)\r\n    this.transform = new Plugins.Transform(this.camera, this.renderer)\r\n    this.csg = CSG\r\n    this.heightMap = new Plugins.HeightMap(this.scene)\r\n    this.factories = new Plugins.Factories(this.scene)\r\n    this.misc = new Plugins.Misc(this.scene, this.renderer, this.factories)\r\n    this.cameras = new Plugins.Cameras()\r\n    this.ws = new Plugins.WarpSpeed(\r\n      this.scene,\r\n      this.renderer,\r\n      this.camera,\r\n      this.lights,\r\n      this.physics,\r\n      this.load,\r\n      this.factories\r\n    )\r\n    this.mixers = new Plugins.Mixers()\r\n\r\n    // remove the update event which is used by ThreeGraphics.ts and AmmoPhysics.ts\r\n    scene3D.events.once('shutdown', () => {\r\n      // view.destroy(true)\r\n      // this.renderer.dispose()\r\n      // this.renderer.domElement.remove()\r\n      scene3D.clearThirdDimension()\r\n      scene3D.events.removeListener('update')\r\n    })\r\n  }\r\n\r\n  /** Will be called before THREE.WebGLRenderer.render() */\r\n  public preRender() {}\r\n  /** Will be called after THREE.WebGLRenderer.render() */\r\n  public postRender() {}\r\n\r\n  /** Destroys a object and its body. */\r\n  public destroy(obj: ExtendedObject3D | ExtendedMesh) {\r\n    this.physics?.destroy(obj.body)\r\n    this.scene.remove(obj)\r\n    // @ts-ignore\r\n    obj = null\r\n  }\r\n  public async warpSpeed(...features: Plugins.WarpedStartFeatures[]) {\r\n    return await this.ws.warpSpeed(...features)\r\n  }\r\n  public haveSomeFun(numberOfElements: number = 20) {\r\n    Plugins.HaveSomeFun(numberOfElements, this.physics)\r\n  }\r\n  public get animationMixers() {\r\n    return this.mixers?.mixers\r\n  }\r\n  public get make() {\r\n    return this.factories.make\r\n  }\r\n  public get add() {\r\n    return this.factories.add\r\n  }\r\n}\r\n\r\nexport default Third\r\n","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\nimport * as THREE from 'three';\r\nimport Cameras from './plugins/cameras';\r\nimport { AmmoPhysics } from '@enable3d/ammo-physics/dist/index';\r\nimport { logger } from '@enable3d/common/dist/logger';\r\nexport class ThreeGraphics {\r\n    constructor(threeGraphicsConfig = {}) {\r\n        this.threeGraphicsConfig = threeGraphicsConfig;\r\n        const { alpha = false, anisotropy = 1, camera = Cameras.Perspective({ z: 25, y: 5 }), antialias = false, usePhysics = true, renderer } = threeGraphicsConfig;\r\n        this.textureAnisotropy = anisotropy;\r\n        this.camera = camera;\r\n        this.scene = new THREE.Scene();\r\n        // this.renderer.physicallyCorrectLights = true\r\n        this.renderer = renderer || new THREE.WebGLRenderer({ antialias, alpha });\r\n        // see https://threejs.org/docs/#examples/en/loaders/GLTFLoader\r\n        // this.renderer.outputEncoding = sRGBEncoding\r\n        // shadow\r\n        this.renderer.shadowMap.enabled = true;\r\n        this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;\r\n        // enable cache\r\n        this.cache = THREE.Cache;\r\n        this.cache.enabled = true;\r\n        if (usePhysics) {\r\n            if (typeof Ammo !== 'undefined')\r\n                this.physics = new AmmoPhysics(this.scene, threeGraphicsConfig);\r\n            else\r\n                logger('Are you sure you included ammo.js?');\r\n        }\r\n    }\r\n}\r\n//# sourceMappingURL=core.js.map","import { AnimationMixer } from 'three';\r\nclass Mixers {\r\n    constructor() {\r\n        this._mixers = [];\r\n    }\r\n    /**\r\n     * Create an Animation Mixer and ads it to the mixers array\r\n     */\r\n    animationMixer(root) {\r\n        const mixer = new AnimationMixer(root);\r\n        this.mixers.add(mixer);\r\n        return mixer;\r\n    }\r\n    get mixers() {\r\n        return {\r\n            create: (root) => this.animationMixer(root),\r\n            add: (animationMixer) => this._mixers.push(animationMixer),\r\n            get: () => this._mixers,\r\n            update: (delta) => { var _a; return (_a = this._mixers) === null || _a === void 0 ? void 0 : _a.forEach(mixer => mixer.update(delta / 1000)); }\r\n        };\r\n    }\r\n}\r\nexport default Mixers;\r\n//# sourceMappingURL=mixers.js.map","const HaveSomeFun = (numberOfElements = 20, physics) => {\r\n    if (!window.__loadPhysics) {\r\n        console.log('There is not much fun without physics enabled!');\r\n        return;\r\n    }\r\n    // adding some boxes (with physics)\r\n    for (let i = 0; i < numberOfElements; i++) {\r\n        const materials = ['standard', 'basic', 'normal', 'phong', 'line', 'points'];\r\n        const Between = (min, max) => Math.floor(Math.random() * (max - min + 1) + min);\r\n        const RandomPick = (array) => array[Math.floor(Math.random() * array.length)];\r\n        if (Math.random() > 0.5) {\r\n            physics.add\r\n                .box({\r\n                x: Between(-10, 10),\r\n                y: Between(10, 20),\r\n                z: Between(-10, 10),\r\n                width: Between(1, 2) / 10,\r\n                height: Between(1, 2) / 10,\r\n                depth: Between(1, 2) / 10,\r\n                mass: 1\r\n            }, { [RandomPick(materials)]: { color: Math.floor(Math.random() * 0xffffff) } })\r\n                .body.setRestitution(Math.floor(Math.random() * 10) / 20);\r\n        }\r\n        else {\r\n            physics.add\r\n                .sphere({\r\n                x: Between(-10, 10),\r\n                y: Between(10, 20),\r\n                z: Between(-10, 10),\r\n                radius: Between(1, 2) / 10,\r\n                mass: 1\r\n            }, { [RandomPick(materials)]: { color: Math.floor(Math.random() * 0xffffff) } })\r\n                .body.setRestitution(Math.floor(Math.random() * 10) / 20);\r\n        }\r\n    }\r\n};\r\nexport default HaveSomeFun;\r\n//# sourceMappingURL=haveSomeFun.js.map","import loadAmmoModule from '@enable3d/common/dist/wasmLoader'\r\n\r\nwindow.__loadPhysics = false\r\nwindow.__ammoPath = ''\r\n\r\n/** Discover a whole new dimension wrapping your Phaser game with enable3d */\r\nexport const enable3d = (ready: Function) => {\r\n  window.setTimeout(() => {\r\n    if (window.__loadPhysics) {\r\n      loadAmmoModule(window.__ammoPath, () => {\r\n        Ammo().then(() => {\r\n          ready()\r\n        })\r\n      })\r\n    } else {\r\n      ready()\r\n    }\r\n  }, 50)\r\n  return {\r\n    withPhysics(path: string) {\r\n      window.__loadPhysics = true\r\n      window.__ammoPath = path\r\n    }\r\n  }\r\n}\r\n\r\nexport default enable3d\r\n","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\n// copied from https://phaser.io/examples/v3/view/game-config/custom-webgl-canvas\r\n// copied from https://github.com/mrdoob/three.js/blob/dev/src/renderers/WebGLRenderer.js\r\nimport { WEBGL } from 'three/examples/jsm/WebGL';\r\nimport { logger } from './logger';\r\n/**\r\n * The WebGL context created by Phaser does not meed the requirements of three.js.\r\n * So we create a custom canvas and merge the default contextAttributes from 'three'.js into Phasers default contextAttributes.\r\n */\r\nexport const Canvas = (customCanvasConfig = {}) => {\r\n    const { antialias = true, parent: p = undefined, canvasId = 'enable3d-phaser-canvas' } = customCanvasConfig;\r\n    // create canvas\r\n    const myCustomCanvas = document.createElementNS('http://www.w3.org/1999/xhtml', 'canvas');\r\n    myCustomCanvas.id = canvasId;\r\n    const parent = p ? document.getElementById(p) : document.body;\r\n    if (parent)\r\n        parent.appendChild(myCustomCanvas);\r\n    else\r\n        logger(`Parent \"${p}\" not found!`);\r\n    const parameters = { antialias };\r\n    // https://github.com/mrdoob/three.js/blob/9549909d9c631aaa20d81c2fec863a470fa2e3f0/src/renderers/WebGLRenderer.js#L58\r\n    const _alpha = parameters.alpha !== undefined ? parameters.alpha : true;\r\n    const _depth = parameters.depth !== undefined ? parameters.depth : true;\r\n    const _stencil = parameters.stencil !== undefined ? parameters.stencil : true;\r\n    const _antialias = parameters.antialias !== undefined ? parameters.antialias : false;\r\n    const _premultipliedAlpha = parameters.premultipliedAlpha !== undefined ? parameters.premultipliedAlpha : true;\r\n    const _preserveDrawingBuffer = parameters.preserveDrawingBuffer !== undefined ? parameters.preserveDrawingBuffer : false;\r\n    const _powerPreference = parameters.powerPreference !== undefined ? parameters.powerPreference : 'default';\r\n    const _failIfMajorPerformanceCaveat = parameters.failIfMajorPerformanceCaveat !== undefined ? parameters.failIfMajorPerformanceCaveat : false;\r\n    // threejs's context attributes\r\n    // https://github.com/mrdoob/three.js/blob/9549909d9c631aaa20d81c2fec863a470fa2e3f0/src/renderers/WebGLRenderer.js#L192\r\n    const contextAttributes = {\r\n        alpha: _alpha,\r\n        depth: _depth,\r\n        stencil: _stencil,\r\n        antialias: _antialias,\r\n        premultipliedAlpha: _premultipliedAlpha,\r\n        preserveDrawingBuffer: _preserveDrawingBuffer,\r\n        powerPreference: _powerPreference,\r\n        failIfMajorPerformanceCaveat: _failIfMajorPerformanceCaveat,\r\n        xrCompatible: true\r\n    };\r\n    //  default context config for phaser\r\n    const contextCreationConfig = Object.assign({}, contextAttributes);\r\n    const webgl = WEBGL.isWebGL2Available() ? 'webgl2' : 'webgl';\r\n    // create context\r\n    const myCustomContext = myCustomCanvas.getContext(webgl, contextCreationConfig);\r\n    return {\r\n        canvas: myCustomCanvas,\r\n        context: myCustomContext\r\n    };\r\n};\r\n//# sourceMappingURL=customCanvas.js.map","class WEBGL {\n\n\tstatic isWebGLAvailable() {\n\n\t\ttry {\n\n\t\t\tconst canvas = document.createElement( 'canvas' );\n\t\t\treturn !! ( window.WebGLRenderingContext && ( canvas.getContext( 'webgl' ) || canvas.getContext( 'experimental-webgl' ) ) );\n\n\t\t} catch ( e ) {\n\n\t\t\treturn false;\n\n\t\t}\n\n\t}\n\n\tstatic isWebGL2Available() {\n\n\t\ttry {\n\n\t\t\tconst canvas = document.createElement( 'canvas' );\n\t\t\treturn !! ( window.WebGL2RenderingContext && canvas.getContext( 'webgl2' ) );\n\n\t\t} catch ( e ) {\n\n\t\t\treturn false;\n\n\t\t}\n\n\t}\n\n\tstatic getWebGLErrorMessage() {\n\n\t\treturn this.getErrorMessage( 1 );\n\n\t}\n\n\tstatic getWebGL2ErrorMessage() {\n\n\t\treturn this.getErrorMessage( 2 );\n\n\t}\n\n\tstatic getErrorMessage( version ) {\n\n\t\tconst names = {\n\t\t\t1: 'WebGL',\n\t\t\t2: 'WebGL 2'\n\t\t};\n\n\t\tconst contexts = {\n\t\t\t1: window.WebGLRenderingContext,\n\t\t\t2: window.WebGL2RenderingContext\n\t\t};\n\n\t\tlet message = 'Your $0 does not seem to support <a href=\"http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation\" style=\"color:#000\">$1</a>';\n\n\t\tconst element = document.createElement( 'div' );\n\t\telement.id = 'webglmessage';\n\t\telement.style.fontFamily = 'monospace';\n\t\telement.style.fontSize = '13px';\n\t\telement.style.fontWeight = 'normal';\n\t\telement.style.textAlign = 'center';\n\t\telement.style.background = '#fff';\n\t\telement.style.color = '#000';\n\t\telement.style.padding = '1.5em';\n\t\telement.style.width = '400px';\n\t\telement.style.margin = '5em auto 0';\n\n\t\tif ( contexts[ version ] ) {\n\n\t\t\tmessage = message.replace( '$0', 'graphics card' );\n\n\t\t} else {\n\n\t\t\tmessage = message.replace( '$0', 'browser' );\n\n\t\t}\n\n\t\tmessage = message.replace( '$1', names[ version ] );\n\n\t\telement.innerHTML = message;\n\n\t\treturn element;\n\n\t}\n\n}\n\nexport { WEBGL };\n","export const eventMatrix = [\n    {\n        name: 'pointer',\n        enabled: true,\n        test: 'onpointerdown' in window,\n        events: {\n            down: 'pointerdown',\n            move: 'pointermove',\n            up: 'pointerup'\n        }\n    },\n    {\n        name: 'touch',\n        enabled: true,\n        test: 'ontouchstart' in window && window.navigator.maxTouchPoints >= 1,\n        events: {\n            down: 'touchstart',\n            move: 'touchmove',\n            up: 'touchend'\n        }\n    },\n    {\n        name: 'mouse',\n        enabled: true,\n        test: 'onmousedown' in window,\n        events: {\n            down: 'mousedown',\n            move: 'mousemove',\n            up: 'mouseup'\n        }\n    }\n];\n//# sourceMappingURL=eventMatrix.js.map","/**\n * @package      npmjs.com/package/@yandeu/tap (tap.min.js)\n *\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/yandeu/tap\n * @license      {@link https://github.com/yandeu/tap/blob/master/LICENSE|MIT}\n * @description  Inspired by tapjs (https://www.npmjs.com/package/tapjs)\n */\nimport { Events } from '@yandeu/events';\nimport { eventMatrix } from './eventMatrix';\nimport { VERSION } from './version';\nexport class Tap {\n    constructor(domElement) {\n        this._events = new Events();\n        this.domElement = null;\n        this._isDown = false;\n        this._isPaused = false;\n        this.active = {\n            touch: false,\n            mouse: false,\n            pointer: false\n        };\n        this.registered = {\n            touch: false,\n            mouse: false,\n            pointer: false\n        };\n        this._currentPosition = { x: -1, y: -1 };\n        this._lastPosition = { x: -1, y: -1 };\n        this._isPointerLockAvailable = 'onpointerlockchange' in document;\n        this._add(domElement);\n    }\n    static get VERSION() {\n        return VERSION;\n    }\n    get isDown() {\n        return this._isDown;\n    }\n    set _position(position) {\n        if (position.x === this._currentPosition.x && position.y == this._currentPosition.y)\n            return;\n        this._lastPosition = this._currentPosition;\n        this._currentPosition = position;\n    }\n    get currentPosition() {\n        return this._currentPosition;\n    }\n    get lastPosition() {\n        return this._lastPosition;\n    }\n    get isPaused() {\n        return this._isPaused;\n    }\n    pause() {\n        this._isPaused = true;\n    }\n    resume() {\n        this._isPaused = false;\n    }\n    // listen to pointer lock change events\n    _onPointerLockChange() {\n        return new Promise(resolve => {\n            document.addEventListener('pointerlockchange', e => {\n                resolve(e);\n            }, { once: true });\n        });\n    }\n    get pointerLock() {\n        return {\n            onceChange: this._onPointerLockChange,\n            request: () => {\n                return new Promise((resolve, reject) => {\n                    if (!this._isPointerLockAvailable)\n                        return reject('PointerLock is not available!');\n                    if (this.pointerLock.isLocked)\n                        return reject('Pointer is already locked!');\n                    // listen to pointer lock change events\n                    this._onPointerLockChange().then(e => {\n                        resolve(e);\n                    });\n                    this.once.down(() => {\n                        var _a;\n                        (_a = this.domElement) === null || _a === void 0 ? void 0 : _a.requestPointerLock();\n                    });\n                });\n            },\n            exit: () => {\n                return new Promise((resolve, reject) => {\n                    if (!this.pointerLock.isLocked)\n                        return reject('Pointer is not locked!');\n                    // listen to pointer lock change events\n                    this._onPointerLockChange().then(e => {\n                        resolve(e);\n                    });\n                    document.exitPointerLock();\n                });\n            },\n            available: this._isPointerLockAvailable,\n            isLocked: !!document.pointerLockElement\n        };\n    }\n    /** (once ignores paused) */\n    get once() {\n        return {\n            down: (callback) => {\n                this._events.once('down', data => {\n                    callback(data);\n                });\n            },\n            move: (callback) => {\n                this._events.once('move', data => {\n                    callback(data);\n                });\n            },\n            up: (callback) => {\n                this._events.once('up', data => {\n                    callback(data);\n                });\n            }\n        };\n    }\n    get on() {\n        return {\n            down: (callback) => {\n                this._events.on('down', data => {\n                    if (!this._isPaused)\n                        callback(data);\n                });\n            },\n            move: (callback) => {\n                this._events.on('move', data => {\n                    if (!this._isPaused)\n                        callback(data);\n                });\n            },\n            up: (callback) => {\n                this._events.on('up', data => {\n                    if (!this._isPaused)\n                        callback(data);\n                });\n            }\n        };\n    }\n    _add(element) {\n        const el = (this.domElement = element !== null && element !== void 0 ? element : window);\n        if (!el)\n            console.warn('[tap] No domElement found!');\n        this._onDown = this._onDown.bind(this);\n        this._onMove = this._onMove.bind(this);\n        this._onUp = this._onUp.bind(this);\n        eventMatrix.forEach(input => {\n            if (input.test && input.enabled) {\n                this.active[input.name] = true;\n                el.addEventListener(input.events.down, this._onDown, false);\n                el.addEventListener(input.events.move, this._onMove, false);\n                el.addEventListener(input.events.up, this._onUp, false);\n            }\n        });\n    }\n    _remove(type) {\n        if (!this.active[type])\n            return;\n        const el = this.domElement;\n        if (!el)\n            console.warn('[tap] No domElement found!');\n        eventMatrix.forEach(input => {\n            if (input.name === type) {\n                el.removeEventListener(input.events.down, this._onDown, false);\n                el.removeEventListener(input.events.move, this._onMove, false);\n                el.removeEventListener(input.events.up, this._onUp, false);\n            }\n        });\n        this.active[type] = false;\n    }\n    destroy() {\n        this.pause();\n        Object.keys(this.active).forEach(key => {\n            this._remove(key);\n        });\n        this._events.removeAllListeners();\n        // @ts-ignore\n        this._events = null;\n        // @ts-ignore\n        this.domElement = null;\n        // @ts-ignore\n        this._isDown = null;\n        // @ts-ignore\n        this._isPaused = null;\n        // @ts-ignore\n        this.active = null;\n        // @ts-ignore\n        this.registered = null;\n        // @ts-ignore\n        this._currentPosition = null;\n        // @ts-ignore\n        this._lastPosition = null;\n    }\n    _calcPosition(e) {\n        let x;\n        let y;\n        if (e.touches && e.touches[0]) {\n            x = e.touches[0].pageX;\n            y = e.touches[0].pageY;\n        }\n        else if (e.clientX) {\n            x = e.clientX;\n            y = e.clientY;\n        }\n        else {\n            x = this._currentPosition.x;\n            y = this._currentPosition.y;\n        }\n        if (this.pointerLock.isLocked) {\n            x = e.movementX;\n            y = e.movementY;\n        }\n        this._position = { x, y };\n        return { x, y };\n    }\n    _removeDuplicates(e) {\n        if (e.type === 'pointerdown')\n            this.registered.pointer = true;\n        if (e.type === 'touchstart')\n            this.registered.touch = true;\n        if (e.type === 'mousedown')\n            this.registered.mouse = true;\n        if (e.type === 'touchstart' && this.active.touch && this.registered.pointer) {\n            this._remove('touch');\n            return false;\n        }\n        if (e.type === 'mousedown' && this.active.mouse && (this.registered.pointer || this.registered.touch)) {\n            this._remove('mouse');\n            return false;\n        }\n        return true;\n    }\n    _onDown(e) {\n        const proceed = this._removeDuplicates(e);\n        if (!proceed)\n            return;\n        this._isDown = true;\n        this._events.emit('down', { position: this._calcPosition(e), event: e });\n    }\n    _onMove(e) {\n        this._events.emit('move', { position: this._calcPosition(e), event: e, dragging: this._isDown });\n    }\n    _onUp(e) {\n        this._isDown = false;\n        this._events.emit('up', { position: this._calcPosition(e), event: e });\n    }\n}\n// test section\n// const test = new Tap(document.body)\n// test.pointerLock.onceChange()\n// test.on.down(({ event, position }) => {\n//   console.log(event, position)\n// })\n// const requestPointerLockLoop = () => {\n//   console.log('request')\n//   test.pointerLock.request().then(() => {\n//     console.log('locked')\n//     test.pointerLock.onceChange().then(() => {\n//       console.log('onceChange', !test.pointerLock.isLocked)\n//       if (!test.pointerLock.isLocked) requestPointerLockLoop()\n//     })\n//   })\n// }\n// requestPointerLockLoop()\n// setTimeout(() => {\n//   test.pointerLock.request()\n// }, 2000)\n//# sourceMappingURL=index.js.map","// THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY.\nexport const VERSION = \"0.0.3\";\n//# sourceMappingURL=version.js.map","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nimport { LinearFilter, Raycaster, Texture, Vector2 } from 'three';\r\nimport { Tap } from '@yandeu/tap';\r\n// https://stackoverflow.com/a/7838871\r\nexport const roundRect = (ctx, x, y, w, h, r) => {\r\n    if (w < 2 * r)\r\n        r = w / 2;\r\n    if (h < 2 * r)\r\n        r = h / 2;\r\n    ctx.beginPath();\r\n    ctx.moveTo(x + r, y);\r\n    ctx.arcTo(x + w, y, x + w, y + h, r);\r\n    ctx.arcTo(x + w, y + h, x, y + h, r);\r\n    ctx.arcTo(x, y + h, x, y, r);\r\n    ctx.arcTo(x, y, x + w, y, r);\r\n    ctx.closePath();\r\n};\r\nexport const fontHeightCache = new Map();\r\nexport const calcHeight = (text, fontSize, fontFamily, lineHeight = 1) => {\r\n    const key = fontSize + fontFamily;\r\n    let height = fontHeightCache.get(key);\r\n    if (!height) {\r\n        // https://stackoverflow.com/a/10500938\r\n        const span = document.createElement('p');\r\n        span.style.fontFamily = fontFamily;\r\n        span.style.fontSize = `${fontSize}px`;\r\n        span.style.whiteSpace = 'nowrap';\r\n        span.style.lineHeight = lineHeight.toString();\r\n        span.textContent = text;\r\n        document.body.appendChild(span);\r\n        height = Math.ceil(span.offsetHeight);\r\n        document.body.removeChild(span);\r\n        // add to cache\r\n        fontHeightCache.set(key, height);\r\n    }\r\n    return height;\r\n};\r\nexport const calcWidth = (ctx, lines) => {\r\n    // return the longest line\r\n    return Math.max(...lines.map(line => Math.ceil(ctx.measureText(line).width)));\r\n};\r\nexport const createNewTexture = (image) => {\r\n    const texture = new Texture(image);\r\n    texture.minFilter = LinearFilter;\r\n    texture.generateMipmaps = false;\r\n    // texture.magFilter = NearestFilter\r\n    // texture.minFilter = NearestFilter\r\n    // texture.magFilter = NearestFilter\r\n    // texture.minFilter = LinearMipMapLinearFilter\r\n    texture.needsUpdate = true;\r\n    return texture;\r\n};\r\n// create the canvas for the texture\r\nexport const canvas = document.createElement('canvas');\r\nlet parent;\r\nlet orbitCtl;\r\nlet tap;\r\nlet down = false;\r\nconst objects = [];\r\nconst raycaster = new Raycaster();\r\nconst mouse = new Vector2();\r\nconst pos = new Vector2();\r\nconst size = new Vector2();\r\nconst messages = [];\r\nconst warn = (msg) => {\r\n    if (messages.includes(msg))\r\n        return;\r\n    console.warn(msg);\r\n    messages.push(msg);\r\n};\r\nexport const setSize = (width, height) => {\r\n    size.x = width;\r\n    size.y = height;\r\n};\r\nexport const setParent = (canvas) => {\r\n    parent = canvas;\r\n};\r\nexport const getParent = () => parent;\r\nexport const setOrbitControls = (orbitControls) => {\r\n    if (orbitControls)\r\n        orbitCtl = orbitControls;\r\n};\r\nconst addEventListeners = () => {\r\n    // get the canvas element for the input events\r\n    const canvas = getParent();\r\n    if (!canvas) {\r\n        warn('Please call \"FLAT.initEvents()\" first.');\r\n        return;\r\n    }\r\n    tap = new Tap(canvas);\r\n};\r\nexport const destroy = () => {\r\n    clearObjects();\r\n    if (tap)\r\n        tap.destroy();\r\n};\r\nexport const addObject = (object) => {\r\n    if (objects.length === 0)\r\n        addEventListeners();\r\n    objects.push(object);\r\n};\r\nexport const clearObjects = () => {\r\n    while (objects.length > 0) {\r\n        objects.pop();\r\n    }\r\n};\r\n// TODO(yandeu) Don't call this in a update loop! Call it on an input event!!! Or not? I don't know :/\r\nexport const updateEvents = (camera) => __awaiter(void 0, void 0, void 0, function* () {\r\n    // console.log(tap.currentPosition)\r\n    if (!tap)\r\n        return;\r\n    const { currentPosition: { x, y }, isDown } = tap;\r\n    const hasMouseMoved = mouse.x !== x || mouse.y !== y;\r\n    const hasClicked = down !== isDown;\r\n    if (!hasMouseMoved && !hasClicked)\r\n        return;\r\n    down = isDown;\r\n    mouse.x = x;\r\n    mouse.y = y;\r\n    if (size.x === 0 || typeof size.x === 'undefined') {\r\n        warn('[FLAT] Please call FLAT.setSize() first!');\r\n        return;\r\n    }\r\n    // calculate mouse position in normalized device coordinates\r\n    // (-1 to +1) for both components\r\n    pos.x = (x / size.x) * 2 - 1;\r\n    pos.y = -(y / size.y) * 2 + 1;\r\n    // update the picking ray with the camera and mouse position\r\n    raycaster.setFromCamera(pos, camera);\r\n    let _objects = [...objects];\r\n    // calculate objects intersecting the picking ray\r\n    const intersects = raycaster.intersectObjects(_objects);\r\n    // console.log('i', intersects)\r\n    if (intersects.length === 0)\r\n        document.body.style.cursor = 'default';\r\n    else\r\n        document.body.style.cursor = 'pointer';\r\n    if (orbitCtl && orbitCtl.enabled && intersects.length >= 0)\r\n        orbitCtl.enabled = false;\r\n    if (orbitCtl && !orbitCtl.enabled && intersects.length === 0)\r\n        orbitCtl.enabled = true;\r\n    for (let i = 0; i < intersects.length; i++) {\r\n        const object = intersects[i].object;\r\n        let isTransparent = false;\r\n        if (object.pixelPerfect) {\r\n            // https://github.com/mrdoob/three.js/issues/758\r\n            const getImageData = (image) => {\r\n                // const canvas = document.createElement('canvas')\r\n                canvas.width = image.width;\r\n                canvas.height = image.height;\r\n                const context = canvas.getContext('2d');\r\n                context.drawImage(image, 0, 0);\r\n                return context.getImageData(0, 0, image.width, image.height);\r\n            };\r\n            const getPixel = (imagedata, x, y) => {\r\n                const position = (x + imagedata.width * y) * 4;\r\n                const data = imagedata.data;\r\n                return { r: data[position], g: data[position + 1], b: data[position + 2], a: data[position + 3] };\r\n            };\r\n            const uv = intersects[0].uv;\r\n            const { x, y } = object.texture.transformUv(uv);\r\n            const bitmap = yield createImageBitmap(object.texture.image);\r\n            const imageData = getImageData(bitmap);\r\n            const { r, g, b, a } = getPixel(imageData, Math.round(x * imageData.width), Math.round(y * imageData.height));\r\n            isTransparent = r + g + b + a === 0;\r\n        }\r\n        // get the colors of the pixel\r\n        // var gl = renderer.getContext()\r\n        // var pixels = new Uint8Array(1 * 1 * 4)\r\n        // gl.readPixels(client.x, window.innerHeight - client.y, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, pixels)\r\n        // console.log(pixels) // Uint8Array\r\n        // we skip to the next object in intersects[] if this pixel is transparent\r\n        if (object.pixelPerfect && isTransparent)\r\n            continue;\r\n        // set event\r\n        object.event = tap.isDown ? 'down' : 'over';\r\n        // Removing Items in Arrays\r\n        const removeIndex = _objects.findIndex(o => o.uuid === object.uuid);\r\n        _objects = [..._objects.slice(0, removeIndex), ..._objects.slice(removeIndex + 1)];\r\n        // we do not want to send events to objects that lay lower\r\n        break;\r\n    }\r\n    // send out event remaining objects\r\n    _objects.forEach(o => {\r\n        o.event = 'out';\r\n    });\r\n    return intersects;\r\n});\r\n//# sourceMappingURL=_misc.js.map","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\nimport { Sprite, SpriteMaterial } from 'three';\r\nimport { addObject } from './_misc';\r\nexport class SimpleSprite extends Sprite {\r\n    constructor(texture, clone = true) {\r\n        super(new SpriteMaterial({\r\n            map: clone ? texture.clone() : texture,\r\n            color: 0xffffff\r\n        }));\r\n        this._event = 'out';\r\n        this._pixelPerfect = false;\r\n        this._isInteractive = false;\r\n        this._depth = 0;\r\n        this._bodyOffset = { x: 0, y: 0 };\r\n        this._internalScale = { x: 1, y: 1 };\r\n        this._pixelRatio = 1;\r\n        this.onInputOver = () => { };\r\n        this.onInputOut = () => { };\r\n        this.onInputDown = () => { };\r\n        this._setTexture();\r\n        this.setScale(this._internalScale.x, this._internalScale.y);\r\n        this.setDepth(this._calcZ());\r\n    }\r\n    _onInputOver() { }\r\n    _onInputOut() { }\r\n    _onInputDown() { }\r\n    set event(event) {\r\n        if (this._event === event)\r\n            return;\r\n        this._event = event;\r\n        if (event === 'over') {\r\n            this._onInputOver();\r\n            this.onInputOver();\r\n        }\r\n        else if (event === 'out') {\r\n            this._onInputOut();\r\n            this.onInputOut();\r\n        }\r\n        else if (event === 'down') {\r\n            this._onInputDown();\r\n            this.onInputDown();\r\n        }\r\n    }\r\n    setPixelRatio(pixelRatio) {\r\n        this._pixelRatio = pixelRatio;\r\n        this.setScale(this._internalScale.x, this._internalScale.y);\r\n    }\r\n    setInteractive({ pixelPerfect = false } = {}) {\r\n        if (this._isInteractive)\r\n            return;\r\n        this._isInteractive = true;\r\n        this._pixelPerfect = pixelPerfect;\r\n        addObject(this);\r\n    }\r\n    get pixelPerfect() {\r\n        return this._pixelPerfect;\r\n    }\r\n    _calcZ() {\r\n        return this._depth / 100 - this.id * 1e-8;\r\n    }\r\n    getTexture() {\r\n        return this.texture;\r\n    }\r\n    setTexture(texture) {\r\n        this._setTexture(texture);\r\n    }\r\n    get texture() {\r\n        return this.material.map;\r\n    }\r\n    _setTexture(texture) {\r\n        if (!this.material.map) {\r\n            console.warn('Something went wrong!');\r\n            return;\r\n        }\r\n        if (texture)\r\n            this.material.map = texture;\r\n        const { width, height } = this.material.map.image;\r\n        this.textureWidth = width;\r\n        this.textureHeight = height;\r\n        this.material.map.needsUpdate = true;\r\n    }\r\n    getBodyOffset() {\r\n        // remember: pixelRatio is only for the sprite, not the body\r\n        return {\r\n            x: this._bodyOffset.x * this.getScale().x /* / this.getPixelRatio()*/,\r\n            y: this._bodyOffset.y * this.getScale().y /* / this.getPixelRatio()*/\r\n        };\r\n    }\r\n    setPosition(x, y) {\r\n        this.position.set(x, y, this._calcZ());\r\n    }\r\n    setDepth(z) {\r\n        this._depth = z;\r\n        this.position.setZ(this._calcZ());\r\n    }\r\n    setRotation(rotation) {\r\n        this.material.rotation = rotation;\r\n    }\r\n    getRotation() {\r\n        return this.material.rotation;\r\n    }\r\n    getPixelRatio() {\r\n        return this._pixelRatio;\r\n    }\r\n    getScale() {\r\n        return { x: this._internalScale.x, y: this._internalScale.y };\r\n    }\r\n    setScale(x, y) {\r\n        this._internalScale.x = x;\r\n        if (y)\r\n            this._internalScale.y = y;\r\n        else\r\n            this._internalScale.y = x;\r\n        const xx = x;\r\n        const yy = y ? y : x;\r\n        this.scale.set((xx * this.textureWidth) / this._pixelRatio, (yy * this.textureHeight) / this._pixelRatio, 1);\r\n    }\r\n}\r\n//# sourceMappingURL=simpleSprite.js.map","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\nimport { SimpleSprite } from './simpleSprite';\r\nimport { Events } from '@yandeu/events';\r\nexport class ActionSprite extends SimpleSprite {\r\n    constructor(texture) {\r\n        super(texture);\r\n        this._anims = [];\r\n        this._flipX = false;\r\n        this._frame = {\r\n            name: '',\r\n            index: -1,\r\n            width: -1,\r\n            height: -1\r\n        };\r\n        this._currentIndex = 0;\r\n        this._currentAnimationName = '';\r\n    }\r\n    get frame() {\r\n        return {\r\n            name: this._frame.name,\r\n            index: this._frame.index,\r\n            width: (this._frame.width * this._internalScale.x * 1) / this._pixelRatio,\r\n            height: (this._frame.height * this._internalScale.y * 1) / this._pixelRatio\r\n        };\r\n    }\r\n    get anims() {\r\n        return {\r\n            add: this._add.bind(this),\r\n            get: this.getAnimationByName.bind(this),\r\n            play: this._play.bind(this),\r\n            stop: this._stop.bind(this),\r\n            getName: () => this._currentAnimationName,\r\n            name: this._currentAnimationName\r\n        };\r\n    }\r\n    getAnimationByName(name) {\r\n        return this._anims.filter(a => a.name === name)[0];\r\n    }\r\n    _add(name, frameOptions) {\r\n        const { start, end, rate = 30, repeat = -1, timeline = [] } = frameOptions;\r\n        if (this.getAnimationByName(name)) {\r\n            console.warn(`The animation \"${name}\" does already exist!`);\r\n            return;\r\n        }\r\n        if (timeline.length === 0) {\r\n            if (typeof end === 'undefined' || typeof start === 'undefined') {\r\n                console.warn(`You need to provide \"start\" and \"end or a \"timeline\"!`);\r\n                return;\r\n            }\r\n            for (let i = start; i <= end; i++) {\r\n                timeline.push(i);\r\n            }\r\n        }\r\n        this._anims.push({ name, timeline, rate, repeat });\r\n    }\r\n    _stop() {\r\n        if (this.interval)\r\n            clearInterval(this.interval);\r\n    }\r\n    _play(name) {\r\n        this._stop();\r\n        this._currentAnimationName = name;\r\n        const animation = this.getAnimationByName(name);\r\n        if (!animation)\r\n            console.warn(`Animation \"${name}\" does not exist!`);\r\n        const { timeline, rate, repeat } = animation;\r\n        this._currentIndex = -1;\r\n        let loops = 0;\r\n        const playNextFrame = () => {\r\n            this._currentIndex++;\r\n            if (this._currentIndex >= timeline.length) {\r\n                this._currentIndex = 0;\r\n                loops++;\r\n            }\r\n            this._currentIndex = timeline[this._currentIndex];\r\n            const shouldStop = !(repeat === -1 || loops < repeat);\r\n            if (shouldStop) {\r\n                this._stop();\r\n                this._events.emit('complete');\r\n                return;\r\n            }\r\n            this.setFrame(this._currentIndex);\r\n        };\r\n        playNextFrame();\r\n        this.interval = window.setInterval(() => {\r\n            playNextFrame();\r\n        }, 1000 / rate);\r\n        return { onComplete: (cb) => this._events.once('complete', cb) };\r\n    }\r\n    get _events() {\r\n        return {\r\n            emit: (event) => {\r\n                if (!this._eventEmitter)\r\n                    this._eventEmitter = new Events();\r\n                this._eventEmitter.emit(event);\r\n            },\r\n            once: (event, callback) => {\r\n                if (!this._eventEmitter)\r\n                    this._eventEmitter = new Events();\r\n                this._eventEmitter.once(event, callback);\r\n            }\r\n        };\r\n    }\r\n}\r\n//# sourceMappingURL=actionSprite.js.map","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\n// inspired by\r\n// https://felixmariotto.github.io/from_indexed_texture\r\n// https://github.com/felixmariotto/three-SpriteMixer/blob/master/examples/from_indexed_texture.html\r\nimport { RepeatWrapping } from 'three';\r\nimport { ActionSprite } from './actionSprite';\r\nexport class SpriteSheet extends ActionSprite {\r\n    constructor(texture, frameOptions) {\r\n        super(texture);\r\n        const { width = this.textureWidth, height = this.textureHeight } = frameOptions;\r\n        this._tilesHoriz = this.textureWidth / width;\r\n        this._tilesVert = this.textureHeight / height;\r\n        if (this._tilesHoriz !== Math.round(this._tilesHoriz))\r\n            console.warn('The horizontal row does not seem to fit!');\r\n        if (this._tilesVert !== Math.round(this._tilesVert))\r\n            console.warn('The vertical row does not seem to fit!');\r\n        this._width = width;\r\n        this._height = height;\r\n        // stays always the same\r\n        this._frame.width = width;\r\n        this._frame.height = height;\r\n        // this.texture.center.set(0.5, 0.5)\r\n        // this.material.rotation = Math.PI // turn 180 deg\r\n        this.sizeFrame(1 / this._tilesHoriz, 1 / this._tilesVert);\r\n        this.scaleFrame();\r\n    }\r\n    setScale(x, y) {\r\n        super.setScale(x, y);\r\n        this.scaleFrame();\r\n    }\r\n    scaleFrame() {\r\n        this.scale.set((this._width * this._internalScale.x) / this._pixelRatio, (this._height * this._internalScale.y) / this._pixelRatio, 1);\r\n    }\r\n    // returns the row of the current tile.\r\n    getRow(index) {\r\n        return Math.floor(index / this._tilesHoriz);\r\n    }\r\n    // returns the column of the current tile.\r\n    getColumn(index) {\r\n        return index % this._tilesHoriz;\r\n    }\r\n    sizeFrame(width, height) {\r\n        this.texture.wrapS = this.texture.wrapT = RepeatWrapping;\r\n        this.texture.repeat.set(width, height);\r\n        this.texture.needsUpdate = true;\r\n    }\r\n    offsetTexture(x, y) {\r\n        if (this._flipX)\r\n            x += 1 / this._tilesHoriz;\r\n        this.texture.offset.setX(x);\r\n        this.texture.offset.setY(y);\r\n    }\r\n    flipX(flip) {\r\n        this._flipX = flip;\r\n        let x = 1 / this._tilesHoriz;\r\n        const y = 1 / this._tilesVert;\r\n        if (flip)\r\n            x *= -1;\r\n        this.texture.repeat.set(x, y);\r\n        this.setFrame(this._frame.index);\r\n    }\r\n    setFrame(index) {\r\n        this._frame.index = index;\r\n        const x = this.getColumn(index) / this._tilesHoriz;\r\n        const y = (this._tilesVert - this.getRow(index) - 1) / this._tilesVert;\r\n        this.offsetTexture(x, y);\r\n    }\r\n}\r\n//# sourceMappingURL=spriteSheet.js.map","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\nimport { SpriteSheet } from './spriteSheet';\r\nexport class Button extends SpriteSheet {\r\n    constructor(texture, frameOptions, overFrame, outFrame, downFrame) {\r\n        super(texture, frameOptions);\r\n        this.overFrame = overFrame;\r\n        this.outFrame = outFrame;\r\n        this.downFrame = downFrame;\r\n        this.setFrame(outFrame);\r\n    }\r\n    _onInputOver() {\r\n        this.setFrame(this.overFrame);\r\n    }\r\n    _onInputOut() {\r\n        this.setFrame(this.outFrame);\r\n    }\r\n    _onInputDown() {\r\n        this.setFrame(this.downFrame);\r\n    }\r\n}\r\n//# sourceMappingURL=button.js.map","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\nimport { LinearFilter, Texture } from 'three';\r\nimport { SimpleSprite } from './simpleSprite';\r\nimport { canvas, createNewTexture } from './_misc';\r\nexport class DrawTexture extends Texture {\r\n    constructor(width, height, drawCanvas) {\r\n        // get ctx and clear\r\n        const ctx = canvas.getContext('2d');\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n        // set width and height\r\n        canvas.height = height;\r\n        canvas.width = width;\r\n        // let the user draw the ctx\r\n        drawCanvas(ctx);\r\n        // generate image and texture\r\n        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n        super(imageData);\r\n        this.minFilter = LinearFilter;\r\n        this.generateMipmaps = false;\r\n        this.width = width;\r\n        this.height = height;\r\n        this.drawCanvas = drawCanvas;\r\n        this.needsUpdate = true;\r\n    }\r\n    // @ts-ignore\r\n    clone() {\r\n        // return new this.constructor(this.width, this.height, this.drawCanvas).copy(this)\r\n        return new DrawTexture(this.width, this.height, this.drawCanvas).copy(this);\r\n    }\r\n}\r\nexport class DrawSprite extends SimpleSprite {\r\n    constructor(width, height, drawCanvas) {\r\n        // get ctx and clear\r\n        const ctx = canvas.getContext('2d');\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n        // set width and height\r\n        canvas.height = height;\r\n        canvas.width = width;\r\n        // let the user draw the ctx\r\n        drawCanvas(ctx);\r\n        // generate image and texture\r\n        const image = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n        const texture = createNewTexture(image);\r\n        super(texture);\r\n        this._drawCanvas = drawCanvas;\r\n    }\r\n    // @ts-ignore\r\n    clone() {\r\n        return new DrawSprite(this.textureWidth, this.textureHeight, this._drawCanvas).clone();\r\n    }\r\n}\r\n//# sourceMappingURL=draw.js.map","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\nimport { setOrbitControls, setParent } from './_misc';\r\nexport { updateEvents, getParent, destroy, setSize } from './_misc';\r\nexport const initEvents = ({ canvas, orbitControls }) => {\r\n    setOrbitControls(orbitControls);\r\n    setParent(canvas);\r\n};\r\n//# sourceMappingURL=flat.js.map","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\nimport { LinearFilter, Texture } from 'three';\r\nimport { SimpleSprite } from './simpleSprite';\r\nimport { calcHeight, calcWidth, canvas, createNewTexture, roundRect } from './_misc';\r\nexport class TextTexture extends Texture {\r\n    constructor(text, styles = {}) {\r\n        const { imageData, width, height } = createTextImage(text, styles);\r\n        super(imageData);\r\n        this.width = width;\r\n        this.height = height;\r\n        this._text = text;\r\n        this._styles = styles;\r\n        this._image = imageData;\r\n        this.minFilter = LinearFilter;\r\n        this.generateMipmaps = false;\r\n        this.needsUpdate = true;\r\n    }\r\n    getText() {\r\n        return this._text;\r\n    }\r\n    getStyles() {\r\n        return this._styles;\r\n    }\r\n    // @ts-ignore\r\n    clone() {\r\n        // @ts-ignore\r\n        return new this.constructor(this._text, this._styles).copy(this);\r\n    }\r\n}\r\nexport class TextSprite extends SimpleSprite {\r\n    constructor(texture) {\r\n        super(texture, false);\r\n        this._text = texture.getText();\r\n        this._styles = texture.getStyles();\r\n    }\r\n    getText() {\r\n        return this._text;\r\n    }\r\n    getStyles() {\r\n        return this._styles;\r\n    }\r\n    setStyles(styles) {\r\n        this._styles = styles;\r\n        this.texture.dispose();\r\n        this.setTexture(createNewTexture(createTextImage(this._text, styles).imageData));\r\n    }\r\n    setText(text) {\r\n        this._text = text;\r\n        this.texture.dispose();\r\n        this.setTexture(createNewTexture(createTextImage(text, this._styles).imageData));\r\n        this._update();\r\n    }\r\n    _update() {\r\n        // update size\r\n        this.textureHeight = this.texture.image.height;\r\n        this.textureWidth = this.texture.image.width;\r\n        // update\r\n        this.texture.needsUpdate = true;\r\n        this.material.needsUpdate = true;\r\n        const { x, y } = this._internalScale;\r\n        this.setScale(x, y);\r\n    }\r\n}\r\nconst createTextImage = (text, styles) => {\r\n    const { align = 'center', background = '', baseline = 'middle', borderColor = '', borderRadius = 0, borderWidth = 0, fillStyle = 'SlateBlue', fontFamily = 'Arial', fontSize = 48, fontWeight = '', lineHeight = 1, lineWidth = 4, padding = 0, strokeStyle = '' } = styles;\r\n    // get offset\r\n    const { offset: { x: offsetX = 0, y: offsetY = 0 } = {} } = styles;\r\n    // get padding\r\n    let paddingX;\r\n    let paddingY;\r\n    if (typeof padding !== 'number') {\r\n        paddingX = padding.x || 0;\r\n        paddingY = padding.y || 0;\r\n    }\r\n    else {\r\n        paddingX = padding;\r\n        paddingY = padding;\r\n    }\r\n    const font = `${fontWeight} ${fontSize}px ${fontFamily}`;\r\n    const ctx = canvas.getContext('2d');\r\n    // clean up\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n    const lines = text.split('\\n');\r\n    ctx.font = font;\r\n    const line_height = calcHeight(text, fontSize, fontFamily, lineHeight);\r\n    const line_width = fillStyle ? lineWidth * 2 : lineWidth;\r\n    const height = line_height * lines.length + paddingY * 2 + borderWidth * 2;\r\n    const width = calcWidth(ctx, lines) + line_width + paddingX * 2 + borderWidth * 2;\r\n    // adjust to PowerOfTwo (WebGL1 only)\r\n    // width = Math.max(2, MathUtils.ceilPowerOfTwo(width))\r\n    // height = Math.max(2, MathUtils.ceilPowerOfTwo(height))\r\n    canvas.height = height;\r\n    canvas.width = width;\r\n    // border\r\n    if (borderColor) {\r\n        ctx.strokeStyle = borderColor;\r\n        roundRect(ctx, borderWidth / 2, borderWidth / 2, canvas.width - borderWidth, canvas.height - borderWidth, borderRadius);\r\n        ctx.lineWidth = borderWidth;\r\n        ctx.stroke();\r\n    }\r\n    // background\r\n    if (background) {\r\n        ctx.fillStyle = background;\r\n        roundRect(ctx, borderWidth, borderWidth, canvas.width - borderWidth * 2, canvas.height - borderWidth * 2, borderColor ? borderRadius / 2 : borderRadius);\r\n        ctx.fill();\r\n        // if (borderColor && borderWidth)\r\n        //   ctx.fillRect(borderWidth, borderWidth, canvas.width - borderWidth * 2, canvas.height - borderWidth * 2)\r\n        // else ctx.fillRect(0, 0, canvas.width, canvas.height)\r\n    }\r\n    // text\r\n    ctx.font = font;\r\n    ctx.textAlign = align;\r\n    ctx.textBaseline = baseline;\r\n    if (strokeStyle && lineWidth) {\r\n        ctx.strokeStyle = strokeStyle;\r\n        ctx.lineWidth = line_width;\r\n    }\r\n    if (fillStyle)\r\n        ctx.fillStyle = fillStyle;\r\n    for (var i = 0; i < lines.length; i++) {\r\n        let top = i * line_height + line_height / 2;\r\n        let left = 0;\r\n        if (align === 'left') {\r\n            left = line_width / 2;\r\n            left += paddingX;\r\n            left += borderWidth;\r\n        }\r\n        if (align === 'center') {\r\n            left = width / 2;\r\n        }\r\n        if (align === 'right') {\r\n            left = width - line_width / 2;\r\n            left -= paddingX;\r\n            left -= borderWidth;\r\n        }\r\n        top += paddingY;\r\n        top += borderWidth;\r\n        top += offsetY;\r\n        left += offsetX;\r\n        if (strokeStyle && lineWidth)\r\n            ctx.strokeText(lines[i], left, top);\r\n        if (fillStyle)\r\n            ctx.fillText(lines[i], left, top);\r\n    }\r\n    // https://github.com/makc/Edelweiss/blob/c3e63135f2f57f1a422c30abbeca35e579b84f02/docs/js/AssetManager.js#L245\r\n    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n    return { imageData, width, height };\r\n};\r\n//# sourceMappingURL=text.js.map","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\nimport { ActionSprite } from './actionSprite';\r\nimport { RepeatWrapping } from 'three';\r\nexport class TextureAtlas extends ActionSprite {\r\n    /**\r\n     * @param texture Atlas Texture (image)\r\n     * @param json Atlas .json file (string). Needs to be  \"JSON hash\".\r\n     */\r\n    constructor(atlas, frame) {\r\n        super(atlas.texture);\r\n        this.positionOffset = { x: 0, y: 0 };\r\n        this.JSONHash = atlas.json;\r\n        if (frame)\r\n            this.setFrame(frame);\r\n    }\r\n    setScale(x, y) {\r\n        this._internalScale.x = x;\r\n        if (y)\r\n            this._internalScale.y = y;\r\n        else\r\n            this._internalScale.y = x;\r\n        this.scaleFrame();\r\n    }\r\n    scaleFrame() {\r\n        var _a;\r\n        if (!((_a = this._frame) === null || _a === void 0 ? void 0 : _a.name))\r\n            return;\r\n        const { frame: { w, h } } = this.getFrame(this._frame.name);\r\n        const scaleX = (w * this._internalScale.x) / this._pixelRatio;\r\n        const scaleY = (h * this._internalScale.y) / this._pixelRatio;\r\n        this.scale.set(scaleX, scaleY, 1);\r\n    }\r\n    sizeFrame(width, height) {\r\n        this.texture.wrapS = this.texture.wrapT = RepeatWrapping;\r\n        this.texture.repeat.set(width, height);\r\n        this.texture.needsUpdate = true;\r\n    }\r\n    offsetTexture(x, y) {\r\n        this.texture.offset.setX(x);\r\n        this.texture.offset.setY(y);\r\n    }\r\n    flipX(flip) {\r\n        this._flipX = flip;\r\n        this.update();\r\n    }\r\n    getFrame(frameName) {\r\n        return this.JSONHash.frames[frameName];\r\n    }\r\n    setFrame(frameName) {\r\n        this.update(frameName);\r\n    }\r\n    update(frameName) {\r\n        if (!frameName)\r\n            frameName = this._frame.name;\r\n        if (!frameName)\r\n            return;\r\n        const f = this.getFrame(frameName);\r\n        if (!f)\r\n            console.warn(`Frame ${frameName} not found!`);\r\n        const { frame, rotated, trimmed, spriteSourceSize, sourceSize } = f;\r\n        // set current frame\r\n        this._frame.name = frameName;\r\n        // reset rotation\r\n        this.texture.rotation = 0;\r\n        // set values\r\n        const x = frame.x / this.textureWidth;\r\n        let y = 1 - (frame.y + frame.h) / this.textureHeight;\r\n        let w = frame.w;\r\n        let h = frame.h;\r\n        this._frame.width = w;\r\n        this._frame.height = h;\r\n        // if the frame is rotated\r\n        if (rotated) {\r\n            // rotate texture\r\n            this.texture.rotation = Math.PI / 2;\r\n            // adjust y\r\n            y = 1 - frame.y / this.textureHeight;\r\n            [w, h] = [h, w];\r\n            // check flipX\r\n            if (this._flipX)\r\n                this.texture.rotation *= -1;\r\n        }\r\n        // if the frame is trimmed\r\n        if (trimmed) {\r\n            const newOffX = ((sourceSize.w - frame.w) / 2 - spriteSourceSize.x) / (1 / this._internalScale.x);\r\n            const newOffY = ((sourceSize.h - frame.h) / 2 - spriteSourceSize.y) / (1 / this._internalScale.x);\r\n            // x\r\n            if (!this._flipX)\r\n                this.position.x -= newOffX - this.positionOffset.x;\r\n            else\r\n                this.position.x += newOffX - this.positionOffset.x;\r\n            //y\r\n            this.position.y += newOffY - this.positionOffset.y;\r\n            this.positionOffset.x = newOffX;\r\n            this.positionOffset.y = newOffY;\r\n        }\r\n        // set offset, size and scale\r\n        let offsetX = x;\r\n        let offsetY = y;\r\n        let sizeX = w / this.textureWidth;\r\n        const sizeY = h / this.textureHeight;\r\n        // if the frame is flipped\r\n        if (this._flipX) {\r\n            sizeX *= -1;\r\n            if (!rotated)\r\n                offsetX += frame.w / this.textureWidth;\r\n            else\r\n                offsetY -= frame.w / this.textureHeight;\r\n        }\r\n        this.offsetTexture(offsetX, offsetY);\r\n        this.sizeFrame(sizeX, sizeY);\r\n        this.scaleFrame();\r\n    }\r\n}\r\n//# sourceMappingURL=textureAtlas.js.map","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\nexport const debugSettings = {\r\n    colors: {\r\n        dynamic: '#ff0000',\r\n        static: '#90ee90',\r\n        sensor: '#ffff00',\r\n        sleeping: '#464646' // gray\r\n    },\r\n    lineWidth: 2,\r\n    fill: false,\r\n    opacity: 0.25\r\n};\r\nexport const getDebugColors = (options = {}) => {\r\n    const { colors } = debugSettings;\r\n    if (options.isStatic)\r\n        return colors.static;\r\n    if (options.isSensor)\r\n        return colors.sensor;\r\n    if (options.isSleeping)\r\n        return colors.sleeping;\r\n    return colors.dynamic;\r\n};\r\nexport const adjustDebugColor = (body, depth = 0, _fill, _stroke) => {\r\n    // get color\r\n    const color = getDebugColors(body);\r\n    const opacity = debugSettings.opacity;\r\n    const lineWidth = debugSettings.lineWidth;\r\n    const shouldFill = debugSettings.fill;\r\n    let fill = _fill !== null && _fill !== void 0 ? _fill : color + Math.round(255 * opacity).toString(16);\r\n    if (!shouldFill)\r\n        fill = _fill !== null && _fill !== void 0 ? _fill : 'transparent';\r\n    if (body.isSleeping && !body.isStatic && !body.isSensor)\r\n        fill = _fill !== null && _fill !== void 0 ? _fill : color; //+ Math.round(255 * opacity).toString(16)\r\n    const stroke = _stroke !== null && _stroke !== void 0 ? _stroke : color;\r\n    body.render.fillStyle = fill;\r\n    body.render.strokeStyle = stroke;\r\n    body.render.lineWidth = lineWidth;\r\n    if (depth >= 5)\r\n        return;\r\n    body.parts.forEach(part => {\r\n        adjustDebugColor(part, depth + 1, fill, stroke);\r\n    });\r\n};\r\n//# sourceMappingURL=_misc.js.map","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\nimport { Bodies, Body, Engine, Events, Render, Runner, Vector, Vertices, World } from 'matter-js';\r\nimport { Vector2 } from 'three';\r\nimport { adjustDebugColor } from './_misc';\r\n// manually update circle radius for debugging (bug in matter-js ??)\r\n// copied from Body.js\r\nconst scaleCircle_Fix = (body, scaleX, scaleY) => {\r\n    // handle circles\r\n    if (body.circleRadius) {\r\n        if (scaleX === scaleY) {\r\n            body.circleRadius *= scaleX;\r\n        }\r\n        else {\r\n            // body is no longer a circle\r\n            body.circleRadius = undefined;\r\n        }\r\n    }\r\n};\r\nconst scaleBody_Fix = (body, scaleX, scaleY) => {\r\n    if (!body.circleRadius) {\r\n        body.parts.forEach(part => {\r\n            scaleCircle_Fix(part, scaleX, scaleY);\r\n        });\r\n    }\r\n    Body.scale(body, scaleX, scaleY);\r\n};\r\nexport class Physics {\r\n    constructor(debug = true) {\r\n        this._objects = new Map();\r\n        this.width = window.innerWidth;\r\n        this.height = window.innerHeight;\r\n        const DEBUG = debug;\r\n        this.engine = Engine.create({ enableSleeping: true });\r\n        this.world = this.engine.world;\r\n        this.runner = Runner.create();\r\n        // for debugging\r\n        if (DEBUG) {\r\n            const canvas = document.createElement('canvas');\r\n            canvas.id = 'matter-debug';\r\n            canvas.style.position = 'absolute';\r\n            canvas.style.top = '0px';\r\n            canvas.style.left = '0px';\r\n            canvas.style.pointerEvents = 'none';\r\n            document.body.append(canvas);\r\n            this.render = Render.create({\r\n                canvas: canvas,\r\n                engine: this.engine,\r\n                options: {\r\n                    width: this.width,\r\n                    height: this.height,\r\n                    background: 'transparent',\r\n                    wireframeBackground: 'transparent',\r\n                    wireframes: false,\r\n                    showConvexHulls: true,\r\n                    showPositions: true,\r\n                    showVelocity: true\r\n                }\r\n            });\r\n            Render.run(this.render);\r\n        }\r\n        Runner.run(this.runner, this.engine);\r\n        Events.on(this.engine, 'afterUpdate', () => this.update());\r\n    }\r\n    destroy() {\r\n        World.clear(this.world, false);\r\n        Engine.clear(this.engine);\r\n    }\r\n    parsePhysics(file) {\r\n        const json = JSON.parse(file);\r\n        delete json['generator_info'];\r\n        let bodies = {};\r\n        for (const key in json) {\r\n            const fixtures = json[key].fixtures;\r\n            bodies = Object.assign(Object.assign({}, bodies), { [key]: fixtures });\r\n        }\r\n        return bodies;\r\n    }\r\n    addBodyFromFixtures(x, y, fixtures) {\r\n        const bodies = [];\r\n        fixtures.forEach(fixture => {\r\n            let body;\r\n            if (fixture.vertices) {\r\n                body = this.add.fromVertices(x, y, fixture.vertices);\r\n            }\r\n            else if (fixture.circle) {\r\n                body = this.add.circle(x + fixture.circle.x, y + fixture.circle.y, fixture.circle.radius);\r\n            }\r\n            else {\r\n                console.log(`Shape not recognized!`);\r\n            }\r\n            if (body)\r\n                bodies.push(body);\r\n        });\r\n        let body;\r\n        if (bodies.length > 1)\r\n            body = Body.create({\r\n                parts: bodies\r\n            });\r\n        else\r\n            body = bodies[0];\r\n        Body.setPosition(body, { x, y });\r\n        return body;\r\n    }\r\n    fromVertices_Fixed(x, y, vertexSets, options = {}) {\r\n        // https://github.com/liabru/matter-js/issues/248#issuecomment-361983251\r\n        const bodies = [];\r\n        for (var i = 0; i < vertexSets.length; i++) {\r\n            const body = Bodies.fromVertices(x, y, [vertexSets[i]], Object.assign({}, options));\r\n            bodies.push(body);\r\n            const centre = Vertices.centre(vertexSets[i]);\r\n            Body.setPosition(body, {\r\n                x: body.position.x + centre.x,\r\n                y: body.position.y + centre.y\r\n            });\r\n        }\r\n        const compound = Body.create(Object.assign(Object.assign({}, options), { parts: bodies }));\r\n        return compound;\r\n    }\r\n    fromVertices(x, y, vertexSets, options = {}) {\r\n        return this.fromVertices_Fixed(x, y, vertexSets, Object.assign({}, options));\r\n    }\r\n    setBounds(x = 0, y = 0, width = this.width, height = this.height, depth = 50) {\r\n        // x = 100\r\n        // y = 100\r\n        // width = 300\r\n        // height = 500\r\n        // walls\r\n        World.add(this.world, [\r\n            // top\r\n            this.add.rectangle(x + width / 2, y + 0 - depth / 2, width + depth * 2, depth, { isStatic: true }),\r\n            // bottom\r\n            this.add.rectangle(x + width / 2, y + height + depth / 2, width + depth * 2, depth, { isStatic: true }),\r\n            // left\r\n            this.add.rectangle(x + 0 - depth / 2, y + height / 2, depth, height + depth * 2, { isStatic: true }),\r\n            // right\r\n            this.add.rectangle(x + width + depth / 2, y + height / 2, depth, height + depth * 2, { isStatic: true })\r\n        ]);\r\n    }\r\n    rectangle(x, y, width, height, options = {}) {\r\n        return Bodies.rectangle(x, y, width, height, Object.assign({}, options));\r\n    }\r\n    circle(x, y, radius, options = {}) {\r\n        return Bodies.circle(x, y, radius, Object.assign({}, options));\r\n    }\r\n    existing(sprite) {\r\n        this.add.bodyToSprite(sprite);\r\n        this._objects.set(sprite.body.id.toString(), sprite);\r\n    }\r\n    calcBodyOffset(sprite) {\r\n        const body = sprite.body;\r\n        // https://github.com/liabru/matter-js/issues/211#issuecomment-184804576\r\n        const width = body.bounds.max.x - body.bounds.min.x;\r\n        const height = body.bounds.max.y - body.bounds.min.y;\r\n        const topLeft = Vector.sub(body.bounds.min, body.position);\r\n        const centerOfBody = { x: width / 2, y: height / 2 };\r\n        const centerOfMass = body.position;\r\n        const offsetX = topLeft.x + width / 2;\r\n        const offsetY = topLeft.y + height / 2;\r\n        const offset = { x: offsetX, y: offsetY };\r\n        // @ts-expect-error\r\n        sprite._bodyOffset = offset;\r\n    }\r\n    _addBodyToSprite(sprite) {\r\n        this.add.body(sprite.body);\r\n        this.calcBodyOffset(sprite);\r\n        // /remember: pixelRatio is only for the sprite, not the body\r\n        const scaleX = sprite.getScale().x; // / sprite.getPixelRatio()\r\n        const scaleY = sprite.getScale().y; // / sprite.getPixelRatio()\r\n        scaleBody_Fix(sprite.body, scaleX, scaleY);\r\n        sprite.setBodyPosition = (x, y) => {\r\n            Body.setPosition(sprite.body, {\r\n                x: x - sprite.getBodyOffset().x,\r\n                y: y - sprite.getBodyOffset().y\r\n            });\r\n        };\r\n    }\r\n    _addBody(body) {\r\n        World.add(this.world, body);\r\n    }\r\n    get add() {\r\n        return {\r\n            body: this._addBody.bind(this),\r\n            bodyToSprite: this._addBodyToSprite.bind(this),\r\n            fromVertices: this.fromVertices.bind(this),\r\n            circle: this.circle.bind(this),\r\n            existing: this.existing.bind(this),\r\n            rectangle: this.rectangle.bind(this)\r\n        };\r\n    }\r\n    adjustDebugColor(body) {\r\n        adjustDebugColor(body);\r\n    }\r\n    update() {\r\n        this._objects.forEach(object => {\r\n            const { body } = object;\r\n            const { angle, position } = body;\r\n            const { x, y } = position;\r\n            // https://github.com/liabru/matter-js/issues/211#issuecomment-184804576\r\n            const offset = new Vector2(object.getBodyOffset().x, object.getBodyOffset().y);\r\n            offset.rotateAround(new Vector2(), angle);\r\n            object.setPosition(x + offset.x, this.height - y - offset.y);\r\n            object.setRotation(-angle);\r\n            adjustDebugColor(body);\r\n        });\r\n    }\r\n}\r\n//# sourceMappingURL=physics.js.map","/**\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\r\n */\r\nimport { Events } from '@yandeu/events';\r\n// This class is based on a file I found online called toon3d.js\r\n// Unfortunately I could not find its license or author.\r\n// I just ported it to TypeScript and improved the code.\r\nexport class JoyStick extends Events {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.id = -1;\r\n    }\r\n    get add() {\r\n        return {\r\n            axis: (config = {}) => this.addAxis(config),\r\n            button: (config = {}) => this.addButton(config)\r\n        };\r\n    }\r\n    addAxis(config = {}) {\r\n        this.id++;\r\n        const { styles = { left: 35, bottom: 35, size: 100 } } = config;\r\n        const circle = this.circle({ styles });\r\n        const thumb = this.thumb({ styles });\r\n        circle.appendChild(thumb);\r\n        document.body.appendChild(circle);\r\n        const { maxRadius = 40, rotationDamping = 0.06, moveDamping = 0.01 } = config;\r\n        // element\r\n        const element = {\r\n            id: this.id,\r\n            domElement: thumb,\r\n            maxRadius: maxRadius,\r\n            maxRadiusSquared: maxRadius * maxRadius,\r\n            origin: { left: thumb.offsetLeft, top: thumb.offsetTop },\r\n            offset: { x: 0, y: 0 },\r\n            rotationDamping: rotationDamping,\r\n            moveDamping: moveDamping\r\n        };\r\n        if (element === null || element === void 0 ? void 0 : element.domElement) {\r\n            const { domElement } = element;\r\n            if ('ontouchstart' in window) {\r\n                domElement.addEventListener('touchstart', evt => {\r\n                    evt.preventDefault();\r\n                    this.tap(evt, element);\r\n                    evt.stopPropagation();\r\n                });\r\n            }\r\n            else {\r\n                domElement.addEventListener('mousedown', evt => {\r\n                    evt.preventDefault();\r\n                    this.tap(evt, element);\r\n                    evt.stopPropagation();\r\n                });\r\n            }\r\n        }\r\n        return {\r\n            onMove: (event) => {\r\n                this.on(`axis_onmove_${element.id}`, (delta) => {\r\n                    event(delta);\r\n                });\r\n            }\r\n        };\r\n    }\r\n    addButton(config = {}) {\r\n        this.id++;\r\n        const { styles = { right: 35, bottom: 35, size: 80 }, letter: l = 'A' } = config;\r\n        const circle = this.circle({ styles });\r\n        const letter = this.letter({ letter: l });\r\n        circle.appendChild(letter);\r\n        document.body.appendChild(circle);\r\n        // element\r\n        const element = {\r\n            id: this.id,\r\n            domElement: circle,\r\n            offset: { x: 0, y: 0 }\r\n        };\r\n        if (element === null || element === void 0 ? void 0 : element.domElement) {\r\n            this.click(element);\r\n        }\r\n        return {\r\n            onClick: (event) => {\r\n                this.on(`button_onclick_${element.id}`, (data) => {\r\n                    event(data);\r\n                });\r\n            },\r\n            onRelease: (event) => {\r\n                this.on(`button_onrelease_${element.id}`, (data) => {\r\n                    event(data);\r\n                });\r\n            }\r\n        };\r\n    }\r\n    circle(config = {}) {\r\n        const { styles } = config;\r\n        const { top, right, bottom, left, size } = styles;\r\n        const circle = document.createElement('div');\r\n        let css = `position:absolute; width:${size}px; height:${size}px; background:rgba(126, 126, 126, 0.5); border:#444 solid medium; border-radius:50%; cursor: pointer; `;\r\n        if (top)\r\n            css += `top:${top}px; `;\r\n        if (right)\r\n            css += `right:${right}px; `;\r\n        if (bottom)\r\n            css += `bottom:${bottom}px; `;\r\n        if (left)\r\n            css += `left:${left}px; `;\r\n        circle.style.cssText = css;\r\n        return circle;\r\n    }\r\n    thumb(config = {}) {\r\n        const { styles } = config;\r\n        const { size } = styles;\r\n        const thumb = document.createElement('div');\r\n        thumb.style.cssText = `position: absolute; left: ${size / 4}px; top: ${size / 4}px; width: ${size / 2}px; height: ${size / 2}px; border-radius: 50%; background: #fff; `;\r\n        return thumb;\r\n    }\r\n    letter(config = {}) {\r\n        const { letter: l } = config;\r\n        const letter = document.createElement('span');\r\n        letter.innerText = l;\r\n        letter.style.cssText =\r\n            'position: absolute; text-align: center; top: 4px; width: 80px; height: 80px; font-size: 64px; color: #fff; ';\r\n        return letter;\r\n    }\r\n    click(element) {\r\n        const { id, domElement } = element;\r\n        if ('ontouchstart' in window) {\r\n            domElement.addEventListener('touchstart', evt => {\r\n                evt.preventDefault();\r\n                this.emit(`button_onclick_${id}`);\r\n            });\r\n            domElement.addEventListener('touchend', evt => {\r\n                evt.preventDefault();\r\n                this.emit(`button_onrelease_${id}`);\r\n            });\r\n        }\r\n        else {\r\n            domElement.addEventListener('mousedown', evt => {\r\n                evt.preventDefault();\r\n                this.emit(`button_onclick_${id}`);\r\n                evt.stopPropagation();\r\n            });\r\n            domElement.addEventListener('mouseup', evt => {\r\n                evt.preventDefault();\r\n                this.emit(`button_onrelease_${id}`);\r\n                evt.stopPropagation();\r\n            });\r\n        }\r\n    }\r\n    tap(evt, element) {\r\n        evt = evt || window.event;\r\n        // get the mouse cursor position at startup:\r\n        element.offset = this.getMousePosition(evt);\r\n        if ('ontouchstart' in window) {\r\n            document.ontouchmove = evt => {\r\n                if (evt.target === element.domElement)\r\n                    this.move(evt, element);\r\n            };\r\n            document.ontouchend = evt => {\r\n                if (evt.target === element.domElement)\r\n                    this.up(element);\r\n            };\r\n        }\r\n        else {\r\n            document.onmousemove = evt => {\r\n                if (evt.target === element.domElement)\r\n                    this.move(evt, element);\r\n            };\r\n            document.onmouseup = _evt => {\r\n                this.up(element);\r\n            };\r\n        }\r\n    }\r\n    move(evt, element) {\r\n        const { domElement, maxRadius, maxRadiusSquared, origin, offset, id } = element;\r\n        evt = evt || window.event;\r\n        const mouse = this.getMousePosition(evt);\r\n        // calculate the new cursor position:\r\n        let left = mouse.x - offset.x;\r\n        let top = mouse.y - offset.y;\r\n        //this.offset = mouse;\r\n        const sqMag = left * left + top * top;\r\n        if (sqMag > maxRadiusSquared) {\r\n            //Only use sqrt if essential\r\n            const magnitude = Math.sqrt(sqMag);\r\n            left /= magnitude;\r\n            top /= magnitude;\r\n            left *= maxRadius;\r\n            top *= maxRadius;\r\n        }\r\n        // set the element's new position:\r\n        domElement.style.top = `${top + domElement.clientHeight / 2}px`;\r\n        domElement.style.left = `${left + domElement.clientWidth / 2}px`;\r\n        const forward = -(top - origin.top + domElement.clientHeight / 2) / maxRadius;\r\n        const turn = (left - origin.left + domElement.clientWidth / 2) / maxRadius;\r\n        this.emit(`axis_onmove_${id}`, { top: forward, right: turn });\r\n    }\r\n    up(element) {\r\n        const { domElement, origin, id } = element;\r\n        if ('ontouchstart' in window) {\r\n            document.ontouchmove = null;\r\n            // @ts-ignore\r\n            document.touchend = null;\r\n        }\r\n        else {\r\n            document.onmousemove = null;\r\n            document.onmouseup = null;\r\n        }\r\n        domElement.style.top = `${origin.top}px`;\r\n        domElement.style.left = `${origin.left}px`;\r\n        this.emit(`axis_onmove_${id}`, { top: 0, right: 0 });\r\n    }\r\n    getMousePosition(evt) {\r\n        // @ts-ignore\r\n        const clientX = evt.targetTouches ? evt.targetTouches[0].pageX : evt.clientX;\r\n        // @ts-ignore\r\n        const clientY = evt.targetTouches ? evt.targetTouches[0].pageY : evt.clientY;\r\n        return { x: clientX, y: clientY };\r\n    }\r\n}\r\n//# sourceMappingURL=joystick.js.map","/**\r\n * @description  This code has originally been copied from Sketchbook\r\n *\r\n * @author       swift502 <blaha.j502@gmail.com> (http://jblaha.art/)\r\n * @copyright    Copyright (c) 2018 swift502; Project Url: https://github.com/swift502/Sketchbook\r\n * @license      {@link https://github.com/swift502/Sketchbook/blob/master/LICENSE GPL-3.0}\r\n *\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE GNU GPLv3}\r\n */\r\nimport { MathUtils as THREE_Math, Vector2, Vector3 } from 'three';\r\nclass ThirdPersonControls {\r\n    constructor(camera, target, config) {\r\n        this.camera = camera;\r\n        this.target = target;\r\n        this.config = config;\r\n        const { offset = new Vector3(0, 0, 0), sensitivity = new Vector2(0.25, 0.25), radius = 8, targetRadius = 10, interpolationFactor = 0.05, pointerLock = true, autoUpdate = true, theta = 0, phi = 0, \r\n        /** Max Phi in deg */\r\n        maxPhi = 85, \r\n        /** Min Phi in deg */\r\n        minPhi = -85 } = config;\r\n        this.offset = offset;\r\n        this.sensitivity = sensitivity;\r\n        this.radius = radius;\r\n        this.targetRadius = targetRadius;\r\n        this.interpolationFactor = interpolationFactor;\r\n        this.theta = theta;\r\n        this.phi = phi;\r\n        this.maxPhi = maxPhi;\r\n        this.minPhi = minPhi;\r\n        // if (pointerLock) {\r\n        //   scene.input.on('pointerdown', () => {\r\n        //     scene.input.mouse.requestPointerLock()\r\n        //   })\r\n        //   scene.input.on('pointermove', (pointer: PointerEvent) => {\r\n        //     if (scene.input.mouse.locked) {\r\n        //       this.update(pointer.movementX, pointer.movementY)\r\n        //     }\r\n        //   })\r\n        // }\r\n        // if (autoUpdate) {\r\n        //   scene.events.on('update', () => {\r\n        //     this.update(0, 0)\r\n        //   })\r\n        // }\r\n    }\r\n    update(deltaX, deltaY) {\r\n        const target = this.target.position.clone().add(this.offset);\r\n        this.theta -= deltaX * (this.sensitivity.x / 2);\r\n        this.theta %= 360;\r\n        this.phi += deltaY * (this.sensitivity.y / 2);\r\n        this.phi = Math.min(this.maxPhi, Math.max(this.minPhi, this.phi));\r\n        this.radius = THREE_Math.lerp(this.radius, this.targetRadius, this.interpolationFactor);\r\n        this.camera.position.x =\r\n            target.x + this.radius * Math.sin((this.theta * Math.PI) / 180) * Math.cos((this.phi * Math.PI) / 180);\r\n        this.camera.position.y = target.y + this.radius * Math.sin((this.phi * Math.PI) / 180);\r\n        this.camera.position.z =\r\n            target.z + this.radius * Math.cos((this.theta * Math.PI) / 180) * Math.cos((this.phi * Math.PI) / 180);\r\n        this.camera.updateMatrix();\r\n        this.camera.lookAt(target);\r\n    }\r\n}\r\nexport { ThirdPersonControls };\r\n//# sourceMappingURL=thirdPersonControls.js.map","/**\r\n * @description  This code has originally been copied from Sketchbook\r\n *\r\n * @author       swift502 <blaha.j502@gmail.com> (http://jblaha.art/)\r\n * @copyright    Copyright (c) 2018 swift502; Project Url: https://github.com/swift502/Sketchbook\r\n * @license      {@link https://github.com/swift502/Sketchbook/blob/master/LICENSE GPL-3.0}\r\n *\r\n * @author       Yannick Deubel (https://github.com/yandeu)\r\n * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\r\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE GNU GPLv3}\r\n */\r\nimport { Vector2, Vector3 } from 'three';\r\nclass FirstPersonControls {\r\n    constructor(camera, target, config) {\r\n        this.camera = camera;\r\n        this.target = target;\r\n        this.config = config;\r\n        const { offset = new Vector3(0, 0, 0), sensitivity = new Vector2(0.25, 0.25), radius = 8, targetRadius = 10, interpolationFactor = 0.05, pointerLock = true, autoUpdate = true } = config;\r\n        this.offset = offset;\r\n        this.sensitivity = sensitivity;\r\n        this.radius = radius;\r\n        this.targetRadius = targetRadius;\r\n        this.interpolationFactor = interpolationFactor;\r\n        this.theta = 0;\r\n        this.phi = 0;\r\n        // if (pointerLock) {\r\n        //   scene.input.on('pointerdown', () => {\r\n        //     scene.input.mouse.requestPointerLock()\r\n        //   })\r\n        //   scene.input.on('pointermove', (pointer: PointerEvent) => {\r\n        //     if (scene.input.mouse.locked) {\r\n        //       this.update(pointer.movementX, pointer.movementY)\r\n        //     }\r\n        //   })\r\n        // }\r\n        // if (autoUpdate) {\r\n        //   scene.events.on('update', () => {\r\n        //     this.update(0, 0)\r\n        //   })\r\n        // }\r\n    }\r\n    update(deltaX, deltaY) {\r\n        const center = this.target.position.clone().add(this.offset);\r\n        this.camera.position.copy(center);\r\n        this.theta -= deltaX * (this.sensitivity.x / 2);\r\n        this.theta %= 360;\r\n        this.phi += deltaY * (-this.sensitivity.y / 2);\r\n        this.phi = Math.min(85, Math.max(-85, this.phi));\r\n        const lookAt = new Vector3();\r\n        lookAt.x = center.x + this.radius * Math.sin((this.theta * Math.PI) / 180) * Math.cos((this.phi * Math.PI) / 180);\r\n        lookAt.y = center.y + this.radius * Math.sin((this.phi * Math.PI) / 180);\r\n        lookAt.z = center.z + this.radius * Math.cos((this.theta * Math.PI) / 180) * Math.cos((this.phi * Math.PI) / 180);\r\n        this.camera.updateMatrix();\r\n        this.camera.lookAt(lookAt);\r\n    }\r\n}\r\nexport { FirstPersonControls };\r\n//# sourceMappingURL=firstPersonControls.js.map","class PointerLock {\r\n    constructor(_element, autoLock = true) {\r\n        this._element = _element;\r\n        this._isRunning = false;\r\n        if (autoLock)\r\n            this.request();\r\n    }\r\n    isLocked() {\r\n        return !!document.pointerLockElement;\r\n    }\r\n    exit() {\r\n        this._isRunning = false;\r\n        document.exitPointerLock();\r\n        this.removeListeners();\r\n    }\r\n    removeListeners() {\r\n        document.removeEventListener('pointerlockchange', () => this.pointerLockChangeHandler());\r\n        this._element.removeEventListener('pointerdown', () => this.pointerDownHandlerHandler());\r\n    }\r\n    pointerLockChangeHandler() {\r\n        if (!this._isRunning)\r\n            return;\r\n        this._request();\r\n    }\r\n    pointerDownHandlerHandler() {\r\n        if (!this._isRunning)\r\n            return;\r\n        this._element.requestPointerLock();\r\n    }\r\n    request() {\r\n        this._isRunning = true;\r\n        this._request();\r\n    }\r\n    _request() {\r\n        // listen to pointer lock change events\r\n        document.addEventListener('pointerlockchange', () => this.pointerLockChangeHandler(), {\r\n            once: true\r\n        });\r\n        // return if pointer is already locked\r\n        if (document.pointerLockElement)\r\n            return;\r\n        // listen for pointerdown event\r\n        this._element.addEventListener('pointerdown', () => this.pointerDownHandlerHandler(), { once: true });\r\n    }\r\n}\r\nexport { PointerLock };\r\n//# sourceMappingURL=pointerLock.js.map","class PointerDrag {\r\n    constructor(_element, autoStart = true) {\r\n        this._element = _element;\r\n        this._isRunning = false;\r\n        this._position = { x: 0, y: 0 };\r\n        this._delta = { x: 0, y: 0 };\r\n        this._onMoveCallback = () => { };\r\n        this._isPointerDown = false;\r\n        if (autoStart)\r\n            this.start();\r\n    }\r\n    get isTouchDevice() {\r\n        return 'ontouchstart' in window;\r\n    }\r\n    get isPointerDown() {\r\n        return this._isPointerDown;\r\n    }\r\n    start() {\r\n        if (this._isRunning)\r\n            return;\r\n        this._isRunning = true;\r\n        if (this.isTouchDevice) {\r\n            this._element.addEventListener('touchstart', e => this.onTouchStart(e));\r\n            this._element.addEventListener('touchend', e => this.onTouchEnd(e));\r\n            this._element.addEventListener('touchmove', e => this.onTouchMove(e));\r\n        }\r\n        else {\r\n            this._element.addEventListener('mousedown', e => this.onPointerDown(e));\r\n            this._element.addEventListener('mouseup', e => this.onPointerUp(e));\r\n            this._element.addEventListener('mouseleave', e => this.onPointerLeave(e));\r\n            this._element.addEventListener('mouseover', e => this.onPointerOver(e));\r\n            this._element.addEventListener('mousemove', e => this.onPointerMove(e));\r\n        }\r\n    }\r\n    stop() {\r\n        if (this.isTouchDevice) {\r\n            this._element.removeEventListener('touchstart', e => this.onTouchStart(e));\r\n            this._element.removeEventListener('touchend', e => this.onTouchEnd(e));\r\n            this._element.removeEventListener('touchmove', e => this.onTouchMove(e));\r\n        }\r\n        else {\r\n            this._element.removeEventListener('mousedown', e => this.onPointerDown(e));\r\n            this._element.removeEventListener('mouseleave', e => this.onPointerLeave(e));\r\n            this._element.removeEventListener('mouseup', e => this.onPointerUp(e));\r\n            this._element.removeEventListener('mouseover', e => this.onPointerOver(e));\r\n            this._element.removeEventListener('mousemove', e => this.onPointerMove(e));\r\n        }\r\n        this._isRunning = false;\r\n    }\r\n    removeListeners() {\r\n        this.stop();\r\n    }\r\n    onMove(onMoveCallback) {\r\n        this._onMoveCallback = onMoveCallback;\r\n    }\r\n    onPointerDown(_e) {\r\n        this._isPointerDown = true;\r\n    }\r\n    onPointerUp(_e) {\r\n        this._isPointerDown = false;\r\n    }\r\n    onPointerLeave(_e) {\r\n        this._isPointerDown = false;\r\n    }\r\n    onPointerMove(e) {\r\n        const clientX = e.movementX;\r\n        const clientY = e.movementY;\r\n        this._delta = { x: clientX, y: clientY };\r\n        this._onMoveCallback(this._delta);\r\n    }\r\n    onPointerOver(_e) { }\r\n    onTouchStart(e) {\r\n        const clientX = e.touches[0].clientX;\r\n        const clientY = e.touches[0].clientY;\r\n        this._position = { x: clientX, y: clientY };\r\n    }\r\n    onTouchEnd(_e) {\r\n        this._position = { x: 0, y: 0 };\r\n        this._delta = { x: 0, y: 0 };\r\n        this._onMoveCallback(this._delta);\r\n    }\r\n    onTouchMove(e) {\r\n        const clientX = e.touches[0].clientX;\r\n        const clientY = e.touches[0].clientY;\r\n        this._delta = { x: clientX - this._position.x, y: clientY - this._position.y };\r\n        this._onMoveCallback(this._delta);\r\n        this._position = { x: clientX, y: clientY };\r\n    }\r\n}\r\nexport { PointerDrag };\r\n//# sourceMappingURL=pointerDrag.js.map","/**\n * Full-screen textured quad shader\n */\n\nvar CopyShader = {\n\n\tuniforms: {\n\n\t\t'tDiffuse': { value: null },\n\t\t'opacity': { value: 1.0 }\n\n\t},\n\n\tvertexShader: /* glsl */`\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}`,\n\n\tfragmentShader: /* glsl */`\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\t\t}`\n\n};\n\nexport { CopyShader };\n","import {\n\tBufferGeometry,\n\tFloat32BufferAttribute,\n\tOrthographicCamera,\n\tMesh\n} from 'three';\n\nclass Pass {\n\n\tconstructor() {\n\n\t\t// if set to true, the pass is processed by the composer\n\t\tthis.enabled = true;\n\n\t\t// if set to true, the pass indicates to swap read and write buffer after rendering\n\t\tthis.needsSwap = true;\n\n\t\t// if set to true, the pass clears its buffer before rendering\n\t\tthis.clear = false;\n\n\t\t// if set to true, the result of the pass is rendered to screen. This is set automatically by EffectComposer.\n\t\tthis.renderToScreen = false;\n\n\t}\n\n\tsetSize( /* width, height */ ) {}\n\n\trender( /* renderer, writeBuffer, readBuffer, deltaTime, maskActive */ ) {\n\n\t\tconsole.error( 'THREE.Pass: .render() must be implemented in derived pass.' );\n\n\t}\n\n}\n\n// Helper for passes that need to fill the viewport with a single quad.\n\nconst _camera = new OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );\n\n// https://github.com/mrdoob/three.js/pull/21358\n\nconst _geometry = new BufferGeometry();\n_geometry.setAttribute( 'position', new Float32BufferAttribute( [ - 1, 3, 0, - 1, - 1, 0, 3, - 1, 0 ], 3 ) );\n_geometry.setAttribute( 'uv', new Float32BufferAttribute( [ 0, 2, 0, 0, 2, 0 ], 2 ) );\n\nclass FullScreenQuad {\n\n\tconstructor( material ) {\n\n\t\tthis._mesh = new Mesh( _geometry, material );\n\n\t}\n\n\tdispose() {\n\n\t\tthis._mesh.geometry.dispose();\n\n\t}\n\n\trender( renderer ) {\n\n\t\trenderer.render( this._mesh, _camera );\n\n\t}\n\n\tget material() {\n\n\t\treturn this._mesh.material;\n\n\t}\n\n\tset material( value ) {\n\n\t\tthis._mesh.material = value;\n\n\t}\n\n}\n\nexport { Pass, FullScreenQuad };\n","import {\n\tShaderMaterial,\n\tUniformsUtils\n} from 'three';\nimport { Pass, FullScreenQuad } from '../postprocessing/Pass.js';\n\nclass ShaderPass extends Pass {\n\n\tconstructor( shader, textureID ) {\n\n\t\tsuper();\n\n\t\tthis.textureID = ( textureID !== undefined ) ? textureID : 'tDiffuse';\n\n\t\tif ( shader instanceof ShaderMaterial ) {\n\n\t\t\tthis.uniforms = shader.uniforms;\n\n\t\t\tthis.material = shader;\n\n\t\t} else if ( shader ) {\n\n\t\t\tthis.uniforms = UniformsUtils.clone( shader.uniforms );\n\n\t\t\tthis.material = new ShaderMaterial( {\n\n\t\t\t\tdefines: Object.assign( {}, shader.defines ),\n\t\t\t\tuniforms: this.uniforms,\n\t\t\t\tvertexShader: shader.vertexShader,\n\t\t\t\tfragmentShader: shader.fragmentShader\n\n\t\t\t} );\n\n\t\t}\n\n\t\tthis.fsQuad = new FullScreenQuad( this.material );\n\n\t}\n\n\trender( renderer, writeBuffer, readBuffer /*, deltaTime, maskActive */ ) {\n\n\t\tif ( this.uniforms[ this.textureID ] ) {\n\n\t\t\tthis.uniforms[ this.textureID ].value = readBuffer.texture;\n\n\t\t}\n\n\t\tthis.fsQuad.material = this.material;\n\n\t\tif ( this.renderToScreen ) {\n\n\t\t\trenderer.setRenderTarget( null );\n\t\t\tthis.fsQuad.render( renderer );\n\n\t\t} else {\n\n\t\t\trenderer.setRenderTarget( writeBuffer );\n\t\t\t// TODO: Avoid using autoClear properties, see https://github.com/mrdoob/three.js/pull/15571#issuecomment-465669600\n\t\t\tif ( this.clear ) renderer.clear( renderer.autoClearColor, renderer.autoClearDepth, renderer.autoClearStencil );\n\t\t\tthis.fsQuad.render( renderer );\n\n\t\t}\n\n\t}\n\n}\n\nexport { ShaderPass };\n","import { Pass } from '../postprocessing/Pass.js';\n\nclass MaskPass extends Pass {\n\n\tconstructor( scene, camera ) {\n\n\t\tsuper();\n\n\t\tthis.scene = scene;\n\t\tthis.camera = camera;\n\n\t\tthis.clear = true;\n\t\tthis.needsSwap = false;\n\n\t\tthis.inverse = false;\n\n\t}\n\n\trender( renderer, writeBuffer, readBuffer /*, deltaTime, maskActive */ ) {\n\n\t\tconst context = renderer.getContext();\n\t\tconst state = renderer.state;\n\n\t\t// don't update color or depth\n\n\t\tstate.buffers.color.setMask( false );\n\t\tstate.buffers.depth.setMask( false );\n\n\t\t// lock buffers\n\n\t\tstate.buffers.color.setLocked( true );\n\t\tstate.buffers.depth.setLocked( true );\n\n\t\t// set up stencil\n\n\t\tlet writeValue, clearValue;\n\n\t\tif ( this.inverse ) {\n\n\t\t\twriteValue = 0;\n\t\t\tclearValue = 1;\n\n\t\t} else {\n\n\t\t\twriteValue = 1;\n\t\t\tclearValue = 0;\n\n\t\t}\n\n\t\tstate.buffers.stencil.setTest( true );\n\t\tstate.buffers.stencil.setOp( context.REPLACE, context.REPLACE, context.REPLACE );\n\t\tstate.buffers.stencil.setFunc( context.ALWAYS, writeValue, 0xffffffff );\n\t\tstate.buffers.stencil.setClear( clearValue );\n\t\tstate.buffers.stencil.setLocked( true );\n\n\t\t// draw into the stencil buffer\n\n\t\trenderer.setRenderTarget( readBuffer );\n\t\tif ( this.clear ) renderer.clear();\n\t\trenderer.render( this.scene, this.camera );\n\n\t\trenderer.setRenderTarget( writeBuffer );\n\t\tif ( this.clear ) renderer.clear();\n\t\trenderer.render( this.scene, this.camera );\n\n\t\t// unlock color and depth buffer for subsequent rendering\n\n\t\tstate.buffers.color.setLocked( false );\n\t\tstate.buffers.depth.setLocked( false );\n\n\t\t// only render where stencil is set to 1\n\n\t\tstate.buffers.stencil.setLocked( false );\n\t\tstate.buffers.stencil.setFunc( context.EQUAL, 1, 0xffffffff ); // draw if == 1\n\t\tstate.buffers.stencil.setOp( context.KEEP, context.KEEP, context.KEEP );\n\t\tstate.buffers.stencil.setLocked( true );\n\n\t}\n\n}\n\nclass ClearMaskPass extends Pass {\n\n\tconstructor() {\n\n\t\tsuper();\n\n\t\tthis.needsSwap = false;\n\n\t}\n\n\trender( renderer /*, writeBuffer, readBuffer, deltaTime, maskActive */ ) {\n\n\t\trenderer.state.buffers.stencil.setLocked( false );\n\t\trenderer.state.buffers.stencil.setTest( false );\n\n\t}\n\n}\n\nexport { MaskPass, ClearMaskPass };\n","import {\n\tBufferGeometry,\n\tClock,\n\tFloat32BufferAttribute,\n\tLinearFilter,\n\tMesh,\n\tOrthographicCamera,\n\tRGBAFormat,\n\tVector2,\n\tWebGLRenderTarget\n} from 'three';\nimport { CopyShader } from '../shaders/CopyShader.js';\nimport { ShaderPass } from '../postprocessing/ShaderPass.js';\nimport { MaskPass } from '../postprocessing/MaskPass.js';\nimport { ClearMaskPass } from '../postprocessing/MaskPass.js';\n\nclass EffectComposer {\n\n\tconstructor( renderer, renderTarget ) {\n\n\t\tthis.renderer = renderer;\n\n\t\tif ( renderTarget === undefined ) {\n\n\t\t\tconst parameters = {\n\t\t\t\tminFilter: LinearFilter,\n\t\t\t\tmagFilter: LinearFilter,\n\t\t\t\tformat: RGBAFormat\n\t\t\t};\n\n\t\t\tconst size = renderer.getSize( new Vector2() );\n\t\t\tthis._pixelRatio = renderer.getPixelRatio();\n\t\t\tthis._width = size.width;\n\t\t\tthis._height = size.height;\n\n\t\t\trenderTarget = new WebGLRenderTarget( this._width * this._pixelRatio, this._height * this._pixelRatio, parameters );\n\t\t\trenderTarget.texture.name = 'EffectComposer.rt1';\n\n\t\t} else {\n\n\t\t\tthis._pixelRatio = 1;\n\t\t\tthis._width = renderTarget.width;\n\t\t\tthis._height = renderTarget.height;\n\n\t\t}\n\n\t\tthis.renderTarget1 = renderTarget;\n\t\tthis.renderTarget2 = renderTarget.clone();\n\t\tthis.renderTarget2.texture.name = 'EffectComposer.rt2';\n\n\t\tthis.writeBuffer = this.renderTarget1;\n\t\tthis.readBuffer = this.renderTarget2;\n\n\t\tthis.renderToScreen = true;\n\n\t\tthis.passes = [];\n\n\t\t// dependencies\n\n\t\tif ( CopyShader === undefined ) {\n\n\t\t\tconsole.error( 'THREE.EffectComposer relies on CopyShader' );\n\n\t\t}\n\n\t\tif ( ShaderPass === undefined ) {\n\n\t\t\tconsole.error( 'THREE.EffectComposer relies on ShaderPass' );\n\n\t\t}\n\n\t\tthis.copyPass = new ShaderPass( CopyShader );\n\n\t\tthis.clock = new Clock();\n\n\t}\n\n\tswapBuffers() {\n\n\t\tconst tmp = this.readBuffer;\n\t\tthis.readBuffer = this.writeBuffer;\n\t\tthis.writeBuffer = tmp;\n\n\t}\n\n\taddPass( pass ) {\n\n\t\tthis.passes.push( pass );\n\t\tpass.setSize( this._width * this._pixelRatio, this._height * this._pixelRatio );\n\n\t}\n\n\tinsertPass( pass, index ) {\n\n\t\tthis.passes.splice( index, 0, pass );\n\t\tpass.setSize( this._width * this._pixelRatio, this._height * this._pixelRatio );\n\n\t}\n\n\tremovePass( pass ) {\n\n\t\tconst index = this.passes.indexOf( pass );\n\n\t\tif ( index !== - 1 ) {\n\n\t\t\tthis.passes.splice( index, 1 );\n\n\t\t}\n\n\t}\n\n\tisLastEnabledPass( passIndex ) {\n\n\t\tfor ( let i = passIndex + 1; i < this.passes.length; i ++ ) {\n\n\t\t\tif ( this.passes[ i ].enabled ) {\n\n\t\t\t\treturn false;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn true;\n\n\t}\n\n\trender( deltaTime ) {\n\n\t\t// deltaTime value is in seconds\n\n\t\tif ( deltaTime === undefined ) {\n\n\t\t\tdeltaTime = this.clock.getDelta();\n\n\t\t}\n\n\t\tconst currentRenderTarget = this.renderer.getRenderTarget();\n\n\t\tlet maskActive = false;\n\n\t\tfor ( let i = 0, il = this.passes.length; i < il; i ++ ) {\n\n\t\t\tconst pass = this.passes[ i ];\n\n\t\t\tif ( pass.enabled === false ) continue;\n\n\t\t\tpass.renderToScreen = ( this.renderToScreen && this.isLastEnabledPass( i ) );\n\t\t\tpass.render( this.renderer, this.writeBuffer, this.readBuffer, deltaTime, maskActive );\n\n\t\t\tif ( pass.needsSwap ) {\n\n\t\t\t\tif ( maskActive ) {\n\n\t\t\t\t\tconst context = this.renderer.getContext();\n\t\t\t\t\tconst stencil = this.renderer.state.buffers.stencil;\n\n\t\t\t\t\t//context.stencilFunc( context.NOTEQUAL, 1, 0xffffffff );\n\t\t\t\t\tstencil.setFunc( context.NOTEQUAL, 1, 0xffffffff );\n\n\t\t\t\t\tthis.copyPass.render( this.renderer, this.writeBuffer, this.readBuffer, deltaTime );\n\n\t\t\t\t\t//context.stencilFunc( context.EQUAL, 1, 0xffffffff );\n\t\t\t\t\tstencil.setFunc( context.EQUAL, 1, 0xffffffff );\n\n\t\t\t\t}\n\n\t\t\t\tthis.swapBuffers();\n\n\t\t\t}\n\n\t\t\tif ( MaskPass !== undefined ) {\n\n\t\t\t\tif ( pass instanceof MaskPass ) {\n\n\t\t\t\t\tmaskActive = true;\n\n\t\t\t\t} else if ( pass instanceof ClearMaskPass ) {\n\n\t\t\t\t\tmaskActive = false;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.renderer.setRenderTarget( currentRenderTarget );\n\n\t}\n\n\treset( renderTarget ) {\n\n\t\tif ( renderTarget === undefined ) {\n\n\t\t\tconst size = this.renderer.getSize( new Vector2() );\n\t\t\tthis._pixelRatio = this.renderer.getPixelRatio();\n\t\t\tthis._width = size.width;\n\t\t\tthis._height = size.height;\n\n\t\t\trenderTarget = this.renderTarget1.clone();\n\t\t\trenderTarget.setSize( this._width * this._pixelRatio, this._height * this._pixelRatio );\n\n\t\t}\n\n\t\tthis.renderTarget1.dispose();\n\t\tthis.renderTarget2.dispose();\n\t\tthis.renderTarget1 = renderTarget;\n\t\tthis.renderTarget2 = renderTarget.clone();\n\n\t\tthis.writeBuffer = this.renderTarget1;\n\t\tthis.readBuffer = this.renderTarget2;\n\n\t}\n\n\tsetSize( width, height ) {\n\n\t\tthis._width = width;\n\t\tthis._height = height;\n\n\t\tconst effectiveWidth = this._width * this._pixelRatio;\n\t\tconst effectiveHeight = this._height * this._pixelRatio;\n\n\t\tthis.renderTarget1.setSize( effectiveWidth, effectiveHeight );\n\t\tthis.renderTarget2.setSize( effectiveWidth, effectiveHeight );\n\n\t\tfor ( let i = 0; i < this.passes.length; i ++ ) {\n\n\t\t\tthis.passes[ i ].setSize( effectiveWidth, effectiveHeight );\n\n\t\t}\n\n\t}\n\n\tsetPixelRatio( pixelRatio ) {\n\n\t\tthis._pixelRatio = pixelRatio;\n\n\t\tthis.setSize( this._width, this._height );\n\n\t}\n\n}\n\n\nclass Pass {\n\n\tconstructor() {\n\n\t\t// if set to true, the pass is processed by the composer\n\t\tthis.enabled = true;\n\n\t\t// if set to true, the pass indicates to swap read and write buffer after rendering\n\t\tthis.needsSwap = true;\n\n\t\t// if set to true, the pass clears its buffer before rendering\n\t\tthis.clear = false;\n\n\t\t// if set to true, the result of the pass is rendered to screen. This is set automatically by EffectComposer.\n\t\tthis.renderToScreen = false;\n\n\t}\n\n\tsetSize( /* width, height */ ) {}\n\n\trender( /* renderer, writeBuffer, readBuffer, deltaTime, maskActive */ ) {\n\n\t\tconsole.error( 'THREE.Pass: .render() must be implemented in derived pass.' );\n\n\t}\n\n}\n\n// Helper for passes that need to fill the viewport with a single quad.\n\nconst _camera = new OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );\n\n// https://github.com/mrdoob/three.js/pull/21358\n\nconst _geometry = new BufferGeometry();\n_geometry.setAttribute( 'position', new Float32BufferAttribute( [ - 1, 3, 0, - 1, - 1, 0, 3, - 1, 0 ], 3 ) );\n_geometry.setAttribute( 'uv', new Float32BufferAttribute( [ 0, 2, 0, 0, 2, 0 ], 2 ) );\n\nclass FullScreenQuad {\n\n\tconstructor( material ) {\n\n\t\tthis._mesh = new Mesh( _geometry, material );\n\n\t}\n\n\tdispose() {\n\n\t\tthis._mesh.geometry.dispose();\n\n\t}\n\n\trender( renderer ) {\n\n\t\trenderer.render( this._mesh, _camera );\n\n\t}\n\n\tget material() {\n\n\t\treturn this._mesh.material;\n\n\t}\n\n\tset material( value ) {\n\n\t\tthis._mesh.material = value;\n\n\t}\n\n}\n\nexport { EffectComposer, Pass, FullScreenQuad };\n","import {\n\tColor\n} from 'three';\nimport { Pass } from '../postprocessing/Pass.js';\n\nclass RenderPass extends Pass {\n\n\tconstructor( scene, camera, overrideMaterial, clearColor, clearAlpha ) {\n\n\t\tsuper();\n\n\t\tthis.scene = scene;\n\t\tthis.camera = camera;\n\n\t\tthis.overrideMaterial = overrideMaterial;\n\n\t\tthis.clearColor = clearColor;\n\t\tthis.clearAlpha = ( clearAlpha !== undefined ) ? clearAlpha : 0;\n\n\t\tthis.clear = true;\n\t\tthis.clearDepth = false;\n\t\tthis.needsSwap = false;\n\t\tthis._oldClearColor = new Color();\n\n\t}\n\n\trender( renderer, writeBuffer, readBuffer /*, deltaTime, maskActive */ ) {\n\n\t\tconst oldAutoClear = renderer.autoClear;\n\t\trenderer.autoClear = false;\n\n\t\tlet oldClearAlpha, oldOverrideMaterial;\n\n\t\tif ( this.overrideMaterial !== undefined ) {\n\n\t\t\toldOverrideMaterial = this.scene.overrideMaterial;\n\n\t\t\tthis.scene.overrideMaterial = this.overrideMaterial;\n\n\t\t}\n\n\t\tif ( this.clearColor ) {\n\n\t\t\trenderer.getClearColor( this._oldClearColor );\n\t\t\toldClearAlpha = renderer.getClearAlpha();\n\n\t\t\trenderer.setClearColor( this.clearColor, this.clearAlpha );\n\n\t\t}\n\n\t\tif ( this.clearDepth ) {\n\n\t\t\trenderer.clearDepth();\n\n\t\t}\n\n\t\trenderer.setRenderTarget( this.renderToScreen ? null : readBuffer );\n\n\t\t// TODO: Avoid using autoClear properties, see https://github.com/mrdoob/three.js/pull/15571#issuecomment-465669600\n\t\tif ( this.clear ) renderer.clear( renderer.autoClearColor, renderer.autoClearDepth, renderer.autoClearStencil );\n\t\trenderer.render( this.scene, this.camera );\n\n\t\tif ( this.clearColor ) {\n\n\t\t\trenderer.setClearColor( this._oldClearColor, oldClearAlpha );\n\n\t\t}\n\n\t\tif ( this.overrideMaterial !== undefined ) {\n\n\t\t\tthis.scene.overrideMaterial = oldOverrideMaterial;\n\n\t\t}\n\n\t\trenderer.autoClear = oldAutoClear;\n\n\t}\n\n}\n\nexport { RenderPass };\n","/**\n * RGB Shift Shader\n * Shifts red and blue channels from center in opposite directions\n * Ported from http://kriss.cx/tom/2009/05/rgb-shift/\n * by Tom Butterworth / http://kriss.cx/tom/\n *\n * amount: shift distance (1 is width of input)\n * angle: shift angle in radians\n */\n\nconst DigitalGlitch = {\n\n\tuniforms: {\n\n\t\t'tDiffuse': { value: null }, //diffuse texture\n\t\t'tDisp': { value: null }, //displacement texture for digital glitch squares\n\t\t'byp': { value: 0 }, //apply the glitch ?\n\t\t'amount': { value: 0.08 },\n\t\t'angle': { value: 0.02 },\n\t\t'seed': { value: 0.02 },\n\t\t'seed_x': { value: 0.02 }, //-1,1\n\t\t'seed_y': { value: 0.02 }, //-1,1\n\t\t'distortion_x': { value: 0.5 },\n\t\t'distortion_y': { value: 0.6 },\n\t\t'col_s': { value: 0.05 }\n\t},\n\n\tvertexShader: /* glsl */`\n\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t}`,\n\n\tfragmentShader: /* glsl */`\n\n\t\tuniform int byp; //should we apply the glitch ?\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform sampler2D tDisp;\n\n\t\tuniform float amount;\n\t\tuniform float angle;\n\t\tuniform float seed;\n\t\tuniform float seed_x;\n\t\tuniform float seed_y;\n\t\tuniform float distortion_x;\n\t\tuniform float distortion_y;\n\t\tuniform float col_s;\n\n\t\tvarying vec2 vUv;\n\n\n\t\tfloat rand(vec2 co){\n\t\t\treturn fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n\t\t}\n\n\t\tvoid main() {\n\t\t\tif(byp<1) {\n\t\t\t\tvec2 p = vUv;\n\t\t\t\tfloat xs = floor(gl_FragCoord.x / 0.5);\n\t\t\t\tfloat ys = floor(gl_FragCoord.y / 0.5);\n\t\t\t\t//based on staffantans glitch shader for unity https://github.com/staffantan/unityglitch\n\t\t\t\tvec4 normal = texture2D (tDisp, p*seed*seed);\n\t\t\t\tif(p.y<distortion_x+col_s && p.y>distortion_x-col_s*seed) {\n\t\t\t\t\tif(seed_x>0.){\n\t\t\t\t\t\tp.y = 1. - (p.y + distortion_y);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tp.y = distortion_y;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(p.x<distortion_y+col_s && p.x>distortion_y-col_s*seed) {\n\t\t\t\t\tif(seed_y>0.){\n\t\t\t\t\t\tp.x=distortion_x;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tp.x = 1. - (p.x + distortion_x);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tp.x+=normal.x*seed_x*(seed/5.);\n\t\t\t\tp.y+=normal.y*seed_y*(seed/5.);\n\t\t\t\t//base from RGB shift shader\n\t\t\t\tvec2 offset = amount * vec2( cos(angle), sin(angle));\n\t\t\t\tvec4 cr = texture2D(tDiffuse, p + offset);\n\t\t\t\tvec4 cga = texture2D(tDiffuse, p);\n\t\t\t\tvec4 cb = texture2D(tDiffuse, p - offset);\n\t\t\t\tgl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);\n\t\t\t\t//add noise\n\t\t\t\tvec4 snow = 200.*amount*vec4(rand(vec2(xs * seed,ys * seed*50.))*0.2);\n\t\t\t\tgl_FragColor = gl_FragColor+ snow;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tgl_FragColor=texture2D (tDiffuse, vUv);\n\t\t\t}\n\t\t}`\n\n};\n\nexport { DigitalGlitch };\n","import {\n\tDataTexture,\n\tFloatType,\n\tMathUtils,\n\tRGBFormat,\n\tShaderMaterial,\n\tUniformsUtils\n} from 'three';\nimport { Pass, FullScreenQuad } from '../postprocessing/Pass.js';\nimport { DigitalGlitch } from '../shaders/DigitalGlitch.js';\n\nclass GlitchPass extends Pass {\n\n\tconstructor( dt_size = 64 ) {\n\n\t\tsuper();\n\n\t\tif ( DigitalGlitch === undefined ) console.error( 'THREE.GlitchPass relies on DigitalGlitch' );\n\n\t\tconst shader = DigitalGlitch;\n\n\t\tthis.uniforms = UniformsUtils.clone( shader.uniforms );\n\n\t\tthis.uniforms[ 'tDisp' ].value = this.generateHeightmap( dt_size );\n\n\t\tthis.material = new ShaderMaterial( {\n\t\t\tuniforms: this.uniforms,\n\t\t\tvertexShader: shader.vertexShader,\n\t\t\tfragmentShader: shader.fragmentShader\n\t\t} );\n\n\t\tthis.fsQuad = new FullScreenQuad( this.material );\n\n\t\tthis.goWild = false;\n\t\tthis.curF = 0;\n\t\tthis.generateTrigger();\n\n\t}\n\n\trender( renderer, writeBuffer, readBuffer /*, deltaTime, maskActive */ ) {\n\n\t\tthis.uniforms[ 'tDiffuse' ].value = readBuffer.texture;\n\t\tthis.uniforms[ 'seed' ].value = Math.random();//default seeding\n\t\tthis.uniforms[ 'byp' ].value = 0;\n\n\t\tif ( this.curF % this.randX == 0 || this.goWild == true ) {\n\n\t\t\tthis.uniforms[ 'amount' ].value = Math.random() / 30;\n\t\t\tthis.uniforms[ 'angle' ].value = MathUtils.randFloat( - Math.PI, Math.PI );\n\t\t\tthis.uniforms[ 'seed_x' ].value = MathUtils.randFloat( - 1, 1 );\n\t\t\tthis.uniforms[ 'seed_y' ].value = MathUtils.randFloat( - 1, 1 );\n\t\t\tthis.uniforms[ 'distortion_x' ].value = MathUtils.randFloat( 0, 1 );\n\t\t\tthis.uniforms[ 'distortion_y' ].value = MathUtils.randFloat( 0, 1 );\n\t\t\tthis.curF = 0;\n\t\t\tthis.generateTrigger();\n\n\t\t} else if ( this.curF % this.randX < this.randX / 5 ) {\n\n\t\t\tthis.uniforms[ 'amount' ].value = Math.random() / 90;\n\t\t\tthis.uniforms[ 'angle' ].value = MathUtils.randFloat( - Math.PI, Math.PI );\n\t\t\tthis.uniforms[ 'distortion_x' ].value = MathUtils.randFloat( 0, 1 );\n\t\t\tthis.uniforms[ 'distortion_y' ].value = MathUtils.randFloat( 0, 1 );\n\t\t\tthis.uniforms[ 'seed_x' ].value = MathUtils.randFloat( - 0.3, 0.3 );\n\t\t\tthis.uniforms[ 'seed_y' ].value = MathUtils.randFloat( - 0.3, 0.3 );\n\n\t\t} else if ( this.goWild == false ) {\n\n\t\t\tthis.uniforms[ 'byp' ].value = 1;\n\n\t\t}\n\n\t\tthis.curF ++;\n\n\t\tif ( this.renderToScreen ) {\n\n\t\t\trenderer.setRenderTarget( null );\n\t\t\tthis.fsQuad.render( renderer );\n\n\t\t} else {\n\n\t\t\trenderer.setRenderTarget( writeBuffer );\n\t\t\tif ( this.clear ) renderer.clear();\n\t\t\tthis.fsQuad.render( renderer );\n\n\t\t}\n\n\t}\n\n\tgenerateTrigger() {\n\n\t\tthis.randX = MathUtils.randInt( 120, 240 );\n\n\t}\n\n\tgenerateHeightmap( dt_size ) {\n\n\t\tconst data_arr = new Float32Array( dt_size * dt_size * 3 );\n\t\tconst length = dt_size * dt_size;\n\n\t\tfor ( let i = 0; i < length; i ++ ) {\n\n\t\t\tconst val = MathUtils.randFloat( 0, 1 );\n\t\t\tdata_arr[ i * 3 + 0 ] = val;\n\t\t\tdata_arr[ i * 3 + 1 ] = val;\n\t\t\tdata_arr[ i * 3 + 2 ] = val;\n\n\t\t}\n\n\t\treturn new DataTexture( data_arr, dt_size, dt_size, RGBFormat, FloatType );\n\n\t}\n\n}\n\nexport { GlitchPass };\n","import {\n\tVector2\n} from 'three';\n\n/**\n * Dot screen shader\n * based on glfx.js sepia shader\n * https://github.com/evanw/glfx.js\n */\n\nconst DotScreenShader = {\n\n\tuniforms: {\n\n\t\t'tDiffuse': { value: null },\n\t\t'tSize': { value: new Vector2( 256, 256 ) },\n\t\t'center': { value: new Vector2( 0.5, 0.5 ) },\n\t\t'angle': { value: 1.57 },\n\t\t'scale': { value: 1.0 }\n\n\t},\n\n\tvertexShader: /* glsl */`\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}`,\n\n\tfragmentShader: /* glsl */`\n\n\t\tuniform vec2 center;\n\t\tuniform float angle;\n\t\tuniform float scale;\n\t\tuniform vec2 tSize;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tfloat pattern() {\n\n\t\t\tfloat s = sin( angle ), c = cos( angle );\n\n\t\t\tvec2 tex = vUv * tSize - center;\n\t\t\tvec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;\n\n\t\t\treturn ( sin( point.x ) * sin( point.y ) ) * 4.0;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvec4 color = texture2D( tDiffuse, vUv );\n\n\t\t\tfloat average = ( color.r + color.g + color.b ) / 3.0;\n\n\t\t\tgl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );\n\n\t\t}`\n\n};\n\nexport { DotScreenShader };\n"],"names":["root","factory","exports","module","require","define","amd","self","__WEBPACK_EXTERNAL_MODULE__428__","__WEBPACK_EXTERNAL_MODULE__298__","__WEBPACK_EXTERNAL_MODULE__626__","__spreadArray","this","to","from","i","il","length","j","Object","defineProperty","value","Events","version_1","EE","fn","context","once","addListener","emitter","event","TypeError","listener","_events","has","get","set","push","_eventsCount","clearEvent","Map","delete","VERSION","enumerable","configurable","prototype","eventNames","Array","keys","listeners","handlers","l","ee","listenerCount","emit","_a","_b","args","_i","arguments","removeListener","undefined","call","apply","length_1","on","events","removeAllListeners","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","d","definition","key","o","obj","prop","hasOwnProperty","r","Symbol","toStringTag","Cameras","perspectiveCamera","config","Perspective","orthographicCamera","Orthographic","fov","aspect","window","innerWidth","innerHeight","near","far","x","y","z","camera","PerspectiveCamera","position","width","height","left","right","top","bottom","OrthographicCamera","loggerCache","logger","msg","error","count","console","warn","ExtendedObject3D","Object3D","constructor","super","isExtendedObject3D","isGroup","vector3","Vector3","hasBody","fragmentDepth","breakable","fractureImpulse","_currentAnimation","_animationActions","name","id","theta","worldTheta","phi","worldPhi","getWorldDirection","Math","atan2","acos","animationMixer","_animationMixer","AnimationMixer","current","add","animation","_animsAdd","_animsGet","play","transitionDuration","loop","_animsPlay","mixer","anims","clipAction","action","next","reset","crossFadeFrom","clampWhenFinished","setLoop","LoopOnce","setAction","traverse","callback","traverseVisible","traverseAncestors","ExtendedMesh","Mesh","geometry","material","isExtendedMesh","ExtendedGroup","Group","isExtendedGroup","isMesh","Constraints","worldTransform","physicsWorld","tmpBtVector3","Ammo","btVector3","toAmmoV3","v","lock","bodyA","bodyB","disableCollisionsBetweenLinkedBodies","fixed","pointToPoint","hinge","slider","spring","coneTwist","frameA","frameB","dof","getTransform","offset","center","assign","transformB","btTransform","setIdentity","v1","getWorldTransform","getOrigin","v2","dx","dy","dz","setOrigin","transformA","getCenterOfMassTransform","inverse","op_mul","zero","angularLowerLimit","angularUpperLimit","transform","ammo","setRotation","getRotation","constraint","btFixedConstraint","addConstraint","pivotA","pivotB","pivotV3","targetPivotV3","btPoint2PointConstraint","axisA","axisB","axisV3","targetAxisV3","btHingeConstraint","linearLowerLimit","lll","linearUpperLimit","lul","all","aul","rotationA","setEulerZYX","rotationB","btSliderConstraint","setLowerLinLimit","setUpperLinLimit","setLowerAngLimit","setUpperAngLimit","stiffness","damping","angularLock","enableSpring","off","btGeneric6DofSpringConstraint","setValue","setLinearLowerLimit","setLinearUpperLimit","setAngularLowerLimit","setAngularUpperLimit","log","PI","setStiffness","setDamping","rbAFrame","rbBFrame","btConeTwistConstraint","setAngularOnly","btGeneric6DofConstraint","destroy","TYPE","FIT","createHullShape","vertex","matrix","Matrix4","vertices","matrices","matrixWorld","options","type","_setOptions","fit","bounds","_computeBounds","btVertex","originalHull","btConvexHullShape","setMargin","margin","addVectors","max","min","multiplyScalar","vertexCount","maxVertices","hullMaxVertices","p","components","fromArray","isLastVertex","random","applyMatrix4","sub","addPoint","collisionShape","getNumVertices","shapeHull","btShapeHull","buildHull","getPointer","getVertexPointer","numVertices","_finishCollisionShape","_computeScale","createHACDShapes","vector","indexes","scale","triCount","hacd","HACD","SetCompacityWeight","compacityWeight","SetVolumeWeight","volumeWeight","SetNClusters","nClusters","SetNVerticesPerCH","nVerticesPerCH","SetConcavity","concavity","points","_malloc","triangles","SetPoints","SetTriangles","SetNPoints","SetNTriangles","pptr","tptr","HEAPF64","indices","HEAP32","Compute","_free","GetNClusters","shapes","hull","nPoints","GetNPointsCH","nTriangles","GetNTrianglesCH","hullPoints","hullTriangles","GetCH","pi","px","py","pz","createVHACDShapes","vhacd","VHACD","params","Parameters","set_m_resolution","resolution","set_m_depth","depth","set_m_concavity","set_m_planeDownsampling","planeDownsampling","set_m_convexhullDownsampling","convexhullDownsampling","set_m_alpha","alpha","set_m_beta","beta","set_m_gamma","gamma","set_m_pca","pca","set_m_mode","mode","set_m_maxNumVerticesPerCH","maxNumVerticesPerCH","set_m_minVolumePerCH","minVolumePerCH","set_m_convexhullApproximation","convexhullApproximation","set_m_oclAcceleration","oclAcceleration","nHulls","GetNConvexHulls","ch","ConvexHull","GetConvexHull","get_m_nPoints","get_m_points","createTriMeshShape","va","vb","vc","bta","btb","btc","triMesh","btTriangleMesh","index","ai","bi","ci","addTriangle","localScale","setScaling","concave","btBvhTriangleMeshShape","btConvexTriangleMeshShape","resources","iterateGeometries","cb","parseInt","REVISION","copy","invert","getInverse","setFromMatrixScale","mesh","includeInvisible","el","object3D","visible","identity","updateWorldMatrix","multiplyMatrices","isBufferGeometry","attributes","array","elements","Box3","minX","minY","minZ","maxX","maxY","maxZ","_iterateVertices","_defaultMaterial","MeshLambertMaterial","color","__rest","s","e","t","indexOf","getOwnPropertySymbols","propertyIsEnumerable","Factories","scene","isHeadless","defaultMaterial","plane","planeConfig","materialConfig","makePlane","box","boxConfig","makeBox","sphere","sphereConfig","makeSphere","cylinder","cylinderConfig","makeCylinder","cone","coneConfig","makeCone","torus","torusConfig","makeTorus","extrude","extrudeConfig","makeExtrude","addMesh","existing","object","addExisting","addPlane","addBox","ground","groundConfig","addGround","addSphere","addCylinder","addCone","addTorus","addExtrude","addMaterial","isArray","createMesh","Line","Points","castShadow","receiveShadow","shape","autoCenter","rest","bevelEnabled","ExtrudeBufferGeometry","PlaneBufferGeometry","widthSegments","heightSegments","side","DoubleSide","SphereBufferGeometry","radius","phiStart","phiLength","thetaStart","thetaLength","BoxBufferGeometry","depthSegments","rotateX","CylinderBufferGeometry","radiusTop","radiusBottom","radiusSegments","openEnded","ConeBufferGeometry","TorusBufferGeometry","tube","radialSegments","tubularSegments","arc","MeshBasicMaterial","basic","MeshNormalMaterial","normal","MeshStandardMaterial","standard","lambert","MeshPhongMaterial","phong","physical","MeshPhysicalMaterial","MeshToonMaterial","toon","LineBasicMaterial","line","PointsMaterial","custom","CollisionEvents","addCollider","object1","object2","eventCallback","body","checkCollisions","data","bodies","_v1","_line3","Line3","_plane","Plane","_closestPoint","_triangle","Triangle","tolerance","faces","newFaces","assigned","VertexList","unassigned","setFromPoints","makeEmpty","VertexNode","compute","setFromObject","updateMatrixWorld","node","isGeometry","attribute","point","fromBufferAttribute","containsPoint","distanceToPoint","intersectRay","ray","target","tNear","tFar","Infinity","face","vN","origin","vD","dot","direction","at","intersectsRay","addVertexToFace","outside","append","insertBefore","removeVertexFromFace","remove","removeAllVerticesFromFace","start","end","removeSubList","prev","deleteFaceVertices","absorbingFace","faceVertices","appendChain","nextVertex","resolveUnassignedPoints","isEmpty","first","maxDistance","maxFace","mark","distance","computeExtremes","minVertices","getComponent","setComponent","Number","EPSILON","abs","computeInitialHull","extremes","v0","v3","closestPointToPoint","distanceToSquared","setFromCoplanarPoints","Face","create","getEdge","setTwin","reindexFaces","activeFaces","nextVertexToAdd","eyeVertex","eyeFace","computeHorizon","eyePoint","crossEdge","horizon","edge","twinEdge","twin","oppositeFace","addAdjoiningFace","horizonEdge","tail","head","addNewFaces","firstSideEdge","previousSideEdge","sideEdge","addVertexToHull","clear","cleanup","midpoint","area","constant","a","b","c","e0","HalfEdge","e1","e2","getNormal","getMidpoint","getArea","distanceTo","lengthSquared","last","insertAfter","ConvexGeometry","BufferGeometry","normals","setAttribute","Float32BufferAttribute","newConvexGeometry","THREE","ConvexObjectBreaker","minSizeForBreak","smallDelta","tempLine1","tempPlane1","tempPlane2","tempPlane_Cut","tempCM1","tempCM2","tempVector3","tempVector3_2","tempVector3_3","tempVector3_P0","tempVector3_P1","tempVector3_P2","tempVector3_N0","tempVector3_N1","tempVector3_AB","tempVector3_CB","tempResultObjects","segments","prepareBreakableObject","mass","velocity","angularVelocity","userData","ammoPhysicsData","clone","subdivideByImpact","pointOfImpact","maxRadialIterations","maxRandomIterations","debris","maxTotalIterations","scope","subdivideRadial","subObject","startAngle","endAngle","numIterations","angle","applyAxisAngle","cutByPlane","obj1","obj2","output","coords","numPoints","numFaces","getIndex","getVertexIndex","faceIdx","vert","idx","points1","points2","delta","numPointPairs","p0","p1","n0","n1","a1","b1","c1","a2","b2","c2","localPlane","updateMatrix","transformPlaneToLocalSpace","segment","i0","i1","mark0","mark1","intersection","intersectLine","segmentedObject1","segmentedObject2","newMass","radius1","numPoints1","divideScalar","radius2","numPoints2","numObjects","quaternion","transformFreeVector","m","transformFreeVectorInverse","transformTiedVectorInverse","resultPlane","referencePoint","coplanarPoint","wasmSupported","WebAssembly","instantiate","Module","Uint8Array","of","Instance","message","path","doneCallback","url","tag","document","createElement","onload","onerror","Error","async","src","appendChild","loadScriptAsync","PhysicsLoader","__loadPhysics","then","derivedCtor","baseCtors","forEach","baseCtor","getOwnPropertyNames","getOwnPropertyDescriptor","Raycaster","physics","setRayFromWorld","_btRayFrom","setRayToWorld","_btRayTo","hasHit","_btRayCallback","rayTest","ClosestRayResultCallback","AllHitsRayResultCallback","ClosestRaycaster","AllHitsRaycaster","getHitPointWorld","h","get_m_hitPointWorld","getHitNormalWorld","get_m_hitNormalWorld","getCollisionObject","castObject","get_m_collisionObject","btRigidBody","threeObject","getHitPointsWorld","size","hh","getHitNormalsWorld","getCollisionObjects","threeObjects","objects","get_m_collisionObjects","rb","AmmoPhysics","rigidBodies","earlierDetectedCollisions","complexShapes","gravity","tmpEuler","Euler","tmpQuaternion","Quaternion","tmpVector3","tmpVector3a","tmpMatrix4","tmpMatrix4a","tmpBtQuaternion","btQuaternion","emptyV3","impactPoint","impactNormal","includes","isSoftBody","removeSoftBody","removeRigidBody","destructor","splice","setup","setupPhysicsWorld","convexBreaker","objectsToRemove","numObjectsToRemove","collisionEvents","collisionFlags","translateX","constraints","debugDrawer","world","debugDrawMode","drawOnTop","maxBufferSize","Float32Array","colors","BufferAttribute","setUsage","StaticDrawUsage","vertexColors","depthTest","LineSegments","renderOrder","frustumCulled","enabled","DebugDrawer","drawLine","bind","drawContactPoint","reportErrorWarning","draw3dText","setDebugMode","getDebugMode","setDebugDrawer","enable","disable","update","needsUpdate","debugDrawWorld","setDrawRange","heap","HEAPF32","g","fromX","fromY","fromZ","setXYZ","toX","toY","toZ","pointOnB","normalOnB","_lifeTime","warningString","Pointer_stringify","warnedOnce","_location","_textString","debugMode","updateDebugger","softBodies","collisionConfiguration","btDefaultCollisionConfiguration","dispatcher","btCollisionDispatcher","broadphase","btDbvtBroadphase","solver","btSequentialImpulseConstraintSolver","btDiscreteDynamicsWorld","btSoftBodyRigidBodyCollisionConfiguration","softBodySolver","btDefaultSoftBodySolver","btSoftRigidDynamicsWorld","setGravity","createDebrisFromBreakableObject","parent","setTimeout","removeDebris","updatePhysics","detectCollisions","deltaTime","stepSimulation","maxSubSteps","fixedTimeStep","objThree","ms","getMotionState","didUpdate","_emitUpdateEvents","eventEmitter","isKinematicObject","needUpdate","getWorldQuaternion","getWorldPosition","w","setWorldTransform","skipUpdate","isStaticObject","q","ignoreScale","getCollisionShape","getLocalScaling","compose","multiply","decompose","detectedCollisions","getDispatcher","numManifolds","getNumManifolds","contactManifold","getManifoldByIndexInternal","numContacts","getNumContacts","rb0","getBody0","rb1","getBody1","threeObject0","threeObject1","checkCollisions0","checkCollisions1","breakable0","breakable1","fractureImpulse0","fractureImpulse1","checkBreakable","contact","maxImpulse","contactPoint","getContactPoint","getDistance","impulse","getAppliedImpulse","get_m_positionWorldOnB","get_m_normalWorldOnB","names","sort","combinedName","find","collision","MAX_FRAGMENT_DEPTH","physicsBody","vel","getLinearVelocity","angVel","getAngularVelocity","fragment","split","obj0","collider","addConstraints","raycaster","prepareThreeObjectForCollisionShape","defaultParams","test","parameters","createCollisionShape","quat","axis","btHalfExtents","fromGeometry","vertexArray","matrixArray","indexArray","extractData","btBoxShape","btSphereShape","btCylinderShape","btCylinderShapeX","btCylinderShapeZ","btConeShape","btConeShapeX","btConeShapeZ","btCapsuleShape","btCapsuleShapeX","btCapsuleShapeZ","SIMD_PI","subdivisions","gap","sqrt","cos","cylinderShape","compoundShape","btCompoundShape","forward","rotation","rotate","addChildShape","createTorusShape","mergeCollisionShapesToCompoundShape","collisionShapes","_tmp","pos","applyPosQuatScaleMargin","getWorldScale","toString","slice","compound","collisionGroup","collisionMask","addChildren","map","localTransform","rigidBody","collisionShapeToRigidBody","addRigidBodyToWorld","cs","children","child","addRigidBody","ptr","values","errors","_needUpdate","tmpBtVector3_1","setupEventEmitter","need","onUpdateEvent","updateCallback","collisionCallback","onCollision","refresh","setFromEuler","ammoQuat","q1","normalize","setPosition","setVelocity","setLinearVelocity","setVelocityX","setVelocityY","setVelocityZ","setAngularVelocity","setAngularVelocityX","setAngularVelocityY","setAngularVelocityZ","applyForce","applyCentralImpulse","applyForceX","applyForceY","applyForceZ","applyCentralForce","applyCentralLocalForce","applyImpulse","relativePosition","applyLocalTorque","applyTorque","applyTorqueImpulse","setCollisionFlags","getCollisionFlags","setRestitution","setBounciness","setFriction","linear","angular","setLinearFactor","setAngularFactor","setCcdMotionThreshold","threshold","setCcdSweptSphereRadius","setLocalScaling","disableDeactivation","motionState","btDefaultMotionState","localInertia","calculateLocalInertia","rbInfo","btRigidBodyConstructionInfo","setActivationState","ch2","durl","URL","createObjectURL","Blob","cwk","u","Worker","revokeObjectURL","encodeURI","u8","u16","Uint16Array","u32","Uint32Array","fleb","fdeb","clim","freb","eb","fl","revfl","fd","revfd","rev","hMap","cd","mb","co","le","rvb","sv","r_1","flt","fdt","flm","flrm","fdm","fdrm","bits","bits16","shft","slc","n","subarray","inflt","dat","buf","st","sl","noBuf","noSt","cbuf","bl","nbuf","final","f","bt","lm","dm","lbt","dbt","tbts","hLit","hcLen","tl","ldt","clt","clb","clbmsk","clm","lt","dt","lms","dms","lpos","sym","dsym","wbits","wbits16","hTree","t2","et","i2","maxSym","tr","mbt","ln","lft","cst","i2_1","i2_2","i2_3","lc","cl","cli","cln","cls","clen","cf","wfblk","out","wblk","syms","lf","df","li","bs","dlt","mlb","ddt","mdb","_c","lclt","nlc","_d","lcdt","ndc","lcfreq","_e","lct","mlcb","nlcc","ll","dl","flen","ftlen","dtlen","llm","lcts","it","clct","len","dst","deo","dflt","lvl","plvl","pre","post","lst","ceil","opt","msk_1","bs1_1","bs2_1","hsh","lc_1","wi","hv","imod","pimod","rem","ch_1","dif","maxn","maxd","ml","nl","mmd","md","ti","lin","din","crct","k","crc","cr","adler","dopt","level","mem","mrg","wcln","fnStr","td","ks","lastIndexOf","replace","st_1","spInd","wrkr","fns","init","td_1","transfer","onmessage","postMessage","wk","buffer","cbfs","bInflt","inflateSync","pbf","gu8","bDflt","deflateSync","gze","gzh","gzhl","wbytes","guze","gzs","gzl","zle","zlh","zule","zlv","cbify","opts","err","terminate","consume","astrm","strm","ondata","ev","astrmify","b4","b8","filename","mtime","floor","Date","now","charCodeAt","flg","zs","lv","AsyncCmpStrm","Deflate","chunk","AsyncDeflate","deflate","Inflate","bts","AsyncInflate","inflate","Gzip","raw","AsyncGzip","gzip","gzipSync","Gunzip","AsyncGunzip","gunzip","gunzipSync","Zlib","AsyncZlib","zlib","zlibSync","Unzlib","AsyncUnzlib","unzlib","unzlibSync","Decompress","G","I","Z","_this_1","AsyncDecompress","decompress","decompressSync","fltn","val","te","TextEncoder","TextDecoder","tds","decode","stream","dutf8","String","fromCharCode","DecodeUTF8","np","EncodeUTF8","strToU8","str","latin1","ar_1","encode","ar","strFromU8","dbf","slzh","zh","fnl","es","z64e","sc","su","exfl","ex","wzh","ce","extra","col","exl","os","flag","compression","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","attrs","exf","wzf","ZipPassThrough","process","ZipDeflate","AsyncZipDeflate","Zip","file","com","comment","hl","header","chks","pAll","chks_1","chk","ind","uf","nxt","dd","zip","tot","slft","files","term","tAll","cbf","oe","cdl","badd","loc","_loop_1","cbl","zipSync","UnzipPassThrough","UnzipInflate","AsyncUnzipInflate","_","sz","Unzip","onfile","toAdd","is","oc","_loop_2","sig","this_1","bf","cmp_1","chks_2","unshift","d_1","sc_1","su_1","fn_1","file_1","ctr","chks_3","originalSize","register","decoder","unzip","_loop_3","c_1","no","infl","unzipSync","c_2","NURBSUtils","U","low","high","mid","span","N","saved","rv","temp","P","findSpan","calcBasisFunctions","C","Vector4","Nj","wNj","zeroArr","ders","ndu","s1","s2","rk","pk","j2","nd","du","CK","nders","calcBasisFunctionDerivatives","Pw","nom","denom","Pders","Aders","wders","calcKoverI","calcBSplineDerivatives","calcRationalCurveDerivatives","V","uspan","vspan","Nu","Nv","Sw","NURBSCurve","Curve","degree","knots","controlPoints","startKnot","endKnot","getPoint","optionalTarget","hpoint","calcBSplinePoint","getTangent","tangent","calcNURBSDerivatives","fbxTree","connections","sceneGraph","FBXLoader","Loader","manager","load","onLoad","onProgress","onError","LoaderUtils","loader","FileLoader","setPath","setResponseType","setRequestHeader","requestHeader","setWithCredentials","withCredentials","parse","itemError","FBXBuffer","CORRECT","byteLength","convertArrayBufferToString","isFbxFormatBinary","BinaryParser","FBXText","text","cursor","read","result","isFbxFormatASCII","getFbxVersion","TextParser","textureLoader","TextureLoader","resourcePath","setCrossOrigin","crossOrigin","FBXTreeParser","parseConnections","images","parseImages","textures","parseTextures","materials","parseMaterials","deformers","parseDeformers","geometryMap","GeometryParser","parseScene","connectionMap","Connections","rawConnection","fromID","toID","relationship","parents","parentRelationship","ID","childRelationship","blobs","Objects","videoNodes","Video","nodeID","videoNode","RelativeFilename","Filename","arrayBufferContent","Content","ArrayBuffer","base64Content","image","parseImage","pop","content","fileName","extension","toLowerCase","getHandler","textureMap","textureNodes","Texture","texture","parseTexture","textureNode","loadTexture","attrName","wrapModeU","WrapModeU","wrapModeV","WrapModeV","valueU","valueV","wrapS","RepeatWrapping","ClampToEdgeWrapping","wrapT","Scaling","repeat","currentPath","FileName","materialMap","materialNodes","Material","parseMaterial","materialNode","ShadingModel","parseParameters","setValues","BumpFactor","bumpScale","Diffuse","Color","DiffuseColor","DisplacementFactor","displacementScale","Emissive","emissive","EmissiveColor","EmissiveFactor","emissiveIntensity","parseFloat","Opacity","opacity","transparent","ReflectionFactor","reflectivity","Shininess","shininess","Specular","specular","SpecularColor","bumpMap","getTexture","aoMap","encoding","sRGBEncoding","displacementMap","emissiveMap","normalMap","envMap","mapping","EquirectangularReflectionMapping","specularMap","alphaMap","LayeredTexture","skeletons","morphTargets","DeformerNodes","Deformer","deformerNode","relationships","attrType","skeleton","parseSkeleton","geometryID","morphTarget","rawTargets","parseMorphTargets","deformerNodes","rawBones","boneNode","rawBone","weights","transformLink","TransformLink","Indexes","Weights","bones","rawMorphTargets","morphTargetNode","rawMorphTarget","initialWeight","DeformPercent","fullWeights","FullWeights","geoID","filter","modelMap","parseModels","modelNodes","Model","model","modelNode","setLookAtProperties","connection","bindSkeleton","createAmbientLight","setupMorphMaterials","transformData","parentMatrix","parentMatrixWorld","generateTransform","animations","AnimationParser","buildSkeleton","createCamera","createLight","createCurve","Bone","PropertyBinding","getTransformData","bone","subBone","cameraAttribute","attr","NodeAttribute","CameraProjectionType","nearClippingPlane","NearPlane","farClippingPlane","FarPlane","AspectWidth","AspectHeight","FieldOfView","focalLength","FocalLength","setFocalLength","lightAttribute","LightType","intensity","Intensity","CastLightOnObject","FarAttenuationEnd","EnableFarAttenuation","decay","PointLight","DirectionalLight","InnerAngle","MathUtils","penumbra","OuterAngle","SpotLight","CastShadows","FBX_Deformer","SkinnedMesh","normalizeSkinWeights","reduce","geo","linewidth","inheritType","InheritType","eulerOrder","getEulerOrder","RotationOrder","translation","Lcl_Translation","preRotation","PreRotation","Lcl_Rotation","postRotation","PostRotation","Lcl_Scaling","scalingOffset","ScalingOffset","scalingPivot","ScalingPivot","rotationOffset","RotationOffset","rotationPivot","RotationPivot","lookAtTarget","lookAt","bindMatrices","parsePoseNodes","geoConnParent","Skeleton","BindPoseNode","Pose","poseNodes","PoseNode","poseNode","Node","Matrix","GlobalSettings","ambientColor","AmbientColor","AmbientLight","morphAttributes","setupMorphMaterial","uuid","matUuid","sharedMat","mat","clonedMat","geoNodes","Geometry","parseGeometry","geoNode","parseMeshGeometry","parseNurbsGeometry","GeometricTranslation","GeometricRotation","GeometricScaling","genGeometry","preTransform","geoInfo","parseGeoNode","buffers","genBuffers","positionAttribute","Uint16BufferAttribute","weightsIndices","vertexWeights","normalMatrix","Matrix3","getNormalMatrix","normalAttribute","applyNormalMatrix","uvs","uvBuffer","mappingType","prevMaterialIndex","materialIndex","startIndex","currentIndex","addGroup","groups","lastGroup","lastIndex","addMorphTargets","vertexPositions","Vertices","vertexIndices","PolygonVertexIndex","LayerElementColor","parseVertexColors","LayerElementMaterial","parseMaterialIndices","LayerElementNormal","parseNormals","LayerElementUV","uv","UV","parseUVs","weightTable","weight","polygonIndex","faceLength","displayedWeightsWarning","facePositionIndexes","faceNormals","faceColors","faceUVs","faceWeights","faceWeightIndices","vertexIndex","polygonVertexIndex","endOfFace","weightIndices","getData","wt","wIndex","Weight","weightIndex","currentWeight","comparedWeight","comparedWeightIndex","comparedWeightArray","tmp","genFace","parentGeo","parentGeoNode","morphTargetsRelative","rawTarget","morphGeoNode","genMorphGeometry","morphPositionsSparse","morphPositions","morphIndex","morphGeoInfo","morphBuffers","NormalNode","MappingInformationType","referenceType","ReferenceInformationType","Normals","indexBuffer","NormalIndex","NormalsIndex","dataSize","UVNode","UVIndex","ColorNode","Colors","ColorIndex","MaterialNode","materialIndexBuffer","Materials","materialIndices","order","Order","isNaN","KnotVector","pointsValues","Form","getPoints","positions","toArray","animationClips","rawClips","parseClips","rawClip","clip","addClip","AnimationCurve","curveNodesMap","parseAnimationCurveNodes","parseAnimationCurves","layersMap","parseAnimationLayers","parseAnimStacks","rawCurveNodes","AnimationCurveNode","rawCurveNode","match","curveNode","curves","rawCurves","animationCurve","times","KeyTime","convertFBXTimeToSeconds","KeyValueFloat","animationCurveID","animationCurveRelationship","rawLayers","AnimationLayer","layerCurveNodes","modelID","rawModel","modelName","initialPosition","initialRotation","initialScale","morph","deformerID","morpherID","morphName","rawStacks","AnimationStack","layer","tracks","rawTracks","concat","generateTracks","AnimationClip","setFromQuaternion","T","positionTrack","generateVectorTrack","R","rotationTrack","generateRotationTrack","S","scaleTrack","morphTrack","generateMorphTrack","initialValue","getTimesForAllAxes","getKeyframeTrackValues","VectorKeyframeTrack","interpolateRotations","euler","quaternionValues","premultiply","QuaternionKeyframeTrack","morphNum","getObjectByName","morphTargetDictionary","NumberKeyframeTrack","targetIndex","lastValue","currentValue","prevValue","xIndex","yIndex","zIndex","time","xValue","yValue","zValue","curve","valuesSpan","absoluteSpan","numSubIntervals","step","nextValue","initialTime","interval","nextTime","interpolatedTimes","interpolatedValues","inject","getPrevNode","nodeStack","currentIndent","getCurrentNode","getCurrentProp","currentProp","pushStack","popStack","setCurrentProp","currentPropName","allNodes","FBXTree","matchComment","matchEmpty","matchBeginning","matchProperty","matchEnd","parseNodeBegin","parseNodeProperty","parseNodePropertyContinued","property","nodeName","trim","nodeAttrs","parseNodeAttr","currentNode","contentLine","propName","propValue","connProps","elem","parseNumberArray","parseNodeSpecialProperty","props","innerPropName","innerPropType1","innerPropType2","innerPropFlag","innerPropValue","reader","BinaryReader","skip","version","getUint32","endOfContent","parseNode","getOffset","endOffset","getUint64","numProperties","nameLen","getUint8","getString","propertyList","parseProperty","singleProperty","subNode","parseSubNode","getBoolean","getFloat64","getFloat32","getInt32","getInt64","getArrayBuffer","getInt16","arrayLength","compressedLength","getBooleanArray","getFloat64Array","getFloat32Array","getInt32Array","getInt64Array","reader2","littleEndian","dv","DataView","nullByte","dataArray","infoObject","tempEuler","tempVec","lTranslationM","lPreRotationM","lRotationM","lPostRotationM","lScalingM","lScalingPivotM","lScalingOffsetM","lRotationOffsetM","lRotationPivotM","lParentGX","lParentLX","lGlobalT","makeRotationFromEuler","lLRM","lParentGRM","extractRotation","lParentTM","copyPosition","lParentGRSM","lParentGSM","lLSM","lGlobalRS","lParentLSM_inv","lParentGSM_noLocal","lRotationPivotM_inv","lScalingPivotM_inv","lTransform","lLocalTWithAllPivotAndOffsetInfo","lGlobalTranslation","enums","GLTFLoader","dracoLoader","ktx2Loader","meshoptDecoder","pluginCallbacks","parser","GLTFMaterialsClearcoatExtension","GLTFTextureBasisUExtension","GLTFTextureWebPExtension","GLTFMaterialsTransmissionExtension","GLTFLightsExtension","GLTFMeshoptCompression","itemStart","_onError","itemEnd","gltf","setDRACOLoader","setDDSLoader","setKTX2Loader","setMeshoptDecoder","unregister","extensions","plugins","BINARY_EXTENSION_HEADER_MAGIC","EXTENSIONS","KHR_BINARY_GLTF","GLTFBinaryExtension","json","JSON","asset","GLTFParser","fileLoader","plugin","extensionsUsed","extensionName","extensionsRequired","KHR_MATERIALS_UNLIT","GLTFMaterialsUnlitExtension","KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS","GLTFMaterialsPbrSpecularGlossinessExtension","KHR_DRACO_MESH_COMPRESSION","GLTFDracoMeshCompressionExtension","KHR_TEXTURE_TRANSFORM","GLTFTextureTransformExtension","KHR_MESH_QUANTIZATION","GLTFMeshQuantizationExtension","setExtensions","setPlugins","GLTFRegistry","removeAll","KHR_LIGHTS_PUNCTUAL","KHR_MATERIALS_CLEARCOAT","KHR_MATERIALS_TRANSMISSION","KHR_TEXTURE_BASISU","EXT_TEXTURE_WEBP","EXT_MESHOPT_COMPRESSION","cache","refs","uses","_markDefs","nodeDefs","nodes","nodeIndex","nodeLength","nodeDef","light","_addNodeRef","_loadLight","lightIndex","cacheKey","dependency","lightDef","lights","lightNode","range","spot","innerConeAngle","outerConeAngle","createUniqueName","Promise","resolve","createNodeAttachment","_getNodeRef","getMaterialType","extendParams","materialParams","materialDef","pending","metallicRoughness","pbrMetallicRoughness","baseColorFactor","baseColorTexture","assignTexture","extendMaterialParams","clearcoatFactor","clearcoat","clearcoatTexture","clearcoatRoughnessFactor","clearcoatRoughness","clearcoatRoughnessTexture","clearcoatNormalTexture","clearcoatNormalScale","Vector2","transmissionFactor","transmission","transmissionTexture","textureIndex","textureDef","source","loadTextureImage","isSupported","uri","handler","detectSupport","Image","loadBufferView","bufferView","bufferViews","extensionDef","getDependency","supported","ready","res","byteOffset","stride","byteStride","decodeGltfBuffer","headerView","magic","chunkContentsLength","chunkView","chunkIndex","chunkLength","chunkType","contentArray","preload","decodePrimitive","primitive","bufferViewIndex","gltfAttributeMap","threeAttributeMap","attributeNormalizedMap","attributeTypeMap","attributeName","threeAttributeName","ATTRIBUTES","accessorDef","accessors","componentType","WEBGL_COMPONENT_TYPES","normalized","decodeDracoFile","extendTexture","texCoord","GLTFMeshStandardSGMaterial","isGLTFSpecularGlossinessMaterial","specularMapParsFragmentChunk","join","glossinessMapParsFragmentChunk","specularMapFragmentChunk","glossinessMapFragmentChunk","lightPhysicalFragmentChunk","uniforms","setHex","glossiness","glossinessMap","_extraUniforms","onBeforeCompile","shader","uniformName","fragmentShader","defineProperties","defines","USE_SPECULARMAP","USE_GLOSSINESSMAP","USE_UV","metalness","roughness","metalnessMap","roughnessMap","specularGlossinessParams","pbrSpecularGlossiness","diffuseFactor","diffuseTexture","glossinessFactor","specularFactor","specularGlossinessTexture","specGlossMapDef","createMaterial","fog","lightMap","lightMapIntensity","aoMapIntensity","normalMapType","TangentSpaceNormalMap","normalScale","displacementBias","envMapIntensity","refractionRatio","GLTFCubicSplineInterpolant","Interpolant","parameterPositions","sampleValues","sampleSize","resultBuffer","copySampleValue_","valueSize","beforeStart_","afterEnd_","interpolate_","t0","t1","stride2","stride3","pp","ppp","offset1","offset0","s3","s0","m0","m1","Int8Array","Int16Array","WEBGL_FILTERS","NearestFilter","LinearFilter","NearestMipmapNearestFilter","LinearMipmapNearestFilter","NearestMipmapLinearFilter","LinearMipmapLinearFilter","WEBGL_WRAPPINGS","MirroredRepeatWrapping","WEBGL_TYPE_SIZES","POSITION","NORMAL","TANGENT","TEXCOORD_0","TEXCOORD_1","COLOR_0","WEIGHTS_0","JOINTS_0","PATH_PROPERTIES","INTERPOLATION","CUBICSPLINE","LINEAR","InterpolateLinear","STEP","InterpolateDiscrete","resolveURL","addUnknownExtensionsToUserData","knownExtensions","objectDef","gltfExtensions","assignExtrasToUserData","gltfDef","extras","updateMorphTargets","meshDef","morphTargetInfluences","targetNames","createPrimitiveKey","primitiveDef","dracoExtension","geometryKey","createAttributesKey","attributesKey","getNormalizedComponentScale","associations","primitiveCache","meshCache","cameraCache","lightCache","textureCache","nodeNamesUsed","createImageBitmap","navigator","userAgent","ImageBitmapLoader","_invokeAll","ext","beforeRoot","getDependencies","dependencies","scenes","cameras","afterRoot","catch","skinDefs","skins","meshDefs","meshes","skinIndex","skinLength","joints","isBone","skin","isSkinnedMesh","ref","_invokeOne","func","loadScene","loadNode","loadMesh","loadAccessor","loadBuffer","loadMaterial","loadSkin","loadAnimation","loadCamera","defs","def","bufferIndex","bufferDef","reject","bufferViewDef","accessorIndex","sparse","pendingBufferViews","itemSize","TypedArray","elementBytes","BYTES_PER_ELEMENT","itemBytes","bufferAttribute","ibSlice","ibCacheKey","ib","InterleavedBuffer","InterleavedBufferAttribute","itemSizeIndices","SCALAR","TypedArrayIndices","byteOffsetIndices","byteOffsetValues","sparseIndices","sparseValues","setX","setY","setZ","setW","sampler","webkitURL","sourceURI","isObjectURL","hasAlpha","isJPEG","search","mimeType","colorType","blob","promise","isImageBitmapLoader","imageBitmap","flipY","format","RGBFormat","samplers","magFilter","minFilter","mapName","mapDef","gltfReference","assignFinalMaterial","useVertexTangents","useVertexColors","useFlatShading","useMorphTargets","useMorphNormals","isPoints","pointsMaterial","sizeAttenuation","isLine","lineMaterial","cachedMaterial","flatShading","morphNormals","vertexTangents","uv2","materialType","materialExtensions","sgExtension","kmuExtension","metallicFactor","roughnessFactor","metallicRoughnessTexture","doubleSided","alphaMode","depthWrite","alphaTest","alphaCutoff","normalTexture","occlusionTexture","strength","emissiveFactor","emissiveTexture","originalName","sanitizedName","loadGeometries","primitives","createDracoPrimitive","addPrimitiveAttributes","cached","geometryPromise","meshIndex","FrontSide","results","geometries","skinWeight","toTrianglesDrawMode","TriangleStripDrawMode","TriangleFanDrawMode","LineLoop","group","cameraIndex","cameraDef","yfov","aspectRatio","znear","zfar","xmag","ymag","skinDef","skinEntry","inverseBindMatrices","accessor","animationIndex","animationDef","pendingNodes","pendingInputAccessors","pendingOutputAccessors","pendingSamplers","pendingTargets","channels","channel","input","inputAccessors","outputAccessors","targets","inputAccessor","outputAccessor","TypedKeyframeTrack","matrixAutoUpdate","targetName","interpolation","outputArray","scaled","jl","track","createInterpolant","getValueSize","isInterpolantFactoryMethodGLTFCubicSpline","createNodeMesh","meshPromise","sceneIndex","sceneDef","nodeIds","buildNodeHierachy","nodeId","parentObject","pendingJoints","jointNodes","boneInverses","jointNode","assignAttributeAccessor","gltfAttributeName","setIndex","boxScale","maxDisplacement","expandByVector","boundingBox","Sphere","getCenter","boundingSphere","computeBounds","hasMorphPosition","hasMorphNormal","pendingPositionAccessors","pendingNormalAccessors","pendingAccessor","drawMode","getAttribute","numberOfTriangles","newIndices","getX","newGeometry","SVGLoader","defaultDPI","defaultUnit","parseArcCommand","rx","ry","x_axis_rotation","large_arc_flag","sweep_flag","lineTo","dx2","dy2","x1p","sin","y1p","rxs","rys","x1ps","y1ps","dq","pq","cxp","cyp","cx","cy","svgAngle","absellipse","ux","uy","vx","vy","ang","parseStyle","style","stylesheetStyles","hasAttribute","classSelectors","Boolean","stylesheets","addStyle","svgName","jsName","adjustFunction","startsWith","clamp","parseFloatWithUnits","positive","getReflection","parseFloats","flags","RE","SEPARATOR","WHITESPACE","DIGIT","SIGN","POINT","COMMA","EXP","FLAGS","state","seenComma","number","exponent","throwSyntaxError","partial","SyntaxError","newNumber","pow","units","unitConversion","string","theUnit","endsWith","substring","getTransformScaleX","getTransformScaleY","paths","transformStack","tempTransform0","tempTransform1","tempTransform2","tempTransform3","tempV2","tempV3","currentTransform","xml","DOMParser","parseFromString","nodeType","tx","ty","translate","transformsTexts","tIndex","transformText","openParPos","closeParPos","transformType","substr","scaleX","scaleY","tan","parseNodeTransform","getNodeTransform","traverseChildNodes","sheet","cssRules","stylesheet","selectorList","selectorText","parseCSSStylesheet","ShapePath","control","firstPoint","isFirstPoint","doSetFirstPoint","commands","command","charAt","numbers","moveTo","bezierCurveTo","quadraticCurveTo","autoClose","currentPoint","parsePathNode","parseRectNode","parsePolygonNode","parsePolylineNode","subpath","Path","absarc","subPaths","parseCircleNode","parseEllipseNode","x1","y1","x2","y2","parseLineNode","usedNodeId","href","baseVal","usedNode","viewportElement","getElementById","fill","setStyle","transfVec2","applyMatrix3","isRotated","isTransformRotated","isLineCurve","isCubicBezierCurve","isQuadraticBezierCurve","isEllipseCurve","aX","aY","xRadius","yRadius","transformPath","childNodes","documentElement","fillOpacity","strokeOpacity","strokeWidth","strokeLineJoin","strokeLineCap","strokeMiterLimit","shapePath","BIGNUMBER","classifyResult","findEdgeIntersection","a0","b0","x3","x4","y3","y4","nom1","classifyPoint","toPrecision","edgeStart","edgeEnd","ax","ay","bx","by","sa","identifier","scanlineMinX","scanlineMaxX","simplePaths","isCW","ShapeUtils","Box2","sp","isAHole","simplePath","allPaths","_fillRule","centerBoundingBox","scanlineIntersections","scanline","allIntersections","path1","path2","intersectionsRaw","intersections","path1EdgeStart","path1EdgeEnd","index2","getIntersections","getScanlineIntersections","baseIntersections","otherIntersections","firstXOfPath","stack","isHole","isHoleFor","for","lastCWValue","isHoleTo","fillRule","shapesToReturn","Shape","holes","lineJoin","lineCap","miterLimit","strokeColor","arcDivisions","minDistance","pointsToStrokeWithBuffers","vertexOffset","tempV2_1","tempV2_2","tempV2_3","tempV2_4","tempV2_5","tempV2_6","tempV2_7","lastPointL","lastPointR","point0L","point0R","currentPointL","currentPointR","nextPointL","nextPointR","innerPoint","outerPoint","dupPoints","newPoints","removeDuplicatedPoints","isClosed","equals","nextPoint","previousPoint","strokeWidth2","deltaU","u1","innerSideModified","joinIsOnLeftSide","isMiter","u0","initialJoinIsOnLeftSide","currentCoordinate","currentCoordinateUV","iPoint","normal1","subVectors","miterSide","setLength","negate","miterLength2","segmentLengthPrev","segmentLengthNext","makeSegmentTriangles","makeSegmentWithBevelJoin","createSegmentTrianglesWithMiddleSection","makeCircularSector","miterFraction","addVertex","addCapGeometry","lastOuter","lastInner","p2","rotateAround","vl","__awaiter","thisArg","_arguments","generator","fulfilled","rejected","done","Loaders","textureAnisotropy","_fileLoader","_imgLoader","ImageLoader","_svgLoader","_textureLoader","_objectLoader","ObjectLoader","_gltfLoader","_fbxLoader","isModel","textureAtlas","_type","parsed","frames","jsonHash","frame","rotated","sourceSize","spriteSourceSize","trimmed","svg","svgLoader","anisotropy","objectLoader","gltfLoader","fbx","fbxLoader","PointLightHelper","dispose","Lights","directionalLightHelper","helper","DirectionalLightHelper","spotLightHelper","SpotLightHelper","pointLightHelper","directionalLight","hemisphereLight","skyColor","groundColor","HemisphereLight","ambientLight","pointLight","spotLight","rectAreaLight","RectAreaLight","_m1","_obj","_offset","EventDispatcher","faceVertexUvs","skinWeights","skinIndices","lineDistances","elementsNeedUpdate","verticesNeedUpdate","uvsNeedUpdate","normalsNeedUpdate","colorsNeedUpdate","lineDistancesNeedUpdate","groupsNeedUpdate","vertexNormals","computeBoundingBox","computeBoundingSphere","makeRotationX","rotateY","makeRotationY","rotateZ","makeRotationZ","makeTranslation","makeScale","fromBufferGeometry","addFace","Face3","computeFaceNormals","ab","vA","vB","vC","cross","computeVertexNormals","areaWeighted","computeFlatVertexNormals","computeMorphNormals","__originalFaceNormal","__originalVertexNormals","tmpGeo","dstNormalsFace","dstNormalsVertex","faceNormal","merge","materialIndexOffset","vertices1","vertices2","faces1","faces2","colors1","colors2","vertexCopy","faceVertexNormals","faceVertexColors","faceCopy","faceVertexUvs2","uvs2","uvsCopy","kl","mergeMesh","mergeVertices","precisionPoints","verticesMap","unique","changes","precision","round","faceIndicesToRemove","diff","sortFacesByMaterialIndex","_id","uvs1","newUvs1","newUvs2","toJSON","metadata","normalsHash","colorsHash","uvsHash","hasMaterial","hasFaceUv","hasFaceVertexUv","hasFaceNormal","hasFaceVertexNormal","hasFaceColor","hasFaceVertexColor","faceType","setBit","getUvIndex","getNormalIndex","getColorIndex","hash","getHex","morphNormal","srcVertexNormal","destVertexNormal","toBufferGeometry","DirectGeometry","buffergeometry","copyVector3sArray","copyColorsArray","copyVector2sArray","copyVector4sArray","computeTangents","computeLineDistances","applyMatrix","dispatchEvent","copyArray","computeGroups","hasFaceVertexUv2","morphTargetsLength","morphTargetsPosition","morphNormalsLength","morphTargetsNormal","hasSkinIndices","hasSkinWeights","vertexUvs","isVector3","isColor","directGeometry","fromDirectGeometry","HeightMap","heightMap","make","colorScale","canvas","ctx","getContext","drawImage","pixel","getImageData","getHighPoint","hex","_changeEvent","_startEvent","_endEvent","OrbitControls","domElement","touchAction","minZoom","maxZoom","minPolarAngle","maxPolarAngle","minAzimuthAngle","maxAzimuthAngle","enableDamping","dampingFactor","enableZoom","zoomSpeed","enableRotate","rotateSpeed","enablePan","panSpeed","screenSpacePanning","keyPanSpeed","autoRotate","autoRotateSpeed","LEFT","UP","RIGHT","BOTTOM","mouseButtons","MOUSE","MIDDLE","touches","ONE","TOUCH","TWO","target0","position0","zoom0","zoom","_domElementKeyEvents","getPolarAngle","spherical","getAzimuthalAngle","listenToKeyEvents","addEventListener","onKeyDown","saveState","updateProjectionMatrix","STATE","NONE","setFromUnitVectors","up","quatInverse","lastPosition","lastQuaternion","twoPI","applyQuaternion","setFromVector3","rotateLeft","sphericalDelta","isFinite","makeSafe","addScaledVector","panOffset","setFromSpherical","zoomChanged","EPS","removeEventListener","onContextMenu","onPointerDown","onPointerCancel","onMouseWheel","ownerDocument","onPointerMove","onPointerUp","ROTATE","DOLLY","PAN","TOUCH_ROTATE","TOUCH_PAN","TOUCH_DOLLY_PAN","TOUCH_DOLLY_ROTATE","Spherical","rotateStart","rotateEnd","rotateDelta","panStart","panEnd","panDelta","dollyStart","dollyEnd","dollyDelta","pointers","pointerPositions","getZoomScale","rotateUp","panLeft","objectMatrix","setFromMatrixColumn","panUp","crossVectors","pan","deltaX","deltaY","element","isPerspectiveCamera","targetDistance","clientHeight","isOrthographicCamera","clientWidth","dollyOut","dollyScale","dollyIn","handleMouseDownRotate","clientX","clientY","handleMouseDownPan","handleTouchStartRotate","pageX","pageY","handleTouchStartPan","handleTouchStartDolly","handleTouchMoveRotate","getSecondPointerPosition","handleTouchMovePan","handleTouchMoveDolly","addPointer","pointerType","trackPointer","onTouchStart","mouseAction","button","handleMouseDownDolly","ctrlKey","metaKey","shiftKey","onMouseDown","handleTouchMoveDollyPan","handleTouchMoveDollyRotate","onTouchMove","handleMouseMoveRotate","handleMouseMoveDolly","handleMouseMovePan","onMouseMove","removePointer","preventDefault","handleMouseWheel","code","handleKeyDown","pointerId","pointer","passive","WarpSpeed","renderer","factories","warpSpeed","features","Features","negativeFeatures","feature","hasNegativeFeatures","vertexShader","topColor","bottomColor","skyGeo","skyMat","ShaderMaterial","BackSide","sky","shadow","mapSize","addGrid","gridData","orbitControls","Reflector","textureWidth","textureHeight","clipBias","ReflectorShader","reflectorPlane","reflectorWorldPosition","cameraWorldPosition","rotationMatrix","lookAtPosition","clipPlane","view","textureMatrix","virtualCamera","renderTarget","WebGLRenderTarget","generateMipmaps","UniformsUtils","onBeforeRender","setFromMatrixPosition","reflect","projectionMatrix","matrixWorldInverse","setFromNormalAndCoplanarPoint","sign","outputEncoding","currentRenderTarget","getRenderTarget","currentXrEnabled","xr","currentShadowAutoUpdate","shadowMap","autoUpdate","setRenderTarget","setMask","autoClear","render","viewport","isReflector","Refractor","RefractorShader","refractor","refractorPlane","refractorWorldPosition","updateRefractorPlane","updateVirtualCamera","clipVector","updateTextureMatrix","isRefractor","Water","flowDirection","flowSpeed","WaterShader","LinearEncoding","flowMap","normalMap0","normalMap1","cycle","halfCycle","clock","Clock","reflector","UniformsLib","USE_FLOWMAP","getDelta","updateFlow","isWater","Misc","water","flowX","flowY","groundGeometry","groundMaterial","waterGeometry","addWater","textureCube","TextureCube","down","front","back","Transform","bufferGeometry","fromSVGtoShape","isCCW","noHoles","toShapes","from3dto2d","project","from2dto3d","distanceFromCamera","tmpPlane","tmpRaycaster","setRotationFromEuler","setFromCamera","intersects","intersectObjects","Constants","Handedness","freeze","ComponentState","DEFAULT","TOUCHED","PRESSED","ComponentProperty","BUTTON","X_AXIS","Y_AXIS","ComponentType","TRIGGER","SQUEEZE","TOUCHPAD","THUMBSTICK","ButtonTouchThreshold","AxisTouchThreshold","VisualResponseProperty","TRANSFORM","VISIBILITY","fetchJsonFile","response","fetch","ok","statusText","defaultComponentValues","xAxis","yAxis","VisualResponse","visualResponseDescription","componentProperty","states","valueNodeName","valueNodeProperty","minNodeName","maxNodeName","updateFromComponent","normalizedXAxis","normalizedYAxis","normalizeAxes","Component","componentId","componentDescription","visualResponses","gamepadIndices","rootNodeName","touchPointNodeName","responseName","visualResponse","updateFromGamepad","gamepad","buttons","gamepadButton","pressed","touched","axes","MotionController","xrInputSource","profile","assetUrl","profileId","layoutDescription","layouts","handedness","gripSpace","targetRaySpace","component","XRControllerModel","motionController","setEnvironmentMap","force","valueNode","minNode","maxNode","slerpQuaternions","lerpVectors","addAssetSceneToControllerModel","controllerModel","touchPointNode","sphereGeometry","SphereGeometry","findNodes","XRControllerModelFactory","_assetCache","createControllerModel","controller","targetRayMode","basePath","defaultProfile","getAssetPath","supportedProfilesList","fetchProfilesList","profiles","some","supportedProfile","profilePath","deprecated","assetPath","layout","fetchProfile","cachedAsset","WebXR","_renderer","_scene","_camera","controllerModelFactory","cameraGroup","vrButton","stylizeElement","padding","border","borderRadius","background","font","textAlign","outline","display","isSessionSupported","currentSession","onSessionStarted","session","onSessionEnded","setSession","textContent","onmouseenter","onmouseleave","onclick","sessionInit","optionalFeatures","requestSession","showEnterVR","isSecureContext","location","innerHTML","textDecoration","createButton","cssText","isPresenting","getController","getControllerGrip","controllerGrip","getControllerRay","WebXRCamera","getCamera","CSGWrapper","meshA","meshB","bufferGeometryToGeometry","meshC","geometryToBufferGeometry","toGeometry","doCSG","operation","bspA","CSG","fromMesh","bspB","bspC","toMesh","polygons","csg","geom","fs","vs","polys","fm","Vertex","Polygon","fromPolygons","_tmpm3","toMatrix","ps","fvuv","pvs","pvlen","pv","fc","fuv","fnml","inv","tokens","_index","currentOp","token","iEval","op","sourceMesh","nextPrim","currentPrim","doRemove","toPolygons","union","clipTo","build","allPolygons","subtract","intersect","flip","Vector","negated","plus","minus","dividedBy","lerp","unit","interpolate","other","splitPolygon","polygon","coplanarFront","coplanarBack","polygonType","types","tj","vi","vj","shared","fromPoints","reverse","clipPolygons","bsp","Scene3D","warpSpeesd","third","haveSomeFun","numberOfElements","requestThirdDimension","clearThirdDimension","accessThirdDimension","threeGraphicsConfig","antialias","usePhysics","scene3D","WebGLRenderer","sys","game","parentElement","resize","marginLeft","marginTop","baseSize","setSize","innerText","enableXR","isXrEnabled","webXR","lastTime","setAnimationLoop","updateLoopXR","preRender","composer","postRender","extern","_time","animationMixers","misc","ws","mixers","_mixers","Between","RandomPick","main","setBackgroundColor","preUpdateXR","updateXR","postUpdateXR","_delta","__ammoPath","enable3d","withPhysics","Canvas","customCanvasConfig","canvasId","myCustomCanvas","createElementNS","contextAttributes","stencil","premultipliedAlpha","preserveDrawingBuffer","powerPreference","failIfMajorPerformanceCaveat","xrCompatible","contextCreationConfig","webgl","WebGLRenderingContext","WebGL2RenderingContext","getErrorMessage","contexts","fontFamily","fontSize","fontWeight","isWebGL2Available","myCustomContext","eventMatrix","move","maxTouchPoints","Tap","_isDown","_isPaused","active","touch","mouse","registered","_currentPosition","_lastPosition","_isPointerLockAvailable","_add","pause","resume","_onPointerLockChange","onceChange","request","pointerLock","isLocked","requestPointerLock","exit","exitPointerLock","available","pointerLockElement","_onDown","_onMove","_onUp","_remove","_calcPosition","movementX","movementY","_position","_removeDuplicates","dragging","roundRect","beginPath","arcTo","closePath","fontHeightCache","createNewTexture","orbitCtl","tap","messages","getParent","clearObjects","updateEvents","currentPosition","isDown","_objects","isTransparent","pixelPerfect","getPixel","imagedata","transformUv","imageData","removeIndex","findIndex","SimpleSprite","Sprite","SpriteMaterial","_event","_pixelPerfect","_isInteractive","_depth","_bodyOffset","_internalScale","_pixelRatio","onInputOver","onInputOut","onInputDown","_setTexture","setScale","setDepth","_calcZ","_onInputOver","_onInputOut","_onInputDown","setPixelRatio","pixelRatio","setInteractive","addEventListeners","setTexture","getBodyOffset","getScale","getPixelRatio","xx","yy","ActionSprite","_anims","_flipX","_frame","_currentIndex","_currentAnimationName","getAnimationByName","_play","stop","_stop","getName","frameOptions","rate","timeline","clearInterval","loops","playNextFrame","setFrame","setInterval","onComplete","_eventEmitter","SpriteSheet","_tilesHoriz","_tilesVert","_width","_height","sizeFrame","scaleFrame","getRow","getColumn","offsetTexture","flipX","Button","overFrame","outFrame","downFrame","DrawTexture","drawCanvas","clearRect","DrawSprite","_drawCanvas","initEvents","setOrbitControls","setParent","TextTexture","styles","createTextImage","_text","_styles","_image","getText","getStyles","TextSprite","setStyles","setText","_update","align","baseline","borderColor","borderWidth","fillStyle","lineHeight","lineWidth","strokeStyle","offsetX","offsetY","paddingX","paddingY","lines","line_height","whiteSpace","offsetHeight","removeChild","calcHeight","line_width","measureText","calcWidth","stroke","textBaseline","strokeText","fillText","TextureAtlas","atlas","positionOffset","JSONHash","getFrame","frameName","newOffX","newOffY","sizeX","sizeY","debugSettings","dynamic","static","sensor","sleeping","adjustDebugColor","_fill","_stroke","isStatic","isSensor","isSleeping","getDebugColors","shouldFill","parts","part","Physics","debug","DEBUG","engine","Engine","enableSleeping","runner","Runner","pointerEvents","Render","wireframeBackground","wireframes","showConvexHulls","showPositions","showVelocity","World","parsePhysics","fixtures","addBodyFromFixtures","fixture","fromVertices","circle","Body","fromVertices_Fixed","vertexSets","Bodies","centre","setBounds","rectangle","sprite","bodyToSprite","calcBodyOffset","topLeft","_addBodyToSprite","circleRadius","scaleCircle_Fix","scaleBody_Fix","setBodyPosition","_addBody","JoyStick","addAxis","addButton","thumb","maxRadius","rotationDamping","moveDamping","maxRadiusSquared","offsetLeft","offsetTop","evt","stopPropagation","onMove","letter","click","onClick","onRelease","css","getMousePosition","ontouchmove","ontouchend","onmousemove","onmouseup","_evt","sqMag","magnitude","turn","touchend","targetTouches","ThirdPersonControls","sensitivity","targetRadius","interpolationFactor","maxPhi","minPhi","FirstPersonControls","PointerLock","_element","autoLock","_isRunning","removeListeners","pointerLockChangeHandler","pointerDownHandlerHandler","_request","PointerDrag","autoStart","_onMoveCallback","_isPointerDown","isTouchDevice","onTouchEnd","onPointerLeave","onPointerOver","onMoveCallback","CopyShader","Pass","needsSwap","renderToScreen","_geometry","FullScreenQuad","_mesh","ShaderPass","textureID","fsQuad","writeBuffer","readBuffer","autoClearColor","autoClearDepth","autoClearStencil","MaskPass","writeValue","clearValue","setLocked","setTest","setOp","REPLACE","setFunc","ALWAYS","setClear","EQUAL","KEEP","ClearMaskPass","EffectComposer","RGBAFormat","getSize","renderTarget1","renderTarget2","passes","copyPass","swapBuffers","addPass","pass","insertPass","removePass","isLastEnabledPass","passIndex","maskActive","NOTEQUAL","effectiveWidth","effectiveHeight","RenderPass","overrideMaterial","clearColor","clearAlpha","clearDepth","_oldClearColor","oldAutoClear","oldClearAlpha","oldOverrideMaterial","getClearColor","getClearAlpha","setClearColor","DigitalGlitch","GlitchPass","dt_size","generateHeightmap","goWild","curF","generateTrigger","randX","data_arr","DataTexture","FloatType","DotScreenShader"],"sourceRoot":""}